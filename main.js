/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var on=Object.defineProperty;var ji=Object.getOwnPropertyDescriptor;var qi=Object.getOwnPropertyNames;var Ki=Object.prototype.hasOwnProperty;var x=(r,t)=>()=>(r&&(t=r(r=0)),t);var Ht=(r,t)=>{for(var e in t)on(r,e,{get:t[e],enumerable:!0})},Vi=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of qi(t))!Ki.call(r,n)&&n!==e&&on(r,n,{get:()=>t[n],enumerable:!(s=ji(t,n))||s.enumerable});return r};var zi=r=>Vi(on({},"__esModule",{value:!0}),r);function an(r){let t=new Date().toISOString().replace("T"," ").substring(0,19);return{title:r.title||"Unknown Title",subtitle:r.subtitle,author:r.author||[],isbn10:r.isbn10,isbn13:r.isbn13,publisher:r.publisher,publishDate:r.publishDate,totalPages:r.totalPages,coverUrl:r.coverUrl,category:r.category||[],coverEditionKey:r.coverEditionKey,status:r.status||"unread",readPage:r.readPage||0,readStarted:r.readStarted,readFinished:r.readFinished,created:r.created||t,updated:r.updated||t}}var pr=x(()=>{});var hr,Jt,mr=x(()=>{hr=require("obsidian"),Jt=class{constructor(t=5e3){this.timeout=t}async get(t){try{let e=await(0,hr.requestUrl)({url:t,method:"GET",throw:!1});if(e.status>=400)throw new Error(`Request failed with status ${e.status}`);return e.json}catch(e){throw new Error("Request failed. Please try again later.")}}}});var Wt,gr=x(()=>{pr();mr();Wt=class{constructor(t=5e3){this.baseUrl="https://openlibrary.org";this.httpClient=new Jt(t)}async searchBooks(t,e=20,s=0){try{let n=encodeURIComponent(t),i=`${this.baseUrl}/search.json?q=${n}&limit=${e}&offset=${s}`,o=await this.httpClient.get(i);return this.convertSearchDocsToBooks(o.docs)}catch(n){throw new Error("Failed to search books. Please try again later.")}}async getBookByOLID(t){try{let e=`${this.baseUrl}/books/${t}.json`,s=await this.httpClient.get(e),n=await this.fetchWorkDetails(s);return this.convertEditionToBook(s,n)}catch(e){return console.error("[OpenLibrary] Error fetching book by OLID:",e),null}}async fetchWorkDetails(t){if(!t.works||t.works.length===0)return null;let e=t.works[0];if(!(e!=null&&e.key))return null;try{let s=`${this.baseUrl}${e.key}.json`;return await this.httpClient.get(s)}catch(s){return null}}getBookCover(t,e="M"){let s={S:"-S",M:"-M",L:"-L"};return typeof t=="number"?`https://covers.openlibrary.org/b/id/${t}${s[e]}.jpg`:`https://covers.openlibrary.org/b/isbn/${t}${s[e]}.jpg`}convertEditionToBook(t,e,s){var c,d,u,p,h,g,f;let n=this.extractAuthors(t),i=((c=t.isbn_10)==null?void 0:c[0])||(s&&s.length===10?s:void 0),o=((d=t.isbn_13)==null?void 0:d[0])||(s&&s.length===13?s:void 0),a=this.extractCoverUrl(t,o,i),l=(u=t.number_of_pages)!=null?u:e==null?void 0:e.number_of_pages;return an({title:t.title||(e==null?void 0:e.title)||"",subtitle:t.subtitle||(e==null?void 0:e.subtitle),author:n,isbn10:i,isbn13:o,publisher:((p=t.publishers)==null?void 0:p[0])||((h=e==null?void 0:e.publishers)==null?void 0:h[0]),publishDate:t.publish_date||(e==null?void 0:e.publish_date),totalPages:l,coverUrl:a,category:((g=t.subjects)==null?void 0:g.slice(0,5))||((f=e==null?void 0:e.subjects)==null?void 0:f.slice(0,5))||[]})}extractAuthors(t){return!t.authors||!Array.isArray(t.authors)?[]:t.authors.map(e=>e.name||"").filter(e=>e.length>0)}extractCoverUrl(t,e,s){if(t.covers&&t.covers.length>0&&t.covers[0]!==void 0)return this.getBookCover(t.covers[0],"M");if(e)return this.getBookCover(e,"M");if(s)return this.getBookCover(s,"M")}convertSearchDocToBook(t){var a,l,c,d,u;let e=t.author_name||[],s=t.cover_i?this.getBookCover(t.cover_i,"M"):void 0,n=t.first_publish_year||((a=t.publish_year)==null?void 0:a[0]),i=n?n.toString():(l=t.publish_date)==null?void 0:l[0],o=(c=t.number_of_pages_median)!=null?c:t.number_of_pages;return an({title:t.title,subtitle:t.subtitle,author:e,isbn10:void 0,isbn13:void 0,publisher:(d=t.publisher)==null?void 0:d[0],publishDate:i,totalPages:o,coverUrl:s,category:(u=t.subject)==null?void 0:u.slice(0,5),coverEditionKey:t.cover_edition_key})}convertSearchDocsToBooks(t){return t.map(e=>this.convertSearchDocToBook(e))}}});var Gt,Ke,ln=x(()=>{Gt=require("obsidian"),Ke=class{constructor(t){this.app=t}async ensureFolder(t){let e=(0,Gt.normalizePath)(t),s=this.app.vault.getAbstractFileByPath(e);if(!s)await this.app.vault.createFolder(e);else if(!(s instanceof Gt.TFolder))throw new Error(`Path exists but is not a folder: ${e}`)}}});var Ve,cn=x(()=>{Ve=class{static generate(t){let e=t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim(),s=100;return(e.length>s?e.substring(0,s).trim():e)||"Untitled Book"}}});var Qt,Y,Xt=x(()=>{Qt=require("obsidian"),Y=class{static getBooksFolderPath(t){return(0,Qt.normalizePath)(`${t}/Books`)}static getInteractionFolderPath(t){return(0,Qt.normalizePath)(`${t}/.bookshelf`)}static getViewsFolderPath(t){return(0,Qt.normalizePath)(`${t}/Views`)}}});var yr={};Ht(yr,{formatDate:()=>ft,getCurrentDate:()=>Yi,getCurrentDateTime:()=>J,getTimezoneOffset:()=>Hi,setTimezoneOffset:()=>Zt});function Zt(r){dn=r}function Hi(){return dn}function ft(r,t="YYYY-MM-DD HH:mm:ss"){let e=typeof r=="string"?new Date(r):r,s=e.getTime()+e.getTimezoneOffset()*6e4,n=new Date(s+dn*36e5),i=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0"),c=String(n.getMinutes()).padStart(2,"0"),d=String(n.getSeconds()).padStart(2,"0");return t.replace(/YYYY/g,String(i)).replace(/MM/g,o).replace(/DD/g,a).replace(/HH/g,l).replace(/mm/g,c).replace(/ss/g,d)}function J(){return ft(new Date,"YYYY-MM-DD HH:mm:ss")}function Yi(){return ft(new Date,"YYYY-MM-DD")}var dn,Re=x(()=>{dn=0});var be,es=x(()=>{Re();be=class r{static bookToFrontmatter(t){let e=J(),s=t.created||e,n={title:t.title||"",subtitle:t.subtitle||"",author:t.author||[],category:t.category||[],publisher:t.publisher||"",publish:t.publishDate||"",isbn:"",cover:t.coverUrl||"",total:0,status:t.status||"unread",read_page:t.readPage||0,read_started:t.readStarted!==void 0?t.readStarted:s,read_finished:t.readFinished||null,created:s,updated:t.updated||e};t.totalPages!==void 0&&t.totalPages!==null&&!isNaN(t.totalPages)&&(n.total=t.totalPages);let i=`${t.isbn10||""} ${t.isbn13||""}`.trim();return i&&(n.isbn=i),n}static frontmatterToBook(t){let{isbn10:e,isbn13:s}=r.extractIsbn(t.isbn),n=r.calculateReadPage(t),i=t.status,o=i==="unread"||i==="reading"||i==="finished"?i:"unread";return{title:t.title||"",subtitle:t.subtitle,author:Array.isArray(t.author)?t.author:[],category:Array.isArray(t.category)?t.category:[],publisher:t.publisher,publishDate:t.publish,totalPages:typeof t.total=="number"?t.total:void 0,isbn10:e,isbn13:s,coverUrl:t.cover,status:o,readPage:n,readStarted:t.read_started,readFinished:t.read_finished!==null?t.read_finished:void 0,created:t.created||J(),updated:t.updated||J()}}static extractIsbn(t){let e,s;if(t){let n=String(t).trim().split(/\s+/);for(let i of n)i.length===10?e=i:i.length===13&&(s=i)}return{isbn10:e,isbn13:s}}static calculateReadPage(t){let e=typeof t.read_page=="number"?t.read_page:0;if(t.reading_history_summary&&Array.isArray(t.reading_history_summary)){let s=t.reading_history_summary.reduce((n,i)=>n+(i.pagesRead||0),0);s>e&&(e=s)}return e}}});function D(r){if(r&&typeof r=="object")switch(r[H]){case Z:case ke:return!0}return!1}function N(r){if(r&&typeof r=="object")switch(r[H]){case ts:case Z:case G:case ke:return!0}return!1}var ts,ss,Z,fn,G,ke,H,Q,ee,te,P,A,se,ns,L=x(()=>{ts=Symbol.for("yaml.alias"),ss=Symbol.for("yaml.document"),Z=Symbol.for("yaml.map"),fn=Symbol.for("yaml.pair"),G=Symbol.for("yaml.scalar"),ke=Symbol.for("yaml.seq"),H=Symbol.for("yaml.node.type"),Q=r=>!!r&&typeof r=="object"&&r[H]===ts,ee=r=>!!r&&typeof r=="object"&&r[H]===ss,te=r=>!!r&&typeof r=="object"&&r[H]===Z,P=r=>!!r&&typeof r=="object"&&r[H]===fn,A=r=>!!r&&typeof r=="object"&&r[H]===G,se=r=>!!r&&typeof r=="object"&&r[H]===ke;ns=r=>(A(r)||D(r))&&!!r.anchor});function de(r,t){let e=kr(t);ee(r)?ze(null,r.contents,e,Object.freeze([r]))===ce&&(r.contents=null):ze(null,r,e,Object.freeze([]))}function ze(r,t,e,s){let n=wr(r,t,e,s);if(N(n)||P(n))return vr(r,s,n),ze(r,n,e,s);if(typeof n!="symbol"){if(D(t)){s=Object.freeze(s.concat(t));for(let i=0;i<t.items.length;++i){let o=ze(i,t.items[i],e,s);if(typeof o=="number")i=o-1;else{if(o===W)return W;o===ce&&(t.items.splice(i,1),i-=1)}}}else if(P(t)){s=Object.freeze(s.concat(t));let i=ze("key",t.key,e,s);if(i===W)return W;i===ce&&(t.key=null);let o=ze("value",t.value,e,s);if(o===W)return W;o===ce&&(t.value=null)}}return n}async function rs(r,t){let e=kr(t);ee(r)?await He(null,r.contents,e,Object.freeze([r]))===ce&&(r.contents=null):await He(null,r,e,Object.freeze([]))}async function He(r,t,e,s){let n=await wr(r,t,e,s);if(N(n)||P(n))return vr(r,s,n),He(r,n,e,s);if(typeof n!="symbol"){if(D(t)){s=Object.freeze(s.concat(t));for(let i=0;i<t.items.length;++i){let o=await He(i,t.items[i],e,s);if(typeof o=="number")i=o-1;else{if(o===W)return W;o===ce&&(t.items.splice(i,1),i-=1)}}}else if(P(t)){s=Object.freeze(s.concat(t));let i=await He("key",t.key,e,s);if(i===W)return W;i===ce&&(t.key=null);let o=await He("value",t.value,e,s);if(o===W)return W;o===ce&&(t.value=null)}}return n}function kr(r){return typeof r=="object"&&(r.Collection||r.Node||r.Value)?Object.assign({Alias:r.Node,Map:r.Node,Scalar:r.Node,Seq:r.Node},r.Value&&{Map:r.Value,Scalar:r.Value,Seq:r.Value},r.Collection&&{Map:r.Collection,Seq:r.Collection},r):r}function wr(r,t,e,s){var n,i,o,a,l;if(typeof e=="function")return e(r,t,s);if(te(t))return(n=e.Map)==null?void 0:n.call(e,r,t,s);if(se(t))return(i=e.Seq)==null?void 0:i.call(e,r,t,s);if(P(t))return(o=e.Pair)==null?void 0:o.call(e,r,t,s);if(A(t))return(a=e.Scalar)==null?void 0:a.call(e,r,t,s);if(Q(t))return(l=e.Alias)==null?void 0:l.call(e,r,t,s)}function vr(r,t,e){let s=t[t.length-1];if(D(s))s.items[r]=e;else if(P(s))r==="key"?s.key=e:s.value=e;else if(ee(s))s.contents=e;else{let n=Q(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${n} parent`)}}var W,br,ce,ut=x(()=>{L();W=Symbol("break visit"),br=Symbol("skip children"),ce=Symbol("remove node");de.BREAK=W;de.SKIP=br;de.REMOVE=ce;rs.BREAK=W;rs.SKIP=br;rs.REMOVE=ce});var Ji,Wi,fe,un=x(()=>{L();ut();Ji={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},Wi=r=>r.replace(/[!,[\]{}]/g,t=>Ji[t]),fe=class r{constructor(t,e){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},r.defaultYaml,t),this.tags=Object.assign({},r.defaultTags,e)}clone(){let t=new r(this.yaml,this.tags);return t.docStart=this.docStart,t}atDocument(){let t=new r(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:r.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},r.defaultTags);break}return t}add(t,e){this.atNextDocument&&(this.yaml={explicit:r.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},r.defaultTags),this.atNextDocument=!1);let s=t.trim().split(/[ \t]+/),n=s.shift();switch(n){case"%TAG":{if(s.length!==2&&(e(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;let[i,o]=s;return this.tags[i]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return e(0,"%YAML directive should contain exactly one part"),!1;let[i]=s;if(i==="1.1"||i==="1.2")return this.yaml.version=i,!0;{let o=/^\d+\.\d+$/.test(i);return e(6,`Unsupported YAML version ${i}`,o),!1}}default:return e(0,`Unknown directive ${n}`,!0),!1}}tagName(t,e){if(t==="!")return"!";if(t[0]!=="!")return e(`Not a valid tag: ${t}`),null;if(t[1]==="<"){let o=t.slice(2,-1);return o==="!"||o==="!!"?(e(`Verbatim tags aren't resolved, so ${t} is invalid.`),null):(t[t.length-1]!==">"&&e("Verbatim tags must end with a >"),o)}let[,s,n]=t.match(/^(.*!)([^!]*)$/s);n||e(`The ${t} tag has no suffix`);let i=this.tags[s];if(i)try{return i+decodeURIComponent(n)}catch(o){return e(String(o)),null}return s==="!"?t:(e(`Could not resolve tag: ${t}`),null)}tagString(t){for(let[e,s]of Object.entries(this.tags))if(t.startsWith(s))return e+Wi(t.substring(s.length));return t[0]==="!"?t:`!<${t}>`}toString(t){let e=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags),n;if(t&&s.length>0&&N(t.contents)){let i={};de(t.contents,(o,a)=>{N(a)&&a.tag&&(i[a.tag]=!0)}),n=Object.keys(i)}else n=[];for(let[i,o]of s)i==="!!"&&o==="tag:yaml.org,2002:"||(!t||n.some(a=>a.startsWith(o)))&&e.push(`%TAG ${i} ${o}`);return e.join(`
`)}};fe.defaultYaml={explicit:!1,version:"1.2"};fe.defaultTags={"!!":"tag:yaml.org,2002:"}});function is(r){if(/[\x00-\x19\s,[\]{}]/.test(r)){let e=`Anchor must not contain whitespace or control characters: ${JSON.stringify(r)}`;throw new Error(e)}return!0}function pn(r){let t=new Set;return de(r,{Value(e,s){s.anchor&&t.add(s.anchor)}}),t}function hn(r,t){for(let e=1;;++e){let s=`${r}${e}`;if(!t.has(s))return s}}function xr(r,t){let e=[],s=new Map,n=null;return{onAnchor:i=>{e.push(i),n!=null||(n=pn(r));let o=hn(t,n);return n.add(o),o},setAnchors:()=>{for(let i of e){let o=s.get(i);if(typeof o=="object"&&o.anchor&&(A(o.node)||D(o.node)))o.node.anchor=o.anchor;else{let a=new Error("Failed to resolve repeated object (this should not happen)");throw a.source=i,a}}},sourceObjects:s}}var os=x(()=>{L();ut()});function Ce(r,t,e,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let n=0,i=s.length;n<i;++n){let o=s[n],a=Ce(r,s,String(n),o);a===void 0?delete s[n]:a!==o&&(s[n]=a)}else if(s instanceof Map)for(let n of Array.from(s.keys())){let i=s.get(n),o=Ce(r,s,n,i);o===void 0?s.delete(n):o!==i&&s.set(n,o)}else if(s instanceof Set)for(let n of Array.from(s)){let i=Ce(r,s,n,n);i===void 0?s.delete(n):i!==n&&(s.delete(n),s.add(i))}else for(let[n,i]of Object.entries(s)){let o=Ce(r,s,n,i);o===void 0?delete s[n]:o!==i&&(s[n]=o)}return r.call(t,e,s)}var mn=x(()=>{});function U(r,t,e){if(Array.isArray(r))return r.map((s,n)=>U(s,String(n),e));if(r&&typeof r.toJSON=="function"){if(!e||!ns(r))return r.toJSON(t,e);let s={aliasCount:0,count:1,res:void 0};e.anchors.set(r,s),e.onCreate=i=>{s.res=i,delete e.onCreate};let n=r.toJSON(t,e);return e.onCreate&&e.onCreate(n),n}return typeof r=="bigint"&&!(e!=null&&e.keep)?Number(r):r}var Be=x(()=>{L()});var Ae,as=x(()=>{mn();L();Be();Ae=class{constructor(t){Object.defineProperty(this,H,{value:t})}clone(){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(t.range=this.range.slice()),t}toJS(t,{mapAsMap:e,maxAliasCount:s,onAnchor:n,reviver:i}={}){if(!ee(t))throw new TypeError("A document argument is required");let o={anchors:new Map,doc:t,keep:!0,mapAsMap:e===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},a=U(this,"",o);if(typeof n=="function")for(let{count:l,res:c}of o.anchors.values())n(c,l);return typeof i=="function"?Ce(i,{"":a},"",a):a}}});function ls(r,t,e){if(Q(t)){let s=t.resolve(r),n=e&&s&&e.get(s);return n?n.count*n.aliasCount:0}else if(D(t)){let s=0;for(let n of t.items){let i=ls(r,n,e);i>s&&(s=i)}return s}else if(P(t)){let s=ls(r,t.key,e),n=ls(r,t.value,e);return Math.max(s,n)}return 1}var we,pt=x(()=>{os();ut();L();as();Be();we=class extends Ae{constructor(t){super(ts),this.source=t,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(t,e){let s;e!=null&&e.aliasResolveCache?s=e.aliasResolveCache:(s=[],de(t,{Node:(i,o)=>{(Q(o)||ns(o))&&s.push(o)}}),e&&(e.aliasResolveCache=s));let n;for(let i of s){if(i===this)break;i.anchor===this.source&&(n=i)}return n}toJSON(t,e){if(!e)return{source:this.source};let{anchors:s,doc:n,maxAliasCount:i}=e,o=this.resolve(n,e);if(!o){let l=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(l)}let a=s.get(o);if(a||(U(o,null,e),a=s.get(o)),(a==null?void 0:a.res)===void 0){let l="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(l)}if(i>=0&&(a.count+=1,a.aliasCount===0&&(a.aliasCount=ls(n,o,s)),a.count*a.aliasCount>i)){let l="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(l)}return a.res}toString(t,e,s){let n=`*${this.source}`;if(t){if(is(this.source),t.options.verifyAliasOrder&&!t.anchors.has(this.source)){let i=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(i)}if(t.implicitKey)return`${n} `}return n}}});var cs,E,_=x(()=>{L();as();Be();cs=r=>!r||typeof r!="function"&&typeof r!="object",E=class extends Ae{constructor(t){super(G),this.value=t}toJSON(t,e){return e!=null&&e.keep?this.value:U(this.value,t,e)}toString(){return String(this.value)}};E.BLOCK_FOLDED="BLOCK_FOLDED";E.BLOCK_LITERAL="BLOCK_LITERAL";E.PLAIN="PLAIN";E.QUOTE_DOUBLE="QUOTE_DOUBLE";E.QUOTE_SINGLE="QUOTE_SINGLE"});function Qi(r,t,e){var s;if(t){let n=e.filter(o=>o.tag===t),i=(s=n.find(o=>!o.format))!=null?s:n[0];if(!i)throw new Error(`Tag ${t} not found`);return i}return e.find(n=>{var i;return((i=n.identify)==null?void 0:i.call(n,r))&&!n.format})}function ve(r,t,e){var u,p,h,g;if(ee(r)&&(r=r.contents),N(r))return r;if(P(r)){let f=(p=(u=e.schema[Z]).createNode)==null?void 0:p.call(u,e.schema,null,e);return f.items.push(r),f}(r instanceof String||r instanceof Number||r instanceof Boolean||typeof BigInt!="undefined"&&r instanceof BigInt)&&(r=r.valueOf());let{aliasDuplicateObjects:s,onAnchor:n,onTagObj:i,schema:o,sourceObjects:a}=e,l;if(s&&r&&typeof r=="object"){if(l=a.get(r),l)return(h=l.anchor)!=null||(l.anchor=n(r)),new we(l.anchor);l={anchor:null,node:null},a.set(r,l)}t!=null&&t.startsWith("!!")&&(t=Gi+t.slice(2));let c=Qi(r,t,o.tags);if(!c){if(r&&typeof r.toJSON=="function"&&(r=r.toJSON()),!r||typeof r!="object"){let f=new E(r);return l&&(l.node=f),f}c=r instanceof Map?o[Z]:Symbol.iterator in Object(r)?o[ke]:o[Z]}i&&(i(c),delete e.onTagObj);let d=c!=null&&c.createNode?c.createNode(e.schema,r,e):typeof((g=c==null?void 0:c.nodeClass)==null?void 0:g.from)=="function"?c.nodeClass.from(e.schema,r,e):new E(r);return t?d.tag=t:c.default||(d.tag=c.tag),l&&(l.node=d),d}var Gi,ht=x(()=>{pt();L();_();Gi="tag:yaml.org,2002:"});function mt(r,t,e){let s=e;for(let n=t.length-1;n>=0;--n){let i=t[n];if(typeof i=="number"&&Number.isInteger(i)&&i>=0){let o=[];o[i]=s,s=o}else s=new Map([[i,s]])}return ve(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:r,sourceObjects:new Map})}var Je,Ye,ds=x(()=>{ht();L();as();Je=r=>r==null||typeof r=="object"&&!!r[Symbol.iterator]().next().done,Ye=class extends Ae{constructor(t,e){super(t),Object.defineProperty(this,"schema",{value:e,configurable:!0,enumerable:!1,writable:!0})}clone(t){let e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return t&&(e.schema=t),e.items=e.items.map(s=>N(s)||P(s)?s.clone(t):s),this.range&&(e.range=this.range.slice()),e}addIn(t,e){if(Je(t))this.add(e);else{let[s,...n]=t,i=this.get(s,!0);if(D(i))i.addIn(n,e);else if(i===void 0&&this.schema)this.set(s,mt(this.schema,n,e));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}deleteIn(t){let[e,...s]=t;if(s.length===0)return this.delete(e);let n=this.get(e,!0);if(D(n))return n.deleteIn(s);throw new Error(`Expected YAML collection at ${e}. Remaining path: ${s}`)}getIn(t,e){let[s,...n]=t,i=this.get(s,!0);return n.length===0?!e&&A(i)?i.value:i:D(i)?i.getIn(n,e):void 0}hasAllNullValues(t){return this.items.every(e=>{if(!P(e))return!1;let s=e.value;return s==null||t&&A(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(t){let[e,...s]=t;if(s.length===0)return this.has(e);let n=this.get(e,!0);return D(n)?n.hasIn(s):!1}setIn(t,e){let[s,...n]=t;if(n.length===0)this.set(s,e);else{let i=this.get(s,!0);if(D(i))i.setIn(n,e);else if(i===void 0&&this.schema)this.set(s,mt(this.schema,n,e));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}}});function X(r,t){return/^\n+$/.test(r)?r.substring(1):t?r.replace(/^(?! *$)/gm,t):r}var Sr,ue,gt=x(()=>{Sr=r=>r.replace(/^(?!$)(?: $)?/gm,"#");ue=(r,t,e)=>r.endsWith(`
`)?X(e,t):e.includes(`
`)?`
`+X(e,t):(r.endsWith(" ")?"":" ")+e});function bt(r,t,e="flow",{indentAtStart:s,lineWidth:n=80,minContentWidth:i=20,onFold:o,onOverflow:a}={}){if(!n||n<0)return r;n<i&&(i=0);let l=Math.max(1+i,1+n-t.length);if(r.length<=l)return r;let c=[],d={},u=n-t.length;typeof s=="number"&&(s>n-Math.max(2,i)?c.push(0):u=n-s);let p,h,g=!1,f=-1,m=-1,b=-1;e===fs&&(f=Er(r,f,t.length),f!==-1&&(u=f+l));for(let k;k=r[f+=1];){if(e===yt&&k==="\\"){switch(m=f,r[f+1]){case"x":f+=3;break;case"u":f+=5;break;case"U":f+=9;break;default:f+=1}b=f}if(k===`
`)e===fs&&(f=Er(r,f,t.length)),u=f+t.length+l,p=void 0;else{if(k===" "&&h&&h!==" "&&h!==`
`&&h!=="	"){let v=r[f+1];v&&v!==" "&&v!==`
`&&v!=="	"&&(p=f)}if(f>=u)if(p)c.push(p),u=p+l,p=void 0;else if(e===yt){for(;h===" "||h==="	";)h=k,k=r[f+=1],g=!0;let v=f>b+1?f-2:m-1;if(d[v])return r;c.push(v),d[v]=!0,u=v+l,p=void 0}else g=!0}h=k}if(g&&a&&a(),c.length===0)return r;o&&o();let y=r.slice(0,c[0]);for(let k=0;k<c.length;++k){let v=c[k],w=c[k+1]||r.length;v===0?y=`
${t}${r.slice(0,w)}`:(e===yt&&d[v]&&(y+=`${r[v]}\\`),y+=`
${t}${r.slice(v+1,w)}`)}return y}function Er(r,t,e){let s=t,n=t+1,i=r[n];for(;i===" "||i==="	";)if(t<n+e)i=r[++t];else{do i=r[++t];while(i&&i!==`
`);s=t,n=t+1,i=r[n]}return s}var gn,fs,yt,Tr=x(()=>{gn="flow",fs="block",yt="quoted"});function Xi(r,t,e){if(!t||t<0)return!1;let s=t-e,n=r.length;if(n<=s)return!1;for(let i=0,o=0;i<n;++i)if(r[i]===`
`){if(i-o>s)return!0;if(o=i+1,n-o<=s)return!1}return!0}function kt(r,t){let e=JSON.stringify(r);if(t.options.doubleQuotedAsJSON)return e;let{implicitKey:s}=t,n=t.options.doubleQuotedMinMultiLineLength,i=t.indent||(hs(r)?"  ":""),o="",a=0;for(let l=0,c=e[l];c;c=e[++l])if(c===" "&&e[l+1]==="\\"&&e[l+2]==="n"&&(o+=e.slice(a,l)+"\\ ",l+=1,a=l,c="\\"),c==="\\")switch(e[l+1]){case"u":{o+=e.slice(a,l);let d=e.substr(l+2,4);switch(d){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:d.substr(0,2)==="00"?o+="\\x"+d.substr(2):o+=e.substr(l,6)}l+=5,a=l+1}break;case"n":if(s||e[l+2]==='"'||e.length<n)l+=1;else{for(o+=e.slice(a,l)+`

`;e[l+2]==="\\"&&e[l+3]==="n"&&e[l+4]!=='"';)o+=`
`,l+=2;o+=i,e[l+2]===" "&&(o+="\\"),l+=1,a=l+1}break;default:l+=1}return o=a?o+e.slice(a):e,s?o:bt(o,i,yt,ps(t,!1))}function yn(r,t){if(t.options.singleQuote===!1||t.implicitKey&&r.includes(`
`)||/[ \t]\n|\n[ \t]/.test(r))return kt(r,t);let e=t.indent||(hs(r)?"  ":""),s="'"+r.replace(/'/g,"''").replace(/\n+/g,`$&
${e}`)+"'";return t.implicitKey?s:bt(s,e,gn,ps(t,!1))}function We(r,t){let{singleQuote:e}=t.options,s;if(e===!1)s=kt;else{let n=r.includes('"'),i=r.includes("'");n&&!i?s=yn:i&&!n?s=kt:s=e?yn:kt}return s(r,t)}function us({comment:r,type:t,value:e},s,n,i){let{blockQuote:o,commentString:a,lineWidth:l}=s.options;if(!o||/\n[\t ]+$/.test(e))return We(e,s);let c=s.indent||(s.forceBlockIndent||hs(e)?"  ":""),d=o==="literal"?!0:o==="folded"||t===E.BLOCK_FOLDED?!1:t===E.BLOCK_LITERAL?!0:!Xi(e,l,c.length);if(!e)return d?`|
`:`>
`;let u,p;for(p=e.length;p>0;--p){let w=e[p-1];if(w!==`
`&&w!=="	"&&w!==" ")break}let h=e.substring(p),g=h.indexOf(`
`);g===-1?u="-":e===h||g!==h.length-1?(u="+",i&&i()):u="",h&&(e=e.slice(0,-h.length),h[h.length-1]===`
`&&(h=h.slice(0,-1)),h=h.replace(bn,`$&${c}`));let f=!1,m,b=-1;for(m=0;m<e.length;++m){let w=e[m];if(w===" ")f=!0;else if(w===`
`)b=m;else break}let y=e.substring(0,b<m?b+1:m);y&&(e=e.substring(y.length),y=y.replace(/\n+/g,`$&${c}`));let v=(f?c?"2":"1":"")+u;if(r&&(v+=" "+a(r.replace(/ ?[\r\n]+/g," ")),n&&n()),!d){let w=e.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`),T=!1,B=ps(s,!0);o!=="folded"&&t!==E.BLOCK_FOLDED&&(B.onOverflow=()=>{T=!0});let S=bt(`${y}${w}${h}`,c,fs,B);if(!T)return`>${v}
${c}${S}`}return e=e.replace(/\n+/g,`$&${c}`),`|${v}
${c}${y}${e}${h}`}function Zi(r,t,e,s){let{type:n,value:i}=r,{actualString:o,implicitKey:a,indent:l,indentStep:c,inFlow:d}=t;if(a&&i.includes(`
`)||d&&/[[\]{},]/.test(i))return We(i,t);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(i))return a||d||!i.includes(`
`)?We(i,t):us(r,t,e,s);if(!a&&!d&&n!==E.PLAIN&&i.includes(`
`))return us(r,t,e,s);if(hs(i)){if(l==="")return t.forceBlockIndent=!0,us(r,t,e,s);if(a&&l===c)return We(i,t)}let u=i.replace(/\n+/g,`$&
${l}`);if(o){let p=f=>{var m;return f.default&&f.tag!=="tag:yaml.org,2002:str"&&((m=f.test)==null?void 0:m.test(u))},{compat:h,tags:g}=t.doc.schema;if(g.some(p)||h!=null&&h.some(p))return We(i,t)}return a?u:bt(u,l,gn,ps(t,!1))}function _e(r,t,e,s){let{implicitKey:n,inFlow:i}=t,o=typeof r.value=="string"?r:Object.assign({},r,{value:String(r.value)}),{type:a}=r;a!==E.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(a=E.QUOTE_DOUBLE);let l=d=>{switch(d){case E.BLOCK_FOLDED:case E.BLOCK_LITERAL:return n||i?We(o.value,t):us(o,t,e,s);case E.QUOTE_DOUBLE:return kt(o.value,t);case E.QUOTE_SINGLE:return yn(o.value,t);case E.PLAIN:return Zi(o,t,e,s);default:return null}},c=l(a);if(c===null){let{defaultKeyType:d,defaultStringType:u}=t.options,p=n&&d||u;if(c=l(p),c===null)throw new Error(`Unsupported default string type ${p}`)}return c}var ps,hs,bn,wt=x(()=>{_();Tr();ps=(r,t)=>({indentAtStart:t?r.indent.length:r.indentAtStart,lineWidth:r.options.lineWidth,minContentWidth:r.options.minContentWidth}),hs=r=>/^(%|---|\.\.\.)/m.test(r);try{bn=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch(r){bn=/\n+(?!\n|$)/g}});function ms(r,t){let e=Object.assign({blockQuote:!0,commentString:Sr,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},r.schema.toStringOptions,t),s;switch(e.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:r,flowCollectionPadding:e.flowCollectionPadding?" ":"",indent:"",indentStep:typeof e.indent=="number"?" ".repeat(e.indent):"  ",inFlow:s,options:e}}function eo(r,t){var n,i,o,a;if(t.tag){let l=r.filter(c=>c.tag===t.tag);if(l.length>0)return(n=l.find(c=>c.format===t.format))!=null?n:l[0]}let e,s;if(A(t)){s=t.value;let l=r.filter(c=>{var d;return(d=c.identify)==null?void 0:d.call(c,s)});if(l.length>1){let c=l.filter(d=>d.test);c.length>0&&(l=c)}e=(i=l.find(c=>c.format===t.format))!=null?i:l.find(c=>!c.format)}else s=t,e=r.find(l=>l.nodeClass&&s instanceof l.nodeClass);if(!e){let l=(a=(o=s==null?void 0:s.constructor)==null?void 0:o.name)!=null?a:s===null?"null":typeof s;throw new Error(`Tag not resolved for ${l} value`)}return e}function to(r,t,{anchors:e,doc:s}){var a;if(!s.directives)return"";let n=[],i=(A(r)||D(r))&&r.anchor;i&&is(i)&&(e.add(i),n.push(`&${i}`));let o=(a=r.tag)!=null?a:t.default?null:t.tag;return o&&n.push(s.directives.tagString(o)),n.join(" ")}function xe(r,t,e,s){var l,c;if(P(r))return r.toString(t,e,s);if(Q(r)){if(t.doc.directives)return r.toString(t);if((l=t.resolvedAliases)!=null&&l.has(r))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(r):t.resolvedAliases=new Set([r]),r=r.resolve(t.doc)}let n,i=N(r)?r:t.doc.createNode(r,{onTagObj:d=>n=d});n!=null||(n=eo(t.doc.schema.tags,i));let o=to(i,n,t);o.length>0&&(t.indentAtStart=((c=t.indentAtStart)!=null?c:0)+o.length+1);let a=typeof n.stringify=="function"?n.stringify(i,t,e,s):A(i)?_e(i,t,e,s):i.toString(t,e,s);return o?A(i)||a[0]==="{"||a[0]==="["?`${o} ${a}`:`${o}
${t.indent}${a}`:a}var vt=x(()=>{os();L();gt();wt()});function Cr({key:r,value:t},e,s,n){var B,S;let{allNullValues:i,doc:o,indent:a,indentStep:l,options:{commentString:c,indentSeq:d,simpleKeys:u}}=e,p=N(r)&&r.comment||null;if(u){if(p)throw new Error("With simple keys, key nodes cannot have comments");if(D(r)||!N(r)&&typeof r=="object"){let C="With simple keys, collection cannot be used as a key value";throw new Error(C)}}let h=!u&&(!r||p&&t==null&&!e.inFlow||D(r)||(A(r)?r.type===E.BLOCK_FOLDED||r.type===E.BLOCK_LITERAL:typeof r=="object"));e=Object.assign({},e,{allNullValues:!1,implicitKey:!h&&(u||!i),indent:a+l});let g=!1,f=!1,m=xe(r,e,()=>g=!0,()=>f=!0);if(!h&&!e.inFlow&&m.length>1024){if(u)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");h=!0}if(e.inFlow){if(i||t==null)return g&&s&&s(),m===""?"?":h?`? ${m}`:m}else if(i&&!u||t==null&&h)return m=`? ${m}`,p&&!g?m+=ue(m,e.indent,c(p)):f&&n&&n(),m;g&&(p=null),h?(p&&(m+=ue(m,e.indent,c(p))),m=`? ${m}
${a}:`):(m=`${m}:`,p&&(m+=ue(m,e.indent,c(p))));let b,y,k;N(t)?(b=!!t.spaceBefore,y=t.commentBefore,k=t.comment):(b=!1,y=null,k=null,t&&typeof t=="object"&&(t=o.createNode(t))),e.implicitKey=!1,!h&&!p&&A(t)&&(e.indentAtStart=m.length+1),f=!1,!d&&l.length>=2&&!e.inFlow&&!h&&se(t)&&!t.flow&&!t.tag&&!t.anchor&&(e.indent=e.indent.substring(2));let v=!1,w=xe(t,e,()=>v=!0,()=>f=!0),T=" ";if(p||b||y){if(T=b?`
`:"",y){let C=c(y);T+=`
${X(C,e.indent)}`}w===""&&!e.inFlow?T===`
`&&k&&(T=`

`):T+=`
${e.indent}`}else if(!h&&D(t)){let C=w[0],O=w.indexOf(`
`),I=O!==-1,$=(S=(B=e.inFlow)!=null?B:t.flow)!=null?S:t.items.length===0;if(I||!$){let K=!1;if(I&&(C==="&"||C==="!")){let V=w.indexOf(" ");C==="&"&&V!==-1&&V<O&&w[V+1]==="!"&&(V=w.indexOf(" ",V+1)),(V===-1||O<V)&&(K=!0)}K||(T=`
${e.indent}`)}}else(w===""||w[0]===`
`)&&(T="");return m+=T+w,e.inFlow?v&&s&&s():k&&!v?m+=ue(m,e.indent,c(k)):f&&n&&n(),m}var Br=x(()=>{L();_();vt();gt()});function gs(r,t){(r==="debug"||r==="warn")&&console.warn(t)}var kn=x(()=>{});function vn(r,t,e){if(e=r&&Q(e)?e.resolve(r.doc):e,se(e))for(let s of e.items)wn(r,t,s);else if(Array.isArray(e))for(let s of e)wn(r,t,s);else wn(r,t,e)}function wn(r,t,e){let s=r&&Q(e)?e.resolve(r.doc):e;if(!te(s))throw new Error("Merge sources must be maps or map aliases");let n=s.toJSON(null,r,Map);for(let[i,o]of n)t instanceof Map?t.has(i)||t.set(i,o):t instanceof Set?t.add(i):Object.prototype.hasOwnProperty.call(t,i)||Object.defineProperty(t,i,{value:o,writable:!0,enumerable:!0,configurable:!0});return t}var ys,ne,Ar,bs=x(()=>{L();_();ys="<<",ne={identify:r=>r===ys||typeof r=="symbol"&&r.description===ys,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new E(Symbol(ys)),{addToJSMap:vn}),stringify:()=>ys},Ar=(r,t)=>(ne.identify(t)||A(t)&&(!t.type||t.type===E.PLAIN)&&ne.identify(t.value))&&(r==null?void 0:r.doc.schema.tags.some(e=>e.tag===ne.tag&&e.default))});function ks(r,t,{key:e,value:s}){if(N(e)&&e.addToJSMap)e.addToJSMap(r,t,s);else if(Ar(r,e))vn(r,t,s);else{let n=U(e,"",r);if(t instanceof Map)t.set(n,U(s,n,r));else if(t instanceof Set)t.add(n);else{let i=so(e,n,r),o=U(s,i,r);i in t?Object.defineProperty(t,i,{value:o,writable:!0,enumerable:!0,configurable:!0}):t[i]=o}}return t}function so(r,t,e){if(t===null)return"";if(typeof t!="object")return String(t);if(N(r)&&(e!=null&&e.doc)){let s=ms(e.doc,{});s.anchors=new Set;for(let i of e.anchors.keys())s.anchors.add(i.anchor);s.inFlow=!0,s.inStringifyKey=!0;let n=r.toString(s);if(!e.mapKeyWarned){let i=JSON.stringify(n);i.length>40&&(i=i.substring(0,36)+'..."'),gs(e.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${i}. Set mapAsMap: true to use object keys.`),e.mapKeyWarned=!0}return n}return JSON.stringify(t)}var xn=x(()=>{kn();bs();vt();L();Be()});function Ge(r,t,e){let s=ve(r,void 0,e),n=ve(t,void 0,e);return new F(s,n)}var F,Pe=x(()=>{ht();Br();xn();L();F=class r{constructor(t,e=null){Object.defineProperty(this,H,{value:fn}),this.key=t,this.value=e}clone(t){let{key:e,value:s}=this;return N(e)&&(e=e.clone(t)),N(s)&&(s=s.clone(t)),new r(e,s)}toJSON(t,e){let s=e!=null&&e.mapAsMap?new Map:{};return ks(e,s,this)}toString(t,e,s){return t!=null&&t.doc?Cr(this,t,e,s):JSON.stringify(this)}}});function vs(r,t,e){var i;return(((i=t.inFlow)!=null?i:r.flow)?ro:no)(r,t,e)}function no({comment:r,items:t},e,{blockItemPrefix:s,flowChars:n,itemIndent:i,onChompKeep:o,onComment:a}){let{indent:l,options:{commentString:c}}=e,d=Object.assign({},e,{indent:i,type:null}),u=!1,p=[];for(let g=0;g<t.length;++g){let f=t[g],m=null;if(N(f))!u&&f.spaceBefore&&p.push(""),ws(e,p,f.commentBefore,u),f.comment&&(m=f.comment);else if(P(f)){let y=N(f.key)?f.key:null;y&&(!u&&y.spaceBefore&&p.push(""),ws(e,p,y.commentBefore,u))}u=!1;let b=xe(f,d,()=>m=null,()=>u=!0);m&&(b+=ue(b,i,c(m))),u&&m&&(u=!1),p.push(s+b)}let h;if(p.length===0)h=n.start+n.end;else{h=p[0];for(let g=1;g<p.length;++g){let f=p[g];h+=f?`
${l}${f}`:`
`}}return r?(h+=`
`+X(c(r),l),a&&a()):u&&o&&o(),h}function ro({items:r},t,{flowChars:e,itemIndent:s}){let{indent:n,indentStep:i,flowCollectionPadding:o,options:{commentString:a}}=t;s+=i;let l=Object.assign({},t,{indent:s,inFlow:!0,type:null}),c=!1,d=0,u=[];for(let g=0;g<r.length;++g){let f=r[g],m=null;if(N(f))f.spaceBefore&&u.push(""),ws(t,u,f.commentBefore,!1),f.comment&&(m=f.comment);else if(P(f)){let y=N(f.key)?f.key:null;y&&(y.spaceBefore&&u.push(""),ws(t,u,y.commentBefore,!1),y.comment&&(c=!0));let k=N(f.value)?f.value:null;k?(k.comment&&(m=k.comment),k.commentBefore&&(c=!0)):f.value==null&&(y!=null&&y.comment)&&(m=y.comment)}m&&(c=!0);let b=xe(f,l,()=>m=null);g<r.length-1&&(b+=","),m&&(b+=ue(b,s,a(m))),!c&&(u.length>d||b.includes(`
`))&&(c=!0),u.push(b),d=u.length}let{start:p,end:h}=e;if(u.length===0)return p+h;if(!c){let g=u.reduce((f,m)=>f+m.length+2,2);c=t.options.lineWidth>0&&g>t.options.lineWidth}if(c){let g=p;for(let f of u)g+=f?`
${i}${n}${f}`:`
`;return`${g}
${n}${h}`}else return`${p}${o}${u.join(" ")}${o}${h}`}function ws({indent:r,options:{commentString:t}},e,s,n){if(s&&n&&(s=s.replace(/^\n+/,"")),s){let i=X(t(s),r);e.push(i.trimStart())}}var Sn=x(()=>{L();vt();gt()});function Ne(r,t){let e=A(t)?t.value:t;for(let s of r)if(P(s)&&(s.key===t||s.key===e||A(s.key)&&s.key.value===e))return s}var R,Le=x(()=>{Sn();xn();ds();L();Pe();_();R=class extends Ye{static get tagName(){return"tag:yaml.org,2002:map"}constructor(t){super(Z,t),this.items=[]}static from(t,e,s){let{keepUndefined:n,replacer:i}=s,o=new this(t),a=(l,c)=>{if(typeof i=="function")c=i.call(e,l,c);else if(Array.isArray(i)&&!i.includes(l))return;(c!==void 0||n)&&o.items.push(Ge(l,c,s))};if(e instanceof Map)for(let[l,c]of e)a(l,c);else if(e&&typeof e=="object")for(let l of Object.keys(e))a(l,e[l]);return typeof t.sortMapEntries=="function"&&o.items.sort(t.sortMapEntries),o}add(t,e){var o;let s;P(t)?s=t:!t||typeof t!="object"||!("key"in t)?s=new F(t,t==null?void 0:t.value):s=new F(t.key,t.value);let n=Ne(this.items,s.key),i=(o=this.schema)==null?void 0:o.sortMapEntries;if(n){if(!e)throw new Error(`Key ${s.key} already set`);A(n.value)&&cs(s.value)?n.value.value=s.value:n.value=s.value}else if(i){let a=this.items.findIndex(l=>i(s,l)<0);a===-1?this.items.push(s):this.items.splice(a,0,s)}else this.items.push(s)}delete(t){let e=Ne(this.items,t);return e?this.items.splice(this.items.indexOf(e),1).length>0:!1}get(t,e){var i;let s=Ne(this.items,t),n=s==null?void 0:s.value;return(i=!e&&A(n)?n.value:n)!=null?i:void 0}has(t){return!!Ne(this.items,t)}set(t,e){this.add(new F(t,e),!0)}toJSON(t,e,s){let n=s?new s:e!=null&&e.mapAsMap?new Map:{};e!=null&&e.onCreate&&e.onCreate(n);for(let i of this.items)ks(e,n,i);return n}toString(t,e,s){if(!t)return JSON.stringify(this);for(let n of this.items)if(!P(n))throw new Error(`Map items must all be pairs; found ${JSON.stringify(n)} instead`);return!t.allNullValues&&this.hasAllNullValues(!1)&&(t=Object.assign({},t,{allNullValues:!0})),vs(this,t,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:t.indent||"",onChompKeep:s,onComment:e})}}});var re,Qe=x(()=>{L();Le();re={collection:"map",default:!0,nodeClass:R,tag:"tag:yaml.org,2002:map",resolve(r,t){return te(r)||t("Expected a mapping for this tag"),r},createNode:(r,t,e)=>R.from(r,t,e)}});function xs(r){let t=A(r)?r.value:r;return t&&typeof t=="string"&&(t=Number(t)),typeof t=="number"&&Number.isInteger(t)&&t>=0?t:null}var j,De=x(()=>{ht();Sn();ds();L();_();Be();j=class extends Ye{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(t){super(ke,t),this.items=[]}add(t){this.items.push(t)}delete(t){let e=xs(t);return typeof e!="number"?!1:this.items.splice(e,1).length>0}get(t,e){let s=xs(t);if(typeof s!="number")return;let n=this.items[s];return!e&&A(n)?n.value:n}has(t){let e=xs(t);return typeof e=="number"&&e<this.items.length}set(t,e){let s=xs(t);if(typeof s!="number")throw new Error(`Expected a valid index, not ${t}.`);let n=this.items[s];A(n)&&cs(e)?n.value=e:this.items[s]=e}toJSON(t,e){let s=[];e!=null&&e.onCreate&&e.onCreate(s);let n=0;for(let i of this.items)s.push(U(i,String(n++),e));return s}toString(t,e,s){return t?vs(this,t,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(t.indent||"")+"  ",onChompKeep:s,onComment:e}):JSON.stringify(this)}static from(t,e,s){let{replacer:n}=s,i=new this(t);if(e&&Symbol.iterator in Object(e)){let o=0;for(let a of e){if(typeof n=="function"){let l=e instanceof Set?a:String(o++);a=n.call(e,l,a)}i.items.push(ve(a,void 0,s))}}return i}}});var ie,Xe=x(()=>{L();De();ie={collection:"seq",default:!0,nodeClass:j,tag:"tag:yaml.org,2002:seq",resolve(r,t){return se(r)||t("Expected a sequence for this tag"),r},createNode:(r,t,e)=>j.from(r,t,e)}});var Ie,xt=x(()=>{wt();Ie={identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify(r,t,e,s){return t=Object.assign({actualString:!0},t),_e(r,t,e,s)}}});var Ue,Ss=x(()=>{_();Ue={identify:r=>r==null,createNode:()=>new E(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new E(null),stringify:({source:r},t)=>typeof r=="string"&&Ue.test.test(r)?r:t.options.nullStr}});var St,En=x(()=>{_();St={identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:r=>new E(r[0]==="t"||r[0]==="T"),stringify({source:r,value:t},e){if(r&&St.test.test(r)){let s=r[0]==="t"||r[0]==="T";if(t===s)return r}return t?e.options.trueStr:e.options.falseStr}}});function q({format:r,minFractionDigits:t,tag:e,value:s}){if(typeof s=="bigint")return String(s);let n=typeof s=="number"?s:Number(s);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let i=Object.is(s,-0)?"-0":JSON.stringify(s);if(!r&&t&&(!e||e==="tag:yaml.org,2002:float")&&/^\d/.test(i)){let o=i.indexOf(".");o<0&&(o=i.length,i+=".");let a=t-(i.length-o-1);for(;a-- >0;)i+="0"}return i}var Ze=x(()=>{});var Es,Ts,Cs,Tn=x(()=>{_();Ze();Es={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:q},Ts={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r),stringify(r){let t=Number(r.value);return isFinite(t)?t.toExponential():q(r)}},Cs={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(r){let t=new E(parseFloat(r)),e=r.indexOf(".");return e!==-1&&r[r.length-1]==="0"&&(t.minFractionDigits=r.length-e-1),t},stringify:q}});function Pr(r,t,e){let{value:s}=r;return Bs(s)&&s>=0?e+s.toString(t):q(r)}var Bs,Cn,As,Ps,Ns,Bn=x(()=>{Ze();Bs=r=>typeof r=="bigint"||Number.isInteger(r),Cn=(r,t,e,{intAsBigInt:s})=>s?BigInt(r):parseInt(r.substring(t),e);As={identify:r=>Bs(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(r,t,e)=>Cn(r,2,8,e),stringify:r=>Pr(r,8,"0o")},Ps={identify:Bs,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(r,t,e)=>Cn(r,0,10,e),stringify:q},Ns={identify:r=>Bs(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(r,t,e)=>Cn(r,2,16,e),stringify:r=>Pr(r,16,"0x")}});var Nr,Lr=x(()=>{Qe();Ss();Xe();xt();En();Tn();Bn();Nr=[re,ie,Ie,Ue,St,As,Ps,Ns,Es,Ts,Cs]});function Dr(r){return typeof r=="bigint"||Number.isInteger(r)}var Ls,io,oo,Ir,Or=x(()=>{_();Qe();Xe();Ls=({value:r})=>JSON.stringify(r),io=[{identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify:Ls},{identify:r=>r==null,createNode:()=>new E(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Ls},{identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:r=>r==="true",stringify:Ls},{identify:Dr,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(r,t,{intAsBigInt:e})=>e?BigInt(r):parseInt(r,10),stringify:({value:r})=>Dr(r)?r.toString():JSON.stringify(r)},{identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:r=>parseFloat(r),stringify:Ls}],oo={default:!0,tag:"",test:/^/,resolve(r,t){return t(`Unresolved plain scalar ${JSON.stringify(r)}`),r}},Ir=[re,ie].concat(io,oo)});var Et,An=x(()=>{_();wt();Et={identify:r=>r instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(r,t){if(typeof atob=="function"){let e=atob(r.replace(/[\n\r]/g,"")),s=new Uint8Array(e.length);for(let n=0;n<e.length;++n)s[n]=e.charCodeAt(n);return s}else return t("This environment does not support reading binary tags; either Buffer or atob is required"),r},stringify({comment:r,type:t,value:e},s,n,i){if(!e)return"";let o=e,a;if(typeof btoa=="function"){let l="";for(let c=0;c<o.length;++c)l+=String.fromCharCode(o[c]);a=btoa(l)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(t!=null||(t=E.BLOCK_LITERAL),t!==E.QUOTE_DOUBLE){let l=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),c=Math.ceil(a.length/l),d=new Array(c);for(let u=0,p=0;u<c;++u,p+=l)d[u]=a.substr(p,l);a=d.join(t===E.BLOCK_LITERAL?`
`:" ")}return _e({comment:r,type:t,value:a},s,n,i)}}});function Pn(r,t){var e;if(se(r))for(let s=0;s<r.items.length;++s){let n=r.items[s];if(!P(n)){if(te(n)){n.items.length>1&&t("Each pair must have its own sequence indicator");let i=n.items[0]||new F(new E(null));if(n.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${n.commentBefore}
${i.key.commentBefore}`:n.commentBefore),n.comment){let o=(e=i.value)!=null?e:i.key;o.comment=o.comment?`${n.comment}
${o.comment}`:n.comment}n=i}r.items[s]=P(n)?n:new F(n)}}else t("Expected a sequence for this tag");return r}function Nn(r,t,e){let{replacer:s}=e,n=new j(r);n.tag="tag:yaml.org,2002:pairs";let i=0;if(t&&Symbol.iterator in Object(t))for(let o of t){typeof s=="function"&&(o=s.call(t,String(i++),o));let a,l;if(Array.isArray(o))if(o.length===2)a=o[0],l=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){let c=Object.keys(o);if(c.length===1)a=c[0],l=o[a];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else a=o;n.items.push(Ge(a,l,e))}return n}var Tt,Ds=x(()=>{L();Pe();_();De();Tt={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Pn,createNode:Nn}});var et,Ct,Ln=x(()=>{L();Be();Le();De();Ds();et=class r extends j{constructor(){super(),this.add=R.prototype.add.bind(this),this.delete=R.prototype.delete.bind(this),this.get=R.prototype.get.bind(this),this.has=R.prototype.has.bind(this),this.set=R.prototype.set.bind(this),this.tag=r.tag}toJSON(t,e){if(!e)return super.toJSON(t);let s=new Map;e!=null&&e.onCreate&&e.onCreate(s);for(let n of this.items){let i,o;if(P(n)?(i=U(n.key,"",e),o=U(n.value,i,e)):i=U(n,"",e),s.has(i))throw new Error("Ordered maps must not include duplicate keys");s.set(i,o)}return s}static from(t,e,s){let n=Nn(t,e,s),i=new this;return i.items=n.items,i}};et.tag="tag:yaml.org,2002:omap";Ct={collection:"seq",identify:r=>r instanceof Map,nodeClass:et,default:!1,tag:"tag:yaml.org,2002:omap",resolve(r,t){let e=Pn(r,t),s=[];for(let{key:n}of e.items)A(n)&&(s.includes(n.value)?t(`Ordered maps must not include duplicate keys: ${n.value}`):s.push(n.value));return Object.assign(new et,e)},createNode:(r,t,e)=>et.from(r,t,e)}});function Fr({value:r,source:t},e){return t&&(r?Dn:In).test.test(t)?t:r?e.options.trueStr:e.options.falseStr}var Dn,In,$r=x(()=>{_();Dn={identify:r=>r===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new E(!0),stringify:Fr},In={identify:r=>r===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new E(!1),stringify:Fr}});var Mr,Rr,_r,Ur=x(()=>{_();Ze();Mr={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:q},Rr={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r.replace(/_/g,"")),stringify(r){let t=Number(r.value);return isFinite(t)?t.toExponential():q(r)}},_r={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(r){let t=new E(parseFloat(r.replace(/_/g,""))),e=r.indexOf(".");if(e!==-1){let s=r.substring(e+1).replace(/_/g,"");s[s.length-1]==="0"&&(t.minFractionDigits=s.length)}return t},stringify:q}});function Is(r,t,e,{intAsBigInt:s}){let n=r[0];if((n==="-"||n==="+")&&(t+=1),r=r.substring(t).replace(/_/g,""),s){switch(e){case 2:r=`0b${r}`;break;case 8:r=`0o${r}`;break;case 16:r=`0x${r}`;break}let o=BigInt(r);return n==="-"?BigInt(-1)*o:o}let i=parseInt(r,e);return n==="-"?-1*i:i}function On(r,t,e){let{value:s}=r;if(Bt(s)){let n=s.toString(t);return s<0?"-"+e+n.substr(1):e+n}return q(r)}var Bt,jr,qr,Kr,Vr,zr=x(()=>{Ze();Bt=r=>typeof r=="bigint"||Number.isInteger(r);jr={identify:Bt,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(r,t,e)=>Is(r,2,2,e),stringify:r=>On(r,2,"0b")},qr={identify:Bt,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(r,t,e)=>Is(r,1,8,e),stringify:r=>On(r,8,"0")},Kr={identify:Bt,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(r,t,e)=>Is(r,0,10,e),stringify:q},Vr={identify:Bt,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(r,t,e)=>Is(r,2,16,e),stringify:r=>On(r,16,"0x")}});var tt,At,Fn=x(()=>{L();Pe();Le();tt=class r extends R{constructor(t){super(t),this.tag=r.tag}add(t){let e;P(t)?e=t:t&&typeof t=="object"&&"key"in t&&"value"in t&&t.value===null?e=new F(t.key,null):e=new F(t,null),Ne(this.items,e.key)||this.items.push(e)}get(t,e){let s=Ne(this.items,t);return!e&&P(s)?A(s.key)?s.key.value:s.key:s}set(t,e){if(typeof e!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof e}`);let s=Ne(this.items,t);s&&!e?this.items.splice(this.items.indexOf(s),1):!s&&e&&this.items.push(new F(t))}toJSON(t,e){return super.toJSON(t,e,Set)}toString(t,e,s){if(!t)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},t,{allNullValues:!0}),e,s);throw new Error("Set items must all have null values")}static from(t,e,s){let{replacer:n}=s,i=new this(t);if(e&&Symbol.iterator in Object(e))for(let o of e)typeof n=="function"&&(o=n.call(e,o,o)),i.items.push(Ge(o,null,s));return i}};tt.tag="tag:yaml.org,2002:set";At={collection:"map",identify:r=>r instanceof Set,nodeClass:tt,default:!1,tag:"tag:yaml.org,2002:set",createNode:(r,t,e)=>tt.from(r,t,e),resolve(r,t){if(te(r)){if(r.hasAllNullValues(!0))return Object.assign(new tt,r);t("Set items must all have null values")}else t("Expected a mapping for this tag");return r}}});function $n(r,t){let e=r[0],s=e==="-"||e==="+"?r.substring(1):r,n=o=>t?BigInt(o):Number(o),i=s.replace(/_/g,"").split(":").reduce((o,a)=>o*n(60)+n(a),n(0));return e==="-"?n(-1)*i:i}function Hr(r){let{value:t}=r,e=o=>o;if(typeof t=="bigint")e=o=>BigInt(o);else if(isNaN(t)||!isFinite(t))return q(r);let s="";t<0&&(s="-",t*=e(-1));let n=e(60),i=[t%n];return t<60?i.unshift(0):(t=(t-i[0])/n,i.unshift(t%n),t>=60&&(t=(t-i[0])/n,i.unshift(t))),s+i.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}var Os,Fs,st,Mn=x(()=>{Ze();Os={identify:r=>typeof r=="bigint"||Number.isInteger(r),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(r,t,{intAsBigInt:e})=>$n(r,e),stringify:Hr},Fs={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:r=>$n(r,!1),stringify:Hr},st={identify:r=>r instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(r){let t=r.match(st.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,e,s,n,i,o,a]=t.map(Number),l=t[7]?Number((t[7]+"00").substr(1,3)):0,c=Date.UTC(e,s-1,n,i||0,o||0,a||0,l),d=t[8];if(d&&d!=="Z"){let u=$n(d,!1);Math.abs(u)<30&&(u*=60),c-=6e4*u}return new Date(c)},stringify:({value:r})=>{var t;return(t=r==null?void 0:r.toISOString().replace(/(T00:00:00)?\.000Z$/,""))!=null?t:""}}});var Rn,Yr=x(()=>{Qe();Ss();Xe();xt();An();$r();Ur();zr();bs();Ln();Ds();Fn();Mn();Rn=[re,ie,Ie,Ue,Dn,In,jr,qr,Kr,Vr,Mr,Rr,_r,Et,ne,Ct,Tt,At,Os,Fs,st]});function $s(r,t,e){let s=Jr.get(t);if(s&&!r)return e&&!s.includes(ne)?s.concat(ne):s.slice();let n=s;if(!n)if(Array.isArray(r))n=[];else{let i=Array.from(Jr.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${i} or define customTags array`)}if(Array.isArray(r))for(let i of r)n=n.concat(i);else typeof r=="function"&&(n=r(n.slice()));return e&&(n=n.concat(ne)),n.reduce((i,o)=>{let a=typeof o=="string"?Wr[o]:o;if(!a){let l=JSON.stringify(o),c=Object.keys(Wr).map(d=>JSON.stringify(d)).join(", ");throw new Error(`Unknown custom tag ${l}; use one of ${c}`)}return i.includes(a)||i.push(a),i},[])}var Jr,Wr,Gr,Qr=x(()=>{Qe();Ss();Xe();xt();En();Tn();Bn();Lr();Or();An();bs();Ln();Ds();Yr();Fn();Mn();Jr=new Map([["core",Nr],["failsafe",[re,ie,Ie]],["json",Ir],["yaml11",Rn],["yaml-1.1",Rn]]),Wr={binary:Et,bool:St,float:Cs,floatExp:Ts,floatNaN:Es,floatTime:Fs,int:Ps,intHex:Ns,intOct:As,intTime:Os,map:re,merge:ne,null:Ue,omap:Ct,pairs:Tt,seq:ie,set:At,timestamp:st},Gr={"tag:yaml.org,2002:binary":Et,"tag:yaml.org,2002:merge":ne,"tag:yaml.org,2002:omap":Ct,"tag:yaml.org,2002:pairs":Tt,"tag:yaml.org,2002:set":At,"tag:yaml.org,2002:timestamp":st}});var ao,Pt,_n=x(()=>{L();Qe();Xe();xt();Qr();ao=(r,t)=>r.key<t.key?-1:r.key>t.key?1:0,Pt=class r{constructor({compat:t,customTags:e,merge:s,resolveKnownTags:n,schema:i,sortMapEntries:o,toStringDefaults:a}){this.compat=Array.isArray(t)?$s(t,"compat"):t?$s(null,t):null,this.name=typeof i=="string"&&i||"core",this.knownTags=n?Gr:{},this.tags=$s(e,this.name,s),this.toStringOptions=a!=null?a:null,Object.defineProperty(this,Z,{value:re}),Object.defineProperty(this,G,{value:Ie}),Object.defineProperty(this,ke,{value:ie}),this.sortMapEntries=typeof o=="function"?o:o===!0?ao:null}clone(){let t=Object.create(r.prototype,Object.getOwnPropertyDescriptors(this));return t.tags=this.tags.slice(),t}}});function Xr(r,t){var l;let e=[],s=t.directives===!0;if(t.directives!==!1&&r.directives){let c=r.directives.toString(r);c?(e.push(c),s=!0):r.directives.docStart&&(s=!0)}s&&e.push("---");let n=ms(r,t),{commentString:i}=n.options;if(r.commentBefore){e.length!==1&&e.unshift("");let c=i(r.commentBefore);e.unshift(X(c,""))}let o=!1,a=null;if(r.contents){if(N(r.contents)){if(r.contents.spaceBefore&&s&&e.push(""),r.contents.commentBefore){let u=i(r.contents.commentBefore);e.push(X(u,""))}n.forceBlockIndent=!!r.comment,a=r.contents.comment}let c=a?void 0:()=>o=!0,d=xe(r.contents,n,()=>a=null,c);a&&(d+=ue(d,"",i(a))),(d[0]==="|"||d[0]===">")&&e[e.length-1]==="---"?e[e.length-1]=`--- ${d}`:e.push(d)}else e.push(xe(r.contents,n));if((l=r.directives)!=null&&l.docEnd)if(r.comment){let c=i(r.comment);c.includes(`
`)?(e.push("..."),e.push(X(c,""))):e.push(`... ${c}`)}else e.push("...");else{let c=r.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||a)&&e[e.length-1]!==""&&e.push(""),e.push(X(i(c),"")))}return e.join(`
`)+`
`}var Zr=x(()=>{L();vt();gt()});function nt(r){if(D(r))return!0;throw new Error("Expected a YAML collection as document contents")}var Se,Nt=x(()=>{pt();ds();L();Pe();Be();_n();Zr();os();mn();ht();un();Se=class r{constructor(t,e,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,H,{value:ss});let n=null;typeof e=="function"||Array.isArray(e)?n=e:s===void 0&&e&&(s=e,e=void 0);let i=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},s);this.options=i;let{version:o}=i;s!=null&&s._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new fe({version:o}),this.setSchema(o,s),this.contents=t===void 0?null:this.createNode(t,n,s)}clone(){let t=Object.create(r.prototype,{[H]:{value:ss}});return t.commentBefore=this.commentBefore,t.comment=this.comment,t.errors=this.errors.slice(),t.warnings=this.warnings.slice(),t.options=Object.assign({},this.options),this.directives&&(t.directives=this.directives.clone()),t.schema=this.schema.clone(),t.contents=N(this.contents)?this.contents.clone(t.schema):this.contents,this.range&&(t.range=this.range.slice()),t}add(t){nt(this.contents)&&this.contents.add(t)}addIn(t,e){nt(this.contents)&&this.contents.addIn(t,e)}createAlias(t,e){if(!t.anchor){let s=pn(this);t.anchor=!e||s.has(e)?hn(e||"a",s):e}return new we(t.anchor)}createNode(t,e,s){let n;if(typeof e=="function")t=e.call({"":t},"",t),n=e;else if(Array.isArray(e)){let m=y=>typeof y=="number"||y instanceof String||y instanceof Number,b=e.filter(m).map(String);b.length>0&&(e=e.concat(b)),n=e}else s===void 0&&e&&(s=e,e=void 0);let{aliasDuplicateObjects:i,anchorPrefix:o,flow:a,keepUndefined:l,onTagObj:c,tag:d}=s!=null?s:{},{onAnchor:u,setAnchors:p,sourceObjects:h}=xr(this,o||"a"),g={aliasDuplicateObjects:i!=null?i:!0,keepUndefined:l!=null?l:!1,onAnchor:u,onTagObj:c,replacer:n,schema:this.schema,sourceObjects:h},f=ve(t,d,g);return a&&D(f)&&(f.flow=!0),p(),f}createPair(t,e,s={}){let n=this.createNode(t,null,s),i=this.createNode(e,null,s);return new F(n,i)}delete(t){return nt(this.contents)?this.contents.delete(t):!1}deleteIn(t){return Je(t)?this.contents==null?!1:(this.contents=null,!0):nt(this.contents)?this.contents.deleteIn(t):!1}get(t,e){return D(this.contents)?this.contents.get(t,e):void 0}getIn(t,e){return Je(t)?!e&&A(this.contents)?this.contents.value:this.contents:D(this.contents)?this.contents.getIn(t,e):void 0}has(t){return D(this.contents)?this.contents.has(t):!1}hasIn(t){return Je(t)?this.contents!==void 0:D(this.contents)?this.contents.hasIn(t):!1}set(t,e){this.contents==null?this.contents=mt(this.schema,[t],e):nt(this.contents)&&this.contents.set(t,e)}setIn(t,e){Je(t)?this.contents=e:this.contents==null?this.contents=mt(this.schema,Array.from(t),e):nt(this.contents)&&this.contents.setIn(t,e)}setSchema(t,e={}){typeof t=="number"&&(t=String(t));let s;switch(t){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new fe({version:"1.1"}),s={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=t:this.directives=new fe({version:t}),s={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{let n=JSON.stringify(t);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${n}`)}}if(e.schema instanceof Object)this.schema=e.schema;else if(s)this.schema=new Pt(Object.assign(s,e));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:t,jsonArg:e,mapAsMap:s,maxAliasCount:n,onAnchor:i,reviver:o}={}){let a={anchors:new Map,doc:this,keep:!t,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},l=U(this.contents,e!=null?e:"",a);if(typeof i=="function")for(let{count:c,res:d}of a.anchors.values())i(d,c);return typeof o=="function"?Ce(o,{"":l},"",l):l}toJSON(t,e){return this.toJS({json:!0,jsonArg:t,mapAsMap:!1,onAnchor:e})}toString(t={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in t&&(!Number.isInteger(t.indent)||Number(t.indent)<=0)){let e=JSON.stringify(t.indent);throw new Error(`"indent" option must be a positive integer, not ${e}`)}return Xr(this,t)}}});var Lt,oe,Dt,Un,It=x(()=>{Lt=class extends Error{constructor(t,e,s,n){super(),this.name=t,this.code=s,this.message=n,this.pos=e}},oe=class extends Lt{constructor(t,e,s){super("YAMLParseError",t,e,s)}},Dt=class extends Lt{constructor(t,e,s){super("YAMLWarning",t,e,s)}},Un=(r,t)=>e=>{if(e.pos[0]===-1)return;e.linePos=e.pos.map(a=>t.linePos(a));let{line:s,col:n}=e.linePos[0];e.message+=` at line ${s}, column ${n}`;let i=n-1,o=r.substring(t.lineStarts[s-1],t.lineStarts[s]).replace(/[\n\r]+$/,"");if(i>=60&&o.length>80){let a=Math.min(i-39,o.length-79);o="\u2026"+o.substring(a),i-=a-1}if(o.length>80&&(o=o.substring(0,79)+"\u2026"),s>1&&/^ *$/.test(o.substring(0,i))){let a=r.substring(t.lineStarts[s-2],t.lineStarts[s-1]);a.length>80&&(a=a.substring(0,79)+`\u2026
`),o=a+o}if(/[^ ]/.test(o)){let a=1,l=e.linePos[1];(l==null?void 0:l.line)===s&&l.col>n&&(a=Math.max(1,Math.min(l.col-n,80-i)));let c=" ".repeat(i)+"^".repeat(a);e.message+=`:

${o}
${c}
`}}});function pe(r,{flow:t,indicator:e,next:s,offset:n,onError:i,parentIndent:o,startOnNewline:a}){let l=!1,c=a,d=a,u="",p="",h=!1,g=!1,f=null,m=null,b=null,y=null,k=null,v=null,w=null;for(let S of r)switch(g&&(S.type!=="space"&&S.type!=="newline"&&S.type!=="comma"&&i(S.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g=!1),f&&(c&&S.type!=="comment"&&S.type!=="newline"&&i(f,"TAB_AS_INDENT","Tabs are not allowed as indentation"),f=null),S.type){case"space":!t&&(e!=="doc-start"||(s==null?void 0:s.type)!=="flow-collection")&&S.source.includes("	")&&(f=S),d=!0;break;case"comment":{d||i(S,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let C=S.source.substring(1)||" ";u?u+=p+C:u=C,p="",c=!1;break}case"newline":c?u?u+=S.source:(!v||e!=="seq-item-ind")&&(l=!0):p+=S.source,c=!0,h=!0,(m||b)&&(y=S),d=!0;break;case"anchor":m&&i(S,"MULTIPLE_ANCHORS","A node can have at most one anchor"),S.source.endsWith(":")&&i(S.offset+S.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=S,w!=null||(w=S.offset),c=!1,d=!1,g=!0;break;case"tag":{b&&i(S,"MULTIPLE_TAGS","A node can have at most one tag"),b=S,w!=null||(w=S.offset),c=!1,d=!1,g=!0;break}case e:(m||b)&&i(S,"BAD_PROP_ORDER",`Anchors and tags must be after the ${S.source} indicator`),v&&i(S,"UNEXPECTED_TOKEN",`Unexpected ${S.source} in ${t!=null?t:"collection"}`),v=S,c=e==="seq-item-ind"||e==="explicit-key-ind",d=!1;break;case"comma":if(t){k&&i(S,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),k=S,c=!1,d=!1;break}default:i(S,"UNEXPECTED_TOKEN",`Unexpected ${S.type} token`),c=!1,d=!1}let T=r[r.length-1],B=T?T.offset+T.source.length:n;return g&&s&&s.type!=="space"&&s.type!=="newline"&&s.type!=="comma"&&(s.type!=="scalar"||s.source!=="")&&i(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),f&&(c&&f.indent<=o||(s==null?void 0:s.type)==="block-map"||(s==null?void 0:s.type)==="block-seq")&&i(f,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:k,found:v,spaceBefore:l,comment:u,hasNewline:h,anchor:m,tag:b,newlineAfterProp:y,end:B,start:w!=null?w:B}}var Ot=x(()=>{});function Oe(r){if(!r)return null;switch(r.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(r.source.includes(`
`))return!0;if(r.end){for(let t of r.end)if(t.type==="newline")return!0}return!1;case"flow-collection":for(let t of r.items){for(let e of t.start)if(e.type==="newline")return!0;if(t.sep){for(let e of t.sep)if(e.type==="newline")return!0}if(Oe(t.key)||Oe(t.value))return!0}return!1;default:return!0}}var Ms=x(()=>{});function Ft(r,t,e){if((t==null?void 0:t.type)==="flow-collection"){let s=t.end[0];s.indent===r&&(s.source==="]"||s.source==="}")&&Oe(t)&&e(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}var jn=x(()=>{Ms()});function Rs(r,t,e){let{uniqueKeys:s}=r.options;if(s===!1)return!1;let n=typeof s=="function"?s:(i,o)=>i===o||A(i)&&A(o)&&i.value===o.value;return t.some(i=>n(i.key,e))}var qn=x(()=>{L()});function ti({composeNode:r,composeEmptyNode:t},e,s,n,i){var d,u;let o=(d=i==null?void 0:i.nodeClass)!=null?d:R,a=new o(e.schema);e.atRoot&&(e.atRoot=!1);let l=s.offset,c=null;for(let p of s.items){let{start:h,key:g,sep:f,value:m}=p,b=pe(h,{indicator:"explicit-key-ind",next:g!=null?g:f==null?void 0:f[0],offset:l,onError:n,parentIndent:s.indent,startOnNewline:!0}),y=!b.found;if(y){if(g&&(g.type==="block-seq"?n(l,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==s.indent&&n(l,"BAD_INDENT",ei)),!b.anchor&&!b.tag&&!f){c=b.end,b.comment&&(a.comment?a.comment+=`
`+b.comment:a.comment=b.comment);continue}(b.newlineAfterProp||Oe(g))&&n(g!=null?g:h[h.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((u=b.found)==null?void 0:u.indent)!==s.indent&&n(l,"BAD_INDENT",ei);e.atKey=!0;let k=b.end,v=g?r(e,g,b,n):t(e,k,h,null,b,n);e.schema.compat&&Ft(s.indent,g,n),e.atKey=!1,Rs(e,a.items,v)&&n(k,"DUPLICATE_KEY","Map keys must be unique");let w=pe(f!=null?f:[],{indicator:"map-value-ind",next:m,offset:v.range[2],onError:n,parentIndent:s.indent,startOnNewline:!g||g.type==="block-scalar"});if(l=w.end,w.found){y&&((m==null?void 0:m.type)==="block-map"&&!w.hasNewline&&n(l,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),e.options.strict&&b.start<w.found.offset-1024&&n(v.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let T=m?r(e,m,w,n):t(e,l,f,null,w,n);e.schema.compat&&Ft(s.indent,m,n),l=T.range[2];let B=new F(v,T);e.options.keepSourceTokens&&(B.srcToken=p),a.items.push(B)}else{y&&n(v.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),w.comment&&(v.comment?v.comment+=`
`+w.comment:v.comment=w.comment);let T=new F(v);e.options.keepSourceTokens&&(T.srcToken=p),a.items.push(T)}}return c&&c<l&&n(c,"IMPOSSIBLE","Map comment with trailing content"),a.range=[s.offset,l,c!=null?c:l],a}var ei,si=x(()=>{Pe();Le();Ot();Ms();jn();qn();ei="All mapping items must start at the same column"});function ni({composeNode:r,composeEmptyNode:t},e,s,n,i){var d;let o=(d=i==null?void 0:i.nodeClass)!=null?d:j,a=new o(e.schema);e.atRoot&&(e.atRoot=!1),e.atKey&&(e.atKey=!1);let l=s.offset,c=null;for(let{start:u,value:p}of s.items){let h=pe(u,{indicator:"seq-item-ind",next:p,offset:l,onError:n,parentIndent:s.indent,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||p)(p==null?void 0:p.type)==="block-seq"?n(h.end,"BAD_INDENT","All sequence items must start at the same column"):n(l,"MISSING_CHAR","Sequence item without - indicator");else{c=h.end,h.comment&&(a.comment=h.comment);continue}let g=p?r(e,p,h,n):t(e,h.end,u,null,h,n);e.schema.compat&&Ft(s.indent,p,n),l=g.range[2],a.items.push(g)}return a.range=[s.offset,l,c!=null?c:l],a}var ri=x(()=>{De();Ot();jn()});function he(r,t,e,s){let n="";if(r){let i=!1,o="";for(let a of r){let{source:l,type:c}=a;switch(c){case"space":i=!0;break;case"comment":{e&&!i&&s(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let d=l.substring(1)||" ";n?n+=o+d:n=d,o="";break}case"newline":n&&(o+=l),i=!0;break;default:s(a,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}t+=l.length}}return{comment:n,offset:t}}var rt=x(()=>{});function ii({composeNode:r,composeEmptyNode:t},e,s,n,i){var m,b,y;let o=s.start.source==="{",a=o?"flow map":"flow sequence",l=(m=i==null?void 0:i.nodeClass)!=null?m:o?R:j,c=new l(e.schema);c.flow=!0;let d=e.atRoot;d&&(e.atRoot=!1),e.atKey&&(e.atKey=!1);let u=s.offset+s.start.source.length;for(let k=0;k<s.items.length;++k){let v=s.items[k],{start:w,key:T,sep:B,value:S}=v,C=pe(w,{flow:a,indicator:"explicit-key-ind",next:T!=null?T:B==null?void 0:B[0],offset:u,onError:n,parentIndent:s.indent,startOnNewline:!1});if(!C.found){if(!C.anchor&&!C.tag&&!B&&!S){k===0&&C.comma?n(C.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):k<s.items.length-1&&n(C.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),C.comment&&(c.comment?c.comment+=`
`+C.comment:c.comment=C.comment),u=C.end;continue}!o&&e.options.strict&&Oe(T)&&n(T,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(k===0)C.comma&&n(C.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(C.comma||n(C.start,"MISSING_CHAR",`Missing , between ${a} items`),C.comment){let O="";e:for(let I of w)switch(I.type){case"comma":case"space":break;case"comment":O=I.source.substring(1);break e;default:break e}if(O){let I=c.items[c.items.length-1];P(I)&&(I=(b=I.value)!=null?b:I.key),I.comment?I.comment+=`
`+O:I.comment=O,C.comment=C.comment.substring(O.length+1)}}if(!o&&!B&&!C.found){let O=S?r(e,S,C,n):t(e,C.end,B,null,C,n);c.items.push(O),u=O.range[2],Vn(S)&&n(O.range,"BLOCK_IN_FLOW",Kn)}else{e.atKey=!0;let O=C.end,I=T?r(e,T,C,n):t(e,O,w,null,C,n);Vn(T)&&n(I.range,"BLOCK_IN_FLOW",Kn),e.atKey=!1;let $=pe(B!=null?B:[],{flow:a,indicator:"map-value-ind",next:S,offset:I.range[2],onError:n,parentIndent:s.indent,startOnNewline:!1});if($.found){if(!o&&!C.found&&e.options.strict){if(B)for(let z of B){if(z===$.found)break;if(z.type==="newline"){n(z,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}C.start<$.found.offset-1024&&n($.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else S&&("source"in S&&((y=S.source)==null?void 0:y[0])===":"?n(S,"MISSING_CHAR",`Missing space after : in ${a}`):n($.start,"MISSING_CHAR",`Missing , or : between ${a} items`));let K=S?r(e,S,$,n):$.found?t(e,$.end,B,null,$,n):null;K?Vn(S)&&n(K.range,"BLOCK_IN_FLOW",Kn):$.comment&&(I.comment?I.comment+=`
`+$.comment:I.comment=$.comment);let V=new F(I,K);if(e.options.keepSourceTokens&&(V.srcToken=v),o){let z=c;Rs(e,z.items,I)&&n(O,"DUPLICATE_KEY","Map keys must be unique"),z.items.push(V)}else{let z=new R(e.schema);z.flow=!0,z.items.push(V);let zt=(K!=null?K:I).range;z.range=[I.range[0],zt[1],zt[2]],c.items.push(z)}u=K?K.range[2]:$.end}}let p=o?"}":"]",[h,...g]=s.end,f=u;if((h==null?void 0:h.source)===p)f=h.offset+h.source.length;else{let k=a[0].toUpperCase()+a.substring(1),v=d?`${k} must end with a ${p}`:`${k} in block collection must be sufficiently indented and end with a ${p}`;n(u,d?"MISSING_CHAR":"BAD_INDENT",v),h&&h.source.length!==1&&g.unshift(h)}if(g.length>0){let k=he(g,f,e.options.strict,n);k.comment&&(c.comment?c.comment+=`
`+k.comment:c.comment=k.comment),c.range=[s.offset,f,k.offset]}else c.range=[s.offset,f,f];return c}var Kn,Vn,oi=x(()=>{L();Pe();Le();De();rt();Ot();Ms();qn();Kn="Block collections are not allowed within flow collections",Vn=r=>r&&(r.type==="block-map"||r.type==="block-seq")});function zn(r,t,e,s,n,i){let o=e.type==="block-map"?ti(r,t,e,s,i):e.type==="block-seq"?ni(r,t,e,s,i):ii(r,t,e,s,i),a=o.constructor;return n==="!"||n===a.tagName?(o.tag=a.tagName,o):(n&&(o.tag=n),o)}function ai(r,t,e,s,n){var p,h,g;let i=s.tag,o=i?t.directives.tagName(i.source,f=>n(i,"TAG_RESOLVE_FAILED",f)):null;if(e.type==="block-seq"){let{anchor:f,newlineAfterProp:m}=s,b=f&&i?f.offset>i.offset?f:i:f!=null?f:i;b&&(!m||m.offset<b.offset)&&n(b,"MISSING_CHAR","Missing newline after block sequence props")}let a=e.type==="block-map"?"map":e.type==="block-seq"?"seq":e.start.source==="{"?"map":"seq";if(!i||!o||o==="!"||o===R.tagName&&a==="map"||o===j.tagName&&a==="seq")return zn(r,t,e,n,o);let l=t.schema.tags.find(f=>f.tag===o&&f.collection===a);if(!l){let f=t.schema.knownTags[o];if((f==null?void 0:f.collection)===a)t.schema.tags.push(Object.assign({},f,{default:!1})),l=f;else return f?n(i,"BAD_COLLECTION_TYPE",`${f.tag} used for ${a} collection, but expects ${(p=f.collection)!=null?p:"scalar"}`,!0):n(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),zn(r,t,e,n,o)}let c=zn(r,t,e,n,o,l),d=(g=(h=l.resolve)==null?void 0:h.call(l,c,f=>n(i,"TAG_RESOLVE_FAILED",f),t.options))!=null?g:c,u=N(d)?d:new E(d);return u.range=c.range,u.tag=o,l!=null&&l.format&&(u.format=l.format),u}var li=x(()=>{L();_();Le();De();si();ri();oi()});function Hn(r,t,e){let s=t.offset,n=lo(t,r.options.strict,e);if(!n)return{value:"",type:null,comment:"",range:[s,s,s]};let i=n.mode===">"?E.BLOCK_FOLDED:E.BLOCK_LITERAL,o=t.source?co(t.source):[],a=o.length;for(let f=o.length-1;f>=0;--f){let m=o[f][1];if(m===""||m==="\r")a=f;else break}if(a===0){let f=n.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"",m=s+n.length;return t.source&&(m+=t.source.length),{value:f,type:i,comment:n.comment,range:[s,m,m]}}let l=t.indent+n.indent,c=t.offset+n.length,d=0;for(let f=0;f<a;++f){let[m,b]=o[f];if(b===""||b==="\r")n.indent===0&&m.length>l&&(l=m.length);else{m.length<l&&e(c+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),n.indent===0&&(l=m.length),d=f,l===0&&!r.atRoot&&e(c,"BAD_INDENT","Block scalar values in collections must be indented");break}c+=m.length+b.length+1}for(let f=o.length-1;f>=a;--f)o[f][0].length>l&&(a=f+1);let u="",p="",h=!1;for(let f=0;f<d;++f)u+=o[f][0].slice(l)+`
`;for(let f=d;f<a;++f){let[m,b]=o[f];c+=m.length+b.length+1;let y=b[b.length-1]==="\r";if(y&&(b=b.slice(0,-1)),b&&m.length<l){let v=`Block scalar lines must not be less indented than their ${n.indent?"explicit indentation indicator":"first line"}`;e(c-b.length-(y?2:1),"BAD_INDENT",v),m=""}i===E.BLOCK_LITERAL?(u+=p+m.slice(l)+b,p=`
`):m.length>l||b[0]==="	"?(p===" "?p=`
`:!h&&p===`
`&&(p=`

`),u+=p+m.slice(l)+b,p=`
`,h=!0):b===""?p===`
`?u+=`
`:p=`
`:(u+=p+b,p=" ",h=!1)}switch(n.chomp){case"-":break;case"+":for(let f=a;f<o.length;++f)u+=`
`+o[f][0].slice(l);u[u.length-1]!==`
`&&(u+=`
`);break;default:u+=`
`}let g=s+n.length+t.source.length;return{value:u,type:i,comment:n.comment,range:[s,g,g]}}function lo({offset:r,props:t},e,s){if(t[0].type!=="block-scalar-header")return s(t[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:n}=t[0],i=n[0],o=0,a="",l=-1;for(let p=1;p<n.length;++p){let h=n[p];if(!a&&(h==="-"||h==="+"))a=h;else{let g=Number(h);!o&&g?o=g:l===-1&&(l=r+p)}}l!==-1&&s(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let c=!1,d="",u=n.length;for(let p=1;p<t.length;++p){let h=t[p];switch(h.type){case"space":c=!0;case"newline":u+=h.source.length;break;case"comment":e&&!c&&s(h,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),u+=h.source.length,d=h.source.substring(1);break;case"error":s(h,"UNEXPECTED_TOKEN",h.message),u+=h.source.length;break;default:{let g=`Unexpected token in block scalar header: ${h.type}`;s(h,"UNEXPECTED_TOKEN",g);let f=h.source;f&&typeof f=="string"&&(u+=f.length)}}}return{mode:i,indent:o,chomp:a,comment:d,length:u}}function co(r){let t=r.split(/\n( *)/),e=t[0],s=e.match(/^( *)/),i=[s!=null&&s[1]?[s[1],e.slice(s[1].length)]:["",e]];for(let o=1;o<t.length;o+=2)i.push([t[o],t[o+1]]);return i}var Yn=x(()=>{_()});function Jn(r,t,e){let{offset:s,type:n,source:i,end:o}=r,a,l,c=(p,h,g)=>e(s+p,h,g);switch(n){case"scalar":a=E.PLAIN,l=fo(i,c);break;case"single-quoted-scalar":a=E.QUOTE_SINGLE,l=uo(i,c);break;case"double-quoted-scalar":a=E.QUOTE_DOUBLE,l=po(i,c);break;default:return e(r,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[s,s+i.length,s+i.length]}}let d=s+i.length,u=he(o,d,t,e);return{value:l,type:a,comment:u.comment,range:[s,d,u.offset]}}function fo(r,t){let e="";switch(r[0]){case"	":e="a tab character";break;case",":e="flow indicator character ,";break;case"%":e="directive indicator character %";break;case"|":case">":{e=`block scalar indicator ${r[0]}`;break}case"@":case"`":{e=`reserved character ${r[0]}`;break}}return e&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${e}`),ci(r)}function uo(r,t){return(r[r.length-1]!=="'"||r.length===1)&&t(r.length,"MISSING_CHAR","Missing closing 'quote"),ci(r.slice(1,-1)).replace(/''/g,"'")}function ci(r){var l;let t,e;try{t=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),e=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch(c){t=/(.*?)[ \t]*\r?\n/sy,e=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=t.exec(r);if(!s)return r;let n=s[1],i=" ",o=t.lastIndex;for(e.lastIndex=o;s=e.exec(r);)s[1]===""?i===`
`?n+=i:i=`
`:(n+=i+s[1],i=" "),o=e.lastIndex;let a=/[ \t]*(.*)/sy;return a.lastIndex=o,s=a.exec(r),n+i+((l=s==null?void 0:s[1])!=null?l:"")}function po(r,t){let e="";for(let s=1;s<r.length-1;++s){let n=r[s];if(!(n==="\r"&&r[s+1]===`
`))if(n===`
`){let{fold:i,offset:o}=ho(r,s);e+=i,s=o}else if(n==="\\"){let i=r[++s],o=mo[i];if(o)e+=o;else if(i===`
`)for(i=r[s+1];i===" "||i==="	";)i=r[++s+1];else if(i==="\r"&&r[s+1]===`
`)for(i=r[++s+1];i===" "||i==="	";)i=r[++s+1];else if(i==="x"||i==="u"||i==="U"){let a={x:2,u:4,U:8}[i];e+=go(r,s+1,a,t),s+=a}else{let a=r.substr(s-1,2);t(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),e+=a}}else if(n===" "||n==="	"){let i=s,o=r[s+1];for(;o===" "||o==="	";)o=r[++s+1];o!==`
`&&!(o==="\r"&&r[s+2]===`
`)&&(e+=s>i?r.slice(i,s+1):n)}else e+=n}return(r[r.length-1]!=='"'||r.length===1)&&t(r.length,"MISSING_CHAR",'Missing closing "quote'),e}function ho(r,t){let e="",s=r[t+1];for(;(s===" "||s==="	"||s===`
`||s==="\r")&&!(s==="\r"&&r[t+2]!==`
`);)s===`
`&&(e+=`
`),t+=1,s=r[t+1];return e||(e=" "),{fold:e,offset:t}}function go(r,t,e,s){let n=r.substr(t,e),o=n.length===e&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(o)){let a=r.substr(t-2,e+2);return s(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),a}return String.fromCodePoint(o)}var mo,Wn=x(()=>{_();rt();mo={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"}});function Gn(r,t,e,s){let{value:n,type:i,comment:o,range:a}=t.type==="block-scalar"?Hn(r,t,s):Jn(t,r.options.strict,s),l=e?r.directives.tagName(e.source,u=>s(e,"TAG_RESOLVE_FAILED",u)):null,c;r.options.stringKeys&&r.atKey?c=r.schema[G]:l?c=yo(r.schema,n,l,e,s):t.type==="scalar"?c=bo(r,n,t,s):c=r.schema[G];let d;try{let u=c.resolve(n,p=>s(e!=null?e:t,"TAG_RESOLVE_FAILED",p),r.options);d=A(u)?u:new E(u)}catch(u){let p=u instanceof Error?u.message:String(u);s(e!=null?e:t,"TAG_RESOLVE_FAILED",p),d=new E(n)}return d.range=a,d.source=n,i&&(d.type=i),l&&(d.tag=l),c.format&&(d.format=c.format),o&&(d.comment=o),d}function yo(r,t,e,s,n){var a;if(e==="!")return r[G];let i=[];for(let l of r.tags)if(!l.collection&&l.tag===e)if(l.default&&l.test)i.push(l);else return l;for(let l of i)if((a=l.test)!=null&&a.test(t))return l;let o=r.knownTags[e];return o&&!o.collection?(r.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(n(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${e}`,e!=="tag:yaml.org,2002:str"),r[G])}function bo({atKey:r,directives:t,schema:e},s,n,i){var a;let o=e.tags.find(l=>{var c;return(l.default===!0||r&&l.default==="key")&&((c=l.test)==null?void 0:c.test(s))})||e[G];if(e.compat){let l=(a=e.compat.find(c=>{var d;return c.default&&((d=c.test)==null?void 0:d.test(s))}))!=null?a:e[G];if(o.tag!==l.tag){let c=t.tagString(o.tag),d=t.tagString(l.tag),u=`Value may be parsed as either ${c} or ${d}`;i(n,"TAG_RESOLVE_FAILED",u,!0)}}return o}var di=x(()=>{L();_();Yn();Wn()});function fi(r,t,e){if(t){e!=null||(e=t.length);for(let s=e-1;s>=0;--s){let n=t[s];switch(n.type){case"space":case"comment":case"newline":r-=n.source.length;continue}for(n=t[++s];(n==null?void 0:n.type)==="space";)r+=n.source.length,n=t[++s];break}}return r}var ui=x(()=>{});function Qn(r,t,e,s){let n=r.atKey,{spaceBefore:i,comment:o,anchor:a,tag:l}=e,c,d=!0;switch(t.type){case"alias":c=wo(r,t,s),(a||l)&&s(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=Gn(r,t,l,s),a&&(c.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":c=ai(ko,r,t,e,s),a&&(c.anchor=a.source.substring(1));break;default:{let u=t.type==="error"?t.message:`Unsupported token (type: ${t.type})`;s(t,"UNEXPECTED_TOKEN",u),c=_s(r,t.offset,void 0,null,e,s),d=!1}}return a&&c.anchor===""&&s(a,"BAD_ALIAS","Anchor cannot be an empty string"),n&&r.options.stringKeys&&(!A(c)||typeof c.value!="string"||c.tag&&c.tag!=="tag:yaml.org,2002:str")&&s(l!=null?l:t,"NON_STRING_KEY","With stringKeys, all keys must be strings"),i&&(c.spaceBefore=!0),o&&(t.type==="scalar"&&t.source===""?c.comment=o:c.commentBefore=o),r.options.keepSourceTokens&&d&&(c.srcToken=t),c}function _s(r,t,e,s,{spaceBefore:n,comment:i,anchor:o,tag:a,end:l},c){let d={type:"scalar",offset:fi(t,e,s),indent:-1,source:""},u=Gn(r,d,a,c);return o&&(u.anchor=o.source.substring(1),u.anchor===""&&c(o,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(u.spaceBefore=!0),i&&(u.comment=i,u.range[2]=l),u}function wo({options:r},{offset:t,source:e,end:s},n){let i=new we(e.substring(1));i.source===""&&n(t,"BAD_ALIAS","Alias cannot be an empty string"),i.source.endsWith(":")&&n(t+e.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let o=t+e.length,a=he(s,o,r.strict,n);return i.range=[t,o,a.offset],a.comment&&(i.comment=a.comment),i}var ko,pi=x(()=>{pt();L();li();di();rt();ui();ko={composeNode:Qn,composeEmptyNode:_s}});function hi(r,t,{offset:e,start:s,value:n,end:i},o){let a=Object.assign({_directives:t},r),l=new Se(void 0,a),c={atKey:!1,atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},d=pe(s,{indicator:"doc-start",next:n!=null?n:i==null?void 0:i[0],offset:e,onError:o,parentIndent:0,startOnNewline:!0});d.found&&(l.directives.docStart=!0,n&&(n.type==="block-map"||n.type==="block-seq")&&!d.hasNewline&&o(d.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=n?Qn(c,n,d,o):_s(c,d.end,s,null,d,o);let u=l.contents.range[2],p=he(i,u,!1,o);return p.comment&&(l.comment=p.comment),l.range=[e,u,p.offset],l}var mi=x(()=>{Nt();pi();rt();Ot()});function $t(r){if(typeof r=="number")return[r,r+1];if(Array.isArray(r))return r.length===2?r:[r[0],r[1]];let{offset:t,source:e}=r;return[t,t+(typeof e=="string"?e.length:1)]}function gi(r){var n;let t="",e=!1,s=!1;for(let i=0;i<r.length;++i){let o=r[i];switch(o[0]){case"#":t+=(t===""?"":s?`

`:`
`)+(o.substring(1)||" "),e=!0,s=!1;break;case"%":((n=r[i+1])==null?void 0:n[0])!=="#"&&(i+=1),e=!1;break;default:e||(s=!0),e=!1}}return{comment:t,afterEmptyLine:s}}var Mt,Xn=x(()=>{un();Nt();It();L();mi();rt();Mt=class{constructor(t={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,s,n,i)=>{let o=$t(e);i?this.warnings.push(new Dt(o,s,n)):this.errors.push(new oe(o,s,n))},this.directives=new fe({version:t.version||"1.2"}),this.options=t}decorate(t,e){let{comment:s,afterEmptyLine:n}=gi(this.prelude);if(s){let i=t.contents;if(e)t.comment=t.comment?`${t.comment}
${s}`:s;else if(n||t.directives.docStart||!i)t.commentBefore=s;else if(D(i)&&!i.flow&&i.items.length>0){let o=i.items[0];P(o)&&(o=o.key);let a=o.commentBefore;o.commentBefore=a?`${s}
${a}`:s}else{let o=i.commentBefore;i.commentBefore=o?`${s}
${o}`:s}}e?(Array.prototype.push.apply(t.errors,this.errors),Array.prototype.push.apply(t.warnings,this.warnings)):(t.errors=this.errors,t.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:gi(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(t,e=!1,s=-1){for(let n of t)yield*this.next(n);yield*this.end(e,s)}*next(t){switch(t.type){case"directive":this.directives.add(t.source,(e,s,n)=>{let i=$t(t);i[0]+=e,this.onError(i,"BAD_DIRECTIVE",s,n)}),this.prelude.push(t.source),this.atDirectives=!0;break;case"document":{let e=hi(this.options,this.directives,t,this.onError);this.atDirectives&&!e.directives.docStart&&this.onError(t,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(e,!1),this.doc&&(yield this.doc),this.doc=e,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(t.source);break;case"error":{let e=t.source?`${t.message}: ${JSON.stringify(t.source)}`:t.message,s=new oe($t(t),"UNEXPECTED_TOKEN",e);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){let s="Unexpected doc-end without preceding document";this.errors.push(new oe($t(t),"UNEXPECTED_TOKEN",s));break}this.doc.directives.docEnd=!0;let e=he(t.end,t.offset+t.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),e.comment){let s=this.doc.comment;this.doc.comment=s?`${s}
${e.comment}`:e.comment}this.doc.range[2]=e.offset;break}default:this.errors.push(new oe($t(t),"UNEXPECTED_TOKEN",`Unsupported token ${t.type}`))}}*end(t=!1,e=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(t){let s=Object.assign({_directives:this.directives},this.options),n=new Se(void 0,s);this.atDirectives&&this.onError(e,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,e,e],this.decorate(n,!1),yield n}}}});var yi=x(()=>{Yn();Wn();It();wt()});var bi=x(()=>{});function je(r,t){"type"in r&&r.type==="document"&&(r={start:r.start,value:r.value}),wi(Object.freeze([]),r,t)}function wi(r,t,e){let s=e(t,r);if(typeof s=="symbol")return s;for(let n of["key","value"]){let i=t[n];if(i&&"items"in i){for(let o=0;o<i.items.length;++o){let a=wi(Object.freeze(r.concat([[n,o]])),i.items[o],e);if(typeof a=="number")o=a-1;else{if(a===Zn)return Zn;a===ki&&(i.items.splice(o,1),o-=1)}}typeof s=="function"&&n==="key"&&(s=s(t,r))}}return typeof s=="function"?s(t,r):s}var Zn,vo,ki,vi=x(()=>{Zn=Symbol("break visit"),vo=Symbol("skip children"),ki=Symbol("remove item");je.BREAK=Zn;je.SKIP=vo;je.REMOVE=ki;je.itemAtPath=(r,t)=>{let e=r;for(let[s,n]of t){let i=e==null?void 0:e[s];if(i&&"items"in i)e=i.items[n];else return}return e};je.parentCollection=(r,t)=>{let e=je.itemAtPath(r,t.slice(0,-1)),s=t[t.length-1][0],n=e==null?void 0:e[s];if(n&&"items"in n)return n;throw new Error("Parent collection not found")}});function xi(r){switch(r){case er:return"byte-order-mark";case tr:return"doc-mode";case sr:return"flow-error-end";case Us:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(r[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}var er,tr,sr,Us,js=x(()=>{yi();bi();vi();er="\uFEFF",tr="",sr="",Us=""});function ae(r){switch(r){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}var Si,So,qs,Eo,nr,Rt,rr=x(()=>{js();Si=new Set("0123456789ABCDEFabcdef"),So=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),qs=new Set(",[]{}"),Eo=new Set(` ,[]{}
\r	`),nr=r=>!r||Eo.has(r),Rt=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(t,e=!1){var n;if(t){if(typeof t!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+t:t,this.lineEndPos=null}this.atEnd=!e;let s=(n=this.next)!=null?n:"stream";for(;s&&(e||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let t=this.pos,e=this.buffer[t];for(;e===" "||e==="	";)e=this.buffer[++t];return!e||e==="#"||e===`
`?!0:e==="\r"?this.buffer[t+1]===`
`:!1}charAt(t){return this.buffer[this.pos+t]}continueScalar(t){let e=this.buffer[t];if(this.indentNext>0){let s=0;for(;e===" ";)e=this.buffer[++s+t];if(e==="\r"){let n=this.buffer[s+t+1];if(n===`
`||!n&&!this.atEnd)return t+s+1}return e===`
`||s>=this.indentNext||!e&&!this.atEnd?t+s:-1}if(e==="-"||e==="."){let s=this.buffer.substr(t,3);if((s==="---"||s==="...")&&ae(this.buffer[t+3]))return-1}return t}getLine(){let t=this.lineEndPos;return(typeof t!="number"||t!==-1&&t<this.pos)&&(t=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=t),t===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[t-1]==="\r"&&(t-=1),this.buffer.substring(this.pos,t))}hasChars(t){return this.pos+t<=this.buffer.length}setNext(t){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=t,null}peek(t){return this.buffer.substr(this.pos,t)}*parseNext(t){switch(t){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let t=this.getLine();if(t===null)return this.setNext("stream");if(t[0]===er&&(yield*this.pushCount(1),t=t.substring(1)),t[0]==="%"){let e=t.length,s=t.indexOf("#");for(;s!==-1;){let i=t[s-1];if(i===" "||i==="	"){e=s-1;break}else s=t.indexOf("#",s+1)}for(;;){let i=t[e-1];if(i===" "||i==="	")e-=1;else break}let n=(yield*this.pushCount(e))+(yield*this.pushSpaces(!0));return yield*this.pushCount(t.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){let e=yield*this.pushSpaces(!0);return yield*this.pushCount(t.length-e),yield*this.pushNewline(),"stream"}return yield tr,yield*this.parseLineStart()}*parseLineStart(){let t=this.charAt(0);if(!t&&!this.atEnd)return this.setNext("line-start");if(t==="-"||t==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let e=this.peek(3);if((e==="---"||e==="...")&&ae(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,e==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!ae(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[t,e]=this.peek(2);if(!e&&!this.atEnd)return this.setNext("block-start");if((t==="-"||t==="?"||t===":")&&ae(e)){let s=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=s,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let t=this.getLine();if(t===null)return this.setNext("doc");let e=yield*this.pushIndicators();switch(t[e]){case"#":yield*this.pushCount(t.length-e);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(nr),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return e+=yield*this.parseBlockScalarHeader(),e+=yield*this.pushSpaces(!0),yield*this.pushCount(t.length-e),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let t,e,s=-1;do t=yield*this.pushNewline(),t>0?(e=yield*this.pushSpaces(!1),this.indentValue=s=e):e=0,e+=yield*this.pushSpaces(!0);while(t+e>0);let n=this.getLine();if(n===null)return this.setNext("flow");if((s!==-1&&s<this.indentNext&&n[0]!=="#"||s===0&&(n.startsWith("---")||n.startsWith("..."))&&ae(n[3]))&&!(s===this.indentNext-1&&this.flowLevel===1&&(n[0]==="]"||n[0]==="}")))return this.flowLevel=0,yield sr,yield*this.parseLineStart();let i=0;for(;n[i]===",";)i+=yield*this.pushCount(1),i+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(i+=yield*this.pushIndicators(),n[i]){case void 0:return"flow";case"#":return yield*this.pushCount(n.length-i),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(nr),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let o=this.charAt(1);if(this.flowKey||ae(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let t=this.charAt(0),e=this.buffer.indexOf(t,this.pos+1);if(t==="'")for(;e!==-1&&this.buffer[e+1]==="'";)e=this.buffer.indexOf("'",e+2);else for(;e!==-1;){let i=0;for(;this.buffer[e-1-i]==="\\";)i+=1;if(i%2===0)break;e=this.buffer.indexOf('"',e+1)}let s=this.buffer.substring(0,e),n=s.indexOf(`
`,this.pos);if(n!==-1){for(;n!==-1;){let i=this.continueScalar(n+1);if(i===-1)break;n=s.indexOf(`
`,i)}n!==-1&&(e=n-(s[n-1]==="\r"?2:1))}if(e===-1){if(!this.atEnd)return this.setNext("quoted-scalar");e=this.buffer.length}return yield*this.pushToIndex(e+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let t=this.pos;for(;;){let e=this.buffer[++t];if(e==="+")this.blockScalarKeep=!0;else if(e>"0"&&e<="9")this.blockScalarIndent=Number(e)-1;else if(e!=="-")break}return yield*this.pushUntil(e=>ae(e)||e==="#")}*parseBlockScalar(){let t=this.pos-1,e=0,s;e:for(let i=this.pos;s=this.buffer[i];++i)switch(s){case" ":e+=1;break;case`
`:t=i,e=0;break;case"\r":{let o=this.buffer[i+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!s&&!this.atEnd)return this.setNext("block-scalar");if(e>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=e:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{let i=this.continueScalar(t+1);if(i===-1)break;t=this.buffer.indexOf(`
`,i)}while(t!==-1);if(t===-1){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}let n=t+1;for(s=this.buffer[n];s===" ";)s=this.buffer[++n];if(s==="	"){for(;s==="	"||s===" "||s==="\r"||s===`
`;)s=this.buffer[++n];t=n-1}else if(!this.blockScalarKeep)do{let i=t-1,o=this.buffer[i];o==="\r"&&(o=this.buffer[--i]);let a=i;for(;o===" ";)o=this.buffer[--i];if(o===`
`&&i>=this.pos&&i+1+e>a)t=i;else break}while(!0);return yield Us,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let t=this.flowLevel>0,e=this.pos-1,s=this.pos-1,n;for(;n=this.buffer[++s];)if(n===":"){let i=this.buffer[s+1];if(ae(i)||t&&qs.has(i))break;e=s}else if(ae(n)){let i=this.buffer[s+1];if(n==="\r"&&(i===`
`?(s+=1,n=`
`,i=this.buffer[s+1]):e=s),i==="#"||t&&qs.has(i))break;if(n===`
`){let o=this.continueScalar(s+1);if(o===-1)break;s=Math.max(s,o-2)}}else{if(t&&qs.has(n))break;e=s}return!n&&!this.atEnd?this.setNext("plain-scalar"):(yield Us,yield*this.pushToIndex(e+1,!0),t?"flow":"doc")}*pushCount(t){return t>0?(yield this.buffer.substr(this.pos,t),this.pos+=t,t):0}*pushToIndex(t,e){let s=this.buffer.slice(this.pos,t);return s?(yield s,this.pos+=s.length,s.length):(e&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(nr))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let t=this.flowLevel>0,e=this.charAt(1);if(ae(e)||t&&qs.has(e))return t?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let t=this.pos+2,e=this.buffer[t];for(;!ae(e)&&e!==">";)e=this.buffer[++t];return yield*this.pushToIndex(e===">"?t+1:t,!1)}else{let t=this.pos+1,e=this.buffer[t];for(;e;)if(So.has(e))e=this.buffer[++t];else if(e==="%"&&Si.has(this.buffer[t+1])&&Si.has(this.buffer[t+2]))e=this.buffer[t+=3];else break;return yield*this.pushToIndex(t,!1)}}*pushNewline(){let t=this.buffer[this.pos];return t===`
`?yield*this.pushCount(1):t==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(t){let e=this.pos-1,s;do s=this.buffer[++e];while(s===" "||t&&s==="	");let n=e-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=e),n}*pushUntil(t){let e=this.pos,s=this.buffer[e];for(;!t(s);)s=this.buffer[++e];return yield*this.pushToIndex(e,!1)}}});var _t,ir=x(()=>{_t=class{constructor(){this.lineStarts=[],this.addNewLine=t=>this.lineStarts.push(t),this.linePos=t=>{let e=0,s=this.lineStarts.length;for(;e<s;){let i=e+s>>1;this.lineStarts[i]<t?e=i+1:s=i}if(this.lineStarts[e]===t)return{line:e+1,col:1};if(e===0)return{line:0,col:t};let n=this.lineStarts[e-1];return{line:e,col:t-n+1}}}}});function Fe(r,t){for(let e=0;e<r.length;++e)if(r[e].type===t)return!0;return!1}function Ei(r){for(let t=0;t<r.length;++t)switch(r[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function Ci(r){switch(r==null?void 0:r.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Ks(r){var t;switch(r.type){case"document":return r.start;case"block-map":{let e=r.items[r.items.length-1];return(t=e.sep)!=null?t:e.start}case"block-seq":return r.items[r.items.length-1].start;default:return[]}}function it(r){var e;if(r.length===0)return[];let t=r.length;e:for(;--t>=0;)switch(r[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((e=r[++t])==null?void 0:e.type)==="space";);return r.splice(t,r.length)}function Ti(r){if(r.start.type==="flow-seq-start")for(let t of r.items)t.sep&&!t.value&&!Fe(t.start,"explicit-key-ind")&&!Fe(t.sep,"map-value-ind")&&(t.key&&(t.value=t.key),delete t.key,Ci(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}var Ut,or=x(()=>{js();rr();Ut=class{constructor(t){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Rt,this.onNewLine=t}*parse(t,e=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let s of this.lexer.lex(t,e))yield*this.next(s);e||(yield*this.end())}*next(t){if(this.source=t,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=t.length;return}let e=xi(t);if(e)if(e==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=e,yield*this.step(),e){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+t.length);break;case"space":this.atNewLine&&t[0]===" "&&(this.indent+=t.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=t.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=t.length}else{let s=`Not a YAML token: ${t}`;yield*this.pop({type:"error",offset:this.offset,message:s,source:t}),this.offset+=t.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let t=this.peek(1);if(this.type==="doc-end"&&(t==null?void 0:t.type)!=="doc-end"){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!t)return yield*this.stream();switch(t.type){case"document":return yield*this.document(t);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(t);case"block-scalar":return yield*this.blockScalar(t);case"block-map":return yield*this.blockMap(t);case"block-seq":return yield*this.blockSequence(t);case"flow-collection":return yield*this.flowCollection(t);case"doc-end":return yield*this.documentEnd(t)}yield*this.pop()}peek(t){return this.stack[this.stack.length-t]}*pop(t){let e=t!=null?t:this.stack.pop();if(!e)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield e;else{let s=this.peek(1);switch(e.type==="block-scalar"?e.indent="indent"in s?s.indent:0:e.type==="flow-collection"&&s.type==="document"&&(e.indent=0),e.type==="flow-collection"&&Ti(e),s.type){case"document":s.value=e;break;case"block-scalar":s.props.push(e);break;case"block-map":{let n=s.items[s.items.length-1];if(n.value){s.items.push({start:[],key:e,sep:[]}),this.onKeyLine=!0;return}else if(n.sep)n.value=e;else{Object.assign(n,{key:e,sep:[]}),this.onKeyLine=!n.explicitKey;return}break}case"block-seq":{let n=s.items[s.items.length-1];n.value?s.items.push({start:[],value:e}):n.value=e;break}case"flow-collection":{let n=s.items[s.items.length-1];!n||n.value?s.items.push({start:[],key:e,sep:[]}):n.sep?n.value=e:Object.assign(n,{key:e,sep:[]});return}default:yield*this.pop(),yield*this.pop(e)}if((s.type==="document"||s.type==="block-map"||s.type==="block-seq")&&(e.type==="block-map"||e.type==="block-seq")){let n=e.items[e.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&Ei(n.start)===-1&&(e.indent===0||n.start.every(i=>i.type!=="comment"||i.indent<e.indent))&&(s.type==="document"?s.end=n.start:s.items.push({start:n.start}),e.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let t={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&t.start.push(this.sourceToken),this.stack.push(t);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(t){if(t.value)return yield*this.lineEnd(t);switch(this.type){case"doc-start":{Ei(t.start)!==-1?(yield*this.pop(),yield*this.step()):t.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":t.start.push(this.sourceToken);return}let e=this.startBlockValue(t);e?this.stack.push(e):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(t){if(this.type==="map-value-ind"){let e=Ks(this.peek(2)),s=it(e),n;t.end?(n=t.end,n.push(this.sourceToken),delete t.end):n=[this.sourceToken];let i={type:"block-map",offset:t.offset,indent:t.indent,items:[{start:s,key:t,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=i}else yield*this.lineEnd(t)}*blockScalar(t){switch(this.type){case"space":case"comment":case"newline":t.props.push(this.sourceToken);return;case"scalar":if(t.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf(`
`)+1;for(;e!==0;)this.onNewLine(this.offset+e),e=this.source.indexOf(`
`,e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(t){var s;let e=t.items[t.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,e.value){let n="end"in e.value?e.value.end:void 0,i=Array.isArray(n)?n[n.length-1]:void 0;(i==null?void 0:i.type)==="comment"?n==null||n.push(this.sourceToken):t.items.push({start:[this.sourceToken]})}else e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"space":case"comment":if(e.value)t.items.push({start:[this.sourceToken]});else if(e.sep)e.sep.push(this.sourceToken);else{if(this.atIndentedComment(e.start,t.indent)){let n=t.items[t.items.length-2],i=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(i)){Array.prototype.push.apply(i,e.start),i.push(this.sourceToken),t.items.pop();return}}e.start.push(this.sourceToken)}return}if(this.indent>=t.indent){let n=!this.onKeyLine&&this.indent===t.indent,i=n&&(e.sep||e.explicitKey)&&this.type!=="seq-item-ind",o=[];if(i&&e.sep&&!e.value){let a=[];for(let l=0;l<e.sep.length;++l){let c=e.sep[l];switch(c.type){case"newline":a.push(l);break;case"space":break;case"comment":c.indent>t.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(o=e.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":i||e.value?(o.push(this.sourceToken),t.items.push({start:o}),this.onKeyLine=!0):e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"explicit-key-ind":!e.sep&&!e.explicitKey?(e.start.push(this.sourceToken),e.explicitKey=!0):i||e.value?(o.push(this.sourceToken),t.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(e.explicitKey)if(e.sep)if(e.value)t.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Fe(e.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(Ci(e.key)&&!Fe(e.sep,"newline")){let a=it(e.start),l=e.key,c=e.sep;c.push(this.sourceToken),delete e.key,delete e.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:l,sep:c}]})}else o.length>0?e.sep=e.sep.concat(o,this.sourceToken):e.sep.push(this.sourceToken);else if(Fe(e.start,"newline"))Object.assign(e,{key:null,sep:[this.sourceToken]});else{let a=it(e.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else e.sep?e.value||i?t.items.push({start:o,key:null,sep:[this.sourceToken]}):Fe(e.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):e.sep.push(this.sourceToken):Object.assign(e,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let a=this.flowScalar(this.type);i||e.value?(t.items.push({start:o,key:a,sep:[]}),this.onKeyLine=!0):e.sep?this.stack.push(a):(Object.assign(e,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{let a=this.startBlockValue(t);if(a){if(a.type==="block-seq"){if(!e.explicitKey&&e.sep&&!Fe(e.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else n&&t.items.push({start:o});this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(t){var s;let e=t.items[t.items.length-1];switch(this.type){case"newline":if(e.value){let n="end"in e.value?e.value.end:void 0,i=Array.isArray(n)?n[n.length-1]:void 0;(i==null?void 0:i.type)==="comment"?n==null||n.push(this.sourceToken):t.items.push({start:[this.sourceToken]})}else e.start.push(this.sourceToken);return;case"space":case"comment":if(e.value)t.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(e.start,t.indent)){let n=t.items[t.items.length-2],i=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(i)){Array.prototype.push.apply(i,e.start),i.push(this.sourceToken),t.items.pop();return}}e.start.push(this.sourceToken)}return;case"anchor":case"tag":if(e.value||this.indent<=t.indent)break;e.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==t.indent)break;e.value||Fe(e.start,"seq-item-ind")?t.items.push({start:[this.sourceToken]}):e.start.push(this.sourceToken);return}if(this.indent>t.indent){let n=this.startBlockValue(t);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(t){let e=t.items[t.items.length-1];if(this.type==="flow-error-end"){let s;do yield*this.pop(),s=this.peek(1);while((s==null?void 0:s.type)==="flow-collection")}else if(t.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!e||e.sep?t.items.push({start:[this.sourceToken]}):e.start.push(this.sourceToken);return;case"map-value-ind":!e||e.value?t.items.push({start:[],key:null,sep:[this.sourceToken]}):e.sep?e.sep.push(this.sourceToken):Object.assign(e,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!e||e.value?t.items.push({start:[this.sourceToken]}):e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let n=this.flowScalar(this.type);!e||e.value?t.items.push({start:[],key:n,sep:[]}):e.sep?this.stack.push(n):Object.assign(e,{key:n,sep:[]});return}case"flow-map-end":case"flow-seq-end":t.end.push(this.sourceToken);return}let s=this.startBlockValue(t);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{let s=this.peek(2);if(s.type==="block-map"&&(this.type==="map-value-ind"&&s.indent===t.indent||this.type==="newline"&&!s.items[s.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&s.type!=="flow-collection"){let n=Ks(s),i=it(n);Ti(t);let o=t.end.splice(1,t.end.length);o.push(this.sourceToken);let a={type:"block-map",offset:t.offset,indent:t.indent,items:[{start:i,key:t,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(t)}}flowScalar(t){if(this.onNewLine){let e=this.source.indexOf(`
`)+1;for(;e!==0;)this.onNewLine(this.offset+e),e=this.source.indexOf(`
`,e)+1}return{type:t,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(t){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let e=Ks(t),s=it(e);return s.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;let e=Ks(t),s=it(e);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(t,e){return this.type!=="comment"||this.indent<=e?!1:t.every(s=>s.type==="newline"||s.type==="space")}*documentEnd(t){this.type!=="doc-mode"&&(t.end?t.end.push(this.sourceToken):t.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(t){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:t.end?t.end.push(this.sourceToken):t.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}});function To(r){let t=r.prettyErrors!==!1;return{lineCounter:r.lineCounter||t&&new _t||null,prettyErrors:t}}function Bi(r,t={}){let{lineCounter:e,prettyErrors:s}=To(t),n=new Ut(e==null?void 0:e.addNewLine),i=new Mt(t),o=null;for(let a of i.compose(n.parse(r),!0,r.length))if(!o)o=a;else if(o.options.logLevel!=="silent"){o.errors.push(new oe(a.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return s&&e&&(o.errors.forEach(Un(r,e)),o.warnings.forEach(Un(r,e))),o}function ar(r,t,e){let s;typeof t=="function"?s=t:e===void 0&&t&&typeof t=="object"&&(e=t);let n=Bi(r,e);if(!n)return null;if(n.warnings.forEach(i=>gs(n.options.logLevel,i)),n.errors.length>0){if(n.options.logLevel!=="silent")throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:s},e))}function lr(r,t,e){var n;let s=null;if(typeof t=="function"||Array.isArray(t)?s=t:e===void 0&&t&&(e=t),typeof e=="string"&&(e=e.length),typeof e=="number"){let i=Math.round(e);e=i<1?void 0:i>8?{indent:8}:{indent:i}}if(r===void 0){let{keepUndefined:i}=(n=e!=null?e:t)!=null?n:{};if(!i)return}return ee(r)&&!s?r.toString(e):new Se(r,s,e).toString(e)}var Ai=x(()=>{Xn();Nt();It();kn();L();ir();or()});var cr=x(()=>{Xn();Nt();_n();It();pt();L();Pe();_();Le();De();js();rr();ir();or();Ai();ut()});var dr=x(()=>{cr();cr()});var Ee,Vs=x(()=>{dr();Ee=class{static create(t){let e={};for(let[s,n]of Object.entries(t))if(n!=null&&s!=="reading_history"){if(n===""){(s==="title"||s==="author"||s==="status")&&(e[s]=n);continue}if(Array.isArray(n)){if(n.length===0){s==="reading_history_summary"&&(e[s]=[]);continue}if(s==="reading_history_summary"){let i=n.filter(o=>o&&typeof o=="object"&&!Array.isArray(o));e[s]=i.length>0?i:[]}else e[s]=n}else e[s]=n}try{return`---
${lr(e,{lineWidth:0,defaultStringType:"QUOTE_DOUBLE",defaultKeyType:"PLAIN"})}---`}catch(s){return console.error("[FrontmatterCreator] Error creating YAML:",s),`---
---`}}}});var zs,Pi=x(()=>{Re();zs=class{processTemplate(t,e){let s=this.prepareTemplateData(e);return this.replacePlaceholders(t,s)}getDefaultTemplate(){return this.getDefaultTemplateContent()}prepareTemplateData(t){var e,s;return{title:t.title||"",subtitle:t.subtitle||"",author:this.formatAuthorArray(t.author||[]),category:this.formatArray(t.category||[]),publisher:t.publisher||"",publishDate:t.publishDate||"",totalPage:((e=t.totalPages)==null?void 0:e.toString())||"",isbn10:t.isbn10||"",isbn13:t.isbn13||"",coverUrl:t.coverUrl||"",page:((s=t.readPage)==null?void 0:s.toString())||"0"}}formatAuthorArray(t){return t.length===0?"":t.map(e=>`"${e}"`).join(", ")}formatArray(t){return t.length===0?"":t.map(e=>`"${e}"`).join(", ")}replacePlaceholders(t,e){let s=t;s=s.replace(/<%[\s\S]*?%>/g,""),s=s.replace(/^%%[\s\S]*?%%$/gm,""),s=s.replace(/\{\{DATE:([^}]+)\}\}/g,(n,i)=>ft(new Date,i));for(let[n,i]of Object.entries(e)){let o=new RegExp(`\\{\\{${n}\\}\\}`,"g");s=s.replace(o,i)}return s=s.replace(/\n{3,}/g,`

`),s.trim()}getDefaultTemplateContent(){return`# {{title}}

%% To use an image URL from the server, use the following syntax: %%
<%* if (tp.frontmatter.cover && tp.frontmatter.cover.trim() !== "") { tR += \`![cover|150](\${tp.frontmatter.cover})\` } %>
`}}});var Ys,Hs,Ni=x(()=>{Ys=require("obsidian");ln();cn();Xt();es();Vs();Pi();Hs=class{constructor(t){this.app=t,this.folderManager=new Ke(t),this.templateProcessor=new zs}async create(t,e){let s=Y.getBooksFolderPath(e);await this.folderManager.ensureFolder(s);let n=Ve.generate(t.title),i=(0,Ys.normalizePath)(`${s}/${n}.md`),o=this.app.vault.getAbstractFileByPath(i);if(o instanceof Ys.TFile)throw new Error(`Book note already exists: ${o.path}`);let a=be.bookToFrontmatter(t),l=Ee.create(a),c=this.templateProcessor.getDefaultTemplate(),u=this.templateProcessor.processTemplate(c,t).trim()||`# ${t.title}
`,p=`${l}
${u}`;return await this.app.vault.create(i,p)}}});var ot={};Ht(ot,{FrontmatterParser:()=>me});var me,Te=x(()=>{dr();me=class r{static parse(t){let e=/^---\s*\n([\s\S]*?)\n---\s*\n/,s=t.match(e);if(!s||!s[1])return{};let n=s[1];try{let i=ar(n);if(!i||typeof i!="object")return{};let o={};for(let[a,l]of Object.entries(i))if(a!=="reading_history"){if(a==="reading_history_summary"){o[a]=r.normalizeReadingHistorySummary(l);continue}if(l===""){a==="title"||a==="status"?o[a]=l:a==="author"&&(o[a]=[]);continue}o[a]=l}return o}catch(i){return console.error("[FrontmatterParser] Error parsing YAML:",i),{}}}static extract(t){let e=/^---\s*\n([\s\S]*?)\n---\s*\n/,s=t.match(e);if(!s)return{frontmatter:{},body:t};let n=r.parse(t),i=t.substring(s[0].length);return{frontmatter:n,body:i}}static normalizeReadingHistorySummary(t){return t==null||t===""?[]:Array.isArray(t)?t.filter(e=>e&&typeof e=="object"&&!Array.isArray(e)):[]}}});var Js,Li=x(()=>{Js=class{static validateAndFixBook(t){let e={...t};return e.readPage!==void 0&&e.readPage<0&&(e.readPage=0),e.totalPages!==void 0&&e.totalPages<0&&(e.totalPages=void 0),e.readPage!==void 0&&e.totalPages!==void 0&&e.readPage>e.totalPages&&(e.readPage=e.totalPages),e.status&&!["unread","reading","finished"].includes(e.status)&&(e.status="unread"),(!e.title||e.title.trim().length===0)&&(e.title="Unknown title"),e}}});var Ws,ge,jt=x(()=>{Ws=require("obsidian");Te();es();Li();cn();ge=class{constructor(t){this.app=t}async read(t,e=!0){let s=await this.app.vault.read(t),{frontmatter:n}=me.extract(s),i=be.frontmatterToBook(n);return e?Js.validateAndFixBook(i):i}async findExisting(t,e){let s=`${Ve.generate(e)}.md`,n=(0,Ws.normalizePath)(`${t}/${s}`),i=this.app.vault.getAbstractFileByPath(n);return i instanceof Ws.TFile?i:null}}});var fr={};Ht(fr,{SearchModal:()=>qe});var Gs,qe,qt=x(()=>{Gs=require("obsidian");gr();Ni();jt();Xt();qe=class extends Gs.Modal{constructor(e,s){super(e);this.searchTimeout=null;this.currentResults=[];this.currentOffset=0;this.hasMoreResults=!1;this.isLoadingMore=!1;this.plugin=s,this.openLibraryClient=new Wt(this.plugin.settings.apiTimeout),this.bookFileCreator=new Hs(e),this.bookFileReader=new ge(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Search Books"}),new Gs.Setting(e).setName("Search query").setDesc("Enter book title, author, or ISBN").addText(s=>{this.searchInput=s.inputEl,this.searchInput.placeholder="Search for books...",this.searchInput.addEventListener("input",()=>{this.handleSearchInput()})}),this.loadingIndicator=e.createEl("div",{cls:"bookshelf-loading",text:"Searching..."}),this.loadingIndicator.style.display="none",this.resultsContainer=e.createEl("div",{cls:"bookshelf-search-results"}),this.resultsContainer.style.cssText="max-height: 60vh; overflow-y: auto; margin-top: 16px;",this.resultsContainer.addEventListener("scroll",()=>{this.handleScroll()}),this.searchInput.focus()}onClose(){let{contentEl:e}=this;e.empty(),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null)}handleSearchInput(){let e=this.searchInput.value.trim();if(this.searchTimeout&&clearTimeout(this.searchTimeout),e.length<2){this.resultsContainer.empty(),this.hideLoading(),this.hideError(),this.currentResults=[],this.currentOffset=0,this.hasMoreResults=!1;return}this.showLoading(),this.hideError(),this.currentResults=[],this.currentOffset=0,this.hasMoreResults=!1,this.searchTimeout=setTimeout(()=>{this.performSearch(e,0)},500)}async performSearch(e,s=0){try{let n=this.plugin.settings.searchResultLimit||20,i=await this.openLibraryClient.searchBooks(e,n,s);s===0?this.currentResults=i:this.currentResults=[...this.currentResults,...i],this.hasMoreResults=i.length===n,this.currentOffset=s+i.length,this.renderResults(this.currentResults),this.hideLoading(),this.isLoadingMore=!1}catch(n){this.hideLoading(),this.showError("Failed to search books. Please try again later."),s===0&&this.resultsContainer.empty(),this.isLoadingMore=!1}}handleScroll(){if(this.isLoadingMore||!this.hasMoreResults)return;let e=this.resultsContainer,s=e.scrollTop,n=e.scrollHeight,i=e.clientHeight;s+i>=n*.8&&this.loadMoreResults()}async loadMoreResults(){if(this.isLoadingMore||!this.hasMoreResults)return;let e=this.searchInput.value.trim();e&&(this.isLoadingMore=!0,await this.performSearch(e,this.currentOffset))}renderResults(e){if(this.currentOffset===e.length&&this.resultsContainer.empty(),e.length===0&&this.currentOffset===0){this.resultsContainer.createEl("div",{cls:"bookshelf-no-results",text:"No books found. Try a different search query."});return}if(e.forEach((s,n)=>{if(n<this.currentOffset-e.length)return;let i=this.resultsContainer.createEl("div",{cls:"bookshelf-result-item"});if(s.coverUrl){let c=i.createEl("div",{cls:"bookshelf-result-cover"}).createEl("img",{attr:{src:s.coverUrl,alt:s.title}});c.style.width="80px",c.style.height="120px",c.style.objectFit="cover"}let o=i.createEl("div",{cls:"bookshelf-result-info"});o.createEl("div",{cls:"bookshelf-result-title",text:s.title}),s.author&&s.author.length>0&&o.createEl("div",{cls:"bookshelf-result-author",text:`by ${s.author.join(", ")}`}),s.publishDate&&o.createEl("div",{cls:"bookshelf-result-meta",text:`Published: ${s.publishDate}`}),s.publisher&&o.createEl("div",{cls:"bookshelf-result-meta",text:`Publisher: ${s.publisher}`}),o.createEl("button",{cls:"mod-cta",text:"Add Book"}).addEventListener("click",async()=>{await this.addBook(s)}),n<e.length-1&&i.createEl("hr")}),this.isLoadingMore){let s=this.resultsContainer.createEl("div",{cls:"bookshelf-loading-more",text:"Loading more..."});s.style.cssText="text-align: center; padding: 16px; color: var(--text-muted);"}}async addBook(e){try{this.setButtonsState(!0,"Adding...");let n={...await this.fetchDetailedBookInfo(e),status:this.plugin.settings.defaultStatus};await this.validateBookNotExists(n);let i=await this.bookFileCreator.create(n,this.plugin.settings.bookFolder);this.showSuccess(`Book "${n.title}" added successfully!`),this.triggerViewRefresh(i),setTimeout(()=>this.close(),1e3),this.setButtonsState(!1,"Add Book")}catch(s){this.showError(`Failed to add book: ${s instanceof Error?s.message:"Unknown error"}`),this.setButtonsState(!1,"Add Book")}}async fetchDetailedBookInfo(e){if(!e.coverEditionKey)return e;let s=await this.openLibraryClient.getBookByOLID(e.coverEditionKey);return s?{...e,...s,totalPages:s.totalPages||e.totalPages,coverUrl:s.coverUrl||e.coverUrl,title:s.title||e.title,author:s.author.length>0?s.author:e.author,publisher:s.publisher||e.publisher,publishDate:s.publishDate||e.publishDate}:e}async validateBookNotExists(e){let s=Y.getBooksFolderPath(this.plugin.settings.bookFolder);if(await this.bookFileReader.findExisting(s,e.title))throw new Error(`Book "${e.title}" already exists.`)}setButtonsState(e,s){this.resultsContainer.querySelectorAll("button").forEach(i=>{i.disabled=e,i.textContent=s})}triggerViewRefresh(e){try{this.app.vault.trigger("modify",e),this.app.workspace.iterateAllLeaves(s=>{var n,i;if(((i=(n=s.view)==null?void 0:n.getViewType)==null?void 0:i.call(n))==="bases"){let o=s.view;typeof o.requestUpdate=="function"?o.requestUpdate():typeof o.refresh=="function"&&o.refresh()}})}catch(s){console.debug("[Bookshelf] Error triggering Bases refresh:",s)}}showLoading(){this.loadingIndicator.style.display="block"}hideLoading(){this.loadingIndicator.style.display="none"}showError(e){let s=this.contentEl.querySelector(".bookshelf-message");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-message bookshelf-message-error"});n.createEl("div",{cls:"bookshelf-message-icon",text:"!"}),n.createEl("div",{cls:"bookshelf-message-text",text:e}),n.createEl("button",{cls:"bookshelf-message-close",text:"Dismiss"}).addEventListener("click",()=>n.remove())}hideError(){let e=this.contentEl.querySelector(".bookshelf-message");e&&e.remove()}showSuccess(e){let s=this.contentEl.querySelector(".bookshelf-message-success");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-message-success"});n.style.cssText="padding: 12px; margin-top: 16px; background-color: transparent; color: var(--interactive-accent); font-size: 14px; text-align: center; font-weight: 500;",n.createEl("span",{text:e})}}});var Ao={};Ht(Ao,{default:()=>rn});module.exports=zi(Ao);var le=require("obsidian");var ur={bookFolder:"Bookshelf",apiTimeout:5e3,searchResultLimit:20,defaultSort:"date",autoUpdateTimestamp:!0,autoStatusChange:!0,showProgressNotification:!0,trackReadingHistory:!0,requireReadingNotes:!1,defaultStatus:"unread",timezone:0};var M=require("obsidian"),Yt=class extends M.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new M.Setting(t).setName("Folders").setHeading(),new M.Setting(t).setName("Book notes folder").setDesc("Folder path where book notes will be saved").addText(e=>e.setPlaceholder("Books").setValue(this.plugin.settings.bookFolder).onChange(async s=>{this.plugin.settings.bookFolder=s,await this.plugin.saveSettings()})),new M.Setting(t).setName("API").setHeading(),new M.Setting(t).setName("Timeout (ms)").setDesc("Timeout duration for Open Library requests (in milliseconds)").addText(e=>e.setPlaceholder("5000").setValue(this.plugin.settings.apiTimeout.toString()).onChange(async s=>{let n=parseInt(s,10);!isNaN(n)&&n>0&&(this.plugin.settings.apiTimeout=n,await this.plugin.saveSettings())})),new M.Setting(t).setName("Search result limit").setDesc("Maximum number of search results to display").addText(e=>e.setPlaceholder("20").setValue(this.plugin.settings.searchResultLimit.toString()).onChange(async s=>{let n=parseInt(s,10);!isNaN(n)&&n>0&&(this.plugin.settings.searchResultLimit=n,await this.plugin.saveSettings())})),new M.Setting(t).setName("Auto update").setHeading(),new M.Setting(t).setName("Auto update timestamp").setDesc("Whether to automatically update the updated field when book information is modified").addToggle(e=>e.setValue(this.plugin.settings.autoUpdateTimestamp).onChange(async s=>{this.plugin.settings.autoUpdateTimestamp=s,await this.plugin.saveSettings(),s&&this.plugin.registerAutoUpdateTimestamp()})),new M.Setting(t).setName("Auto status change").setDesc('Automatically change status to "finished" when read_page reaches total pages').addToggle(e=>e.setValue(this.plugin.settings.autoStatusChange).onChange(async s=>{this.plugin.settings.autoStatusChange=s,await this.plugin.saveSettings()})),new M.Setting(t).setName("Show progress notification").setDesc("Show notification when progress is updated").addToggle(e=>e.setValue(this.plugin.settings.showProgressNotification).onChange(async s=>{this.plugin.settings.showProgressNotification=s,await this.plugin.saveSettings()})),new M.Setting(t).setName("Reading history").setHeading(),new M.Setting(t).setName("Track reading history").setDesc("Whether to track reading history (pages read per session)").addToggle(e=>e.setValue(this.plugin.settings.trackReadingHistory).onChange(async s=>{this.plugin.settings.trackReadingHistory=s,await this.plugin.saveSettings()})),new M.Setting(t).setName("Require reading notes").setDesc("Require notes when updating reading progress").addToggle(e=>e.setValue(this.plugin.settings.requireReadingNotes).onChange(async s=>{this.plugin.settings.requireReadingNotes=s,await this.plugin.saveSettings()})),new M.Setting(t).setName("View").setHeading(),new M.Setting(t).setName("Default sort order").setDesc("Default sort order for bookshelf view").addDropdown(e=>e.addOption("date","Date").addOption("title","Title").addOption("author","Author").addOption("progress","Progress").setValue(this.plugin.settings.defaultSort).onChange(async s=>{this.plugin.settings.defaultSort=s,await this.plugin.saveSettings()})),new M.Setting(t).setName("Default values").setHeading(),new M.Setting(t).setName("Default reading status").setDesc("Default reading status for newly added books").addDropdown(e=>e.addOption("unread","Unread").addOption("reading","Reading").setValue(this.plugin.settings.defaultStatus).onChange(async s=>{this.plugin.settings.defaultStatus=s,await this.plugin.saveSettings()})),new M.Setting(t).setName("Date & time").setHeading(),new M.Setting(t).setName("Timezone offset").setDesc("Timezone offset from UTC in hours (e.g., 0 for UTC, 9 for Korea, -5 for EST)").addText(e=>e.setPlaceholder("0").setValue(this.plugin.settings.timezone.toString()).onChange(async s=>{let n=parseFloat(s);!isNaN(n)&&n>=-12&&n<=14&&(this.plugin.settings.timezone=n,await this.plugin.saveSettings())}))}};qt();function Di(r,t){t.addCommand({id:"bookshelf-search-book",name:"Search book",callback:()=>{new qe(r,t).open()}})}var lt=require("obsidian");function Ii(r){if(r.length===0)return 0;let e=[...r].sort((s,n)=>new Date(n.date).getTime()-new Date(s.date).getTime())[0];return e?e.endPage:0}jt();Te();es();Vs();Re();var at=class{static parseFromBody(t){let e=[],s=/^##\s+Reading History\s*\n([\s\S]*?)(?=\n##|\n#|$)/m,n=t.match(s);if(!n||!n[1])return e;let i=n[1],o=/(?:^###\s+(\d{4}-\d{2}-\d{2})|^-\s+\*\*Date:\*\*\s+(\d{4}-\d{2}-\d{2}))\s*\n([\s\S]*?)(?=\n(?:###|-\s+\*\*Date:)|$)/gm,a;for(;(a=o.exec(i))!==null;){let l=a[1]||a[2]||"",c=a[3]||"",d=c.match(/(?:\*\*Start Page:\*\*|Start Page:|Start:|From:)\s*(\d+)/i),u=c.match(/(?:\*\*End Page:\*\*|End Page:|End:|To:|Page:)\s*(\d+)/i),p=c.match(/(?:\*\*Pages Read:\*\*|Pages Read:|Pages:|Read:)\s*(\d+)/i),h=c.match(/(?:\*\*Timestamp:\*\*|Timestamp:|Time:)\s*([^\n]+)/i),g,f=c.match(/(?:Notes?:|Note:)\s*\n?([\s\S]*?)(?=\n(?:Time|Timestamp)|$)/i);f&&f[1]&&(g=f[1].trim(),g===""&&(g=void 0));let m={date:l,startPage:d&&d[1]?parseInt(d[1],10):0,endPage:u&&u[1]?parseInt(u[1],10):0,pagesRead:p&&p[1]?parseInt(p[1],10):0,notes:g,timestamp:h&&h[1]?h[1].trim():void 0};m.pagesRead===0&&m.endPage>m.startPage&&(m.pagesRead=m.endPage-m.startPage),e.push(m)}return e}static updateInBody(t,e){var l,c,d;let s=[];s.push("## Reading History"),s.push("");let n=[...e].sort((u,p)=>{let h=u.timestamp||u.date||"";return(p.timestamp||p.date||"").localeCompare(h)});for(let u of n){if(s.push(`### ${u.date||"Unknown Date"}`),s.push(""),s.push(`- **Start Page:** ${(l=u.startPage)!=null?l:0}`),s.push(`- **End Page:** ${(c=u.endPage)!=null?c:0}`),s.push(`- **Pages Read:** ${(d=u.pagesRead)!=null?d:0}`),u.timestamp&&s.push(`- **Timestamp:** ${u.timestamp}`),u.notes){s.push("- **Notes:**"),s.push("");let p=u.notes.split(`
`);for(let h of p)s.push(`  ${h}`)}s.push("")}let i=s.join(`
`),o=/^##\s+Reading History\s*\n[\s\S]*?(?=\n##|\n#|$)/m,a=t;if(o.test(t))a=t.replace(o,i);else{let u=/^(##\s+[^\n]+)/m;u.test(t)?a=t.replace(u,`${i}

$1`):a=t.trim()+`

`+i}return a}static createRecord(t,e,s){let n=J();return{date:n.split(" ")[0]||n,startPage:t,endPage:e,pagesRead:Math.max(0,e-t),notes:s||void 0,timestamp:n}}};Re();var $e=class{constructor(t){this.app=t}async updateBook(t,e){let s=await this.app.vault.read(t),{frontmatter:n,body:i}=me.extract(s),a={...be.frontmatterToBook(n),...e},l=be.bookToFrontmatter(a);l.updated=J();let d=`${Ee.create(l)}
${i}`;await this.app.vault.modify(t,d)}async updateReadingProgress(t,e,s,n,i=!0){var b;let o=await this.app.vault.read(t),{frontmatter:a,body:l}=me.extract(o);if(a.read_page=e,i){let y=typeof a.total=="number"?a.total:typeof a.totalPages=="number"?a.totalPages:void 0;y&&e>=y?(a.status="finished",a.read_finished||(a.read_finished=J())):e>0&&a.status==="unread"&&(a.status="reading",a.read_started||(a.read_started=J()))}a.updated=J();let c=at.parseFromBody(l),d=c.length>0?c[c.length-1]:null,u=typeof a.read_page=="number"?a.read_page:0,p=s!==void 0?s:(b=d==null?void 0:d.endPage)!=null?b:u,h=at.createRecord(p,e,n);c.push(h),(!a.reading_history_summary||!Array.isArray(a.reading_history_summary))&&(a.reading_history_summary=[]),a.reading_history_summary.push({date:h.date,startPage:h.startPage,endPage:h.endPage,pagesRead:h.pagesRead,timestamp:h.timestamp||"",notes:h.notes});let g=at.updateInBody(l,c),m=`${Ee.create(a)}
${g}`;await this.app.vault.modify(t,m)}};var Me=class extends lt.Modal{constructor(e,s,n){super(e);this.book=null;this.plugin=s,this.bookFileReader=new ge(e),this.bookFileUpdater=new $e(e),this.file=n||this.app.workspace.getActiveFile()}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Update Reading Progress"}),this.loadBookData().then(()=>{if(!this.book){e.createEl("div",{cls:"bookshelf-error",text:"No book data found. Please open a book note first."});return}this.renderForm(e)})}onClose(){let{contentEl:e}=this;e.empty()}async loadBookData(){if(this.file)try{let e=await this.bookFileReader.read(this.file);e.title&&(this.book={title:e.title||"Unknown",subtitle:e.subtitle,author:e.author||[],isbn10:e.isbn10,isbn13:e.isbn13,publisher:e.publisher,publishDate:e.publishDate,totalPages:e.totalPages,coverUrl:e.coverUrl,category:e.category||[],status:e.status||"unread",readPage:e.readPage||0,readStarted:e.readStarted,readFinished:e.readFinished,created:e.created||new Date().toISOString(),updated:e.updated||new Date().toISOString()})}catch(e){console.error("Error loading book data:",e)}}renderForm(e){if(!this.book||!this.file)return;let s=e.createEl("div",{cls:"bookshelf-progress-book-info"});s.createEl("div",{cls:"bookshelf-progress-title",text:this.book.title}),this.book.author&&this.book.author.length>0&&s.createEl("div",{cls:"bookshelf-progress-author",text:`by ${this.book.author.join(", ")}`}),this.app.vault.read(this.file).then(async n=>{var f;let{FrontmatterParser:i}=await Promise.resolve().then(()=>(Te(),ot)),{frontmatter:o}=i.extract(n),l=(o.reading_history_summary||[]).map(m=>({date:m.date||"",startPage:m.startPage||0,endPage:m.endPage||0,pagesRead:m.pagesRead||0,timestamp:m.timestamp})),c=Ii(l),d=((f=this.book)==null?void 0:f.readPage)||0;new lt.Setting(e).setName("Start page").setDesc("Starting page for this reading session").addText(m=>{this.startPageInput=m.inputEl,this.startPageInput.type="number",this.startPageInput.value=c>0?c.toString():(d||"0").toString(),this.startPageInput.addEventListener("input",()=>this.updateCalculations())}),new lt.Setting(e).setName("End page").setDesc("Current page you finished reading").addText(m=>{this.endPageInput=m.inputEl,this.endPageInput.type="number",this.endPageInput.value=(d||"0").toString(),this.endPageInput.addEventListener("input",()=>this.updateCalculations())});let u=e.createEl("div",{cls:"bookshelf-progress-calc"});if(u.createEl("div",{cls:"bookshelf-progress-label",text:"Pages read:"}),this.pagesReadDisplay=u.createEl("div",{cls:"bookshelf-progress-value",text:"0"}),this.book&&this.book.totalPages){let m=e.createEl("div",{cls:"bookshelf-progress-calc"});m.createEl("div",{cls:"bookshelf-progress-label",text:"Progress:"}),this.progressDisplay=m.createEl("div",{cls:"bookshelf-progress-value",text:"0%"})}let p=new lt.Setting(e).setName("Notes (optional)").setDesc("Add notes about this reading session");this.notesInput=p.controlEl.createEl("textarea",{cls:"bookshelf-notes-input"}),this.notesInput.placeholder="What did you read? Any thoughts?",this.notesInput.style.cssText=`
				width: 100%;
				min-height: 300px;
				padding: 12px;
				font-size: 14px;
				line-height: 1.6;
				font-family: var(--font-text);
				border: 1px solid var(--background-modifier-border);
				border-radius: 4px;
				background-color: var(--background-primary);
				color: var(--text-normal);
				resize: vertical;
				margin-top: 8px;
			`,this.updateCalculations(),e.createEl("div",{cls:"bookshelf-progress-buttons"}).createEl("button",{cls:"mod-cta",text:"Update Progress"}).addEventListener("click",()=>{this.updateProgress()})})}updateCalculations(){var i;let e=parseInt(this.startPageInput.value,10)||0,s=parseInt(this.endPageInput.value,10)||0,n=Math.max(0,s-e);if(this.pagesReadDisplay.textContent=n.toString(),(i=this.book)!=null&&i.totalPages&&this.progressDisplay){let o=Math.min(s/this.book.totalPages*100,100);this.progressDisplay.textContent=`${Math.round(o)}%`}}async updateProgress(){if(!this.file||!this.book)return;let e=parseInt(this.startPageInput.value,10)||0,s=parseInt(this.endPageInput.value,10)||0,n=Math.max(0,s-e),i=this.notesInput.value.trim()||void 0;if(this.plugin.settings.requireReadingNotes&&!i){this.showErrorMessage("Notes are required when updating progress.");return}if(s<e){this.showErrorMessage("End page must be greater than or equal to start page.");return}try{await this.bookFileUpdater.updateReadingProgress(this.file,s,e,i,this.plugin.settings.autoStatusChange),this.showSuccessMessage("Progress updated successfully!")}catch(o){this.showErrorMessage(`Failed to update progress: ${o instanceof Error?o.message:"Unknown error"}`)}}showSuccessMessage(e){let s=this.contentEl.querySelector(".bookshelf-progress-success");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-progress-success"});n.style.cssText="padding: 12px; margin-top: 16px; background-color: transparent; color: var(--interactive-accent); font-size: 14px; text-align: center; font-weight: 500;";let i=n.createEl("span",{text:e});setTimeout(()=>{this.close()},2e3)}showErrorMessage(e){let s=this.contentEl.querySelector(".bookshelf-message");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-message bookshelf-message-error"}),i=n.createEl("div",{cls:"bookshelf-message-icon",text:"!"}),o=n.createEl("div",{cls:"bookshelf-message-text",text:e});n.createEl("button",{cls:"bookshelf-message-close",text:"Dismiss"}).addEventListener("click",()=>{n.remove()})}};function Oi(r,t){t.addCommand({id:"bookshelf-update-progress",name:"Update reading progress",callback:()=>{let e=r.workspace.getActiveFile();new Me(r,t,e).open()}})}function Fi(r,t){Di(r,t),Oi(r,t)}ln();Xt();Te();Vs();qt();Re();var Mi=require("obsidian");function Bo(r){var t,e;try{let n=r.internalPlugins;if(!n)return console.debug("[Bookshelf][Bases] Internal plugins manager not available"),null;let i=(t=n.getEnabledPluginById)==null?void 0:t.call(n,"bases");return i?!i.registrations||typeof i.registrations!="object"?(console.warn("[Bookshelf][Bases] Bases plugin found but registrations API not available"),null):{registrations:i.registrations,isEnabled:!0,version:((e=i.manifest)==null?void 0:e.version)||"unknown"}:(console.debug("[Bookshelf][Bases] Bases plugin not found or not enabled"),null)}catch(s){return console.warn("[Bookshelf][Bases] Error accessing Bases plugin API:",s),null}}function Kt(r,t,e){var n;let s=r;if(typeof s.registerBasesView=="function")try{return s.registerBasesView(t,e)?(console.debug(`[Bookshelf][Bases] Successfully registered view via public API: ${t}`),!0):(console.debug("[Bookshelf][Bases] Public API returned false (Bases may be disabled)"),!1)}catch(i){let o=i;return(n=o==null?void 0:o.message)!=null&&n.includes("already exists")?(console.debug(`[Bookshelf][Bases] View ${t} already registered via public API`),!0):(console.warn(`[Bookshelf][Bases] Public API registration failed for ${t}:`,i),!1)}return console.warn("[Bookshelf][Bases] Cannot register view: Bases public API not available (requires Obsidian 1.10.0+)"),!1}function Vt(r,t){let e=Bo(r.app);if(!e)return!0;try{return e.registrations[t]&&delete e.registrations[t],!0}catch(s){return console.error(`[Bookshelf][Bases] Error unregistering view ${t}:`,s),!1}}var $i=require("obsidian");var ct=require("obsidian");jt();var ye=class extends ct.Component{constructor(e,s,n){super();this.rootElement=null;this.updateDebounceTimer=null;this.dataUpdateDebounceTimer=null;this.plugin=n,this.containerEl=s,this.bookFileReader=new ge(n.app),this.bookFileUpdater=new $e(n.app)}onload(){this.setupContainer(),requestAnimationFrame(()=>{setTimeout(()=>{var e;(e=this.rootElement)!=null&&e.isConnected&&this.render()},100)})}onDataUpdated(){var s;if(!((s=this.rootElement)!=null&&s.isConnected))return;this.dataUpdateDebounceTimer&&clearTimeout(this.dataUpdateDebounceTimer);let e=this.containerEl.ownerDocument.defaultView||window;this.dataUpdateDebounceTimer=e.setTimeout(()=>{this.dataUpdateDebounceTimer=null;try{this.render()}catch(n){console.error(`[Bookshelf][${this.type}] Render error:`,n),this.renderError(n)}},500)}onunload(){this.dataUpdateDebounceTimer&&clearTimeout(this.dataUpdateDebounceTimer),this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),super.onunload()}setupContainer(){let s=this.containerEl.ownerDocument.createElement("div");s.className="bookshelf-bases-view",s.style.cssText="display: flex; flex-direction: column; height: 100%; width: 100%;",s.tabIndex=-1,this.containerEl.appendChild(s),this.rootElement=s,this.setupNewBookButton()}setupNewBookButton(){let e=0,s=10,n=()=>{e++,this.injectNewBookButton();let i=this.containerEl.closest(".bases-view"),o=i==null?void 0:i.parentElement,a=o==null?void 0:o.querySelector(".bases-toolbar");!(a==null?void 0:a.querySelector(".bookshelf-bases-new-book-btn"))&&e<s&&setTimeout(n,200)};setTimeout(n,100),this.register(()=>this.cleanupNewBookButton())}cleanupNewBookButton(){let e=this.containerEl.closest(".bases-view"),s=e==null?void 0:e.parentElement;s==null||s.classList.remove("bookshelf-view-active")}injectNewBookButton(){let e=this.containerEl.closest(".bases-view");if(!e){console.debug("[Bookshelf][Bases] No .bases-view found");return}let s=e.parentElement;if(!s){console.debug("[Bookshelf][Bases] No parent element found");return}s.classList.add("bookshelf-view-active");let n=s.querySelector(".bases-toolbar");if(!n){console.debug("[Bookshelf][Bases] No .bases-toolbar found in parent");return}if(n.querySelector(".bookshelf-bases-new-book-btn"))return;let i=this.containerEl.ownerDocument,o=i.createElement("div");o.className="bases-toolbar-item bookshelf-bases-new-book-btn";let a=i.createElement("div");a.className="text-icon-button",a.tabIndex=0;let l=i.createElement("span");l.className="text-button-icon",(0,ct.setIcon)(l,"book-plus"),a.appendChild(l);let c=i.createElement("span");c.className="text-button-label",c.textContent="New book",a.appendChild(c),o.appendChild(a);let d=async p=>{p.stopPropagation(),p.preventDefault(),p.stopImmediatePropagation();let h=this.app||this.plugin.app;if(!h){console.error("[Bookshelf][Bases] App not available");return}try{let{SearchModal:g}=await Promise.resolve().then(()=>(qt(),fr));new g(h,this.plugin).open()}catch(g){console.error("[Bookshelf][Bases] Error opening search modal:",g)}};a.addEventListener("click",d,{capture:!0,once:!1}),a.addEventListener("mousedown",p=>{p.button===0&&d(p)},{capture:!0}),a.addEventListener("keydown",p=>{(p.key==="Enter"||p.key===" ")&&(p.stopPropagation(),p.preventDefault(),d(p))});let u=n.querySelector(".bases-toolbar-new-item-menu");u?u.before(o):n.appendChild(o),console.debug("[Bookshelf][Bases] Injected New Book button into toolbar")}extractDataItems(){var s;return(s=this.data)!=null&&s.data?this.data.data.map(n=>{var o;let i=n;return(o=i==null?void 0:i.file)!=null&&o.path?{key:i.file.path,data:i,file:i.file,path:i.file.path,properties:this.extractEntryProperties(i),basesData:i}:(console.warn("[Bookshelf][BasesView] Entry missing file.path:",i),null)}).filter(n=>n!==null):(console.warn("[Bookshelf][BasesView] No data available"),[])}extractEntryProperties(e){let s={};return e.note&&Object.assign(s,e.note),e.file&&(s["file.name"]=e.file.name,s["file.path"]=e.file.path,s["file.ctime"]=e.file.ctime,s["file.mtime"]=e.file.mtime),s}async extractBooksFromBasesData(e){let s=[];for(let n of e)try{let i=n.file;if(!i||!i.path)continue;let o=this.app||this.plugin.app;if(!o)continue;let a=o.vault.getAbstractFileByPath(i.path);if(!a||!(a instanceof ct.TFile))continue;let l=await this.bookFileReader.read(a);if(l.title){let c,d;try{let g=await o.vault.read(a),{FrontmatterParser:f}=await Promise.resolve().then(()=>(Te(),ot)),{frontmatter:m}=f.extract(g),b=m.reading_history_summary;if(b&&Array.isArray(b)&&b.length>0){let k=[...b].sort((v,w)=>{let T=v,B=w,S=T.date||T.timestamp||"";return(B.date||B.timestamp||"").localeCompare(S)})[0];k!=null&&k.date?c=k.date:k!=null&&k.timestamp&&(c=k.timestamp.split(" ")[0]),d=b.reduce((v,w)=>v+(w.pagesRead||0),0)}}catch(g){}let u=d!==void 0&&d>(l.readPage||0)?d:l.readPage,p=l.status==="unread"||l.status==="reading"||l.status==="finished"?l.status:"unread",h={title:l.title||"Unknown",subtitle:l.subtitle,author:l.author||[],isbn10:l.isbn10,isbn13:l.isbn13,publisher:l.publisher,publishDate:l.publishDate,totalPages:l.totalPages,coverUrl:l.coverUrl,category:l.category||[],status:p,readPage:u,readStarted:l.readStarted,readFinished:l.readFinished,created:l.created||new Date().toISOString(),updated:l.updated||new Date().toISOString(),lastReadDate:c};s.push({book:h,file:a})}}catch(i){console.error("[Bookshelf] Error extracting book from Bases data:",i)}return s}renderError(e){if(!this.rootElement)return;let s=this.rootElement.ownerDocument;this.rootElement.empty();let n=s.createElement("div");n.className="bookshelf-error",n.style.cssText="padding: 20px; text-align: center; color: var(--text-error);",n.textContent=`Error: ${e.message}`,this.rootElement.appendChild(n)}getEphemeralState(){var e;return{scrollTop:((e=this.rootElement)==null?void 0:e.scrollTop)||0}}setEphemeralState(e){if(!(!e||!this.rootElement||!this.rootElement.isConnected))try{let s=e;s.scrollTop!==void 0&&(this.rootElement.scrollTop=s.scrollTop)}catch(s){console.debug("[Bookshelf][Bases] Failed to restore ephemeral state:",s)}}focus(){var e;try{(e=this.rootElement)!=null&&e.isConnected&&typeof this.rootElement.focus=="function"&&this.rootElement.focus()}catch(s){console.debug("[Bookshelf][Bases] Failed to focus view:",s)}}refresh(){this.render()}onResize(){}};var dt=class{constructor(t,e,s=null,n){this.app=t,this.book=e,this.file=s,this.plugin=n||null}render(t="grid"){return this.book.status==="reading"?this.renderReadingBook(t):this.renderShelfBook(t)}renderReadingBook(t){let e=document.createElement("div");if(e.className=`bookshelf-book-card bookshelf-book-reading bookshelf-layout-${t}`,e.style.cssText="min-height: 420px; display: flex; flex-direction: column;",this.book.coverUrl){let o=e.createEl("div",{cls:"bookshelf-book-cover"});o.style.cssText="width: 100%; height: 240px; margin-bottom: 16px; flex-shrink: 0;";let a=o.createEl("img",{attr:{src:this.book.coverUrl||"",alt:this.book.title||"Book cover"}});a.style.cssText="width: 100%; height: 100%; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);",a.addEventListener("error",()=>{a.style.display="none"})}let s=e.createEl("div",{cls:"bookshelf-book-info"});s.style.cssText="padding: 0 12px 12px 12px; flex: 1; display: flex; flex-direction: column;",s.createEl("div",{cls:"bookshelf-book-title",text:this.book.title}).style.cssText="font-size: 17px; font-weight: 600; margin-bottom: 8px; line-height: 1.4; color: var(--text-normal);",this.book.author&&this.book.author.length>0&&(s.createEl("div",{cls:"bookshelf-book-author",text:this.book.author.join(", ")}).style.cssText="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;");let n=this.book.lastReadDate,i=s.createEl("div",{cls:"bookshelf-reading-status"});if(i.style.cssText="font-size: 12px; color: var(--text-muted); margin-bottom: 16px; padding: 12px; background-color: var(--background-secondary); border-radius: 6px; display: flex; flex-direction: column; gap: 8px;",this.book.readStarted){let o=i.createEl("div");o.style.cssText="display: flex; justify-content: space-between; align-items: center;";let a=o.createEl("span",{text:"Started:"});a.style.cssText="color: var(--text-faint); font-size: 11px;";let l=typeof this.book.readStarted=="string"?this.book.readStarted.includes("T")?this.book.readStarted.split("T")[0]:this.book.readStarted.split(" ")[0]:String(this.book.readStarted),c=o.createEl("span",{text:l});c.style.cssText="font-weight: 600; color: var(--text-normal); font-size: 12px;"}else{let o=i.createEl("div");o.style.cssText="display: flex; justify-content: space-between; align-items: center;";let a=o.createEl("span",{text:"Started:"});a.style.cssText="color: var(--text-faint); font-size: 11px;";let l=o.createEl("span",{text:"Not started"});l.style.cssText="font-weight: 400; color: var(--text-muted); font-size: 12px; font-style: italic;"}if(n){let o=i.createEl("div");o.style.cssText="display: flex; justify-content: space-between; align-items: center;";let a=o.createEl("span",{text:"Last read:"});a.style.cssText="color: var(--text-faint); font-size: 11px;";let l=o.createEl("span",{text:n});l.style.cssText="font-weight: 700; color: var(--interactive-accent); font-size: 12px;"}else if(this.book.readStarted){let o=i.createEl("div");o.style.cssText="display: flex; justify-content: space-between; align-items: center;";let a=o.createEl("span",{text:"Last read:"});a.style.cssText="color: var(--text-faint); font-size: 11px;";let l=o.createEl("span",{text:"Not yet"});l.style.cssText="font-weight: 400; color: var(--text-muted); font-size: 12px; font-style: italic;"}if(this.book.totalPages!==void 0&&this.book.totalPages!==null&&this.book.totalPages>0){let o=this.book.readPage||0,a=Math.min(o/this.book.totalPages*100,100),l=Math.max(0,this.book.totalPages-o),c=s.createEl("div",{cls:"bookshelf-progress-container"});c.style.cssText="margin-bottom: 16px;";let d=c.createEl("div");d.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;";let u=d.createEl("div");u.style.cssText="font-size: 12px; font-weight: 600; color: var(--text-normal);",u.textContent="Progress";let p=d.createEl("div");p.style.cssText="font-size: 14px; font-weight: 700; color: var(--interactive-accent);",p.textContent=`${Math.round(a)}%`;let h=c.createEl("div",{cls:"bookshelf-progress-bar"});h.style.cssText="width: 100%; height: 10px; background-color: var(--background-modifier-border); border-radius: 5px; overflow: hidden; margin-bottom: 6px;";let g=c.createEl("div",{cls:"bookshelf-progress-fill"});g.style.cssText=`width: ${a}%; height: 100%; background-color: var(--interactive-accent); transition: width 0.3s; border-radius: 5px;`,h.appendChild(g);let f=c.createEl("div");f.style.cssText="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted);";let m=f.createEl("span");m.textContent=`Read: ${o} pages`;let b=f.createEl("span");b.textContent=`Remaining: ${l} pages`}else{let o=s.createEl("div");o.style.cssText="padding: 12px; background: var(--background-secondary); border-radius: 6px; margin-bottom: 16px;";let a=o.createEl("div");a.style.cssText="font-size: 12px; color: var(--text-muted); text-align: center;",a.textContent="Please set total pages in frontmatter to track progress"}if(this.plugin&&this.file){let o=s.createEl("div",{cls:"bookshelf-card-actions"});o.style.cssText="margin-top: auto; padding-top: 12px;";let a=o.createEl("button",{cls:"mod-cta",text:"Update Progress"});a.style.cssText="width: 100%; padding: 10px; font-size: 13px; font-weight: 600;",a.addEventListener("click",l=>{l.stopPropagation(),new Me(this.app,this.plugin,this.file).open()})}return this.file&&(e.addEventListener("click",o=>{o.target.closest("button")||this.app.workspace.openLinkText(this.file.path,"",!1)}),e.style.cursor="pointer"),e}renderShelfBook(t){let e=document.createElement("div");e.className=`bookshelf-book-card bookshelf-book-shelf bookshelf-status-${this.book.status} bookshelf-layout-${t}`;let s=e.createEl("div",{cls:"bookshelf-book-spine"});s.createEl("div",{cls:"bookshelf-spine-title",text:this.book.title}),this.book.author&&this.book.author.length>0&&s.createEl("div",{cls:"bookshelf-spine-author",text:this.book.author.join(", ")});let n=s.createEl("div",{cls:"bookshelf-status-badge",text:this.book.status==="finished"?"Finished":"Unread"});return this.book.status==="finished"&&this.book.readFinished&&s.createEl("div",{cls:"bookshelf-spine-meta",text:`Finished: ${this.book.readFinished.split(" ")[0]}`}),this.file&&(e.addEventListener("click",()=>{this.app.workspace.openLinkText(this.file.path,"",!1)}),e.style.cursor="pointer"),e}};jt();var Qs=class extends ye{constructor(){super(...arguments);this.type="bookshelfView";this.books=[]}onload(){super.onload()}async render(){var e;if(this.rootElement&&(e=this.data)!=null&&e.data)try{let s=this.extractDataItems();this.books=await this.extractBooksFromBasesData(s),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][BasesView] Render error:",s),this.renderError(s)}}renderContent(){if(!this.rootElement)return;let s=this.rootElement.ownerDocument.createElement("div");s.style.cssText="flex: 1; overflow-y: auto; padding: 12px;";let n=this.books.filter(({book:o})=>o.status==="reading"),i=this.books.filter(({book:o})=>o.status==="unread");n.sort((o,a)=>this.sortBooks(o.book,a.book)),i.sort((o,a)=>this.sortBooks(o.book,a.book)),n.length>0?this.renderReadingSection(s,n):this.renderEmptyReadingSection(s),i.length>0?this.renderUnreadSubSection(s,i):this.renderEmptyUnreadSection(s),n.length===0&&i.length===0&&(s.empty(),this.renderEmptyState(s)),this.rootElement.appendChild(s)}renderReadingSection(e,s){let n=e.ownerDocument,i=n.createElement("div");i.className="bookshelf-section-header",i.style.cssText="margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);";let o=n.createElement("h2");o.textContent=`Reading (${s.length})`,o.style.cssText="margin: 0; font-size: 1.5em; font-weight: 600;",i.appendChild(o),e.appendChild(i);let a=n.createElement("div");a.className="bookshelf-section-books bookshelf-layout-grid bookshelf-drop-zone",a.style.cssText="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; min-height: 100px;";let l=p=>{p.preventDefault(),p.stopPropagation(),p.dataTransfer&&(p.dataTransfer.dropEffect="move"),a.classList.add("drag-over")},c=p=>{p.preventDefault(),p.stopPropagation(),a.classList.add("drag-over")},d=p=>{p.preventDefault(),p.stopPropagation();let h=a.getBoundingClientRect(),g=p.clientX,f=p.clientY;(g<h.left||g>h.right||f<h.top||f>h.bottom)&&a.classList.remove("drag-over")};a.addEventListener("dragover",l,!1),a.addEventListener("dragenter",c,!1),a.addEventListener("dragleave",d,!1);let u=async p=>{var h,g,f;p.preventDefault(),p.stopPropagation(),p.stopImmediatePropagation(),a.classList.remove("drag-over");try{let m=null;try{let b=(h=p.dataTransfer)==null?void 0:h.getData("application/bookshelf-book");b&&b.trim()&&(m=JSON.parse(b).path)}catch(b){}if(!m)try{let b=(g=p.dataTransfer)==null?void 0:g.getData("text/plain");b&&b.trim()&&(m=b.trim())}catch(b){}m?await this.handleBookStatusChange(m,"reading"):console.warn("[Bookshelf] No file path found in drop data. Available types:",Array.from(((f=p.dataTransfer)==null?void 0:f.types)||[]))}catch(m){console.error("[Bookshelf] Error handling drop:",m)}};a.addEventListener("drop",p=>void u(p),!1),s.forEach(({book:p,file:h})=>{let g=this.app||this.plugin.app,m=new dt(g,p,h,this.plugin).render("grid");a.appendChild(m)}),e.appendChild(a)}async handleBookStatusChange(e,s){try{let n=this.app||this.plugin.app;if(!n)return;let i=n.vault.getAbstractFileByPath(e);if(!i||!(i instanceof $i.TFile))return;let o=new ge(n),a=new $e(n),l={status:s};if(s==="reading"&&!(await o.read(i)).readStarted){let{getCurrentDateTime:d}=await Promise.resolve().then(()=>(Re(),yr));l.readStarted=d()}await a.updateBook(i,l),setTimeout(()=>{this.render()},300)}catch(n){console.error("[Bookshelf] Error changing book status:",n)}}renderEmptyReadingSection(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-section-header",n.style.cssText="margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);";let i=s.createElement("h2");i.textContent="Reading (0)",i.style.cssText="margin: 0; font-size: 1.5em; font-weight: 600;",n.appendChild(i),e.appendChild(n);let o=s.createElement("div");o.className="bookshelf-section-books bookshelf-layout-grid bookshelf-drop-zone",o.style.cssText="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 40px; min-height: 200px; border: 2px dashed var(--background-modifier-border); border-radius: 8px; text-align: center; color: var(--text-muted); transition: all 0.2s;";let a=s.createElement("p");a.textContent='Drag a book from "to read" section here to start reading',a.style.cssText="margin: 0; font-size: 14px; font-weight: 500;",o.appendChild(a);let l=s.createElement("p");l.textContent='Or click "new book" to add a new book',l.style.cssText="margin: 8px 0 0 0; font-size: 12px; color: var(--text-faint);",o.appendChild(l),o.addEventListener("dragover",c=>{c.preventDefault(),c.stopPropagation(),c.dataTransfer&&(c.dataTransfer.dropEffect="move"),o.classList.add("drag-over"),o.style.borderColor="var(--interactive-accent)",o.style.backgroundColor="var(--background-modifier-hover)"}),o.addEventListener("dragenter",c=>{c.preventDefault(),c.stopPropagation(),o.classList.add("drag-over"),o.style.borderColor="var(--interactive-accent)",o.style.backgroundColor="var(--background-modifier-hover)"}),o.addEventListener("dragleave",c=>{c.preventDefault(),c.stopPropagation();let d=o.getBoundingClientRect(),u=c.clientX,p=c.clientY;(u<d.left||u>d.right||p<d.top||p>d.bottom)&&(o.classList.remove("drag-over"),o.style.borderColor="var(--background-modifier-border)",o.style.backgroundColor="")}),o.addEventListener("drop",async c=>{var d,u;c.preventDefault(),c.stopPropagation(),o.classList.remove("drag-over"),o.style.borderColor="var(--background-modifier-border)",o.style.backgroundColor="";try{let p=null,h=(d=c.dataTransfer)==null?void 0:d.getData("application/bookshelf-book");if(h)try{p=JSON.parse(h).path}catch(g){}if(!p){let g=(u=c.dataTransfer)==null?void 0:u.getData("text/plain");g&&(p=g)}p?await this.handleBookStatusChange(p,"reading"):console.warn("[Bookshelf] No file path found in drop data")}catch(p){console.error("[Bookshelf] Error handling drop:",p)}}),e.appendChild(o)}renderEmptyUnreadSection(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-unread-subsection",n.style.cssText="margin-top: 32px;";let i=s.createElement("div");i.className="bookshelf-subsection-header",i.style.cssText="display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--background-modifier-border);";let o=s.createElement("h3");o.textContent="To Read (0)",o.style.cssText="margin: 0; font-size: 1.1em; font-weight: 500; color: var(--text-muted);",i.appendChild(o),n.appendChild(i);let a=s.createElement("div");a.style.cssText="padding: 20px; text-align: center; color: var(--text-muted);",a.textContent="No unread books.",n.appendChild(a),e.appendChild(n)}renderUnreadSubSection(e,s){let n=e.ownerDocument,i=n.createElement("div");i.className="bookshelf-unread-subsection",i.style.cssText="margin-top: 32px;";let o=n.createElement("div");o.className="bookshelf-subsection-header",o.style.cssText="display: flex; align-items: center; justify-content: space-between; padding: 8px 0; cursor: pointer; border-bottom: 1px solid var(--background-modifier-border);";let a=n.createElement("h3");a.textContent=`To Read (${s.length})`,a.style.cssText="margin: 0; font-size: 1.1em; font-weight: 500; color: var(--text-muted);",o.appendChild(a);let l=n.createElement("span");l.textContent="?",l.style.cssText="font-size: 10px; color: var(--text-muted); transition: transform 0.2s;",o.appendChild(l);let c=n.createElement("div");c.className="bookshelf-unread-list",c.style.cssText="max-height: 300px; overflow-y: auto; margin-top: 8px;";let d=!0,u=()=>{d=!d,c.style.display=d?"block":"none",l.style.transform=d?"rotate(0deg)":"rotate(-90deg)"};o.addEventListener("click",u);let p=n.createElement("ul");p.style.cssText="list-style: none; padding: 0; margin: 0;",s.forEach(({book:h,file:g})=>{let f=n.createElement("li");f.className="bookshelf-unread-item",f.draggable=!0,f.dataset.bookPath=g.path,f.style.cssText="padding: 8px 12px; border-bottom: 1px solid var(--background-modifier-border); cursor: pointer; display: flex; justify-content: space-between; align-items: center;",f.addEventListener("click",w=>{if(w.defaultPrevented)return;let T=this.app||this.plugin.app;T&&T.workspace.openLinkText(g.path,"",!0)});let m=!1,b=w=>{m=!0,f.classList.add("dragging"),w.dataTransfer?(w.dataTransfer.effectAllowed="move",w.dataTransfer.setData("text/plain",g.path),w.dataTransfer.setData("application/bookshelf-book",JSON.stringify({path:g.path,status:"unread"}))):console.error("[Bookshelf] dataTransfer is null in dragstart")};f.addEventListener("dragstart",b,!1),f.addEventListener("dragend",w=>{m=!1,f.classList.remove("dragging"),n.querySelectorAll(".bookshelf-drop-zone").forEach(B=>{B.classList.remove("drag-over")})}),f.addEventListener("click",w=>{if(m){w.preventDefault(),w.stopPropagation(),setTimeout(()=>{m=!1},100);return}});let y=n.createElement("div");y.style.cssText="flex: 1;";let k=n.createElement("div");if(k.textContent=h.title,k.style.cssText="font-weight: 500; font-size: 13px; margin-bottom: 2px;",y.appendChild(k),h.author&&h.author.length>0){let w=n.createElement("div");w.textContent=h.author.join(", "),w.style.cssText="font-size: 11px; color: var(--text-muted);",y.appendChild(w)}f.appendChild(y);let v=n.createElement("span");v.textContent="",v.style.cssText="color: var(--text-faint); font-size: 12px; margin-left: 8px; cursor: grab; user-select: none;",v.title="Drag to Reading section to start reading",v.addEventListener("mousedown",w=>{w.stopPropagation()}),f.appendChild(v),p.appendChild(f)}),c.appendChild(p),i.appendChild(o),i.appendChild(c),e.appendChild(i)}sortBooks(e,s){switch(this.plugin.settings.defaultSort||"date"){case"title":return e.title.localeCompare(s.title);case"author":let i=e.author[0]||"",o=s.author[0]||"";return i.localeCompare(o);case"progress":let a=e.totalPages&&e.readPage?e.readPage/e.totalPages:0;return(s.totalPages&&s.readPage?s.readPage/s.totalPages:0)-a;case"date":default:return new Date(s.created).getTime()-new Date(e.created).getTime()}}renderEmptyState(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-empty-state",n.style.cssText="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center;";let i=s.createElement("h2");i.className="bookshelf-empty-title",i.textContent="No books added yet",i.style.cssText="margin: 0 0 8px 0; font-size: 1.5em;",n.appendChild(i);let o=s.createElement("p");o.className="bookshelf-empty-description",o.textContent="Start building your bookshelf by searching and adding books.",o.style.cssText="margin: 0 0 24px 0; color: var(--text-muted);",n.appendChild(o);let a=s.createElement("button");a.className="mod-cta",a.textContent="Search and Add Book",a.addEventListener("click",async l=>{l.stopPropagation(),l.preventDefault();let c=this.app||this.plugin.app;if(!c){console.error("[Bookshelf] App not available");return}try{let{SearchModal:d}=await Promise.resolve().then(()=>(qt(),fr));new d(c,this.plugin).open()}catch(d){console.error("[Bookshelf] Error opening search modal:",d)}}),n.appendChild(a),e.appendChild(n)}};var Xs=class extends ye{constructor(){super(...arguments);this.type="bookshelfReadingView";this.books=[]}async render(){var e;if(!(!this.rootElement||!((e=this.data)!=null&&e.data)))try{let s=this.extractDataItems(),n=await this.extractBooksFromBasesData(s);this.books=n.filter(({book:i})=>i.status==="reading"),this.books.sort((i,o)=>{let a=i.book.totalPages&&i.book.readPage?i.book.readPage/i.book.totalPages:0;return(o.book.totalPages&&o.book.readPage?o.book.readPage/o.book.totalPages:0)-a}),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][ReadingView] Render error:",s),this.renderError(s)}}renderContent(){if(!this.rootElement)return;let e=this.rootElement.ownerDocument,s=e.createElement("div");s.className="bookshelf-header",s.style.cssText="padding: 12px; border-bottom: 1px solid var(--background-modifier-border);";let n=e.createElement("h2");n.textContent=`Reading (${this.books.length})`,n.style.cssText="margin: 0; font-size: 1.2em;",s.appendChild(n),this.rootElement.appendChild(s);let i=e.createElement("div");i.className="bookshelf-books-container bookshelf-layout-grid",i.style.cssText="flex: 1; overflow-y: auto; padding: 12px; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px;",this.books.length===0?this.renderEmptyState(i):this.books.forEach(({book:o,file:a})=>{let c=new dt(this.app,o,a,this.plugin).render("grid");i.appendChild(c)}),this.rootElement.appendChild(i)}renderEmptyState(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-empty-state",n.style.cssText="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center;";let i=s.createElement("div");i.textContent="\u{1F4D6}",i.style.cssText="font-size: 4em; margin-bottom: 16px;",n.appendChild(i);let o=s.createElement("h2");o.textContent="No books being read",o.style.cssText="margin: 0 0 8px 0; font-size: 1.5em;",n.appendChild(o);let a=s.createElement("p");a.textContent="Start reading a book to see it here.",a.style.cssText="margin: 0 0 24px 0; color: var(--text-muted);",n.appendChild(a),e.appendChild(n)}};var Zs=class extends ye{constructor(e,s,n){super(e,s,n);this.type="bookshelfLibraryView";this.unreadBooks=[];this.finishedBooks=[]}async render(){var e;if(!(!this.rootElement||!((e=this.data)!=null&&e.data)))try{let s=this.extractDataItems(),n=await this.extractBooksFromBasesData(s);this.unreadBooks=n.filter(({book:i})=>i.status==="unread"),this.finishedBooks=n.filter(({book:i})=>i.status==="finished"),this.unreadBooks.sort((i,o)=>new Date(o.book.created).getTime()-new Date(i.book.created).getTime()),this.finishedBooks.sort((i,o)=>{let a=i.book.readFinished?new Date(i.book.readFinished).getTime():0;return(o.book.readFinished?new Date(o.book.readFinished).getTime():0)-a}),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][UnreadFinishedView] Render error:",s),this.renderError(s)}}renderContent(){if(!this.rootElement)return;let e=this.rootElement.ownerDocument,s=e.createElement("div");s.className="bookshelf-header",s.style.cssText="padding: 12px; border-bottom: 1px solid var(--background-modifier-border);";let n=e.createElement("h2");n.textContent=`Unread & Finished (${this.unreadBooks.length} unread, ${this.finishedBooks.length} finished)`,n.style.cssText="margin: 0; font-size: 1.2em;",s.appendChild(n),this.rootElement.appendChild(s);let i=e.createElement("div");if(i.style.cssText="flex: 1; overflow-y: auto; padding: 12px;",this.unreadBooks.length>0)this.renderSection(i,e,"Unread Books",this.unreadBooks,"unread");else{let o=e.createElement("div");o.style.cssText="margin-top: 24px;";let a=e.createElement("div");a.style.cssText="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);";let l=e.createElement("h3");l.textContent="Unread Books (0)",l.style.cssText="margin: 0; font-size: 1.2em; font-weight: 600;",a.appendChild(l),o.appendChild(a),this.renderEmptyState(o),i.appendChild(o)}if(this.finishedBooks.length>0)this.renderSection(i,e,"Finished Books",this.finishedBooks,"finished");else{let o=e.createElement("div");o.style.cssText="margin-top: 24px;";let a=e.createElement("div");a.style.cssText="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);";let l=e.createElement("h3");l.textContent="Finished Books (0)",l.style.cssText="margin: 0; font-size: 1.2em; font-weight: 600;",a.appendChild(l),o.appendChild(a),this.renderEmptyState(o),i.appendChild(o)}this.rootElement.appendChild(i)}renderSection(e,s,n,i,o){let a=s.createElement("div");a.style.cssText="margin-top: 24px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);";let l=s.createElement("h3");l.textContent=`${n} (${i.length})`,l.style.cssText="margin: 0; font-size: 1.2em; font-weight: 600;",a.appendChild(l),e.appendChild(a);let c=s.createElement("ul");c.style.cssText="list-style: none; padding: 0; margin: 0;",i.forEach(({book:d,file:u})=>{let p=s.createElement("li");p.style.cssText="padding: 12px; border-bottom: 1px solid var(--background-modifier-border); cursor: pointer;",p.addEventListener("click",f=>{if(f.defaultPrevented)return;let m=this.app||this.plugin.app;m&&m.workspace.openLinkText(u.path,"",!0)});let h=s.createElement("div");if(h.textContent=d.title,h.style.cssText="font-weight: 600; font-size: 14px; margin-bottom: 4px;",p.appendChild(h),d.author&&d.author.length>0){let f=s.createElement("div");f.textContent=d.author.join(", "),f.style.cssText="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;",p.appendChild(f)}let g=s.createElement("div");if(g.style.cssText="font-size: 11px; color: var(--text-faint); display: flex; gap: 12px;",o==="finished"&&d.readFinished){let f=s.createElement("span");f.textContent=`Finished: ${d.readFinished}`,g.appendChild(f)}else if(o==="unread"&&d.created){let f=s.createElement("span");f.textContent=`Added: ${d.created.split(" ")[0]}`,g.appendChild(f)}if(d.totalPages){let f=s.createElement("span");f.textContent=`${d.totalPages} pages`,g.appendChild(f)}p.appendChild(g),c.appendChild(p)}),e.appendChild(c)}renderEmptyState(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-empty-state",n.style.cssText="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; text-align: center;";let i=s.createElement("div");i.className="bookshelf-empty-icon",i.textContent="\u{1F4DA}",i.style.cssText="font-size: 3em; margin-bottom: 12px;",n.appendChild(i);let o=s.createElement("div");o.textContent="No books",o.style.cssText="margin: 0; font-size: 1.1em; color: var(--text-muted);",n.appendChild(o),e.appendChild(n)}};var en=class extends ye{constructor(e,s,n){super(e,s,n);this.type="bookshelfStatisticsView";this.books=[];this.stats=null}async render(){var e;if(!(!this.rootElement||!((e=this.data)!=null&&e.data)))try{let s=this.extractDataItems();this.books=await this.extractBooksFromBasesData(s),this.stats=await this.calculateStatistics(),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][StatisticsView] Render error:",s),this.renderError(s)}}async calculateStatistics(){let e={totalBooks:this.books.length,reading:0,unread:0,finished:0,totalPages:0,readPages:0,totalReadingDays:0,averageTimeToFinish:0,categoryCounts:{},yearlyStats:{},monthlyStats:{}},s=[],n=new Set;for(let{book:a,file:l}of this.books){if(a.status==="reading"?e.reading++:a.status==="unread"?e.unread++:a.status==="finished"&&(e.finished++,s.push(a)),a.totalPages&&(e.totalPages+=a.totalPages),a.readPage&&(e.readPages+=a.readPage),a.status==="finished"&&a.category&&a.category.length>0&&a.category.forEach(c=>{e.categoryCounts[c]=(e.categoryCounts[c]||0)+1}),a.status==="finished"&&a.readFinished){let c=new Date(a.readFinished),d=c.getFullYear().toString(),u=`${d}-${String(c.getMonth()+1).padStart(2,"0")}`;e.yearlyStats[d]||(e.yearlyStats[d]={count:0,pages:0,readingDays:0,averageTimeToFinish:0}),e.yearlyStats[d].count++,a.totalPages&&(e.yearlyStats[d].pages+=a.totalPages),e.monthlyStats[u]||(e.monthlyStats[u]={count:0,pages:0,readingDays:0,averageTimeToFinish:0}),e.monthlyStats[u].count++,a.totalPages&&(e.monthlyStats[u].pages+=a.totalPages);let p=new Set;if(a.readStarted){let f=new Date(a.readStarted).toISOString().split("T")[0];f&&p.add(f)}try{let g=await this.plugin.app.vault.read(l),{FrontmatterParser:f}=await Promise.resolve().then(()=>(Te(),ot)),{frontmatter:m}=f.extract(g),b=m.reading_history_summary;b&&Array.isArray(b)&&b.forEach(y=>{y&&typeof y=="object"&&"date"in y&&typeof y.date=="string"&&p.add(y.date)})}catch(g){}let h=p.size;e.yearlyStats[d].readingDays+=h,e.yearlyStats[d].averageTimeToFinish+=h,e.monthlyStats[u].readingDays+=h,e.monthlyStats[u].averageTimeToFinish+=h}if(a.readStarted&&l){let d=new Date(a.readStarted).toISOString().split("T")[0];d&&n.add(d);try{let u=await this.plugin.app.vault.read(l),{FrontmatterParser:p}=await Promise.resolve().then(()=>(Te(),ot)),{frontmatter:h}=p.extract(u),g=h.reading_history_summary;g&&Array.isArray(g)&&g.forEach(f=>{f&&typeof f=="object"&&"date"in f&&typeof f.date=="string"&&n.add(f.date)})}catch(u){}}}e.totalReadingDays=n.size;let i=Object.keys(e.yearlyStats).sort();for(let a=0;a<i.length;a++){let l=i[a];if(!l)continue;let c=e.yearlyStats[l];if(c&&(c.count>0&&(c.averageTimeToFinish=Math.round(c.averageTimeToFinish/c.count)),a>0)){let d=i[a-1],u=d?e.yearlyStats[d]:null;u&&(c.change=c.count-u.count,c.changePercent=u.count>0?Math.round(c.change/u.count*100):c.count>0?100:0)}}let o=Object.keys(e.monthlyStats).sort();for(let a=0;a<o.length;a++){let l=o[a];if(!l)continue;let c=e.monthlyStats[l];if(c&&(c.count>0&&(c.averageTimeToFinish=Math.round(c.averageTimeToFinish/c.count)),a>0)){let d=o[a-1],u=d?e.monthlyStats[d]:null;u&&(c.change=c.count-u.count,c.changePercent=u.count>0?Math.round(c.change/u.count*100):c.count>0?100:0)}}if(s.length>0){let a=0,l=0;for(let c of this.books)if(c.book.status==="finished")try{let d=await this.plugin.app.vault.read(c.file),{FrontmatterParser:u}=await Promise.resolve().then(()=>(Te(),ot)),{frontmatter:p}=u.extract(d),h=p.reading_history_summary,g=new Set;if(c.book.readStarted){let b=new Date(c.book.readStarted).toISOString().split("T")[0];b&&g.add(b)}h&&Array.isArray(h)&&h.forEach(m=>{m&&typeof m=="object"&&"date"in m&&typeof m.date=="string"&&g.add(m.date)});let f=g.size;f>0&&(a+=f,l++)}catch(d){}e.averageTimeToFinish=l>0?Math.round(a/l):0}return e}renderContent(){if(!this.rootElement||!this.stats)return;let e=this.rootElement.ownerDocument,s=e.createElement("div");s.style.cssText="padding: 20px; overflow-y: auto; height: 100%;";let n=e.createElement("h1");n.textContent="Reading statistics",n.style.cssText="margin: 0 0 32px 0; font-size: 1.8em;",s.appendChild(n),this.renderOverallSection(s,e),this.renderTimeBasedSection(s,e),this.renderCategorySection(s,e),this.rootElement.appendChild(s)}renderOverallSection(e,s){let n=s.createElement("div");n.style.cssText="margin-bottom: 40px;";let i=s.createElement("h2");i.textContent="Overall statistics",i.style.cssText="margin: 0 0 16px 0; font-size: 1.4em; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);",n.appendChild(i);let o=s.createElement("div");o.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 16px;",[{label:"Total finished books",value:this.stats.finished,color:"var(--interactive-success)"},{label:"Total pages read",value:this.stats.readPages.toLocaleString(),color:"var(--interactive-accent)"},{label:"Total reading days",value:this.stats.totalReadingDays,color:"var(--text-accent)"}].forEach(p=>{let h=s.createElement("div");h.style.cssText="padding: 20px; border-radius: 8px; background: var(--background-secondary); border: 1px solid var(--background-modifier-border);";let g=s.createElement("div");g.textContent=p.label,g.style.cssText="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;";let f=s.createElement("div");f.textContent=p.value.toString(),f.style.cssText=`font-size: 28px; font-weight: 600; color: ${p.color};`,h.appendChild(g),h.appendChild(f),o.appendChild(h)}),n.appendChild(o);let l=s.createElement("div");l.style.cssText="padding: 20px; border-radius: 8px; background: var(--background-secondary); border: 1px solid var(--background-modifier-border);";let c=s.createElement("div");c.textContent="Average days to finish",c.style.cssText="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;";let d=s.createElement("div");d.textContent="Average number of reading sessions to complete a book",d.style.cssText="font-size: 10px; color: var(--text-faint); margin-bottom: 8px;";let u=s.createElement("div");u.textContent=this.stats.averageTimeToFinish>0?`${this.stats.averageTimeToFinish} sessions`:"No data available",u.style.cssText="font-size: 28px; font-weight: 600; color: var(--interactive-accent);",l.appendChild(c),l.appendChild(d),l.appendChild(u),n.appendChild(l),e.appendChild(n)}renderTimeBasedSection(e,s){let n=s.createElement("div");n.style.cssText="margin-bottom: 40px;";let i=s.createElement("div");i.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);";let o=s.createElement("h2");o.textContent="Time-based statistics",o.style.cssText="margin: 0; font-size: 1.4em;",i.appendChild(o);let a=s.createElement("div");a.style.cssText="display: flex; gap: 4px; background: var(--background-secondary); border-radius: 6px; padding: 4px;";let l=s.createElement("button");l.textContent="Yearly",l.style.cssText="padding: 6px 16px; border: none; border-radius: 4px; background: var(--interactive-accent); color: var(--text-on-accent); font-size: 13px; font-weight: 600; cursor: pointer;";let c=s.createElement("button");c.textContent="Monthly",c.style.cssText="padding: 6px 16px; border: none; border-radius: 4px; background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 600; cursor: pointer;",a.appendChild(l),a.appendChild(c),i.appendChild(a),n.appendChild(i);let d=s.createElement("div");d.style.cssText="position: relative;",this.renderYearlyContent(d,s),l.addEventListener("click",()=>{l.style.cssText="padding: 6px 16px; border: none; border-radius: 4px; background: var(--interactive-accent); color: var(--text-on-accent); font-size: 13px; font-weight: 600; cursor: pointer;",c.style.cssText="padding: 6px 16px; border: none; border-radius: 4px; background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 600; cursor: pointer;",d.empty(),this.renderYearlyContent(d,s)}),c.addEventListener("click",()=>{c.style.cssText="padding: 6px 16px; border: none; border-radius: 4px; background: var(--interactive-accent); color: var(--text-on-accent); font-size: 13px; font-weight: 600; cursor: pointer;",l.style.cssText="padding: 6px 16px; border: none; border-radius: 4px; background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 600; cursor: pointer;",d.empty(),this.renderMonthlyContent(d,s)}),n.appendChild(d),e.appendChild(n)}renderYearlyContent(e,s){let n=Object.keys(this.stats.yearlyStats).sort().reverse();if(n.length===0){let b=s.createElement("div");b.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;",["Finished books","Pages read","Reading days"].forEach(y=>{let k=s.createElement("div");k.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let v=s.createElement("h3");v.textContent=y,v.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",k.appendChild(v);let w=s.createElement("div");w.style.cssText="height: 200px; position: relative;",this.renderEmptyChart(w,s,"Year"),k.appendChild(w),b.appendChild(k)}),e.appendChild(b);return}let i=s.createElement("div");i.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-bottom: 16px;";let o=s.createElement("div");o.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let a=s.createElement("h3");a.textContent="Finished books",a.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",o.appendChild(a);let l=s.createElement("div");l.style.cssText="height: 200px; position: relative;",this.renderLineChart(l,s,n.map(b=>{let y=this.stats.yearlyStats[b];return{label:b,value:y?y.count:0,change:y==null?void 0:y.change,changePercent:y==null?void 0:y.changePercent}}),"Year"),o.appendChild(l),i.appendChild(o);let c=s.createElement("div");c.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let d=s.createElement("h3");d.textContent="Pages read",d.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",c.appendChild(d);let u=s.createElement("div");u.style.cssText="height: 200px; position: relative;",this.renderLineChart(u,s,n.map(b=>{let y=this.stats.yearlyStats[b];return{label:b,value:y?y.pages:0}}),"Year"),c.appendChild(u),i.appendChild(c);let p=s.createElement("div");p.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let h=s.createElement("h3");h.textContent="Reading days",h.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",p.appendChild(h);let g=s.createElement("div");g.style.cssText="height: 200px; position: relative;",this.renderLineChart(g,s,n.map(b=>{let y=this.stats.yearlyStats[b];return{label:b,value:y?y.readingDays:0}}),"Year"),p.appendChild(g),i.appendChild(p),e.appendChild(i);let f=s.createElement("div");f.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let m=s.createElement("h3");m.textContent="Details",m.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",f.appendChild(m),n.forEach(b=>{let y=this.stats.yearlyStats[b];if(!y)return;let k=s.createElement("div");k.style.cssText="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--background-modifier-border);";let v=s.createElement("div");v.style.cssText="display: flex; flex-direction: column; gap: 4px;";let w=s.createElement("span");if(w.textContent=b,w.style.cssText="font-size: 14px; font-weight: 600;",v.appendChild(w),y.change!==void 0&&y.changePercent!==void 0){let C=s.createElement("span"),O=y.change>=0,I=O?`+${y.change}`:`${y.change}`,$=O?`+${y.changePercent}%`:`${y.changePercent}%`;C.textContent=`${I} (${$})`,C.style.cssText=`font-size: 11px; color: ${O?"var(--interactive-success)":"var(--text-error)"};`,v.appendChild(C)}let T=s.createElement("div");T.style.cssText="display: flex; flex-direction: column; gap: 2px; align-items: flex-end;";let B=s.createElement("span");B.textContent=`${y.count} books, ${y.pages.toLocaleString()} pages`,B.style.cssText="font-size: 14px; color: var(--text-muted);";let S=s.createElement("span");S.textContent=`${y.readingDays} reading days, Avg: ${y.averageTimeToFinish} sessions`,S.style.cssText="font-size: 11px; color: var(--text-faint);",T.appendChild(B),T.appendChild(S),k.appendChild(v),k.appendChild(T),f.appendChild(k)}),e.appendChild(f)}renderMonthlyContent(e,s){let n=Object.keys(this.stats.monthlyStats).sort().reverse().slice(0,12);if(n.length===0){let b=s.createElement("div");b.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;",["Finished books (Last 12)","Pages read (Last 12)","Reading days (Last 12)"].forEach(y=>{let k=s.createElement("div");k.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let v=s.createElement("h3");v.textContent=y,v.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",k.appendChild(v);let w=s.createElement("div");w.style.cssText="height: 200px; position: relative;",this.renderEmptyChart(w,s,"Month"),k.appendChild(w),b.appendChild(k)}),e.appendChild(b);return}let i=s.createElement("div");i.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin-bottom: 16px;";let o=s.createElement("div");o.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let a=s.createElement("h3");a.textContent="Finished books (Last 12)",a.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",o.appendChild(a);let l=s.createElement("div");l.style.cssText="height: 200px; position: relative;",this.renderLineChart(l,s,n.map(b=>{let y=this.stats.monthlyStats[b],k=b.split("-"),v=k[0]||"",w=k[1]||"1";return{label:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(w)-1]||"Jan"} ${v}`,value:y?y.count:0,change:y==null?void 0:y.change,changePercent:y==null?void 0:y.changePercent}}),"Month"),o.appendChild(l),i.appendChild(o);let c=s.createElement("div");c.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let d=s.createElement("h3");d.textContent="Pages read (Last 12)",d.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",c.appendChild(d);let u=s.createElement("div");u.style.cssText="height: 200px; position: relative;",this.renderLineChart(u,s,n.map(b=>{let y=this.stats.monthlyStats[b],k=b.split("-"),v=k[0]||"",w=k[1]||"1";return{label:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(w)-1]||"Jan"} ${v}`,value:y?y.pages:0}}),"Month"),c.appendChild(u),i.appendChild(c);let p=s.createElement("div");p.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let h=s.createElement("h3");h.textContent="Reading days (Last 12)",h.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",p.appendChild(h);let g=s.createElement("div");g.style.cssText="height: 200px; position: relative;",this.renderLineChart(g,s,n.map(b=>{let y=this.stats.monthlyStats[b],k=b.split("-"),v=k[0]||"",w=k[1]||"1";return{label:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(w)-1]||"Jan"} ${v}`,value:y?y.readingDays:0}}),"Month"),p.appendChild(g),i.appendChild(p),e.appendChild(i);let f=s.createElement("div");f.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border);";let m=s.createElement("h3");m.textContent="Details",m.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",f.appendChild(m),n.forEach(b=>{let y=this.stats.monthlyStats[b];if(!y)return;let k=b.split("-"),v=k[0]||"",w=k[1]||"1",B=`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(w)-1]||"Jan"} ${v}`,S=s.createElement("div");S.style.cssText="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--background-modifier-border);";let C=s.createElement("div");C.style.cssText="display: flex; flex-direction: column; gap: 4px;";let O=s.createElement("span");if(O.textContent=B,O.style.cssText="font-size: 14px; font-weight: 600;",C.appendChild(O),y.change!==void 0&&y.changePercent!==void 0){let V=s.createElement("span"),z=y.change>=0,zt=z?`+${y.change}`:`${y.change}`,Ui=z?`+${y.changePercent}%`:`${y.changePercent}%`;V.textContent=`${zt} (${Ui})`,V.style.cssText=`font-size: 11px; color: ${z?"var(--interactive-success)":"var(--text-error)"};`,C.appendChild(V)}let I=s.createElement("div");I.style.cssText="display: flex; flex-direction: column; gap: 2px; align-items: flex-end;";let $=s.createElement("span");$.textContent=`${y.count} books, ${y.pages.toLocaleString()} pages`,$.style.cssText="font-size: 14px; color: var(--text-muted);";let K=s.createElement("span");K.textContent=`${y.readingDays} reading days, Avg: ${y.averageTimeToFinish} sessions`,K.style.cssText="font-size: 11px; color: var(--text-faint);",I.appendChild($),I.appendChild(K),S.appendChild(C),S.appendChild(I),f.appendChild(S)}),e.appendChild(f)}renderCategorySection(e,s){let n=s.createElement("div");n.style.cssText="margin-bottom: 40px;";let i=s.createElement("h2");i.textContent="Category statistics",i.style.cssText="margin: 0 0 16px 0; font-size: 1.4em; padding-bottom: 8px; border-bottom: 2px solid var(--background-modifier-border);",n.appendChild(i);let o=Object.entries(this.stats.categoryCounts).sort((d,u)=>u[1]-d[1]).slice(0,10),a=s.createElement("div");a.style.cssText="padding: 16px; background: var(--background-secondary); border-radius: 8px; border: 1px solid var(--background-modifier-border); max-width: 600px;";let l=s.createElement("h3");l.textContent="Books by category (Top 10)",l.style.cssText="margin: 0 0 12px 0; font-size: 0.9em; color: var(--text-muted);",a.appendChild(l);let c=s.createElement("div");c.style.cssText="height: 200px; position: relative;",o.length===0?this.renderEmptyChart(c,s,"Category"):this.renderBarChart(c,s,o.map(([d,u])=>({label:d,value:u}))),a.appendChild(c),n.appendChild(a),e.appendChild(n)}renderBarChart(e,s,n){if(n.length===0)return;let i=Math.max(...n.map(d=>d.value),1),o=180,a=40,l=12,c=s.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","100%"),c.setAttribute("height",`${o}px`),c.style.cssText="display: block;",n.forEach((d,u)=>{let p=d.value/i*(o-40),h=u*(a+l)+10,g=o-p-20,f=s.createElementNS("http://www.w3.org/2000/svg","rect");if(f.setAttribute("x",h.toString()),f.setAttribute("y",g.toString()),f.setAttribute("width",a.toString()),f.setAttribute("height",p.toString()),f.setAttribute("fill","var(--interactive-accent)"),f.setAttribute("rx","4"),c.appendChild(f),d.value>0){let b=s.createElementNS("http://www.w3.org/2000/svg","text");b.setAttribute("x",(h+a/2).toString()),b.setAttribute("y",(g-5).toString()),b.setAttribute("text-anchor","middle"),b.setAttribute("font-size","12"),b.setAttribute("fill","var(--text-normal)"),b.textContent=d.value.toString(),c.appendChild(b)}let m=s.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",(h+a/2).toString()),m.setAttribute("y",(o-5).toString()),m.setAttribute("text-anchor","middle"),m.setAttribute("font-size","10"),m.setAttribute("fill","var(--text-muted)"),m.textContent=d.label.length>7?d.label.substring(0,7)+"...":d.label,c.appendChild(m)}),e.appendChild(c)}renderLineChart(e,s,n,i){if(n.length===0)return;let o=[...n].reverse(),a=Math.max(...o.map(m=>m.value),1),l=200,c=e.clientWidth||600,d=40,u=c-d*2,p=l-d*2,h=s.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("width","100%"),h.setAttribute("height",`${l}px`),h.style.cssText="display: block;";let g=[];if(o.forEach((m,b)=>{let y=d+b/(o.length-1||1)*u,k=d+p-m.value/a*p;g.push(`${y},${k}`)}),g.length>1){let m=s.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",`M ${g.join(" L ")}`),m.setAttribute("fill","none"),m.setAttribute("stroke","var(--interactive-accent)"),m.setAttribute("stroke-width","2"),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),h.appendChild(m)}o.forEach((m,b)=>{let y=d+b/(o.length-1||1)*u,k=d+p-m.value/a*p,v=s.createElementNS("http://www.w3.org/2000/svg","circle");if(v.setAttribute("cx",y.toString()),v.setAttribute("cy",k.toString()),v.setAttribute("r","4"),v.setAttribute("fill","var(--interactive-accent)"),h.appendChild(v),m.value>0){let T=s.createElementNS("http://www.w3.org/2000/svg","text");T.setAttribute("x",y.toString()),T.setAttribute("y",(k-10).toString()),T.setAttribute("text-anchor","middle"),T.setAttribute("font-size","11"),T.setAttribute("fill","var(--text-normal)"),T.setAttribute("font-weight","600"),T.textContent=m.value.toString(),h.appendChild(T)}if(m.change!==void 0&&m.change!==0){let T=m.change>0,B=k-20,S=s.createElementNS("http://www.w3.org/2000/svg","path");T?S.setAttribute("d",`M ${y} ${B} L ${y-4} ${B+6} L ${y+4} ${B+6} Z`):S.setAttribute("d",`M ${y} ${B+6} L ${y-4} ${B} L ${y+4} ${B} Z`),S.setAttribute("fill",T?"var(--interactive-success)":"var(--text-error)"),h.appendChild(S)}let w=s.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x",y.toString()),w.setAttribute("y",(l-10).toString()),w.setAttribute("text-anchor","middle"),w.setAttribute("font-size","9"),w.setAttribute("fill","var(--text-muted)"),w.textContent=m.label.length>8?m.label.substring(0,8)+"...":m.label,h.appendChild(w)});let f=5;for(let m=0;m<=f;m++){let b=a/f*m,y=d+p-m/f*p,k=s.createElementNS("http://www.w3.org/2000/svg","line");k.setAttribute("x1",d.toString()),k.setAttribute("y1",y.toString()),k.setAttribute("x2",(d+u).toString()),k.setAttribute("y2",y.toString()),k.setAttribute("stroke","var(--background-modifier-border)"),k.setAttribute("stroke-width","1"),k.setAttribute("stroke-dasharray","2,2"),h.insertBefore(k,h.firstChild);let v=s.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",(d-5).toString()),v.setAttribute("y",(y+4).toString()),v.setAttribute("text-anchor","end"),v.setAttribute("font-size","9"),v.setAttribute("fill","var(--text-muted)"),v.textContent=Math.round(b).toString(),h.insertBefore(v,h.firstChild)}e.appendChild(h)}renderEmptyChart(e,s,n){let o=e.clientWidth||600,a=40,l=o-a*2,c=200-a*2,d=s.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("width","100%"),d.setAttribute("height","200px"),d.style.cssText="display: block;";let u=5;for(let f=0;f<=u;f++){let m=f,b=a+c-f/u*c,y=s.createElementNS("http://www.w3.org/2000/svg","line");y.setAttribute("x1",a.toString()),y.setAttribute("y1",b.toString()),y.setAttribute("x2",(a+l).toString()),y.setAttribute("y2",b.toString()),y.setAttribute("stroke","var(--background-modifier-border)"),y.setAttribute("stroke-width","1"),y.setAttribute("stroke-dasharray","2,2"),d.appendChild(y);let k=s.createElementNS("http://www.w3.org/2000/svg","text");k.setAttribute("x",(a-5).toString()),k.setAttribute("y",(b+4).toString()),k.setAttribute("text-anchor","end"),k.setAttribute("font-size","9"),k.setAttribute("fill","var(--text-muted)"),k.textContent=m.toString(),d.appendChild(k)}let p=s.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",a.toString()),p.setAttribute("y1",(a+c).toString()),p.setAttribute("x2",(a+l).toString()),p.setAttribute("y2",(a+c).toString()),p.setAttribute("stroke","var(--text-muted)"),p.setAttribute("stroke-width","1"),d.appendChild(p);let h=s.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",a.toString()),h.setAttribute("y1",a.toString()),h.setAttribute("x2",a.toString()),h.setAttribute("y2",(a+c).toString()),h.setAttribute("stroke","var(--text-muted)"),h.setAttribute("stroke-width","1"),d.appendChild(h);let g=s.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",(a+l/2).toString()),g.setAttribute("y",(a+c/2).toString()),g.setAttribute("text-anchor","middle"),g.setAttribute("font-size","14"),g.setAttribute("fill","var(--text-muted)"),g.setAttribute("font-style","italic"),g.textContent="No data available",d.appendChild(g),e.appendChild(d)}};async function Ri(r){if(!(0,Mi.requireApiVersion)("1.10.1")){console.warn("[Bookshelf][Bases] Obsidian 1.10.1+ required for Bases integration");return}let t=async()=>{try{let e=Kt(r,"bookshelfView",{name:"Bookshelf View",icon:"book-open",factory:(o,a)=>new Qs(o,a,r)}),s=Kt(r,"bookshelfReadingView",{name:"Reading Books",icon:"book-open-text",factory:(o,a)=>new Xs(o,a,r)}),n=Kt(r,"bookshelfLibraryView",{name:"Library",icon:"library",factory:(o,a)=>new Zs(o,a,r)}),i=Kt(r,"bookshelfStatisticsView",{name:"Reading Statistics",icon:"bar-chart",factory:(o,a)=>new en(o,a,r)});return!e&&!s&&!n&&!i?(console.debug("[Bookshelf][Bases] Bases plugin not available for registration"),!1):(r.app.workspace.iterateAllLeaves(o=>{var a,l;if(((l=(a=o.view)==null?void 0:a.getViewType)==null?void 0:l.call(a))==="bases"){let c=o.view;if(typeof c.refresh=="function")try{c.refresh()}catch(d){console.debug("[Bookshelf][Bases] Error refreshing view:",d)}}}),!0)}catch(e){return console.warn("[Bookshelf][Bases] Registration attempt failed:",e),!1}};if(!await t()){for(let e=0;e<5;e++)if(await new Promise(s=>setTimeout(s,200)),await t())return;console.warn("[Bookshelf][Bases] Failed to register views after multiple attempts")}}function _i(r){try{Vt(r,"bookshelfView"),Vt(r,"bookshelfReadingView"),Vt(r,"bookshelfLibraryView"),Vt(r,"bookshelfStatisticsView")}catch(t){console.error("[Bookshelf][Bases] Error during view unregistration:",t)}}var tn=class{static generate(t){return`filters:
  and:
    - file.path.startsWith("${`${t.bookFolder}/Books`}/")
    - file.path.endsWith(".md")
    - note.status == "reading" || note.status == "unread"

order:
  - note.status
  - note.read_page
  - file.ctime

columns:
  - id: file.name
    display-name: Title
    type: text
  - id: note.author
    display-name: Author
    type: list
  - id: note.status
    display-name: Status
    type: text
  - id: note.read_page
    display-name: Progress
    type: number
  - id: note.total
    display-name: Total Pages
    type: number

views:
  - type: bookshelfView
    name: Bookshelf
`}};var sn=class{static generate(t){return`filters:
  and:
    - file.path.startsWith("${`${t.bookFolder}/Books`}/")
    - file.path.endsWith(".md")
    - note.status == "unread" || note.status == "finished"

order:
  - note.status
  - file.ctime

columns:
  - id: file.name
    display-name: Title
    type: text
  - id: note.author
    display-name: Author
    type: list
  - id: note.status
    display-name: Status
    type: text
  - id: note.total
    display-name: Total Pages
    type: number
  - id: file.ctime
    display-name: Added
    type: date
  - id: note.read_finished
    display-name: Finished
    type: date

views:
  - type: bookshelfLibraryView
    name: Library
`}};var nn=class{static generate(t){return`filters:
  and:
    - file.path.startsWith("${`${t.bookFolder}/Books`}/")
    - file.path.endsWith(".md")

views:
  - type: bookshelfStatisticsView
    name: Statistics
`}};var rn=class extends le.Plugin{async onload(){await this.loadSettings(),Zt(this.settings.timezone);let t=new Ke(this.app);try{await t.ensureFolder(this.settings.bookFolder),await t.ensureFolder(Y.getBooksFolderPath(this.settings.bookFolder)),await t.ensureFolder(Y.getInteractionFolderPath(this.settings.bookFolder)),await t.ensureFolder(Y.getViewsFolderPath(this.settings.bookFolder)),await this.ensureDefaultBaseFiles()}catch(s){console.error("Failed to initialize Bookshelf folders:",s)}this.addSettingTab(new Yt(this.app,this)),Fi(this.app,this),await Ri(this),this.addCommand({id:"open-view",name:"Open view",callback:()=>{this.activateView()}}),this.addRibbonIcon("book-open-text","Open bookshelf",()=>{this.activateView()}),this.addRibbonIcon("book-plus","Search and add book",()=>{new qe(this.app,this).open()}),this.registerEvent(this.app.workspace.on("file-open",s=>{s instanceof le.TFile&&this.addProgressButtonToNote(s)}));let e=this.app.workspace.getActiveFile();e&&this.addProgressButtonToNote(e),this.settings.autoUpdateTimestamp&&this.registerAutoUpdateTimestamp()}async addProgressButtonToNote(t){if(!t||t.extension!=="md")return;let e=Y.getBooksFolderPath(this.settings.bookFolder);t.path.startsWith(e)&&setTimeout(()=>{let s=this.app.workspace.getActiveViewOfType(le.MarkdownView);if(!s)return;let n=s.containerEl;if(!n)return;let i=n.querySelector(".bookshelf-action-container");if(!i){let a=n.querySelector(".view-header")||n.querySelector(".view-header-title-container");if(a)i=a;else{let l=n.querySelector(".markdown-source-view")||n.querySelector(".markdown-preview-view");if(!l)return;let c=l.createEl("div",{cls:"bookshelf-action-container"});l.firstChild&&l.insertBefore(c,l.firstChild),i=c}}if(i.querySelector(".bookshelf-progress-button"))return;i.createEl("button",{cls:"bookshelf-progress-button mod-cta",text:"Update progress"}).addEventListener("click",()=>{let a=this.app.workspace.getActiveFile();a&&new Me(this.app,this,a).open()})},200)}onunload(){_i(this)}registerAutoUpdateTimestamp(){let t=Y.getBooksFolderPath(this.settings.bookFolder);this.registerEvent(this.app.vault.on("modify",async e=>{if(!(!(e instanceof le.TFile)||e.extension!=="md"||!e.path.startsWith(t))&&this.settings.autoUpdateTimestamp)try{let s=await this.app.vault.read(e),{frontmatter:n,body:i}=me.extract(s);if(!n.title)return;n.updated=J();let a=`${Ee.create(n)}
${i}`;s!==a&&await this.app.vault.modify(e,a)}catch(s){console.debug("Auto-update timestamp error:",s)}}))}async activateView(){let{workspace:t}=this.app,e=Y.getViewsFolderPath(this.settings.bookFolder),s=(0,le.normalizePath)(`${e}/bookshelf-default.base`),n=this.app.vault.getAbstractFileByPath(s);if(n&&n instanceof le.TFile){let i=t.getRightLeaf(!1)||t.getLeaf(!0);await i.openFile(n),t.revealLeaf(i)}}async ensureDefaultBaseFiles(){let t=Y.getViewsFolderPath(this.settings.bookFolder),e=[{path:`${t}/bookshelf-default.base`,generator:tn},{path:`${t}/library.base`,generator:sn},{path:`${t}/statistics.base`,generator:nn}];for(let{path:s,generator:n}of e){let i=(0,le.normalizePath)(s);if(!this.app.vault.getAbstractFileByPath(i))try{let a=n.generate(this.settings);await this.app.vault.create(i,a)}catch(a){console.error(`[Bookshelf] Failed to create ${i}:`,a)}}}async loadSettings(){this.settings=Object.assign({},ur,await this.loadData())}async saveSettings(){await this.saveData(this.settings),Zt(this.settings.timezone)}};
