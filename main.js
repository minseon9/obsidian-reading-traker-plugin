/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var fn=Object.defineProperty;var Wi=Object.getOwnPropertyDescriptor;var Ji=Object.getOwnPropertyNames;var Gi=Object.prototype.hasOwnProperty;var k=(r,t)=>()=>(r&&(t=r(r=0)),t);var Gt=(r,t)=>{for(var e in t)fn(r,e,{get:t[e],enumerable:!0})},Qi=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ji(t))!Gi.call(r,n)&&n!==e&&fn(r,n,{get:()=>t[n],enumerable:!(s=Wi(t,n))||s.enumerable});return r};var Xi=r=>Qi(fn({},"__esModule",{value:!0}),r);function un(r){let t=new Date().toISOString().replace("T"," ").substring(0,19);return{title:r.title||"Unknown Title",subtitle:r.subtitle,author:r.author||[],isbn10:r.isbn10,isbn13:r.isbn13,publisher:r.publisher,publishDate:r.publishDate,totalPages:r.totalPages,coverUrl:r.coverUrl,category:r.category||[],coverEditionKey:r.coverEditionKey,status:r.status||"unread",readPage:r.readPage||0,readStarted:r.readStarted,readFinished:r.readFinished,created:r.created||t,updated:r.updated||t}}var vr=k(()=>{});var Sr,Xt,Er=k(()=>{Sr=require("obsidian"),Xt=class{constructor(t=5e3){this.timeout=t}async get(t){try{let e=await(0,Sr.requestUrl)({url:t,method:"GET",throw:!1});if(e.status>=400)throw new Error(`Request failed with status ${e.status}`);return e.json}catch(e){throw new Error("Request failed. Please try again later.")}}}});var Zt,Cr=k(()=>{vr();Er();Zt=class{constructor(t=5e3){this.baseUrl="https://openlibrary.org";this.httpClient=new Xt(t)}async searchBooks(t,e=20,s=0){try{let n=encodeURIComponent(t),i=`${this.baseUrl}/search.json?q=${n}&limit=${e}&offset=${s}`,o=await this.httpClient.get(i);return this.convertSearchDocsToBooks(o.docs)}catch(n){throw new Error("Failed to search books. Please try again later.")}}async getBookByOLID(t){try{let e=`${this.baseUrl}/books/${t}.json`,s=await this.httpClient.get(e),n=await this.fetchWorkDetails(s);return this.convertEditionToBook(s,n)}catch(e){return console.error("[OpenLibrary] Error fetching book by OLID:",e),null}}async fetchWorkDetails(t){if(!t.works||t.works.length===0)return null;let e=t.works[0];if(!(e!=null&&e.key))return null;try{let s=`${this.baseUrl}${e.key}.json`;return await this.httpClient.get(s)}catch(s){return null}}getBookCover(t,e="M"){let s={S:"-S",M:"-M",L:"-L"};return typeof t=="number"?`https://covers.openlibrary.org/b/id/${t}${s[e]}.jpg`:`https://covers.openlibrary.org/b/isbn/${t}${s[e]}.jpg`}convertEditionToBook(t,e,s){var c,d,h,u,f,g,p;let n=this.extractAuthors(t),i=((c=t.isbn_10)==null?void 0:c[0])||(s&&s.length===10?s:void 0),o=((d=t.isbn_13)==null?void 0:d[0])||(s&&s.length===13?s:void 0),a=this.extractCoverUrl(t,o,i),l=(h=t.number_of_pages)!=null?h:e==null?void 0:e.number_of_pages;return un({title:t.title||(e==null?void 0:e.title)||"",subtitle:t.subtitle||(e==null?void 0:e.subtitle),author:n,isbn10:i,isbn13:o,publisher:((u=t.publishers)==null?void 0:u[0])||((f=e==null?void 0:e.publishers)==null?void 0:f[0]),publishDate:t.publish_date||(e==null?void 0:e.publish_date),totalPages:l,coverUrl:a,category:((g=t.subjects)==null?void 0:g.slice(0,5))||((p=e==null?void 0:e.subjects)==null?void 0:p.slice(0,5))||[]})}extractAuthors(t){return!t.authors||!Array.isArray(t.authors)?[]:t.authors.map(e=>e.name||"").filter(e=>e.length>0)}extractCoverUrl(t,e,s){if(t.covers&&t.covers.length>0&&t.covers[0]!==void 0)return this.getBookCover(t.covers[0],"M");if(e)return this.getBookCover(e,"M");if(s)return this.getBookCover(s,"M")}convertSearchDocToBook(t){var a,l,c,d,h;let e=t.author_name||[],s=t.cover_i?this.getBookCover(t.cover_i,"M"):void 0,n=t.first_publish_year||((a=t.publish_year)==null?void 0:a[0]),i=n?n.toString():(l=t.publish_date)==null?void 0:l[0],o=(c=t.number_of_pages_median)!=null?c:t.number_of_pages;return un({title:t.title,subtitle:t.subtitle,author:e,isbn10:void 0,isbn13:void 0,publisher:(d=t.publisher)==null?void 0:d[0],publishDate:i,totalPages:o,coverUrl:s,category:(h=t.subject)==null?void 0:h.slice(0,5),coverEditionKey:t.cover_edition_key})}convertSearchDocsToBooks(t){return t.map(e=>this.convertSearchDocToBook(e))}}});var es,He,pn=k(()=>{es=require("obsidian"),He=class{constructor(t){this.app=t}async ensureFolder(t){let e=(0,es.normalizePath)(t),s=this.app.vault.getAbstractFileByPath(e);if(!s)await this.app.vault.createFolder(e);else if(!(s instanceof es.TFolder))throw new Error(`Path exists but is not a folder: ${e}`)}}});var ze,hn=k(()=>{ze=class{static generate(t){let e=t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim(),s=100;return(e.length>s?e.substring(0,s).trim():e)||"Untitled Book"}}});var ts,K,ss=k(()=>{ts=require("obsidian"),K=class{static getBooksFolderPath(t){return(0,ts.normalizePath)(`${t}/Books`)}static getInteractionFolderPath(t){return(0,ts.normalizePath)(`${t}/.bookshelf`)}static getViewsFolderPath(t){return(0,ts.normalizePath)(`${t}/Views`)}}});var xr={};Gt(xr,{formatDate:()=>pt,getCurrentDate:()=>eo,getCurrentDateTime:()=>H,getTimezoneOffset:()=>Zi,setTimezoneOffset:()=>ns});function ns(r){mn=r}function Zi(){return mn}function pt(r,t="YYYY-MM-DD HH:mm:ss"){let e=typeof r=="string"?new Date(r):r,s=e.getTime()+e.getTimezoneOffset()*6e4,n=new Date(s+mn*36e5),i=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0"),c=String(n.getMinutes()).padStart(2,"0"),d=String(n.getSeconds()).padStart(2,"0");return t.replace(/YYYY/g,String(i)).replace(/MM/g,o).replace(/DD/g,a).replace(/HH/g,l).replace(/mm/g,c).replace(/ss/g,d)}function H(){return pt(new Date,"YYYY-MM-DD HH:mm:ss")}function eo(){return pt(new Date,"YYYY-MM-DD")}var mn,_e=k(()=>{mn=0});var ke,rs=k(()=>{_e();ke=class r{static bookToFrontmatter(t){let e=H(),s=t.created||e,n={title:t.title||"",subtitle:t.subtitle||"",author:t.author||[],category:t.category||[],publisher:t.publisher||"",publish:t.publishDate||"",isbn:"",cover:t.coverUrl||"",total:0,status:t.status||"unread",read_page:t.readPage||0,read_started:t.readStarted!==void 0?t.readStarted:s,read_finished:t.readFinished||null,created:s,updated:t.updated||e};t.totalPages!==void 0&&t.totalPages!==null&&!isNaN(t.totalPages)&&(n.total=t.totalPages);let i=`${t.isbn10||""} ${t.isbn13||""}`.trim();return i&&(n.isbn=i),n}static frontmatterToBook(t){let{isbn10:e,isbn13:s}=r.extractIsbn(t.isbn),n=r.calculateReadPage(t),i=t.status,o=i==="unread"||i==="reading"||i==="finished"?i:"unread";return{title:t.title||"",subtitle:t.subtitle,author:Array.isArray(t.author)?t.author:[],category:Array.isArray(t.category)?t.category:[],publisher:t.publisher,publishDate:t.publish,totalPages:typeof t.total=="number"?t.total:void 0,isbn10:e,isbn13:s,coverUrl:t.cover,status:o,readPage:n,readStarted:t.read_started,readFinished:t.read_finished!==null?t.read_finished:void 0,created:t.created||H(),updated:t.updated||H()}}static extractIsbn(t){let e,s;if(t){let n=String(t).trim().split(/\s+/);for(let i of n)i.length===10?e=i:i.length===13&&(s=i)}return{isbn10:e,isbn13:s}}static calculateReadPage(t){let e=typeof t.read_page=="number"?t.read_page:0;if(t.reading_history_summary&&Array.isArray(t.reading_history_summary)){let s=t.reading_history_summary.reduce((n,i)=>n+(i.pagesRead||0),0);s>e&&(e=s)}return e}}});function D(r){if(r&&typeof r=="object")switch(r[V]){case ee:case we:return!0}return!1}function N(r){if(r&&typeof r=="object")switch(r[V]){case is:case ee:case W:case we:return!0}return!1}var is,os,ee,gn,W,we,V,J,te,se,A,P,ne,as,L=k(()=>{is=Symbol.for("yaml.alias"),os=Symbol.for("yaml.document"),ee=Symbol.for("yaml.map"),gn=Symbol.for("yaml.pair"),W=Symbol.for("yaml.scalar"),we=Symbol.for("yaml.seq"),V=Symbol.for("yaml.node.type"),J=r=>!!r&&typeof r=="object"&&r[V]===is,te=r=>!!r&&typeof r=="object"&&r[V]===os,se=r=>!!r&&typeof r=="object"&&r[V]===ee,A=r=>!!r&&typeof r=="object"&&r[V]===gn,P=r=>!!r&&typeof r=="object"&&r[V]===W,ne=r=>!!r&&typeof r=="object"&&r[V]===we;as=r=>(P(r)||D(r))&&!!r.anchor});function fe(r,t){let e=Tr(t);te(r)?Ye(null,r.contents,e,Object.freeze([r]))===de&&(r.contents=null):Ye(null,r,e,Object.freeze([]))}function Ye(r,t,e,s){let n=Br(r,t,e,s);if(N(n)||A(n))return Ar(r,s,n),Ye(r,n,e,s);if(typeof n!="symbol"){if(D(t)){s=Object.freeze(s.concat(t));for(let i=0;i<t.items.length;++i){let o=Ye(i,t.items[i],e,s);if(typeof o=="number")i=o-1;else{if(o===z)return z;o===de&&(t.items.splice(i,1),i-=1)}}}else if(A(t)){s=Object.freeze(s.concat(t));let i=Ye("key",t.key,e,s);if(i===z)return z;i===de&&(t.key=null);let o=Ye("value",t.value,e,s);if(o===z)return z;o===de&&(t.value=null)}}return n}async function ls(r,t){let e=Tr(t);te(r)?await We(null,r.contents,e,Object.freeze([r]))===de&&(r.contents=null):await We(null,r,e,Object.freeze([]))}async function We(r,t,e,s){let n=await Br(r,t,e,s);if(N(n)||A(n))return Ar(r,s,n),We(r,n,e,s);if(typeof n!="symbol"){if(D(t)){s=Object.freeze(s.concat(t));for(let i=0;i<t.items.length;++i){let o=await We(i,t.items[i],e,s);if(typeof o=="number")i=o-1;else{if(o===z)return z;o===de&&(t.items.splice(i,1),i-=1)}}}else if(A(t)){s=Object.freeze(s.concat(t));let i=await We("key",t.key,e,s);if(i===z)return z;i===de&&(t.key=null);let o=await We("value",t.value,e,s);if(o===z)return z;o===de&&(t.value=null)}}return n}function Tr(r){return typeof r=="object"&&(r.Collection||r.Node||r.Value)?Object.assign({Alias:r.Node,Map:r.Node,Scalar:r.Node,Seq:r.Node},r.Value&&{Map:r.Value,Scalar:r.Value,Seq:r.Value},r.Collection&&{Map:r.Collection,Seq:r.Collection},r):r}function Br(r,t,e,s){var n,i,o,a,l;if(typeof e=="function")return e(r,t,s);if(se(t))return(n=e.Map)==null?void 0:n.call(e,r,t,s);if(ne(t))return(i=e.Seq)==null?void 0:i.call(e,r,t,s);if(A(t))return(o=e.Pair)==null?void 0:o.call(e,r,t,s);if(P(t))return(a=e.Scalar)==null?void 0:a.call(e,r,t,s);if(J(t))return(l=e.Alias)==null?void 0:l.call(e,r,t,s)}function Ar(r,t,e){let s=t[t.length-1];if(D(s))s.items[r]=e;else if(A(s))r==="key"?s.key=e:s.value=e;else if(te(s))s.contents=e;else{let n=J(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${n} parent`)}}var z,Pr,de,ht=k(()=>{L();z=Symbol("break visit"),Pr=Symbol("skip children"),de=Symbol("remove node");fe.BREAK=z;fe.SKIP=Pr;fe.REMOVE=de;ls.BREAK=z;ls.SKIP=Pr;ls.REMOVE=de});var to,so,ue,yn=k(()=>{L();ht();to={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},so=r=>r.replace(/[!,[\]{}]/g,t=>to[t]),ue=class r{constructor(t,e){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},r.defaultYaml,t),this.tags=Object.assign({},r.defaultTags,e)}clone(){let t=new r(this.yaml,this.tags);return t.docStart=this.docStart,t}atDocument(){let t=new r(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:r.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},r.defaultTags);break}return t}add(t,e){this.atNextDocument&&(this.yaml={explicit:r.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},r.defaultTags),this.atNextDocument=!1);let s=t.trim().split(/[ \t]+/),n=s.shift();switch(n){case"%TAG":{if(s.length!==2&&(e(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;let[i,o]=s;return this.tags[i]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return e(0,"%YAML directive should contain exactly one part"),!1;let[i]=s;if(i==="1.1"||i==="1.2")return this.yaml.version=i,!0;{let o=/^\d+\.\d+$/.test(i);return e(6,`Unsupported YAML version ${i}`,o),!1}}default:return e(0,`Unknown directive ${n}`,!0),!1}}tagName(t,e){if(t==="!")return"!";if(t[0]!=="!")return e(`Not a valid tag: ${t}`),null;if(t[1]==="<"){let o=t.slice(2,-1);return o==="!"||o==="!!"?(e(`Verbatim tags aren't resolved, so ${t} is invalid.`),null):(t[t.length-1]!==">"&&e("Verbatim tags must end with a >"),o)}let[,s,n]=t.match(/^(.*!)([^!]*)$/s);n||e(`The ${t} tag has no suffix`);let i=this.tags[s];if(i)try{return i+decodeURIComponent(n)}catch(o){return e(String(o)),null}return s==="!"?t:(e(`Could not resolve tag: ${t}`),null)}tagString(t){for(let[e,s]of Object.entries(this.tags))if(t.startsWith(s))return e+so(t.substring(s.length));return t[0]==="!"?t:`!<${t}>`}toString(t){let e=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags),n;if(t&&s.length>0&&N(t.contents)){let i={};fe(t.contents,(o,a)=>{N(a)&&a.tag&&(i[a.tag]=!0)}),n=Object.keys(i)}else n=[];for(let[i,o]of s)i==="!!"&&o==="tag:yaml.org,2002:"||(!t||n.some(a=>a.startsWith(o)))&&e.push(`%TAG ${i} ${o}`);return e.join(`
`)}};ue.defaultYaml={explicit:!1,version:"1.2"};ue.defaultTags={"!!":"tag:yaml.org,2002:"}});function cs(r){if(/[\x00-\x19\s,[\]{}]/.test(r)){let e=`Anchor must not contain whitespace or control characters: ${JSON.stringify(r)}`;throw new Error(e)}return!0}function bn(r){let t=new Set;return fe(r,{Value(e,s){s.anchor&&t.add(s.anchor)}}),t}function kn(r,t){for(let e=1;;++e){let s=`${r}${e}`;if(!t.has(s))return s}}function Nr(r,t){let e=[],s=new Map,n=null;return{onAnchor:i=>{e.push(i),n!=null||(n=bn(r));let o=kn(t,n);return n.add(o),o},setAnchors:()=>{for(let i of e){let o=s.get(i);if(typeof o=="object"&&o.anchor&&(P(o.node)||D(o.node)))o.node.anchor=o.anchor;else{let a=new Error("Failed to resolve repeated object (this should not happen)");throw a.source=i,a}}},sourceObjects:s}}var ds=k(()=>{L();ht()});function Te(r,t,e,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let n=0,i=s.length;n<i;++n){let o=s[n],a=Te(r,s,String(n),o);a===void 0?delete s[n]:a!==o&&(s[n]=a)}else if(s instanceof Map)for(let n of Array.from(s.keys())){let i=s.get(n),o=Te(r,s,n,i);o===void 0?s.delete(n):o!==i&&s.set(n,o)}else if(s instanceof Set)for(let n of Array.from(s)){let i=Te(r,s,n,n);i===void 0?s.delete(n):i!==n&&(s.delete(n),s.add(i))}else for(let[n,i]of Object.entries(s)){let o=Te(r,s,n,i);o===void 0?delete s[n]:o!==i&&(s[n]=o)}return r.call(t,e,s)}var wn=k(()=>{});function R(r,t,e){if(Array.isArray(r))return r.map((s,n)=>R(s,String(n),e));if(r&&typeof r.toJSON=="function"){if(!e||!as(r))return r.toJSON(t,e);let s={aliasCount:0,count:1,res:void 0};e.anchors.set(r,s),e.onCreate=i=>{s.res=i,delete e.onCreate};let n=r.toJSON(t,e);return e.onCreate&&e.onCreate(n),n}return typeof r=="bigint"&&!(e!=null&&e.keep)?Number(r):r}var Be=k(()=>{L()});var Ae,fs=k(()=>{wn();L();Be();Ae=class{constructor(t){Object.defineProperty(this,V,{value:t})}clone(){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(t.range=this.range.slice()),t}toJS(t,{mapAsMap:e,maxAliasCount:s,onAnchor:n,reviver:i}={}){if(!te(t))throw new TypeError("A document argument is required");let o={anchors:new Map,doc:t,keep:!0,mapAsMap:e===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},a=R(this,"",o);if(typeof n=="function")for(let{count:l,res:c}of o.anchors.values())n(c,l);return typeof i=="function"?Te(i,{"":a},"",a):a}}});function us(r,t,e){if(J(t)){let s=t.resolve(r),n=e&&s&&e.get(s);return n?n.count*n.aliasCount:0}else if(D(t)){let s=0;for(let n of t.items){let i=us(r,n,e);i>s&&(s=i)}return s}else if(A(t)){let s=us(r,t.key,e),n=us(r,t.value,e);return Math.max(s,n)}return 1}var ve,mt=k(()=>{ds();ht();L();fs();Be();ve=class extends Ae{constructor(t){super(is),this.source=t,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(t,e){let s;e!=null&&e.aliasResolveCache?s=e.aliasResolveCache:(s=[],fe(t,{Node:(i,o)=>{(J(o)||as(o))&&s.push(o)}}),e&&(e.aliasResolveCache=s));let n;for(let i of s){if(i===this)break;i.anchor===this.source&&(n=i)}return n}toJSON(t,e){if(!e)return{source:this.source};let{anchors:s,doc:n,maxAliasCount:i}=e,o=this.resolve(n,e);if(!o){let l=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(l)}let a=s.get(o);if(a||(R(o,null,e),a=s.get(o)),(a==null?void 0:a.res)===void 0){let l="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(l)}if(i>=0&&(a.count+=1,a.aliasCount===0&&(a.aliasCount=us(n,o,s)),a.count*a.aliasCount>i)){let l="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(l)}return a.res}toString(t,e,s){let n=`*${this.source}`;if(t){if(cs(this.source),t.options.verifyAliasOrder&&!t.anchors.has(this.source)){let i=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(i)}if(t.implicitKey)return`${n} `}return n}}});var ps,E,M=k(()=>{L();fs();Be();ps=r=>!r||typeof r!="function"&&typeof r!="object",E=class extends Ae{constructor(t){super(W),this.value=t}toJSON(t,e){return e!=null&&e.keep?this.value:R(this.value,t,e)}toString(){return String(this.value)}};E.BLOCK_FOLDED="BLOCK_FOLDED";E.BLOCK_LITERAL="BLOCK_LITERAL";E.PLAIN="PLAIN";E.QUOTE_DOUBLE="QUOTE_DOUBLE";E.QUOTE_SINGLE="QUOTE_SINGLE"});function ro(r,t,e){var s;if(t){let n=e.filter(o=>o.tag===t),i=(s=n.find(o=>!o.format))!=null?s:n[0];if(!i)throw new Error(`Tag ${t} not found`);return i}return e.find(n=>{var i;return((i=n.identify)==null?void 0:i.call(n,r))&&!n.format})}function Se(r,t,e){var h,u,f,g;if(te(r)&&(r=r.contents),N(r))return r;if(A(r)){let p=(u=(h=e.schema[ee]).createNode)==null?void 0:u.call(h,e.schema,null,e);return p.items.push(r),p}(r instanceof String||r instanceof Number||r instanceof Boolean||typeof BigInt!="undefined"&&r instanceof BigInt)&&(r=r.valueOf());let{aliasDuplicateObjects:s,onAnchor:n,onTagObj:i,schema:o,sourceObjects:a}=e,l;if(s&&r&&typeof r=="object"){if(l=a.get(r),l)return(f=l.anchor)!=null||(l.anchor=n(r)),new ve(l.anchor);l={anchor:null,node:null},a.set(r,l)}t!=null&&t.startsWith("!!")&&(t=no+t.slice(2));let c=ro(r,t,o.tags);if(!c){if(r&&typeof r.toJSON=="function"&&(r=r.toJSON()),!r||typeof r!="object"){let p=new E(r);return l&&(l.node=p),p}c=r instanceof Map?o[ee]:Symbol.iterator in Object(r)?o[we]:o[ee]}i&&(i(c),delete e.onTagObj);let d=c!=null&&c.createNode?c.createNode(e.schema,r,e):typeof((g=c==null?void 0:c.nodeClass)==null?void 0:g.from)=="function"?c.nodeClass.from(e.schema,r,e):new E(r);return t?d.tag=t:c.default||(d.tag=c.tag),l&&(l.node=d),d}var no,gt=k(()=>{mt();L();M();no="tag:yaml.org,2002:"});function yt(r,t,e){let s=e;for(let n=t.length-1;n>=0;--n){let i=t[n];if(typeof i=="number"&&Number.isInteger(i)&&i>=0){let o=[];o[i]=s,s=o}else s=new Map([[i,s]])}return Se(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:r,sourceObjects:new Map})}var Ge,Je,hs=k(()=>{gt();L();fs();Ge=r=>r==null||typeof r=="object"&&!!r[Symbol.iterator]().next().done,Je=class extends Ae{constructor(t,e){super(t),Object.defineProperty(this,"schema",{value:e,configurable:!0,enumerable:!1,writable:!0})}clone(t){let e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return t&&(e.schema=t),e.items=e.items.map(s=>N(s)||A(s)?s.clone(t):s),this.range&&(e.range=this.range.slice()),e}addIn(t,e){if(Ge(t))this.add(e);else{let[s,...n]=t,i=this.get(s,!0);if(D(i))i.addIn(n,e);else if(i===void 0&&this.schema)this.set(s,yt(this.schema,n,e));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}deleteIn(t){let[e,...s]=t;if(s.length===0)return this.delete(e);let n=this.get(e,!0);if(D(n))return n.deleteIn(s);throw new Error(`Expected YAML collection at ${e}. Remaining path: ${s}`)}getIn(t,e){let[s,...n]=t,i=this.get(s,!0);return n.length===0?!e&&P(i)?i.value:i:D(i)?i.getIn(n,e):void 0}hasAllNullValues(t){return this.items.every(e=>{if(!A(e))return!1;let s=e.value;return s==null||t&&P(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(t){let[e,...s]=t;if(s.length===0)return this.has(e);let n=this.get(e,!0);return D(n)?n.hasIn(s):!1}setIn(t,e){let[s,...n]=t;if(n.length===0)this.set(s,e);else{let i=this.get(s,!0);if(D(i))i.setIn(n,e);else if(i===void 0&&this.schema)this.set(s,yt(this.schema,n,e));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}}}});function G(r,t){return/^\n+$/.test(r)?r.substring(1):t?r.replace(/^(?! *$)/gm,t):r}var Lr,pe,bt=k(()=>{Lr=r=>r.replace(/^(?!$)(?: $)?/gm,"#");pe=(r,t,e)=>r.endsWith(`
`)?G(e,t):e.includes(`
`)?`
`+G(e,t):(r.endsWith(" ")?"":" ")+e});function wt(r,t,e="flow",{indentAtStart:s,lineWidth:n=80,minContentWidth:i=20,onFold:o,onOverflow:a}={}){if(!n||n<0)return r;n<i&&(i=0);let l=Math.max(1+i,1+n-t.length);if(r.length<=l)return r;let c=[],d={},h=n-t.length;typeof s=="number"&&(s>n-Math.max(2,i)?c.push(0):h=n-s);let u,f,g=!1,p=-1,m=-1,y=-1;e===ms&&(p=Dr(r,p,t.length),p!==-1&&(h=p+l));for(let w;w=r[p+=1];){if(e===kt&&w==="\\"){switch(m=p,r[p+1]){case"x":p+=3;break;case"u":p+=5;break;case"U":p+=9;break;default:p+=1}y=p}if(w===`
`)e===ms&&(p=Dr(r,p,t.length)),h=p+t.length+l,u=void 0;else{if(w===" "&&f&&f!==" "&&f!==`
`&&f!=="	"){let S=r[p+1];S&&S!==" "&&S!==`
`&&S!=="	"&&(u=p)}if(p>=h)if(u)c.push(u),h=u+l,u=void 0;else if(e===kt){for(;f===" "||f==="	";)f=w,w=r[p+=1],g=!0;let S=p>y+1?p-2:m-1;if(d[S])return r;c.push(S),d[S]=!0,h=S+l,u=void 0}else g=!0}f=w}if(g&&a&&a(),c.length===0)return r;o&&o();let b=r.slice(0,c[0]);for(let w=0;w<c.length;++w){let S=c[w],v=c[w+1]||r.length;S===0?b=`
${t}${r.slice(0,v)}`:(e===kt&&d[S]&&(b+=`${r[S]}\\`),b+=`
${t}${r.slice(S+1,v)}`)}return b}function Dr(r,t,e){let s=t,n=t+1,i=r[n];for(;i===" "||i==="	";)if(t<n+e)i=r[++t];else{do i=r[++t];while(i&&i!==`
`);s=t,n=t+1,i=r[n]}return s}var vn,ms,kt,Ir=k(()=>{vn="flow",ms="block",kt="quoted"});function io(r,t,e){if(!t||t<0)return!1;let s=t-e,n=r.length;if(n<=s)return!1;for(let i=0,o=0;i<n;++i)if(r[i]===`
`){if(i-o>s)return!0;if(o=i+1,n-o<=s)return!1}return!0}function vt(r,t){let e=JSON.stringify(r);if(t.options.doubleQuotedAsJSON)return e;let{implicitKey:s}=t,n=t.options.doubleQuotedMinMultiLineLength,i=t.indent||(bs(r)?"  ":""),o="",a=0;for(let l=0,c=e[l];c;c=e[++l])if(c===" "&&e[l+1]==="\\"&&e[l+2]==="n"&&(o+=e.slice(a,l)+"\\ ",l+=1,a=l,c="\\"),c==="\\")switch(e[l+1]){case"u":{o+=e.slice(a,l);let d=e.substr(l+2,4);switch(d){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:d.substr(0,2)==="00"?o+="\\x"+d.substr(2):o+=e.substr(l,6)}l+=5,a=l+1}break;case"n":if(s||e[l+2]==='"'||e.length<n)l+=1;else{for(o+=e.slice(a,l)+`

`;e[l+2]==="\\"&&e[l+3]==="n"&&e[l+4]!=='"';)o+=`
`,l+=2;o+=i,e[l+2]===" "&&(o+="\\"),l+=1,a=l+1}break;default:l+=1}return o=a?o+e.slice(a):e,s?o:wt(o,i,kt,ys(t,!1))}function Sn(r,t){if(t.options.singleQuote===!1||t.implicitKey&&r.includes(`
`)||/[ \t]\n|\n[ \t]/.test(r))return vt(r,t);let e=t.indent||(bs(r)?"  ":""),s="'"+r.replace(/'/g,"''").replace(/\n+/g,`$&
${e}`)+"'";return t.implicitKey?s:wt(s,e,vn,ys(t,!1))}function Qe(r,t){let{singleQuote:e}=t.options,s;if(e===!1)s=vt;else{let n=r.includes('"'),i=r.includes("'");n&&!i?s=Sn:i&&!n?s=vt:s=e?Sn:vt}return s(r,t)}function gs({comment:r,type:t,value:e},s,n,i){let{blockQuote:o,commentString:a,lineWidth:l}=s.options;if(!o||/\n[\t ]+$/.test(e))return Qe(e,s);let c=s.indent||(s.forceBlockIndent||bs(e)?"  ":""),d=o==="literal"?!0:o==="folded"||t===E.BLOCK_FOLDED?!1:t===E.BLOCK_LITERAL?!0:!io(e,l,c.length);if(!e)return d?`|
`:`>
`;let h,u;for(u=e.length;u>0;--u){let v=e[u-1];if(v!==`
`&&v!=="	"&&v!==" ")break}let f=e.substring(u),g=f.indexOf(`
`);g===-1?h="-":e===f||g!==f.length-1?(h="+",i&&i()):h="",f&&(e=e.slice(0,-f.length),f[f.length-1]===`
`&&(f=f.slice(0,-1)),f=f.replace(En,`$&${c}`));let p=!1,m,y=-1;for(m=0;m<e.length;++m){let v=e[m];if(v===" ")p=!0;else if(v===`
`)y=m;else break}let b=e.substring(0,y<m?y+1:m);b&&(e=e.substring(b.length),b=b.replace(/\n+/g,`$&${c}`));let S=(p?c?"2":"1":"")+h;if(r&&(S+=" "+a(r.replace(/ ?[\r\n]+/g," ")),n&&n()),!d){let v=e.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`),x=!1,B=ys(s,!0);o!=="folded"&&t!==E.BLOCK_FOLDED&&(B.onOverflow=()=>{x=!0});let C=wt(`${b}${v}${f}`,c,ms,B);if(!x)return`>${S}
${c}${C}`}return e=e.replace(/\n+/g,`$&${c}`),`|${S}
${c}${b}${e}${f}`}function oo(r,t,e,s){let{type:n,value:i}=r,{actualString:o,implicitKey:a,indent:l,indentStep:c,inFlow:d}=t;if(a&&i.includes(`
`)||d&&/[[\]{},]/.test(i))return Qe(i,t);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(i))return a||d||!i.includes(`
`)?Qe(i,t):gs(r,t,e,s);if(!a&&!d&&n!==E.PLAIN&&i.includes(`
`))return gs(r,t,e,s);if(bs(i)){if(l==="")return t.forceBlockIndent=!0,gs(r,t,e,s);if(a&&l===c)return Qe(i,t)}let h=i.replace(/\n+/g,`$&
${l}`);if(o){let u=p=>{var m;return p.default&&p.tag!=="tag:yaml.org,2002:str"&&((m=p.test)==null?void 0:m.test(h))},{compat:f,tags:g}=t.doc.schema;if(g.some(u)||f!=null&&f.some(u))return Qe(i,t)}return a?h:wt(h,l,vn,ys(t,!1))}function Ue(r,t,e,s){let{implicitKey:n,inFlow:i}=t,o=typeof r.value=="string"?r:Object.assign({},r,{value:String(r.value)}),{type:a}=r;a!==E.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(a=E.QUOTE_DOUBLE);let l=d=>{switch(d){case E.BLOCK_FOLDED:case E.BLOCK_LITERAL:return n||i?Qe(o.value,t):gs(o,t,e,s);case E.QUOTE_DOUBLE:return vt(o.value,t);case E.QUOTE_SINGLE:return Sn(o.value,t);case E.PLAIN:return oo(o,t,e,s);default:return null}},c=l(a);if(c===null){let{defaultKeyType:d,defaultStringType:h}=t.options,u=n&&d||h;if(c=l(u),c===null)throw new Error(`Unsupported default string type ${u}`)}return c}var ys,bs,En,St=k(()=>{M();Ir();ys=(r,t)=>({indentAtStart:t?r.indent.length:r.indentAtStart,lineWidth:r.options.lineWidth,minContentWidth:r.options.minContentWidth}),bs=r=>/^(%|---|\.\.\.)/m.test(r);try{En=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch(r){En=/\n+(?!\n|$)/g}});function ks(r,t){let e=Object.assign({blockQuote:!0,commentString:Lr,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},r.schema.toStringOptions,t),s;switch(e.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:r,flowCollectionPadding:e.flowCollectionPadding?" ":"",indent:"",indentStep:typeof e.indent=="number"?" ".repeat(e.indent):"  ",inFlow:s,options:e}}function ao(r,t){var n,i,o,a;if(t.tag){let l=r.filter(c=>c.tag===t.tag);if(l.length>0)return(n=l.find(c=>c.format===t.format))!=null?n:l[0]}let e,s;if(P(t)){s=t.value;let l=r.filter(c=>{var d;return(d=c.identify)==null?void 0:d.call(c,s)});if(l.length>1){let c=l.filter(d=>d.test);c.length>0&&(l=c)}e=(i=l.find(c=>c.format===t.format))!=null?i:l.find(c=>!c.format)}else s=t,e=r.find(l=>l.nodeClass&&s instanceof l.nodeClass);if(!e){let l=(a=(o=s==null?void 0:s.constructor)==null?void 0:o.name)!=null?a:s===null?"null":typeof s;throw new Error(`Tag not resolved for ${l} value`)}return e}function lo(r,t,{anchors:e,doc:s}){var a;if(!s.directives)return"";let n=[],i=(P(r)||D(r))&&r.anchor;i&&cs(i)&&(e.add(i),n.push(`&${i}`));let o=(a=r.tag)!=null?a:t.default?null:t.tag;return o&&n.push(s.directives.tagString(o)),n.join(" ")}function Ee(r,t,e,s){var l,c;if(A(r))return r.toString(t,e,s);if(J(r)){if(t.doc.directives)return r.toString(t);if((l=t.resolvedAliases)!=null&&l.has(r))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(r):t.resolvedAliases=new Set([r]),r=r.resolve(t.doc)}let n,i=N(r)?r:t.doc.createNode(r,{onTagObj:d=>n=d});n!=null||(n=ao(t.doc.schema.tags,i));let o=lo(i,n,t);o.length>0&&(t.indentAtStart=((c=t.indentAtStart)!=null?c:0)+o.length+1);let a=typeof n.stringify=="function"?n.stringify(i,t,e,s):P(i)?Ue(i,t,e,s):i.toString(t,e,s);return o?P(i)||a[0]==="{"||a[0]==="["?`${o} ${a}`:`${o}
${t.indent}${a}`:a}var Et=k(()=>{ds();L();bt();St()});function Or({key:r,value:t},e,s,n){var B,C;let{allNullValues:i,doc:o,indent:a,indentStep:l,options:{commentString:c,indentSeq:d,simpleKeys:h}}=e,u=N(r)&&r.comment||null;if(h){if(u)throw new Error("With simple keys, key nodes cannot have comments");if(D(r)||!N(r)&&typeof r=="object"){let T="With simple keys, collection cannot be used as a key value";throw new Error(T)}}let f=!h&&(!r||u&&t==null&&!e.inFlow||D(r)||(P(r)?r.type===E.BLOCK_FOLDED||r.type===E.BLOCK_LITERAL:typeof r=="object"));e=Object.assign({},e,{allNullValues:!1,implicitKey:!f&&(h||!i),indent:a+l});let g=!1,p=!1,m=Ee(r,e,()=>g=!0,()=>p=!0);if(!f&&!e.inFlow&&m.length>1024){if(h)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");f=!0}if(e.inFlow){if(i||t==null)return g&&s&&s(),m===""?"?":f?`? ${m}`:m}else if(i&&!h||t==null&&f)return m=`? ${m}`,u&&!g?m+=pe(m,e.indent,c(u)):p&&n&&n(),m;g&&(u=null),f?(u&&(m+=pe(m,e.indent,c(u))),m=`? ${m}
${a}:`):(m=`${m}:`,u&&(m+=pe(m,e.indent,c(u))));let y,b,w;N(t)?(y=!!t.spaceBefore,b=t.commentBefore,w=t.comment):(y=!1,b=null,w=null,t&&typeof t=="object"&&(t=o.createNode(t))),e.implicitKey=!1,!f&&!u&&P(t)&&(e.indentAtStart=m.length+1),p=!1,!d&&l.length>=2&&!e.inFlow&&!f&&ne(t)&&!t.flow&&!t.tag&&!t.anchor&&(e.indent=e.indent.substring(2));let S=!1,v=Ee(t,e,()=>S=!0,()=>p=!0),x=" ";if(u||y||b){if(x=y?`
`:"",b){let T=c(b);x+=`
${G(T,e.indent)}`}v===""&&!e.inFlow?x===`
`&&w&&(x=`

`):x+=`
${e.indent}`}else if(!f&&D(t)){let T=v[0],_=v.indexOf(`
`),I=_!==-1,q=(C=(B=e.inFlow)!=null?B:t.flow)!=null?C:t.items.length===0;if(I||!q){let Q=!1;if(I&&(T==="&"||T==="!")){let X=v.indexOf(" ");T==="&"&&X!==-1&&X<_&&v[X+1]==="!"&&(X=v.indexOf(" ",X+1)),(X===-1||_<X)&&(Q=!0)}Q||(x=`
${e.indent}`)}}else(v===""||v[0]===`
`)&&(x="");return m+=x+v,e.inFlow?S&&s&&s():w&&!S?m+=pe(m,e.indent,c(w)):p&&n&&n(),m}var Fr=k(()=>{L();M();Et();bt()});function ws(r,t){(r==="debug"||r==="warn")&&console.warn(t)}var Cn=k(()=>{});function Pn(r,t,e){if(e=r&&J(e)?e.resolve(r.doc):e,ne(e))for(let s of e.items)xn(r,t,s);else if(Array.isArray(e))for(let s of e)xn(r,t,s);else xn(r,t,e)}function xn(r,t,e){let s=r&&J(e)?e.resolve(r.doc):e;if(!se(s))throw new Error("Merge sources must be maps or map aliases");let n=s.toJSON(null,r,Map);for(let[i,o]of n)t instanceof Map?t.has(i)||t.set(i,o):t instanceof Set?t.add(i):Object.prototype.hasOwnProperty.call(t,i)||Object.defineProperty(t,i,{value:o,writable:!0,enumerable:!0,configurable:!0});return t}var vs,re,$r,Ss=k(()=>{L();M();vs="<<",re={identify:r=>r===vs||typeof r=="symbol"&&r.description===vs,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new E(Symbol(vs)),{addToJSMap:Pn}),stringify:()=>vs},$r=(r,t)=>(re.identify(t)||P(t)&&(!t.type||t.type===E.PLAIN)&&re.identify(t.value))&&(r==null?void 0:r.doc.schema.tags.some(e=>e.tag===re.tag&&e.default))});function Es(r,t,{key:e,value:s}){if(N(e)&&e.addToJSMap)e.addToJSMap(r,t,s);else if($r(r,e))Pn(r,t,s);else{let n=R(e,"",r);if(t instanceof Map)t.set(n,R(s,n,r));else if(t instanceof Set)t.add(n);else{let i=co(e,n,r),o=R(s,i,r);i in t?Object.defineProperty(t,i,{value:o,writable:!0,enumerable:!0,configurable:!0}):t[i]=o}}return t}function co(r,t,e){if(t===null)return"";if(typeof t!="object")return String(t);if(N(r)&&(e!=null&&e.doc)){let s=ks(e.doc,{});s.anchors=new Set;for(let i of e.anchors.keys())s.anchors.add(i.anchor);s.inFlow=!0,s.inStringifyKey=!0;let n=r.toString(s);if(!e.mapKeyWarned){let i=JSON.stringify(n);i.length>40&&(i=i.substring(0,36)+'..."'),ws(e.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${i}. Set mapAsMap: true to use object keys.`),e.mapKeyWarned=!0}return n}return JSON.stringify(t)}var Tn=k(()=>{Cn();Ss();Et();L();Be()});function Xe(r,t,e){let s=Se(r,void 0,e),n=Se(t,void 0,e);return new O(s,n)}var O,Ne=k(()=>{gt();Fr();Tn();L();O=class r{constructor(t,e=null){Object.defineProperty(this,V,{value:gn}),this.key=t,this.value=e}clone(t){let{key:e,value:s}=this;return N(e)&&(e=e.clone(t)),N(s)&&(s=s.clone(t)),new r(e,s)}toJSON(t,e){let s=e!=null&&e.mapAsMap?new Map:{};return Es(e,s,this)}toString(t,e,s){return t!=null&&t.doc?Or(this,t,e,s):JSON.stringify(this)}}});function xs(r,t,e){var i;return(((i=t.inFlow)!=null?i:r.flow)?uo:fo)(r,t,e)}function fo({comment:r,items:t},e,{blockItemPrefix:s,flowChars:n,itemIndent:i,onChompKeep:o,onComment:a}){let{indent:l,options:{commentString:c}}=e,d=Object.assign({},e,{indent:i,type:null}),h=!1,u=[];for(let g=0;g<t.length;++g){let p=t[g],m=null;if(N(p))!h&&p.spaceBefore&&u.push(""),Cs(e,u,p.commentBefore,h),p.comment&&(m=p.comment);else if(A(p)){let b=N(p.key)?p.key:null;b&&(!h&&b.spaceBefore&&u.push(""),Cs(e,u,b.commentBefore,h))}h=!1;let y=Ee(p,d,()=>m=null,()=>h=!0);m&&(y+=pe(y,i,c(m))),h&&m&&(h=!1),u.push(s+y)}let f;if(u.length===0)f=n.start+n.end;else{f=u[0];for(let g=1;g<u.length;++g){let p=u[g];f+=p?`
${l}${p}`:`
`}}return r?(f+=`
`+G(c(r),l),a&&a()):h&&o&&o(),f}function uo({items:r},t,{flowChars:e,itemIndent:s}){let{indent:n,indentStep:i,flowCollectionPadding:o,options:{commentString:a}}=t;s+=i;let l=Object.assign({},t,{indent:s,inFlow:!0,type:null}),c=!1,d=0,h=[];for(let g=0;g<r.length;++g){let p=r[g],m=null;if(N(p))p.spaceBefore&&h.push(""),Cs(t,h,p.commentBefore,!1),p.comment&&(m=p.comment);else if(A(p)){let b=N(p.key)?p.key:null;b&&(b.spaceBefore&&h.push(""),Cs(t,h,b.commentBefore,!1),b.comment&&(c=!0));let w=N(p.value)?p.value:null;w?(w.comment&&(m=w.comment),w.commentBefore&&(c=!0)):p.value==null&&(b!=null&&b.comment)&&(m=b.comment)}m&&(c=!0);let y=Ee(p,l,()=>m=null);g<r.length-1&&(y+=","),m&&(y+=pe(y,s,a(m))),!c&&(h.length>d||y.includes(`
`))&&(c=!0),h.push(y),d=h.length}let{start:u,end:f}=e;if(h.length===0)return u+f;if(!c){let g=h.reduce((p,m)=>p+m.length+2,2);c=t.options.lineWidth>0&&g>t.options.lineWidth}if(c){let g=u;for(let p of h)g+=p?`
${i}${n}${p}`:`
`;return`${g}
${n}${f}`}else return`${u}${o}${h.join(" ")}${o}${f}`}function Cs({indent:r,options:{commentString:t}},e,s,n){if(s&&n&&(s=s.replace(/^\n+/,"")),s){let i=G(t(s),r);e.push(i.trimStart())}}var Bn=k(()=>{L();Et();bt()});function Le(r,t){let e=P(t)?t.value:t;for(let s of r)if(A(s)&&(s.key===t||s.key===e||P(s.key)&&s.key.value===e))return s}var $,De=k(()=>{Bn();Tn();hs();L();Ne();M();$=class extends Je{static get tagName(){return"tag:yaml.org,2002:map"}constructor(t){super(ee,t),this.items=[]}static from(t,e,s){let{keepUndefined:n,replacer:i}=s,o=new this(t),a=(l,c)=>{if(typeof i=="function")c=i.call(e,l,c);else if(Array.isArray(i)&&!i.includes(l))return;(c!==void 0||n)&&o.items.push(Xe(l,c,s))};if(e instanceof Map)for(let[l,c]of e)a(l,c);else if(e&&typeof e=="object")for(let l of Object.keys(e))a(l,e[l]);return typeof t.sortMapEntries=="function"&&o.items.sort(t.sortMapEntries),o}add(t,e){var o;let s;A(t)?s=t:!t||typeof t!="object"||!("key"in t)?s=new O(t,t==null?void 0:t.value):s=new O(t.key,t.value);let n=Le(this.items,s.key),i=(o=this.schema)==null?void 0:o.sortMapEntries;if(n){if(!e)throw new Error(`Key ${s.key} already set`);P(n.value)&&ps(s.value)?n.value.value=s.value:n.value=s.value}else if(i){let a=this.items.findIndex(l=>i(s,l)<0);a===-1?this.items.push(s):this.items.splice(a,0,s)}else this.items.push(s)}delete(t){let e=Le(this.items,t);return e?this.items.splice(this.items.indexOf(e),1).length>0:!1}get(t,e){var i;let s=Le(this.items,t),n=s==null?void 0:s.value;return(i=!e&&P(n)?n.value:n)!=null?i:void 0}has(t){return!!Le(this.items,t)}set(t,e){this.add(new O(t,e),!0)}toJSON(t,e,s){let n=s?new s:e!=null&&e.mapAsMap?new Map:{};e!=null&&e.onCreate&&e.onCreate(n);for(let i of this.items)Es(e,n,i);return n}toString(t,e,s){if(!t)return JSON.stringify(this);for(let n of this.items)if(!A(n))throw new Error(`Map items must all be pairs; found ${JSON.stringify(n)} instead`);return!t.allNullValues&&this.hasAllNullValues(!1)&&(t=Object.assign({},t,{allNullValues:!0})),xs(this,t,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:t.indent||"",onChompKeep:s,onComment:e})}}});var ie,Ze=k(()=>{L();De();ie={collection:"map",default:!0,nodeClass:$,tag:"tag:yaml.org,2002:map",resolve(r,t){return se(r)||t("Expected a mapping for this tag"),r},createNode:(r,t,e)=>$.from(r,t,e)}});function Ps(r){let t=P(r)?r.value:r;return t&&typeof t=="string"&&(t=Number(t)),typeof t=="number"&&Number.isInteger(t)&&t>=0?t:null}var U,Ie=k(()=>{gt();Bn();hs();L();M();Be();U=class extends Je{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(t){super(we,t),this.items=[]}add(t){this.items.push(t)}delete(t){let e=Ps(t);return typeof e!="number"?!1:this.items.splice(e,1).length>0}get(t,e){let s=Ps(t);if(typeof s!="number")return;let n=this.items[s];return!e&&P(n)?n.value:n}has(t){let e=Ps(t);return typeof e=="number"&&e<this.items.length}set(t,e){let s=Ps(t);if(typeof s!="number")throw new Error(`Expected a valid index, not ${t}.`);let n=this.items[s];P(n)&&ps(e)?n.value=e:this.items[s]=e}toJSON(t,e){let s=[];e!=null&&e.onCreate&&e.onCreate(s);let n=0;for(let i of this.items)s.push(R(i,String(n++),e));return s}toString(t,e,s){return t?xs(this,t,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(t.indent||"")+"  ",onChompKeep:s,onComment:e}):JSON.stringify(this)}static from(t,e,s){let{replacer:n}=s,i=new this(t);if(e&&Symbol.iterator in Object(e)){let o=0;for(let a of e){if(typeof n=="function"){let l=e instanceof Set?a:String(o++);a=n.call(e,l,a)}i.items.push(Se(a,void 0,s))}}return i}}});var oe,et=k(()=>{L();Ie();oe={collection:"seq",default:!0,nodeClass:U,tag:"tag:yaml.org,2002:seq",resolve(r,t){return ne(r)||t("Expected a sequence for this tag"),r},createNode:(r,t,e)=>U.from(r,t,e)}});var Oe,Ct=k(()=>{St();Oe={identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify(r,t,e,s){return t=Object.assign({actualString:!0},t),Ue(r,t,e,s)}}});var je,Ts=k(()=>{M();je={identify:r=>r==null,createNode:()=>new E(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new E(null),stringify:({source:r},t)=>typeof r=="string"&&je.test.test(r)?r:t.options.nullStr}});var xt,An=k(()=>{M();xt={identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:r=>new E(r[0]==="t"||r[0]==="T"),stringify({source:r,value:t},e){if(r&&xt.test.test(r)){let s=r[0]==="t"||r[0]==="T";if(t===s)return r}return t?e.options.trueStr:e.options.falseStr}}});function j({format:r,minFractionDigits:t,tag:e,value:s}){if(typeof s=="bigint")return String(s);let n=typeof s=="number"?s:Number(s);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let i=Object.is(s,-0)?"-0":JSON.stringify(s);if(!r&&t&&(!e||e==="tag:yaml.org,2002:float")&&/^\d/.test(i)){let o=i.indexOf(".");o<0&&(o=i.length,i+=".");let a=t-(i.length-o-1);for(;a-- >0;)i+="0"}return i}var tt=k(()=>{});var Bs,As,Ns,Nn=k(()=>{M();tt();Bs={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:j},As={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r),stringify(r){let t=Number(r.value);return isFinite(t)?t.toExponential():j(r)}},Ns={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(r){let t=new E(parseFloat(r)),e=r.indexOf(".");return e!==-1&&r[r.length-1]==="0"&&(t.minFractionDigits=r.length-e-1),t},stringify:j}});function Mr(r,t,e){let{value:s}=r;return Ls(s)&&s>=0?e+s.toString(t):j(r)}var Ls,Ln,Ds,Is,Os,Dn=k(()=>{tt();Ls=r=>typeof r=="bigint"||Number.isInteger(r),Ln=(r,t,e,{intAsBigInt:s})=>s?BigInt(r):parseInt(r.substring(t),e);Ds={identify:r=>Ls(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(r,t,e)=>Ln(r,2,8,e),stringify:r=>Mr(r,8,"0o")},Is={identify:Ls,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(r,t,e)=>Ln(r,0,10,e),stringify:j},Os={identify:r=>Ls(r)&&r>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(r,t,e)=>Ln(r,2,16,e),stringify:r=>Mr(r,16,"0x")}});var Rr,_r=k(()=>{Ze();Ts();et();Ct();An();Nn();Dn();Rr=[ie,oe,Oe,je,xt,Ds,Is,Os,Bs,As,Ns]});function Ur(r){return typeof r=="bigint"||Number.isInteger(r)}var Fs,po,ho,jr,qr=k(()=>{M();Ze();et();Fs=({value:r})=>JSON.stringify(r),po=[{identify:r=>typeof r=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:r=>r,stringify:Fs},{identify:r=>r==null,createNode:()=>new E(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Fs},{identify:r=>typeof r=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:r=>r==="true",stringify:Fs},{identify:Ur,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(r,t,{intAsBigInt:e})=>e?BigInt(r):parseInt(r,10),stringify:({value:r})=>Ur(r)?r.toString():JSON.stringify(r)},{identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:r=>parseFloat(r),stringify:Fs}],ho={default:!0,tag:"",test:/^/,resolve(r,t){return t(`Unresolved plain scalar ${JSON.stringify(r)}`),r}},jr=[ie,oe].concat(po,ho)});var Pt,In=k(()=>{M();St();Pt={identify:r=>r instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(r,t){if(typeof atob=="function"){let e=atob(r.replace(/[\n\r]/g,"")),s=new Uint8Array(e.length);for(let n=0;n<e.length;++n)s[n]=e.charCodeAt(n);return s}else return t("This environment does not support reading binary tags; either Buffer or atob is required"),r},stringify({comment:r,type:t,value:e},s,n,i){if(!e)return"";let o=e,a;if(typeof btoa=="function"){let l="";for(let c=0;c<o.length;++c)l+=String.fromCharCode(o[c]);a=btoa(l)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(t!=null||(t=E.BLOCK_LITERAL),t!==E.QUOTE_DOUBLE){let l=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),c=Math.ceil(a.length/l),d=new Array(c);for(let h=0,u=0;h<c;++h,u+=l)d[h]=a.substr(u,l);a=d.join(t===E.BLOCK_LITERAL?`
`:" ")}return Ue({comment:r,type:t,value:a},s,n,i)}}});function On(r,t){var e;if(ne(r))for(let s=0;s<r.items.length;++s){let n=r.items[s];if(!A(n)){if(se(n)){n.items.length>1&&t("Each pair must have its own sequence indicator");let i=n.items[0]||new O(new E(null));if(n.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${n.commentBefore}
${i.key.commentBefore}`:n.commentBefore),n.comment){let o=(e=i.value)!=null?e:i.key;o.comment=o.comment?`${n.comment}
${o.comment}`:n.comment}n=i}r.items[s]=A(n)?n:new O(n)}}else t("Expected a sequence for this tag");return r}function Fn(r,t,e){let{replacer:s}=e,n=new U(r);n.tag="tag:yaml.org,2002:pairs";let i=0;if(t&&Symbol.iterator in Object(t))for(let o of t){typeof s=="function"&&(o=s.call(t,String(i++),o));let a,l;if(Array.isArray(o))if(o.length===2)a=o[0],l=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){let c=Object.keys(o);if(c.length===1)a=c[0],l=o[a];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else a=o;n.items.push(Xe(a,l,e))}return n}var Tt,$s=k(()=>{L();Ne();M();Ie();Tt={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:On,createNode:Fn}});var st,Bt,$n=k(()=>{L();Be();De();Ie();$s();st=class r extends U{constructor(){super(),this.add=$.prototype.add.bind(this),this.delete=$.prototype.delete.bind(this),this.get=$.prototype.get.bind(this),this.has=$.prototype.has.bind(this),this.set=$.prototype.set.bind(this),this.tag=r.tag}toJSON(t,e){if(!e)return super.toJSON(t);let s=new Map;e!=null&&e.onCreate&&e.onCreate(s);for(let n of this.items){let i,o;if(A(n)?(i=R(n.key,"",e),o=R(n.value,i,e)):i=R(n,"",e),s.has(i))throw new Error("Ordered maps must not include duplicate keys");s.set(i,o)}return s}static from(t,e,s){let n=Fn(t,e,s),i=new this;return i.items=n.items,i}};st.tag="tag:yaml.org,2002:omap";Bt={collection:"seq",identify:r=>r instanceof Map,nodeClass:st,default:!1,tag:"tag:yaml.org,2002:omap",resolve(r,t){let e=On(r,t),s=[];for(let{key:n}of e.items)P(n)&&(s.includes(n.value)?t(`Ordered maps must not include duplicate keys: ${n.value}`):s.push(n.value));return Object.assign(new st,e)},createNode:(r,t,e)=>st.from(r,t,e)}});function Vr({value:r,source:t},e){return t&&(r?Mn:Rn).test.test(t)?t:r?e.options.trueStr:e.options.falseStr}var Mn,Rn,Kr=k(()=>{M();Mn={identify:r=>r===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new E(!0),stringify:Vr},Rn={identify:r=>r===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new E(!1),stringify:Vr}});var Hr,zr,Yr,Wr=k(()=>{M();tt();Hr={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:r=>r.slice(-3).toLowerCase()==="nan"?NaN:r[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:j},zr={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:r=>parseFloat(r.replace(/_/g,"")),stringify(r){let t=Number(r.value);return isFinite(t)?t.toExponential():j(r)}},Yr={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(r){let t=new E(parseFloat(r.replace(/_/g,""))),e=r.indexOf(".");if(e!==-1){let s=r.substring(e+1).replace(/_/g,"");s[s.length-1]==="0"&&(t.minFractionDigits=s.length)}return t},stringify:j}});function Ms(r,t,e,{intAsBigInt:s}){let n=r[0];if((n==="-"||n==="+")&&(t+=1),r=r.substring(t).replace(/_/g,""),s){switch(e){case 2:r=`0b${r}`;break;case 8:r=`0o${r}`;break;case 16:r=`0x${r}`;break}let o=BigInt(r);return n==="-"?BigInt(-1)*o:o}let i=parseInt(r,e);return n==="-"?-1*i:i}function _n(r,t,e){let{value:s}=r;if(At(s)){let n=s.toString(t);return s<0?"-"+e+n.substr(1):e+n}return j(r)}var At,Jr,Gr,Qr,Xr,Zr=k(()=>{tt();At=r=>typeof r=="bigint"||Number.isInteger(r);Jr={identify:At,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(r,t,e)=>Ms(r,2,2,e),stringify:r=>_n(r,2,"0b")},Gr={identify:At,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(r,t,e)=>Ms(r,1,8,e),stringify:r=>_n(r,8,"0")},Qr={identify:At,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(r,t,e)=>Ms(r,0,10,e),stringify:j},Xr={identify:At,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(r,t,e)=>Ms(r,2,16,e),stringify:r=>_n(r,16,"0x")}});var nt,Nt,Un=k(()=>{L();Ne();De();nt=class r extends ${constructor(t){super(t),this.tag=r.tag}add(t){let e;A(t)?e=t:t&&typeof t=="object"&&"key"in t&&"value"in t&&t.value===null?e=new O(t.key,null):e=new O(t,null),Le(this.items,e.key)||this.items.push(e)}get(t,e){let s=Le(this.items,t);return!e&&A(s)?P(s.key)?s.key.value:s.key:s}set(t,e){if(typeof e!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof e}`);let s=Le(this.items,t);s&&!e?this.items.splice(this.items.indexOf(s),1):!s&&e&&this.items.push(new O(t))}toJSON(t,e){return super.toJSON(t,e,Set)}toString(t,e,s){if(!t)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},t,{allNullValues:!0}),e,s);throw new Error("Set items must all have null values")}static from(t,e,s){let{replacer:n}=s,i=new this(t);if(e&&Symbol.iterator in Object(e))for(let o of e)typeof n=="function"&&(o=n.call(e,o,o)),i.items.push(Xe(o,null,s));return i}};nt.tag="tag:yaml.org,2002:set";Nt={collection:"map",identify:r=>r instanceof Set,nodeClass:nt,default:!1,tag:"tag:yaml.org,2002:set",createNode:(r,t,e)=>nt.from(r,t,e),resolve(r,t){if(se(r)){if(r.hasAllNullValues(!0))return Object.assign(new nt,r);t("Set items must all have null values")}else t("Expected a mapping for this tag");return r}}});function jn(r,t){let e=r[0],s=e==="-"||e==="+"?r.substring(1):r,n=o=>t?BigInt(o):Number(o),i=s.replace(/_/g,"").split(":").reduce((o,a)=>o*n(60)+n(a),n(0));return e==="-"?n(-1)*i:i}function ei(r){let{value:t}=r,e=o=>o;if(typeof t=="bigint")e=o=>BigInt(o);else if(isNaN(t)||!isFinite(t))return j(r);let s="";t<0&&(s="-",t*=e(-1));let n=e(60),i=[t%n];return t<60?i.unshift(0):(t=(t-i[0])/n,i.unshift(t%n),t>=60&&(t=(t-i[0])/n,i.unshift(t))),s+i.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}var Rs,_s,rt,qn=k(()=>{tt();Rs={identify:r=>typeof r=="bigint"||Number.isInteger(r),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(r,t,{intAsBigInt:e})=>jn(r,e),stringify:ei},_s={identify:r=>typeof r=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:r=>jn(r,!1),stringify:ei},rt={identify:r=>r instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(r){let t=r.match(rt.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,e,s,n,i,o,a]=t.map(Number),l=t[7]?Number((t[7]+"00").substr(1,3)):0,c=Date.UTC(e,s-1,n,i||0,o||0,a||0,l),d=t[8];if(d&&d!=="Z"){let h=jn(d,!1);Math.abs(h)<30&&(h*=60),c-=6e4*h}return new Date(c)},stringify:({value:r})=>{var t;return(t=r==null?void 0:r.toISOString().replace(/(T00:00:00)?\.000Z$/,""))!=null?t:""}}});var Vn,ti=k(()=>{Ze();Ts();et();Ct();In();Kr();Wr();Zr();Ss();$n();$s();Un();qn();Vn=[ie,oe,Oe,je,Mn,Rn,Jr,Gr,Qr,Xr,Hr,zr,Yr,Pt,re,Bt,Tt,Nt,Rs,_s,rt]});function Us(r,t,e){let s=si.get(t);if(s&&!r)return e&&!s.includes(re)?s.concat(re):s.slice();let n=s;if(!n)if(Array.isArray(r))n=[];else{let i=Array.from(si.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${i} or define customTags array`)}if(Array.isArray(r))for(let i of r)n=n.concat(i);else typeof r=="function"&&(n=r(n.slice()));return e&&(n=n.concat(re)),n.reduce((i,o)=>{let a=typeof o=="string"?ni[o]:o;if(!a){let l=JSON.stringify(o),c=Object.keys(ni).map(d=>JSON.stringify(d)).join(", ");throw new Error(`Unknown custom tag ${l}; use one of ${c}`)}return i.includes(a)||i.push(a),i},[])}var si,ni,ri,ii=k(()=>{Ze();Ts();et();Ct();An();Nn();Dn();_r();qr();In();Ss();$n();$s();ti();Un();qn();si=new Map([["core",Rr],["failsafe",[ie,oe,Oe]],["json",jr],["yaml11",Vn],["yaml-1.1",Vn]]),ni={binary:Pt,bool:xt,float:Ns,floatExp:As,floatNaN:Bs,floatTime:_s,int:Is,intHex:Os,intOct:Ds,intTime:Rs,map:ie,merge:re,null:je,omap:Bt,pairs:Tt,seq:oe,set:Nt,timestamp:rt},ri={"tag:yaml.org,2002:binary":Pt,"tag:yaml.org,2002:merge":re,"tag:yaml.org,2002:omap":Bt,"tag:yaml.org,2002:pairs":Tt,"tag:yaml.org,2002:set":Nt,"tag:yaml.org,2002:timestamp":rt}});var mo,Lt,Kn=k(()=>{L();Ze();et();Ct();ii();mo=(r,t)=>r.key<t.key?-1:r.key>t.key?1:0,Lt=class r{constructor({compat:t,customTags:e,merge:s,resolveKnownTags:n,schema:i,sortMapEntries:o,toStringDefaults:a}){this.compat=Array.isArray(t)?Us(t,"compat"):t?Us(null,t):null,this.name=typeof i=="string"&&i||"core",this.knownTags=n?ri:{},this.tags=Us(e,this.name,s),this.toStringOptions=a!=null?a:null,Object.defineProperty(this,ee,{value:ie}),Object.defineProperty(this,W,{value:Oe}),Object.defineProperty(this,we,{value:oe}),this.sortMapEntries=typeof o=="function"?o:o===!0?mo:null}clone(){let t=Object.create(r.prototype,Object.getOwnPropertyDescriptors(this));return t.tags=this.tags.slice(),t}}});function oi(r,t){var l;let e=[],s=t.directives===!0;if(t.directives!==!1&&r.directives){let c=r.directives.toString(r);c?(e.push(c),s=!0):r.directives.docStart&&(s=!0)}s&&e.push("---");let n=ks(r,t),{commentString:i}=n.options;if(r.commentBefore){e.length!==1&&e.unshift("");let c=i(r.commentBefore);e.unshift(G(c,""))}let o=!1,a=null;if(r.contents){if(N(r.contents)){if(r.contents.spaceBefore&&s&&e.push(""),r.contents.commentBefore){let h=i(r.contents.commentBefore);e.push(G(h,""))}n.forceBlockIndent=!!r.comment,a=r.contents.comment}let c=a?void 0:()=>o=!0,d=Ee(r.contents,n,()=>a=null,c);a&&(d+=pe(d,"",i(a))),(d[0]==="|"||d[0]===">")&&e[e.length-1]==="---"?e[e.length-1]=`--- ${d}`:e.push(d)}else e.push(Ee(r.contents,n));if((l=r.directives)!=null&&l.docEnd)if(r.comment){let c=i(r.comment);c.includes(`
`)?(e.push("..."),e.push(G(c,""))):e.push(`... ${c}`)}else e.push("...");else{let c=r.comment;c&&o&&(c=c.replace(/^\n+/,"")),c&&((!o||a)&&e[e.length-1]!==""&&e.push(""),e.push(G(i(c),"")))}return e.join(`
`)+`
`}var ai=k(()=>{L();Et();bt()});function it(r){if(D(r))return!0;throw new Error("Expected a YAML collection as document contents")}var Ce,Dt=k(()=>{mt();hs();L();Ne();Be();Kn();ai();ds();wn();gt();yn();Ce=class r{constructor(t,e,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,V,{value:os});let n=null;typeof e=="function"||Array.isArray(e)?n=e:s===void 0&&e&&(s=e,e=void 0);let i=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},s);this.options=i;let{version:o}=i;s!=null&&s._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new ue({version:o}),this.setSchema(o,s),this.contents=t===void 0?null:this.createNode(t,n,s)}clone(){let t=Object.create(r.prototype,{[V]:{value:os}});return t.commentBefore=this.commentBefore,t.comment=this.comment,t.errors=this.errors.slice(),t.warnings=this.warnings.slice(),t.options=Object.assign({},this.options),this.directives&&(t.directives=this.directives.clone()),t.schema=this.schema.clone(),t.contents=N(this.contents)?this.contents.clone(t.schema):this.contents,this.range&&(t.range=this.range.slice()),t}add(t){it(this.contents)&&this.contents.add(t)}addIn(t,e){it(this.contents)&&this.contents.addIn(t,e)}createAlias(t,e){if(!t.anchor){let s=bn(this);t.anchor=!e||s.has(e)?kn(e||"a",s):e}return new ve(t.anchor)}createNode(t,e,s){let n;if(typeof e=="function")t=e.call({"":t},"",t),n=e;else if(Array.isArray(e)){let m=b=>typeof b=="number"||b instanceof String||b instanceof Number,y=e.filter(m).map(String);y.length>0&&(e=e.concat(y)),n=e}else s===void 0&&e&&(s=e,e=void 0);let{aliasDuplicateObjects:i,anchorPrefix:o,flow:a,keepUndefined:l,onTagObj:c,tag:d}=s!=null?s:{},{onAnchor:h,setAnchors:u,sourceObjects:f}=Nr(this,o||"a"),g={aliasDuplicateObjects:i!=null?i:!0,keepUndefined:l!=null?l:!1,onAnchor:h,onTagObj:c,replacer:n,schema:this.schema,sourceObjects:f},p=Se(t,d,g);return a&&D(p)&&(p.flow=!0),u(),p}createPair(t,e,s={}){let n=this.createNode(t,null,s),i=this.createNode(e,null,s);return new O(n,i)}delete(t){return it(this.contents)?this.contents.delete(t):!1}deleteIn(t){return Ge(t)?this.contents==null?!1:(this.contents=null,!0):it(this.contents)?this.contents.deleteIn(t):!1}get(t,e){return D(this.contents)?this.contents.get(t,e):void 0}getIn(t,e){return Ge(t)?!e&&P(this.contents)?this.contents.value:this.contents:D(this.contents)?this.contents.getIn(t,e):void 0}has(t){return D(this.contents)?this.contents.has(t):!1}hasIn(t){return Ge(t)?this.contents!==void 0:D(this.contents)?this.contents.hasIn(t):!1}set(t,e){this.contents==null?this.contents=yt(this.schema,[t],e):it(this.contents)&&this.contents.set(t,e)}setIn(t,e){Ge(t)?this.contents=e:this.contents==null?this.contents=yt(this.schema,Array.from(t),e):it(this.contents)&&this.contents.setIn(t,e)}setSchema(t,e={}){typeof t=="number"&&(t=String(t));let s;switch(t){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new ue({version:"1.1"}),s={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=t:this.directives=new ue({version:t}),s={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{let n=JSON.stringify(t);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${n}`)}}if(e.schema instanceof Object)this.schema=e.schema;else if(s)this.schema=new Lt(Object.assign(s,e));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:t,jsonArg:e,mapAsMap:s,maxAliasCount:n,onAnchor:i,reviver:o}={}){let a={anchors:new Map,doc:this,keep:!t,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},l=R(this.contents,e!=null?e:"",a);if(typeof i=="function")for(let{count:c,res:d}of a.anchors.values())i(d,c);return typeof o=="function"?Te(o,{"":l},"",l):l}toJSON(t,e){return this.toJS({json:!0,jsonArg:t,mapAsMap:!1,onAnchor:e})}toString(t={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in t&&(!Number.isInteger(t.indent)||Number(t.indent)<=0)){let e=JSON.stringify(t.indent);throw new Error(`"indent" option must be a positive integer, not ${e}`)}return oi(this,t)}}});var It,ae,Ot,Hn,Ft=k(()=>{It=class extends Error{constructor(t,e,s,n){super(),this.name=t,this.code=s,this.message=n,this.pos=e}},ae=class extends It{constructor(t,e,s){super("YAMLParseError",t,e,s)}},Ot=class extends It{constructor(t,e,s){super("YAMLWarning",t,e,s)}},Hn=(r,t)=>e=>{if(e.pos[0]===-1)return;e.linePos=e.pos.map(a=>t.linePos(a));let{line:s,col:n}=e.linePos[0];e.message+=` at line ${s}, column ${n}`;let i=n-1,o=r.substring(t.lineStarts[s-1],t.lineStarts[s]).replace(/[\n\r]+$/,"");if(i>=60&&o.length>80){let a=Math.min(i-39,o.length-79);o="\u2026"+o.substring(a),i-=a-1}if(o.length>80&&(o=o.substring(0,79)+"\u2026"),s>1&&/^ *$/.test(o.substring(0,i))){let a=r.substring(t.lineStarts[s-2],t.lineStarts[s-1]);a.length>80&&(a=a.substring(0,79)+`\u2026
`),o=a+o}if(/[^ ]/.test(o)){let a=1,l=e.linePos[1];(l==null?void 0:l.line)===s&&l.col>n&&(a=Math.max(1,Math.min(l.col-n,80-i)));let c=" ".repeat(i)+"^".repeat(a);e.message+=`:

${o}
${c}
`}}});function he(r,{flow:t,indicator:e,next:s,offset:n,onError:i,parentIndent:o,startOnNewline:a}){let l=!1,c=a,d=a,h="",u="",f=!1,g=!1,p=null,m=null,y=null,b=null,w=null,S=null,v=null;for(let C of r)switch(g&&(C.type!=="space"&&C.type!=="newline"&&C.type!=="comma"&&i(C.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g=!1),p&&(c&&C.type!=="comment"&&C.type!=="newline"&&i(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),p=null),C.type){case"space":!t&&(e!=="doc-start"||(s==null?void 0:s.type)!=="flow-collection")&&C.source.includes("	")&&(p=C),d=!0;break;case"comment":{d||i(C,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let T=C.source.substring(1)||" ";h?h+=u+T:h=T,u="",c=!1;break}case"newline":c?h?h+=C.source:(!S||e!=="seq-item-ind")&&(l=!0):u+=C.source,c=!0,f=!0,(m||y)&&(b=C),d=!0;break;case"anchor":m&&i(C,"MULTIPLE_ANCHORS","A node can have at most one anchor"),C.source.endsWith(":")&&i(C.offset+C.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=C,v!=null||(v=C.offset),c=!1,d=!1,g=!0;break;case"tag":{y&&i(C,"MULTIPLE_TAGS","A node can have at most one tag"),y=C,v!=null||(v=C.offset),c=!1,d=!1,g=!0;break}case e:(m||y)&&i(C,"BAD_PROP_ORDER",`Anchors and tags must be after the ${C.source} indicator`),S&&i(C,"UNEXPECTED_TOKEN",`Unexpected ${C.source} in ${t!=null?t:"collection"}`),S=C,c=e==="seq-item-ind"||e==="explicit-key-ind",d=!1;break;case"comma":if(t){w&&i(C,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),w=C,c=!1,d=!1;break}default:i(C,"UNEXPECTED_TOKEN",`Unexpected ${C.type} token`),c=!1,d=!1}let x=r[r.length-1],B=x?x.offset+x.source.length:n;return g&&s&&s.type!=="space"&&s.type!=="newline"&&s.type!=="comma"&&(s.type!=="scalar"||s.source!=="")&&i(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p&&(c&&p.indent<=o||(s==null?void 0:s.type)==="block-map"||(s==null?void 0:s.type)==="block-seq")&&i(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:w,found:S,spaceBefore:l,comment:h,hasNewline:f,anchor:m,tag:y,newlineAfterProp:b,end:B,start:v!=null?v:B}}var $t=k(()=>{});function Fe(r){if(!r)return null;switch(r.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(r.source.includes(`
`))return!0;if(r.end){for(let t of r.end)if(t.type==="newline")return!0}return!1;case"flow-collection":for(let t of r.items){for(let e of t.start)if(e.type==="newline")return!0;if(t.sep){for(let e of t.sep)if(e.type==="newline")return!0}if(Fe(t.key)||Fe(t.value))return!0}return!1;default:return!0}}var js=k(()=>{});function Mt(r,t,e){if((t==null?void 0:t.type)==="flow-collection"){let s=t.end[0];s.indent===r&&(s.source==="]"||s.source==="}")&&Fe(t)&&e(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}var zn=k(()=>{js()});function qs(r,t,e){let{uniqueKeys:s}=r.options;if(s===!1)return!1;let n=typeof s=="function"?s:(i,o)=>i===o||P(i)&&P(o)&&i.value===o.value;return t.some(i=>n(i.key,e))}var Yn=k(()=>{L()});function ci({composeNode:r,composeEmptyNode:t},e,s,n,i){var d,h;let o=(d=i==null?void 0:i.nodeClass)!=null?d:$,a=new o(e.schema);e.atRoot&&(e.atRoot=!1);let l=s.offset,c=null;for(let u of s.items){let{start:f,key:g,sep:p,value:m}=u,y=he(f,{indicator:"explicit-key-ind",next:g!=null?g:p==null?void 0:p[0],offset:l,onError:n,parentIndent:s.indent,startOnNewline:!0}),b=!y.found;if(b){if(g&&(g.type==="block-seq"?n(l,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==s.indent&&n(l,"BAD_INDENT",li)),!y.anchor&&!y.tag&&!p){c=y.end,y.comment&&(a.comment?a.comment+=`
`+y.comment:a.comment=y.comment);continue}(y.newlineAfterProp||Fe(g))&&n(g!=null?g:f[f.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((h=y.found)==null?void 0:h.indent)!==s.indent&&n(l,"BAD_INDENT",li);e.atKey=!0;let w=y.end,S=g?r(e,g,y,n):t(e,w,f,null,y,n);e.schema.compat&&Mt(s.indent,g,n),e.atKey=!1,qs(e,a.items,S)&&n(w,"DUPLICATE_KEY","Map keys must be unique");let v=he(p!=null?p:[],{indicator:"map-value-ind",next:m,offset:S.range[2],onError:n,parentIndent:s.indent,startOnNewline:!g||g.type==="block-scalar"});if(l=v.end,v.found){b&&((m==null?void 0:m.type)==="block-map"&&!v.hasNewline&&n(l,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),e.options.strict&&y.start<v.found.offset-1024&&n(S.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let x=m?r(e,m,v,n):t(e,l,p,null,v,n);e.schema.compat&&Mt(s.indent,m,n),l=x.range[2];let B=new O(S,x);e.options.keepSourceTokens&&(B.srcToken=u),a.items.push(B)}else{b&&n(S.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),v.comment&&(S.comment?S.comment+=`
`+v.comment:S.comment=v.comment);let x=new O(S);e.options.keepSourceTokens&&(x.srcToken=u),a.items.push(x)}}return c&&c<l&&n(c,"IMPOSSIBLE","Map comment with trailing content"),a.range=[s.offset,l,c!=null?c:l],a}var li,di=k(()=>{Ne();De();$t();js();zn();Yn();li="All mapping items must start at the same column"});function fi({composeNode:r,composeEmptyNode:t},e,s,n,i){var d;let o=(d=i==null?void 0:i.nodeClass)!=null?d:U,a=new o(e.schema);e.atRoot&&(e.atRoot=!1),e.atKey&&(e.atKey=!1);let l=s.offset,c=null;for(let{start:h,value:u}of s.items){let f=he(h,{indicator:"seq-item-ind",next:u,offset:l,onError:n,parentIndent:s.indent,startOnNewline:!0});if(!f.found)if(f.anchor||f.tag||u)(u==null?void 0:u.type)==="block-seq"?n(f.end,"BAD_INDENT","All sequence items must start at the same column"):n(l,"MISSING_CHAR","Sequence item without - indicator");else{c=f.end,f.comment&&(a.comment=f.comment);continue}let g=u?r(e,u,f,n):t(e,f.end,h,null,f,n);e.schema.compat&&Mt(s.indent,u,n),l=g.range[2],a.items.push(g)}return a.range=[s.offset,l,c!=null?c:l],a}var ui=k(()=>{Ie();$t();zn()});function me(r,t,e,s){let n="";if(r){let i=!1,o="";for(let a of r){let{source:l,type:c}=a;switch(c){case"space":i=!0;break;case"comment":{e&&!i&&s(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let d=l.substring(1)||" ";n?n+=o+d:n=d,o="";break}case"newline":n&&(o+=l),i=!0;break;default:s(a,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}t+=l.length}}return{comment:n,offset:t}}var ot=k(()=>{});function pi({composeNode:r,composeEmptyNode:t},e,s,n,i){var m,y,b;let o=s.start.source==="{",a=o?"flow map":"flow sequence",l=(m=i==null?void 0:i.nodeClass)!=null?m:o?$:U,c=new l(e.schema);c.flow=!0;let d=e.atRoot;d&&(e.atRoot=!1),e.atKey&&(e.atKey=!1);let h=s.offset+s.start.source.length;for(let w=0;w<s.items.length;++w){let S=s.items[w],{start:v,key:x,sep:B,value:C}=S,T=he(v,{flow:a,indicator:"explicit-key-ind",next:x!=null?x:B==null?void 0:B[0],offset:h,onError:n,parentIndent:s.indent,startOnNewline:!1});if(!T.found){if(!T.anchor&&!T.tag&&!B&&!C){w===0&&T.comma?n(T.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):w<s.items.length-1&&n(T.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),T.comment&&(c.comment?c.comment+=`
`+T.comment:c.comment=T.comment),h=T.end;continue}!o&&e.options.strict&&Fe(x)&&n(x,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(w===0)T.comma&&n(T.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(T.comma||n(T.start,"MISSING_CHAR",`Missing , between ${a} items`),T.comment){let _="";e:for(let I of v)switch(I.type){case"comma":case"space":break;case"comment":_=I.source.substring(1);break e;default:break e}if(_){let I=c.items[c.items.length-1];A(I)&&(I=(y=I.value)!=null?y:I.key),I.comment?I.comment+=`
`+_:I.comment=_,T.comment=T.comment.substring(_.length+1)}}if(!o&&!B&&!T.found){let _=C?r(e,C,T,n):t(e,T.end,B,null,T,n);c.items.push(_),h=_.range[2],Jn(C)&&n(_.range,"BLOCK_IN_FLOW",Wn)}else{e.atKey=!0;let _=T.end,I=x?r(e,x,T,n):t(e,_,v,null,T,n);Jn(x)&&n(I.range,"BLOCK_IN_FLOW",Wn),e.atKey=!1;let q=he(B!=null?B:[],{flow:a,indicator:"map-value-ind",next:C,offset:I.range[2],onError:n,parentIndent:s.indent,startOnNewline:!1});if(q.found){if(!o&&!T.found&&e.options.strict){if(B)for(let Z of B){if(Z===q.found)break;if(Z.type==="newline"){n(Z,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}T.start<q.found.offset-1024&&n(q.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else C&&("source"in C&&((b=C.source)==null?void 0:b[0])===":"?n(C,"MISSING_CHAR",`Missing space after : in ${a}`):n(q.start,"MISSING_CHAR",`Missing , or : between ${a} items`));let Q=C?r(e,C,q,n):q.found?t(e,q.end,B,null,q,n):null;Q?Jn(C)&&n(Q.range,"BLOCK_IN_FLOW",Wn):q.comment&&(I.comment?I.comment+=`
`+q.comment:I.comment=q.comment);let X=new O(I,Q);if(e.options.keepSourceTokens&&(X.srcToken=S),o){let Z=c;qs(e,Z.items,I)&&n(_,"DUPLICATE_KEY","Map keys must be unique"),Z.items.push(X)}else{let Z=new $(e.schema);Z.flow=!0,Z.items.push(X);let kr=(Q!=null?Q:I).range;Z.range=[I.range[0],kr[1],kr[2]],c.items.push(Z)}h=Q?Q.range[2]:q.end}}let u=o?"}":"]",[f,...g]=s.end,p=h;if((f==null?void 0:f.source)===u)p=f.offset+f.source.length;else{let w=a[0].toUpperCase()+a.substring(1),S=d?`${w} must end with a ${u}`:`${w} in block collection must be sufficiently indented and end with a ${u}`;n(h,d?"MISSING_CHAR":"BAD_INDENT",S),f&&f.source.length!==1&&g.unshift(f)}if(g.length>0){let w=me(g,p,e.options.strict,n);w.comment&&(c.comment?c.comment+=`
`+w.comment:c.comment=w.comment),c.range=[s.offset,p,w.offset]}else c.range=[s.offset,p,p];return c}var Wn,Jn,hi=k(()=>{L();Ne();De();Ie();ot();$t();js();Yn();Wn="Block collections are not allowed within flow collections",Jn=r=>r&&(r.type==="block-map"||r.type==="block-seq")});function Gn(r,t,e,s,n,i){let o=e.type==="block-map"?ci(r,t,e,s,i):e.type==="block-seq"?fi(r,t,e,s,i):pi(r,t,e,s,i),a=o.constructor;return n==="!"||n===a.tagName?(o.tag=a.tagName,o):(n&&(o.tag=n),o)}function mi(r,t,e,s,n){var u,f,g;let i=s.tag,o=i?t.directives.tagName(i.source,p=>n(i,"TAG_RESOLVE_FAILED",p)):null;if(e.type==="block-seq"){let{anchor:p,newlineAfterProp:m}=s,y=p&&i?p.offset>i.offset?p:i:p!=null?p:i;y&&(!m||m.offset<y.offset)&&n(y,"MISSING_CHAR","Missing newline after block sequence props")}let a=e.type==="block-map"?"map":e.type==="block-seq"?"seq":e.start.source==="{"?"map":"seq";if(!i||!o||o==="!"||o===$.tagName&&a==="map"||o===U.tagName&&a==="seq")return Gn(r,t,e,n,o);let l=t.schema.tags.find(p=>p.tag===o&&p.collection===a);if(!l){let p=t.schema.knownTags[o];if((p==null?void 0:p.collection)===a)t.schema.tags.push(Object.assign({},p,{default:!1})),l=p;else return p?n(i,"BAD_COLLECTION_TYPE",`${p.tag} used for ${a} collection, but expects ${(u=p.collection)!=null?u:"scalar"}`,!0):n(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),Gn(r,t,e,n,o)}let c=Gn(r,t,e,n,o,l),d=(g=(f=l.resolve)==null?void 0:f.call(l,c,p=>n(i,"TAG_RESOLVE_FAILED",p),t.options))!=null?g:c,h=N(d)?d:new E(d);return h.range=c.range,h.tag=o,l!=null&&l.format&&(h.format=l.format),h}var gi=k(()=>{L();M();De();Ie();di();ui();hi()});function Qn(r,t,e){let s=t.offset,n=go(t,r.options.strict,e);if(!n)return{value:"",type:null,comment:"",range:[s,s,s]};let i=n.mode===">"?E.BLOCK_FOLDED:E.BLOCK_LITERAL,o=t.source?yo(t.source):[],a=o.length;for(let p=o.length-1;p>=0;--p){let m=o[p][1];if(m===""||m==="\r")a=p;else break}if(a===0){let p=n.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"",m=s+n.length;return t.source&&(m+=t.source.length),{value:p,type:i,comment:n.comment,range:[s,m,m]}}let l=t.indent+n.indent,c=t.offset+n.length,d=0;for(let p=0;p<a;++p){let[m,y]=o[p];if(y===""||y==="\r")n.indent===0&&m.length>l&&(l=m.length);else{m.length<l&&e(c+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),n.indent===0&&(l=m.length),d=p,l===0&&!r.atRoot&&e(c,"BAD_INDENT","Block scalar values in collections must be indented");break}c+=m.length+y.length+1}for(let p=o.length-1;p>=a;--p)o[p][0].length>l&&(a=p+1);let h="",u="",f=!1;for(let p=0;p<d;++p)h+=o[p][0].slice(l)+`
`;for(let p=d;p<a;++p){let[m,y]=o[p];c+=m.length+y.length+1;let b=y[y.length-1]==="\r";if(b&&(y=y.slice(0,-1)),y&&m.length<l){let S=`Block scalar lines must not be less indented than their ${n.indent?"explicit indentation indicator":"first line"}`;e(c-y.length-(b?2:1),"BAD_INDENT",S),m=""}i===E.BLOCK_LITERAL?(h+=u+m.slice(l)+y,u=`
`):m.length>l||y[0]==="	"?(u===" "?u=`
`:!f&&u===`
`&&(u=`

`),h+=u+m.slice(l)+y,u=`
`,f=!0):y===""?u===`
`?h+=`
`:u=`
`:(h+=u+y,u=" ",f=!1)}switch(n.chomp){case"-":break;case"+":for(let p=a;p<o.length;++p)h+=`
`+o[p][0].slice(l);h[h.length-1]!==`
`&&(h+=`
`);break;default:h+=`
`}let g=s+n.length+t.source.length;return{value:h,type:i,comment:n.comment,range:[s,g,g]}}function go({offset:r,props:t},e,s){if(t[0].type!=="block-scalar-header")return s(t[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:n}=t[0],i=n[0],o=0,a="",l=-1;for(let u=1;u<n.length;++u){let f=n[u];if(!a&&(f==="-"||f==="+"))a=f;else{let g=Number(f);!o&&g?o=g:l===-1&&(l=r+u)}}l!==-1&&s(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let c=!1,d="",h=n.length;for(let u=1;u<t.length;++u){let f=t[u];switch(f.type){case"space":c=!0;case"newline":h+=f.source.length;break;case"comment":e&&!c&&s(f,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),h+=f.source.length,d=f.source.substring(1);break;case"error":s(f,"UNEXPECTED_TOKEN",f.message),h+=f.source.length;break;default:{let g=`Unexpected token in block scalar header: ${f.type}`;s(f,"UNEXPECTED_TOKEN",g);let p=f.source;p&&typeof p=="string"&&(h+=p.length)}}}return{mode:i,indent:o,chomp:a,comment:d,length:h}}function yo(r){let t=r.split(/\n( *)/),e=t[0],s=e.match(/^( *)/),i=[s!=null&&s[1]?[s[1],e.slice(s[1].length)]:["",e]];for(let o=1;o<t.length;o+=2)i.push([t[o],t[o+1]]);return i}var Xn=k(()=>{M()});function Zn(r,t,e){let{offset:s,type:n,source:i,end:o}=r,a,l,c=(u,f,g)=>e(s+u,f,g);switch(n){case"scalar":a=E.PLAIN,l=bo(i,c);break;case"single-quoted-scalar":a=E.QUOTE_SINGLE,l=ko(i,c);break;case"double-quoted-scalar":a=E.QUOTE_DOUBLE,l=wo(i,c);break;default:return e(r,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[s,s+i.length,s+i.length]}}let d=s+i.length,h=me(o,d,t,e);return{value:l,type:a,comment:h.comment,range:[s,d,h.offset]}}function bo(r,t){let e="";switch(r[0]){case"	":e="a tab character";break;case",":e="flow indicator character ,";break;case"%":e="directive indicator character %";break;case"|":case">":{e=`block scalar indicator ${r[0]}`;break}case"@":case"`":{e=`reserved character ${r[0]}`;break}}return e&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${e}`),yi(r)}function ko(r,t){return(r[r.length-1]!=="'"||r.length===1)&&t(r.length,"MISSING_CHAR","Missing closing 'quote"),yi(r.slice(1,-1)).replace(/''/g,"'")}function yi(r){var l;let t,e;try{t=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),e=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch(c){t=/(.*?)[ \t]*\r?\n/sy,e=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=t.exec(r);if(!s)return r;let n=s[1],i=" ",o=t.lastIndex;for(e.lastIndex=o;s=e.exec(r);)s[1]===""?i===`
`?n+=i:i=`
`:(n+=i+s[1],i=" "),o=e.lastIndex;let a=/[ \t]*(.*)/sy;return a.lastIndex=o,s=a.exec(r),n+i+((l=s==null?void 0:s[1])!=null?l:"")}function wo(r,t){let e="";for(let s=1;s<r.length-1;++s){let n=r[s];if(!(n==="\r"&&r[s+1]===`
`))if(n===`
`){let{fold:i,offset:o}=vo(r,s);e+=i,s=o}else if(n==="\\"){let i=r[++s],o=So[i];if(o)e+=o;else if(i===`
`)for(i=r[s+1];i===" "||i==="	";)i=r[++s+1];else if(i==="\r"&&r[s+1]===`
`)for(i=r[++s+1];i===" "||i==="	";)i=r[++s+1];else if(i==="x"||i==="u"||i==="U"){let a={x:2,u:4,U:8}[i];e+=Eo(r,s+1,a,t),s+=a}else{let a=r.substr(s-1,2);t(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),e+=a}}else if(n===" "||n==="	"){let i=s,o=r[s+1];for(;o===" "||o==="	";)o=r[++s+1];o!==`
`&&!(o==="\r"&&r[s+2]===`
`)&&(e+=s>i?r.slice(i,s+1):n)}else e+=n}return(r[r.length-1]!=='"'||r.length===1)&&t(r.length,"MISSING_CHAR",'Missing closing "quote'),e}function vo(r,t){let e="",s=r[t+1];for(;(s===" "||s==="	"||s===`
`||s==="\r")&&!(s==="\r"&&r[t+2]!==`
`);)s===`
`&&(e+=`
`),t+=1,s=r[t+1];return e||(e=" "),{fold:e,offset:t}}function Eo(r,t,e,s){let n=r.substr(t,e),o=n.length===e&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(o)){let a=r.substr(t-2,e+2);return s(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),a}return String.fromCodePoint(o)}var So,er=k(()=>{M();ot();So={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"}});function tr(r,t,e,s){let{value:n,type:i,comment:o,range:a}=t.type==="block-scalar"?Qn(r,t,s):Zn(t,r.options.strict,s),l=e?r.directives.tagName(e.source,h=>s(e,"TAG_RESOLVE_FAILED",h)):null,c;r.options.stringKeys&&r.atKey?c=r.schema[W]:l?c=Co(r.schema,n,l,e,s):t.type==="scalar"?c=xo(r,n,t,s):c=r.schema[W];let d;try{let h=c.resolve(n,u=>s(e!=null?e:t,"TAG_RESOLVE_FAILED",u),r.options);d=P(h)?h:new E(h)}catch(h){let u=h instanceof Error?h.message:String(h);s(e!=null?e:t,"TAG_RESOLVE_FAILED",u),d=new E(n)}return d.range=a,d.source=n,i&&(d.type=i),l&&(d.tag=l),c.format&&(d.format=c.format),o&&(d.comment=o),d}function Co(r,t,e,s,n){var a;if(e==="!")return r[W];let i=[];for(let l of r.tags)if(!l.collection&&l.tag===e)if(l.default&&l.test)i.push(l);else return l;for(let l of i)if((a=l.test)!=null&&a.test(t))return l;let o=r.knownTags[e];return o&&!o.collection?(r.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(n(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${e}`,e!=="tag:yaml.org,2002:str"),r[W])}function xo({atKey:r,directives:t,schema:e},s,n,i){var a;let o=e.tags.find(l=>{var c;return(l.default===!0||r&&l.default==="key")&&((c=l.test)==null?void 0:c.test(s))})||e[W];if(e.compat){let l=(a=e.compat.find(c=>{var d;return c.default&&((d=c.test)==null?void 0:d.test(s))}))!=null?a:e[W];if(o.tag!==l.tag){let c=t.tagString(o.tag),d=t.tagString(l.tag),h=`Value may be parsed as either ${c} or ${d}`;i(n,"TAG_RESOLVE_FAILED",h,!0)}}return o}var bi=k(()=>{L();M();Xn();er()});function ki(r,t,e){if(t){e!=null||(e=t.length);for(let s=e-1;s>=0;--s){let n=t[s];switch(n.type){case"space":case"comment":case"newline":r-=n.source.length;continue}for(n=t[++s];(n==null?void 0:n.type)==="space";)r+=n.source.length,n=t[++s];break}}return r}var wi=k(()=>{});function sr(r,t,e,s){let n=r.atKey,{spaceBefore:i,comment:o,anchor:a,tag:l}=e,c,d=!0;switch(t.type){case"alias":c=To(r,t,s),(a||l)&&s(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=tr(r,t,l,s),a&&(c.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":c=mi(Po,r,t,e,s),a&&(c.anchor=a.source.substring(1));break;default:{let h=t.type==="error"?t.message:`Unsupported token (type: ${t.type})`;s(t,"UNEXPECTED_TOKEN",h),c=Vs(r,t.offset,void 0,null,e,s),d=!1}}return a&&c.anchor===""&&s(a,"BAD_ALIAS","Anchor cannot be an empty string"),n&&r.options.stringKeys&&(!P(c)||typeof c.value!="string"||c.tag&&c.tag!=="tag:yaml.org,2002:str")&&s(l!=null?l:t,"NON_STRING_KEY","With stringKeys, all keys must be strings"),i&&(c.spaceBefore=!0),o&&(t.type==="scalar"&&t.source===""?c.comment=o:c.commentBefore=o),r.options.keepSourceTokens&&d&&(c.srcToken=t),c}function Vs(r,t,e,s,{spaceBefore:n,comment:i,anchor:o,tag:a,end:l},c){let d={type:"scalar",offset:ki(t,e,s),indent:-1,source:""},h=tr(r,d,a,c);return o&&(h.anchor=o.source.substring(1),h.anchor===""&&c(o,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(h.spaceBefore=!0),i&&(h.comment=i,h.range[2]=l),h}function To({options:r},{offset:t,source:e,end:s},n){let i=new ve(e.substring(1));i.source===""&&n(t,"BAD_ALIAS","Alias cannot be an empty string"),i.source.endsWith(":")&&n(t+e.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let o=t+e.length,a=me(s,o,r.strict,n);return i.range=[t,o,a.offset],a.comment&&(i.comment=a.comment),i}var Po,vi=k(()=>{mt();L();gi();bi();ot();wi();Po={composeNode:sr,composeEmptyNode:Vs}});function Si(r,t,{offset:e,start:s,value:n,end:i},o){let a=Object.assign({_directives:t},r),l=new Ce(void 0,a),c={atKey:!1,atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},d=he(s,{indicator:"doc-start",next:n!=null?n:i==null?void 0:i[0],offset:e,onError:o,parentIndent:0,startOnNewline:!0});d.found&&(l.directives.docStart=!0,n&&(n.type==="block-map"||n.type==="block-seq")&&!d.hasNewline&&o(d.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=n?sr(c,n,d,o):Vs(c,d.end,s,null,d,o);let h=l.contents.range[2],u=me(i,h,!1,o);return u.comment&&(l.comment=u.comment),l.range=[e,h,u.offset],l}var Ei=k(()=>{Dt();vi();ot();$t()});function Rt(r){if(typeof r=="number")return[r,r+1];if(Array.isArray(r))return r.length===2?r:[r[0],r[1]];let{offset:t,source:e}=r;return[t,t+(typeof e=="string"?e.length:1)]}function Ci(r){var n;let t="",e=!1,s=!1;for(let i=0;i<r.length;++i){let o=r[i];switch(o[0]){case"#":t+=(t===""?"":s?`

`:`
`)+(o.substring(1)||" "),e=!0,s=!1;break;case"%":((n=r[i+1])==null?void 0:n[0])!=="#"&&(i+=1),e=!1;break;default:e||(s=!0),e=!1}}return{comment:t,afterEmptyLine:s}}var _t,nr=k(()=>{yn();Dt();Ft();L();Ei();ot();_t=class{constructor(t={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,s,n,i)=>{let o=Rt(e);i?this.warnings.push(new Ot(o,s,n)):this.errors.push(new ae(o,s,n))},this.directives=new ue({version:t.version||"1.2"}),this.options=t}decorate(t,e){let{comment:s,afterEmptyLine:n}=Ci(this.prelude);if(s){let i=t.contents;if(e)t.comment=t.comment?`${t.comment}
${s}`:s;else if(n||t.directives.docStart||!i)t.commentBefore=s;else if(D(i)&&!i.flow&&i.items.length>0){let o=i.items[0];A(o)&&(o=o.key);let a=o.commentBefore;o.commentBefore=a?`${s}
${a}`:s}else{let o=i.commentBefore;i.commentBefore=o?`${s}
${o}`:s}}e?(Array.prototype.push.apply(t.errors,this.errors),Array.prototype.push.apply(t.warnings,this.warnings)):(t.errors=this.errors,t.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Ci(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(t,e=!1,s=-1){for(let n of t)yield*this.next(n);yield*this.end(e,s)}*next(t){switch(t.type){case"directive":this.directives.add(t.source,(e,s,n)=>{let i=Rt(t);i[0]+=e,this.onError(i,"BAD_DIRECTIVE",s,n)}),this.prelude.push(t.source),this.atDirectives=!0;break;case"document":{let e=Si(this.options,this.directives,t,this.onError);this.atDirectives&&!e.directives.docStart&&this.onError(t,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(e,!1),this.doc&&(yield this.doc),this.doc=e,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(t.source);break;case"error":{let e=t.source?`${t.message}: ${JSON.stringify(t.source)}`:t.message,s=new ae(Rt(t),"UNEXPECTED_TOKEN",e);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){let s="Unexpected doc-end without preceding document";this.errors.push(new ae(Rt(t),"UNEXPECTED_TOKEN",s));break}this.doc.directives.docEnd=!0;let e=me(t.end,t.offset+t.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),e.comment){let s=this.doc.comment;this.doc.comment=s?`${s}
${e.comment}`:e.comment}this.doc.range[2]=e.offset;break}default:this.errors.push(new ae(Rt(t),"UNEXPECTED_TOKEN",`Unsupported token ${t.type}`))}}*end(t=!1,e=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(t){let s=Object.assign({_directives:this.directives},this.options),n=new Ce(void 0,s);this.atDirectives&&this.onError(e,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,e,e],this.decorate(n,!1),yield n}}}});var xi=k(()=>{Xn();er();Ft();St()});var Pi=k(()=>{});function qe(r,t){"type"in r&&r.type==="document"&&(r={start:r.start,value:r.value}),Bi(Object.freeze([]),r,t)}function Bi(r,t,e){let s=e(t,r);if(typeof s=="symbol")return s;for(let n of["key","value"]){let i=t[n];if(i&&"items"in i){for(let o=0;o<i.items.length;++o){let a=Bi(Object.freeze(r.concat([[n,o]])),i.items[o],e);if(typeof a=="number")o=a-1;else{if(a===rr)return rr;a===Ti&&(i.items.splice(o,1),o-=1)}}typeof s=="function"&&n==="key"&&(s=s(t,r))}}return typeof s=="function"?s(t,r):s}var rr,Bo,Ti,Ai=k(()=>{rr=Symbol("break visit"),Bo=Symbol("skip children"),Ti=Symbol("remove item");qe.BREAK=rr;qe.SKIP=Bo;qe.REMOVE=Ti;qe.itemAtPath=(r,t)=>{let e=r;for(let[s,n]of t){let i=e==null?void 0:e[s];if(i&&"items"in i)e=i.items[n];else return}return e};qe.parentCollection=(r,t)=>{let e=qe.itemAtPath(r,t.slice(0,-1)),s=t[t.length-1][0],n=e==null?void 0:e[s];if(n&&"items"in n)return n;throw new Error("Parent collection not found")}});function Ni(r){switch(r){case ir:return"byte-order-mark";case or:return"doc-mode";case ar:return"flow-error-end";case Ks:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(r[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}var ir,or,ar,Ks,Hs=k(()=>{xi();Pi();Ai();ir="\uFEFF",or="",ar="",Ks=""});function le(r){switch(r){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}var Li,No,zs,Lo,lr,Ut,cr=k(()=>{Hs();Li=new Set("0123456789ABCDEFabcdef"),No=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),zs=new Set(",[]{}"),Lo=new Set(` ,[]{}
\r	`),lr=r=>!r||Lo.has(r),Ut=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(t,e=!1){var n;if(t){if(typeof t!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+t:t,this.lineEndPos=null}this.atEnd=!e;let s=(n=this.next)!=null?n:"stream";for(;s&&(e||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let t=this.pos,e=this.buffer[t];for(;e===" "||e==="	";)e=this.buffer[++t];return!e||e==="#"||e===`
`?!0:e==="\r"?this.buffer[t+1]===`
`:!1}charAt(t){return this.buffer[this.pos+t]}continueScalar(t){let e=this.buffer[t];if(this.indentNext>0){let s=0;for(;e===" ";)e=this.buffer[++s+t];if(e==="\r"){let n=this.buffer[s+t+1];if(n===`
`||!n&&!this.atEnd)return t+s+1}return e===`
`||s>=this.indentNext||!e&&!this.atEnd?t+s:-1}if(e==="-"||e==="."){let s=this.buffer.substr(t,3);if((s==="---"||s==="...")&&le(this.buffer[t+3]))return-1}return t}getLine(){let t=this.lineEndPos;return(typeof t!="number"||t!==-1&&t<this.pos)&&(t=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=t),t===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[t-1]==="\r"&&(t-=1),this.buffer.substring(this.pos,t))}hasChars(t){return this.pos+t<=this.buffer.length}setNext(t){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=t,null}peek(t){return this.buffer.substr(this.pos,t)}*parseNext(t){switch(t){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let t=this.getLine();if(t===null)return this.setNext("stream");if(t[0]===ir&&(yield*this.pushCount(1),t=t.substring(1)),t[0]==="%"){let e=t.length,s=t.indexOf("#");for(;s!==-1;){let i=t[s-1];if(i===" "||i==="	"){e=s-1;break}else s=t.indexOf("#",s+1)}for(;;){let i=t[e-1];if(i===" "||i==="	")e-=1;else break}let n=(yield*this.pushCount(e))+(yield*this.pushSpaces(!0));return yield*this.pushCount(t.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){let e=yield*this.pushSpaces(!0);return yield*this.pushCount(t.length-e),yield*this.pushNewline(),"stream"}return yield or,yield*this.parseLineStart()}*parseLineStart(){let t=this.charAt(0);if(!t&&!this.atEnd)return this.setNext("line-start");if(t==="-"||t==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let e=this.peek(3);if((e==="---"||e==="...")&&le(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,e==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!le(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[t,e]=this.peek(2);if(!e&&!this.atEnd)return this.setNext("block-start");if((t==="-"||t==="?"||t===":")&&le(e)){let s=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=s,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let t=this.getLine();if(t===null)return this.setNext("doc");let e=yield*this.pushIndicators();switch(t[e]){case"#":yield*this.pushCount(t.length-e);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(lr),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return e+=yield*this.parseBlockScalarHeader(),e+=yield*this.pushSpaces(!0),yield*this.pushCount(t.length-e),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let t,e,s=-1;do t=yield*this.pushNewline(),t>0?(e=yield*this.pushSpaces(!1),this.indentValue=s=e):e=0,e+=yield*this.pushSpaces(!0);while(t+e>0);let n=this.getLine();if(n===null)return this.setNext("flow");if((s!==-1&&s<this.indentNext&&n[0]!=="#"||s===0&&(n.startsWith("---")||n.startsWith("..."))&&le(n[3]))&&!(s===this.indentNext-1&&this.flowLevel===1&&(n[0]==="]"||n[0]==="}")))return this.flowLevel=0,yield ar,yield*this.parseLineStart();let i=0;for(;n[i]===",";)i+=yield*this.pushCount(1),i+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(i+=yield*this.pushIndicators(),n[i]){case void 0:return"flow";case"#":return yield*this.pushCount(n.length-i),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(lr),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let o=this.charAt(1);if(this.flowKey||le(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let t=this.charAt(0),e=this.buffer.indexOf(t,this.pos+1);if(t==="'")for(;e!==-1&&this.buffer[e+1]==="'";)e=this.buffer.indexOf("'",e+2);else for(;e!==-1;){let i=0;for(;this.buffer[e-1-i]==="\\";)i+=1;if(i%2===0)break;e=this.buffer.indexOf('"',e+1)}let s=this.buffer.substring(0,e),n=s.indexOf(`
`,this.pos);if(n!==-1){for(;n!==-1;){let i=this.continueScalar(n+1);if(i===-1)break;n=s.indexOf(`
`,i)}n!==-1&&(e=n-(s[n-1]==="\r"?2:1))}if(e===-1){if(!this.atEnd)return this.setNext("quoted-scalar");e=this.buffer.length}return yield*this.pushToIndex(e+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let t=this.pos;for(;;){let e=this.buffer[++t];if(e==="+")this.blockScalarKeep=!0;else if(e>"0"&&e<="9")this.blockScalarIndent=Number(e)-1;else if(e!=="-")break}return yield*this.pushUntil(e=>le(e)||e==="#")}*parseBlockScalar(){let t=this.pos-1,e=0,s;e:for(let i=this.pos;s=this.buffer[i];++i)switch(s){case" ":e+=1;break;case`
`:t=i,e=0;break;case"\r":{let o=this.buffer[i+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!s&&!this.atEnd)return this.setNext("block-scalar");if(e>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=e:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{let i=this.continueScalar(t+1);if(i===-1)break;t=this.buffer.indexOf(`
`,i)}while(t!==-1);if(t===-1){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}let n=t+1;for(s=this.buffer[n];s===" ";)s=this.buffer[++n];if(s==="	"){for(;s==="	"||s===" "||s==="\r"||s===`
`;)s=this.buffer[++n];t=n-1}else if(!this.blockScalarKeep)do{let i=t-1,o=this.buffer[i];o==="\r"&&(o=this.buffer[--i]);let a=i;for(;o===" ";)o=this.buffer[--i];if(o===`
`&&i>=this.pos&&i+1+e>a)t=i;else break}while(!0);return yield Ks,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let t=this.flowLevel>0,e=this.pos-1,s=this.pos-1,n;for(;n=this.buffer[++s];)if(n===":"){let i=this.buffer[s+1];if(le(i)||t&&zs.has(i))break;e=s}else if(le(n)){let i=this.buffer[s+1];if(n==="\r"&&(i===`
`?(s+=1,n=`
`,i=this.buffer[s+1]):e=s),i==="#"||t&&zs.has(i))break;if(n===`
`){let o=this.continueScalar(s+1);if(o===-1)break;s=Math.max(s,o-2)}}else{if(t&&zs.has(n))break;e=s}return!n&&!this.atEnd?this.setNext("plain-scalar"):(yield Ks,yield*this.pushToIndex(e+1,!0),t?"flow":"doc")}*pushCount(t){return t>0?(yield this.buffer.substr(this.pos,t),this.pos+=t,t):0}*pushToIndex(t,e){let s=this.buffer.slice(this.pos,t);return s?(yield s,this.pos+=s.length,s.length):(e&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(lr))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let t=this.flowLevel>0,e=this.charAt(1);if(le(e)||t&&zs.has(e))return t?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let t=this.pos+2,e=this.buffer[t];for(;!le(e)&&e!==">";)e=this.buffer[++t];return yield*this.pushToIndex(e===">"?t+1:t,!1)}else{let t=this.pos+1,e=this.buffer[t];for(;e;)if(No.has(e))e=this.buffer[++t];else if(e==="%"&&Li.has(this.buffer[t+1])&&Li.has(this.buffer[t+2]))e=this.buffer[t+=3];else break;return yield*this.pushToIndex(t,!1)}}*pushNewline(){let t=this.buffer[this.pos];return t===`
`?yield*this.pushCount(1):t==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(t){let e=this.pos-1,s;do s=this.buffer[++e];while(s===" "||t&&s==="	");let n=e-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=e),n}*pushUntil(t){let e=this.pos,s=this.buffer[e];for(;!t(s);)s=this.buffer[++e];return yield*this.pushToIndex(e,!1)}}});var jt,dr=k(()=>{jt=class{constructor(){this.lineStarts=[],this.addNewLine=t=>this.lineStarts.push(t),this.linePos=t=>{let e=0,s=this.lineStarts.length;for(;e<s;){let i=e+s>>1;this.lineStarts[i]<t?e=i+1:s=i}if(this.lineStarts[e]===t)return{line:e+1,col:1};if(e===0)return{line:0,col:t};let n=this.lineStarts[e-1];return{line:e,col:t-n+1}}}}});function $e(r,t){for(let e=0;e<r.length;++e)if(r[e].type===t)return!0;return!1}function Di(r){for(let t=0;t<r.length;++t)switch(r[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function Oi(r){switch(r==null?void 0:r.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Ys(r){var t;switch(r.type){case"document":return r.start;case"block-map":{let e=r.items[r.items.length-1];return(t=e.sep)!=null?t:e.start}case"block-seq":return r.items[r.items.length-1].start;default:return[]}}function at(r){var e;if(r.length===0)return[];let t=r.length;e:for(;--t>=0;)switch(r[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((e=r[++t])==null?void 0:e.type)==="space";);return r.splice(t,r.length)}function Ii(r){if(r.start.type==="flow-seq-start")for(let t of r.items)t.sep&&!t.value&&!$e(t.start,"explicit-key-ind")&&!$e(t.sep,"map-value-ind")&&(t.key&&(t.value=t.key),delete t.key,Oi(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}var qt,fr=k(()=>{Hs();cr();qt=class{constructor(t){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Ut,this.onNewLine=t}*parse(t,e=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let s of this.lexer.lex(t,e))yield*this.next(s);e||(yield*this.end())}*next(t){if(this.source=t,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=t.length;return}let e=Ni(t);if(e)if(e==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=e,yield*this.step(),e){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+t.length);break;case"space":this.atNewLine&&t[0]===" "&&(this.indent+=t.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=t.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=t.length}else{let s=`Not a YAML token: ${t}`;yield*this.pop({type:"error",offset:this.offset,message:s,source:t}),this.offset+=t.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let t=this.peek(1);if(this.type==="doc-end"&&(t==null?void 0:t.type)!=="doc-end"){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!t)return yield*this.stream();switch(t.type){case"document":return yield*this.document(t);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(t);case"block-scalar":return yield*this.blockScalar(t);case"block-map":return yield*this.blockMap(t);case"block-seq":return yield*this.blockSequence(t);case"flow-collection":return yield*this.flowCollection(t);case"doc-end":return yield*this.documentEnd(t)}yield*this.pop()}peek(t){return this.stack[this.stack.length-t]}*pop(t){let e=t!=null?t:this.stack.pop();if(!e)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield e;else{let s=this.peek(1);switch(e.type==="block-scalar"?e.indent="indent"in s?s.indent:0:e.type==="flow-collection"&&s.type==="document"&&(e.indent=0),e.type==="flow-collection"&&Ii(e),s.type){case"document":s.value=e;break;case"block-scalar":s.props.push(e);break;case"block-map":{let n=s.items[s.items.length-1];if(n.value){s.items.push({start:[],key:e,sep:[]}),this.onKeyLine=!0;return}else if(n.sep)n.value=e;else{Object.assign(n,{key:e,sep:[]}),this.onKeyLine=!n.explicitKey;return}break}case"block-seq":{let n=s.items[s.items.length-1];n.value?s.items.push({start:[],value:e}):n.value=e;break}case"flow-collection":{let n=s.items[s.items.length-1];!n||n.value?s.items.push({start:[],key:e,sep:[]}):n.sep?n.value=e:Object.assign(n,{key:e,sep:[]});return}default:yield*this.pop(),yield*this.pop(e)}if((s.type==="document"||s.type==="block-map"||s.type==="block-seq")&&(e.type==="block-map"||e.type==="block-seq")){let n=e.items[e.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&Di(n.start)===-1&&(e.indent===0||n.start.every(i=>i.type!=="comment"||i.indent<e.indent))&&(s.type==="document"?s.end=n.start:s.items.push({start:n.start}),e.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let t={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&t.start.push(this.sourceToken),this.stack.push(t);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(t){if(t.value)return yield*this.lineEnd(t);switch(this.type){case"doc-start":{Di(t.start)!==-1?(yield*this.pop(),yield*this.step()):t.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":t.start.push(this.sourceToken);return}let e=this.startBlockValue(t);e?this.stack.push(e):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(t){if(this.type==="map-value-ind"){let e=Ys(this.peek(2)),s=at(e),n;t.end?(n=t.end,n.push(this.sourceToken),delete t.end):n=[this.sourceToken];let i={type:"block-map",offset:t.offset,indent:t.indent,items:[{start:s,key:t,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=i}else yield*this.lineEnd(t)}*blockScalar(t){switch(this.type){case"space":case"comment":case"newline":t.props.push(this.sourceToken);return;case"scalar":if(t.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf(`
`)+1;for(;e!==0;)this.onNewLine(this.offset+e),e=this.source.indexOf(`
`,e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(t){var s;let e=t.items[t.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,e.value){let n="end"in e.value?e.value.end:void 0,i=Array.isArray(n)?n[n.length-1]:void 0;(i==null?void 0:i.type)==="comment"?n==null||n.push(this.sourceToken):t.items.push({start:[this.sourceToken]})}else e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"space":case"comment":if(e.value)t.items.push({start:[this.sourceToken]});else if(e.sep)e.sep.push(this.sourceToken);else{if(this.atIndentedComment(e.start,t.indent)){let n=t.items[t.items.length-2],i=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(i)){Array.prototype.push.apply(i,e.start),i.push(this.sourceToken),t.items.pop();return}}e.start.push(this.sourceToken)}return}if(this.indent>=t.indent){let n=!this.onKeyLine&&this.indent===t.indent,i=n&&(e.sep||e.explicitKey)&&this.type!=="seq-item-ind",o=[];if(i&&e.sep&&!e.value){let a=[];for(let l=0;l<e.sep.length;++l){let c=e.sep[l];switch(c.type){case"newline":a.push(l);break;case"space":break;case"comment":c.indent>t.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(o=e.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":i||e.value?(o.push(this.sourceToken),t.items.push({start:o}),this.onKeyLine=!0):e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"explicit-key-ind":!e.sep&&!e.explicitKey?(e.start.push(this.sourceToken),e.explicitKey=!0):i||e.value?(o.push(this.sourceToken),t.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(e.explicitKey)if(e.sep)if(e.value)t.items.push({start:[],key:null,sep:[this.sourceToken]});else if($e(e.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(Oi(e.key)&&!$e(e.sep,"newline")){let a=at(e.start),l=e.key,c=e.sep;c.push(this.sourceToken),delete e.key,delete e.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:l,sep:c}]})}else o.length>0?e.sep=e.sep.concat(o,this.sourceToken):e.sep.push(this.sourceToken);else if($e(e.start,"newline"))Object.assign(e,{key:null,sep:[this.sourceToken]});else{let a=at(e.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else e.sep?e.value||i?t.items.push({start:o,key:null,sep:[this.sourceToken]}):$e(e.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):e.sep.push(this.sourceToken):Object.assign(e,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let a=this.flowScalar(this.type);i||e.value?(t.items.push({start:o,key:a,sep:[]}),this.onKeyLine=!0):e.sep?this.stack.push(a):(Object.assign(e,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{let a=this.startBlockValue(t);if(a){if(a.type==="block-seq"){if(!e.explicitKey&&e.sep&&!$e(e.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else n&&t.items.push({start:o});this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(t){var s;let e=t.items[t.items.length-1];switch(this.type){case"newline":if(e.value){let n="end"in e.value?e.value.end:void 0,i=Array.isArray(n)?n[n.length-1]:void 0;(i==null?void 0:i.type)==="comment"?n==null||n.push(this.sourceToken):t.items.push({start:[this.sourceToken]})}else e.start.push(this.sourceToken);return;case"space":case"comment":if(e.value)t.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(e.start,t.indent)){let n=t.items[t.items.length-2],i=(s=n==null?void 0:n.value)==null?void 0:s.end;if(Array.isArray(i)){Array.prototype.push.apply(i,e.start),i.push(this.sourceToken),t.items.pop();return}}e.start.push(this.sourceToken)}return;case"anchor":case"tag":if(e.value||this.indent<=t.indent)break;e.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==t.indent)break;e.value||$e(e.start,"seq-item-ind")?t.items.push({start:[this.sourceToken]}):e.start.push(this.sourceToken);return}if(this.indent>t.indent){let n=this.startBlockValue(t);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(t){let e=t.items[t.items.length-1];if(this.type==="flow-error-end"){let s;do yield*this.pop(),s=this.peek(1);while((s==null?void 0:s.type)==="flow-collection")}else if(t.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!e||e.sep?t.items.push({start:[this.sourceToken]}):e.start.push(this.sourceToken);return;case"map-value-ind":!e||e.value?t.items.push({start:[],key:null,sep:[this.sourceToken]}):e.sep?e.sep.push(this.sourceToken):Object.assign(e,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!e||e.value?t.items.push({start:[this.sourceToken]}):e.sep?e.sep.push(this.sourceToken):e.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let n=this.flowScalar(this.type);!e||e.value?t.items.push({start:[],key:n,sep:[]}):e.sep?this.stack.push(n):Object.assign(e,{key:n,sep:[]});return}case"flow-map-end":case"flow-seq-end":t.end.push(this.sourceToken);return}let s=this.startBlockValue(t);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{let s=this.peek(2);if(s.type==="block-map"&&(this.type==="map-value-ind"&&s.indent===t.indent||this.type==="newline"&&!s.items[s.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&s.type!=="flow-collection"){let n=Ys(s),i=at(n);Ii(t);let o=t.end.splice(1,t.end.length);o.push(this.sourceToken);let a={type:"block-map",offset:t.offset,indent:t.indent,items:[{start:i,key:t,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(t)}}flowScalar(t){if(this.onNewLine){let e=this.source.indexOf(`
`)+1;for(;e!==0;)this.onNewLine(this.offset+e),e=this.source.indexOf(`
`,e)+1}return{type:t,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(t){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let e=Ys(t),s=at(e);return s.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;let e=Ys(t),s=at(e);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(t,e){return this.type!=="comment"||this.indent<=e?!1:t.every(s=>s.type==="newline"||s.type==="space")}*documentEnd(t){this.type!=="doc-mode"&&(t.end?t.end.push(this.sourceToken):t.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(t){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:t.end?t.end.push(this.sourceToken):t.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}});function Do(r){let t=r.prettyErrors!==!1;return{lineCounter:r.lineCounter||t&&new jt||null,prettyErrors:t}}function Fi(r,t={}){let{lineCounter:e,prettyErrors:s}=Do(t),n=new qt(e==null?void 0:e.addNewLine),i=new _t(t),o=null;for(let a of i.compose(n.parse(r),!0,r.length))if(!o)o=a;else if(o.options.logLevel!=="silent"){o.errors.push(new ae(a.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return s&&e&&(o.errors.forEach(Hn(r,e)),o.warnings.forEach(Hn(r,e))),o}function ur(r,t,e){let s;typeof t=="function"?s=t:e===void 0&&t&&typeof t=="object"&&(e=t);let n=Fi(r,e);if(!n)return null;if(n.warnings.forEach(i=>ws(n.options.logLevel,i)),n.errors.length>0){if(n.options.logLevel!=="silent")throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:s},e))}function pr(r,t,e){var n;let s=null;if(typeof t=="function"||Array.isArray(t)?s=t:e===void 0&&t&&(e=t),typeof e=="string"&&(e=e.length),typeof e=="number"){let i=Math.round(e);e=i<1?void 0:i>8?{indent:8}:{indent:i}}if(r===void 0){let{keepUndefined:i}=(n=e!=null?e:t)!=null?n:{};if(!i)return}return te(r)&&!s?r.toString(e):new Ce(r,s,e).toString(e)}var $i=k(()=>{nr();Dt();Ft();Cn();L();dr();fr()});var hr=k(()=>{nr();Dt();Kn();Ft();mt();L();Ne();M();De();Ie();Hs();cr();dr();fr();$i();ht()});var mr=k(()=>{hr();hr()});var xe,Ws=k(()=>{mr();xe=class{static create(t){let e={};for(let[s,n]of Object.entries(t))if(n!=null&&s!=="reading_history"){if(n===""){(s==="title"||s==="author"||s==="status")&&(e[s]=n);continue}if(Array.isArray(n)){if(n.length===0){s==="reading_history_summary"&&(e[s]=[]);continue}if(s==="reading_history_summary"){let i=n.filter(o=>o&&typeof o=="object"&&!Array.isArray(o));e[s]=i.length>0?i:[]}else e[s]=n}else e[s]=n}try{return`---
${pr(e,{lineWidth:0,defaultStringType:"QUOTE_DOUBLE",defaultKeyType:"PLAIN"})}---`}catch(s){return console.error("[FrontmatterCreator] Error creating YAML:",s),`---
---`}}}});var Js,Mi=k(()=>{_e();Js=class{processTemplate(t,e){let s=this.prepareTemplateData(e);return this.replacePlaceholders(t,s)}getDefaultTemplate(){return this.getDefaultTemplateContent()}prepareTemplateData(t){var e,s;return{title:t.title||"",subtitle:t.subtitle||"",author:this.formatAuthorArray(t.author||[]),category:this.formatArray(t.category||[]),publisher:t.publisher||"",publishDate:t.publishDate||"",totalPage:((e=t.totalPages)==null?void 0:e.toString())||"",isbn10:t.isbn10||"",isbn13:t.isbn13||"",coverUrl:t.coverUrl||"",page:((s=t.readPage)==null?void 0:s.toString())||"0"}}formatAuthorArray(t){return t.length===0?"":t.map(e=>`"${e}"`).join(", ")}formatArray(t){return t.length===0?"":t.map(e=>`"${e}"`).join(", ")}replacePlaceholders(t,e){let s=t;s=s.replace(/<%[\s\S]*?%>/g,""),s=s.replace(/^%%[\s\S]*?%%$/gm,""),s=s.replace(/\{\{DATE:([^}]+)\}\}/g,(n,i)=>pt(new Date,i));for(let[n,i]of Object.entries(e)){let o=new RegExp(`\\{\\{${n}\\}\\}`,"g");s=s.replace(o,i)}return s=s.replace(/\n{3,}/g,`

`),s.trim()}getDefaultTemplateContent(){return`# {{title}}

%% To use an image URL from the server, use the following syntax: %%
<%* if (tp.frontmatter.cover && tp.frontmatter.cover.trim() !== "") { tR += \`![cover|150](\${tp.frontmatter.cover})\` } %>
`}}});var Qs,Gs,Ri=k(()=>{Qs=require("obsidian");pn();hn();ss();rs();Ws();Mi();Gs=class{constructor(t){this.app=t,this.folderManager=new He(t),this.templateProcessor=new Js}async create(t,e){let s=K.getBooksFolderPath(e);await this.folderManager.ensureFolder(s);let n=ze.generate(t.title),i=(0,Qs.normalizePath)(`${s}/${n}.md`),o=this.app.vault.getAbstractFileByPath(i);if(o instanceof Qs.TFile)throw new Error(`Book note already exists: ${o.path}`);let a=ke.bookToFrontmatter(t),l=xe.create(a),c=this.templateProcessor.getDefaultTemplate(),h=this.templateProcessor.processTemplate(c,t).trim()||`# ${t.title}
`,u=`${l}
${h}`;return await this.app.vault.create(i,u)}}});var lt={};Gt(lt,{FrontmatterParser:()=>ge});var ge,Pe=k(()=>{mr();ge=class r{static parse(t){let e=/^---\s*\n([\s\S]*?)\n---\s*\n/,s=t.match(e);if(!s||!s[1])return{};let n=s[1];try{let i=ur(n);if(!i||typeof i!="object")return{};let o={};for(let[a,l]of Object.entries(i))if(a!=="reading_history"){if(a==="reading_history_summary"){o[a]=r.normalizeReadingHistorySummary(l);continue}if(l===""){a==="title"||a==="status"?o[a]=l:a==="author"&&(o[a]=[]);continue}o[a]=l}return o}catch(i){return console.error("[FrontmatterParser] Error parsing YAML:",i),{}}}static extract(t){let e=/^---\s*\n([\s\S]*?)\n---\s*\n/,s=t.match(e);if(!s)return{frontmatter:{},body:t};let n=r.parse(t),i=t.substring(s[0].length);return{frontmatter:n,body:i}}static normalizeReadingHistorySummary(t){return t==null||t===""?[]:Array.isArray(t)?t.filter(e=>e&&typeof e=="object"&&!Array.isArray(e)):[]}}});var Xs,_i=k(()=>{Xs=class{static validateAndFixBook(t){let e={...t};return e.readPage!==void 0&&e.readPage<0&&(e.readPage=0),e.totalPages!==void 0&&e.totalPages<0&&(e.totalPages=void 0),e.readPage!==void 0&&e.totalPages!==void 0&&e.readPage>e.totalPages&&(e.readPage=e.totalPages),e.status&&!["unread","reading","finished"].includes(e.status)&&(e.status="unread"),(!e.title||e.title.trim().length===0)&&(e.title="Unknown title"),e}}});var Zs,ye,Vt=k(()=>{Zs=require("obsidian");Pe();rs();_i();hn();ye=class{constructor(t){this.app=t}async read(t,e=!0){let s=await this.app.vault.read(t),{frontmatter:n}=ge.extract(s),i=ke.frontmatterToBook(n);return e?Xs.validateAndFixBook(i):i}findExisting(t,e){let s=`${ze.generate(e)}.md`,n=(0,Zs.normalizePath)(`${t}/${s}`),i=this.app.vault.getAbstractFileByPath(n);return i instanceof Zs.TFile?i:null}}});var gr={};Gt(gr,{SearchModal:()=>Ve});var en,Ve,Kt=k(()=>{en=require("obsidian");Cr();Ri();Vt();ss();Ve=class extends en.Modal{constructor(e,s){super(e);this.searchTimeout=null;this.currentResults=[];this.currentOffset=0;this.hasMoreResults=!1;this.isLoadingMore=!1;this.plugin=s,this.openLibraryClient=new Zt(this.plugin.settings.apiTimeout),this.bookFileCreator=new Gs(e),this.bookFileReader=new ye(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Search books"}),new en.Setting(e).setName("Search query").setDesc("Enter book title, author or ISBN").addText(s=>{this.searchInput=s.inputEl,this.searchInput.placeholder="Search for books...",this.searchInput.addEventListener("input",()=>{this.handleSearchInput()})}),this.loadingIndicator=e.createEl("div",{cls:"bookshelf-loading",text:"Searching..."}),this.loadingIndicator.setCssProps({display:"none"}),this.resultsContainer=e.createEl("div",{cls:"bookshelf-search-results"}),this.resultsContainer.setCssProps({"max-height":"60vh","overflow-y":"auto","margin-top":"16px"}),this.resultsContainer.addEventListener("scroll",()=>{this.handleScroll()}),this.searchInput.focus()}onClose(){let{contentEl:e}=this;e.empty(),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null)}handleSearchInput(){let e=this.searchInput.value.trim();if(this.searchTimeout&&clearTimeout(this.searchTimeout),e.length<2){this.resultsContainer.empty(),this.hideLoading(),this.hideError(),this.currentResults=[],this.currentOffset=0,this.hasMoreResults=!1;return}this.showLoading(),this.hideError(),this.currentResults=[],this.currentOffset=0,this.hasMoreResults=!1,this.searchTimeout=setTimeout(()=>{this.performSearch(e,0)},500)}async performSearch(e,s=0){try{let n=this.plugin.settings.searchResultLimit||20,i=await this.openLibraryClient.searchBooks(e,n,s);s===0?this.currentResults=i:this.currentResults=[...this.currentResults,...i],this.hasMoreResults=i.length===n,this.currentOffset=s+i.length,this.renderResults(this.currentResults),this.hideLoading(),this.isLoadingMore=!1}catch(n){this.hideLoading(),this.showError("Failed to search books. Please try again later."),s===0&&this.resultsContainer.empty(),this.isLoadingMore=!1}}handleScroll(){if(this.isLoadingMore||!this.hasMoreResults)return;let e=this.resultsContainer,s=e.scrollTop,n=e.scrollHeight,i=e.clientHeight;s+i>=n*.8&&this.loadMoreResults()}loadMoreResults(){if(this.isLoadingMore||!this.hasMoreResults)return;let e=this.searchInput.value.trim();e&&(this.isLoadingMore=!0,this.performSearch(e,this.currentOffset))}renderResults(e){if(this.currentOffset===e.length&&this.resultsContainer.empty(),e.length===0&&this.currentOffset===0){this.resultsContainer.createEl("div",{cls:"bookshelf-no-results",text:"No books found. Try a different search query."});return}e.forEach((s,n)=>{if(n<this.currentOffset-e.length)return;let i=this.resultsContainer.createEl("div",{cls:"bookshelf-result-item"});s.coverUrl&&i.createEl("div",{cls:"bookshelf-result-cover"}).createEl("img",{attr:{src:s.coverUrl,alt:s.title}}).setCssProps({width:"80px",height:"120px","object-fit":"cover"});let o=i.createEl("div",{cls:"bookshelf-result-info"});o.createEl("div",{cls:"bookshelf-result-title",text:s.title}),s.author&&s.author.length>0&&o.createEl("div",{cls:"bookshelf-result-author",text:`by ${s.author.join(", ")}`}),s.publishDate&&o.createEl("div",{cls:"bookshelf-result-meta",text:`Published: ${s.publishDate}`}),s.publisher&&o.createEl("div",{cls:"bookshelf-result-meta",text:`Publisher: ${s.publisher}`});let a=o.createEl("button",{cls:"mod-cta",text:"Add book"}),l=async()=>{await this.addBook(s)};a.addEventListener("click",()=>void l()),n<e.length-1&&i.createEl("hr")}),this.isLoadingMore&&this.resultsContainer.createEl("div",{cls:"bookshelf-loading-more",text:"Loading more..."}).setCssProps({"text-align":"center",padding:"16px",color:"var(--text-muted)"})}async addBook(e){try{this.setButtonsState(!0,"Adding...");let n={...await this.fetchDetailedBookInfo(e),status:this.plugin.settings.defaultStatus};await this.validateBookNotExists(n);let i=await this.bookFileCreator.create(n,this.plugin.settings.bookFolder);this.showSuccess(`Book "${n.title}" added successfully!`),this.triggerViewRefresh(i),setTimeout(()=>this.close(),1e3),this.setButtonsState(!1,"Add Book")}catch(s){this.showError(`Failed to add book: ${s instanceof Error?s.message:"Unknown error"}`),this.setButtonsState(!1,"Add Book")}}async fetchDetailedBookInfo(e){if(!e.coverEditionKey)return e;let s=await this.openLibraryClient.getBookByOLID(e.coverEditionKey);return s?{...e,...s,totalPages:s.totalPages||e.totalPages,coverUrl:s.coverUrl||e.coverUrl,title:s.title||e.title,author:s.author.length>0?s.author:e.author,publisher:s.publisher||e.publisher,publishDate:s.publishDate||e.publishDate}:e}async validateBookNotExists(e){let s=K.getBooksFolderPath(this.plugin.settings.bookFolder);if(this.bookFileReader.findExisting(s,e.title))throw new Error(`Book "${e.title}" already exists.`)}setButtonsState(e,s){this.resultsContainer.querySelectorAll("button").forEach(i=>{i.disabled=e,i.textContent=s})}triggerViewRefresh(e){try{this.app.vault.trigger("modify",e),this.app.workspace.iterateAllLeaves(s=>{var n,i;if(((i=(n=s.view)==null?void 0:n.getViewType)==null?void 0:i.call(n))==="bases"){let o=s.view;typeof o.requestUpdate=="function"?o.requestUpdate():typeof o.refresh=="function"&&o.refresh()}})}catch(s){console.debug("[Bookshelf] Error triggering Bases refresh:",s)}}showLoading(){this.loadingIndicator.setCssProps({display:"block"})}hideLoading(){this.loadingIndicator.setCssProps({display:"none"})}showError(e){let s=this.contentEl.querySelector(".bookshelf-message");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-message bookshelf-message-error"});n.createEl("div",{cls:"bookshelf-message-icon",text:"!"}),n.createEl("div",{cls:"bookshelf-message-text",text:e}),n.createEl("button",{cls:"bookshelf-message-close",text:"Dismiss"}).addEventListener("click",()=>n.remove())}hideError(){let e=this.contentEl.querySelector(".bookshelf-message");e&&e.remove()}showSuccess(e){let s=this.contentEl.querySelector(".bookshelf-message-success");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-message-success"});n.setCssProps({padding:"12px","margin-top":"16px","background-color":"transparent",color:"var(--interactive-accent)","font-size":"14px","text-align":"center","font-weight":"500"}),n.createEl("span",{text:e})}}});var Fo={};Gt(Fo,{default:()=>dn});module.exports=Xi(Fo);var ce=require("obsidian");var wr={bookFolder:"Bookshelf",apiTimeout:5e3,searchResultLimit:20,defaultSort:"date",autoUpdateTimestamp:!0,autoStatusChange:!0,showProgressNotification:!0,trackReadingHistory:!0,requireReadingNotes:!1,defaultStatus:"unread",timezone:0};var F=require("obsidian"),Qt=class extends F.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new F.Setting(t).setName("Folders").setHeading(),new F.Setting(t).setName("Book notes folder").setDesc("Folder path where book notes will be saved").addText(e=>e.setPlaceholder("Books").setValue(this.plugin.settings.bookFolder).onChange(async s=>{this.plugin.settings.bookFolder=s,await this.plugin.saveSettings()})),new F.Setting(t).setName("API").setHeading(),new F.Setting(t).setName("Timeout (ms)").setDesc("Timeout duration for open library requests (milliseconds)").addText(e=>e.setPlaceholder("5000").setValue(this.plugin.settings.apiTimeout.toString()).onChange(async s=>{let n=parseInt(s,10);!isNaN(n)&&n>0&&(this.plugin.settings.apiTimeout=n,await this.plugin.saveSettings())})),new F.Setting(t).setName("Search result limit").setDesc("Maximum number of search results to display").addText(e=>e.setPlaceholder("20").setValue(this.plugin.settings.searchResultLimit.toString()).onChange(async s=>{let n=parseInt(s,10);!isNaN(n)&&n>0&&(this.plugin.settings.searchResultLimit=n,await this.plugin.saveSettings())})),new F.Setting(t).setName("Auto update").setHeading(),new F.Setting(t).setName("Auto update timestamp").setDesc("Whether to automatically update the updated field when book information is modified").addToggle(e=>e.setValue(this.plugin.settings.autoUpdateTimestamp).onChange(async s=>{this.plugin.settings.autoUpdateTimestamp=s,await this.plugin.saveSettings(),s&&this.plugin.registerAutoUpdateTimestamp()})),new F.Setting(t).setName("Auto status change").setDesc('Automatically change status to "finished" when read_page reaches total pages').addToggle(e=>e.setValue(this.plugin.settings.autoStatusChange).onChange(async s=>{this.plugin.settings.autoStatusChange=s,await this.plugin.saveSettings()})),new F.Setting(t).setName("Show progress notification").setDesc("Show notification when progress is updated").addToggle(e=>e.setValue(this.plugin.settings.showProgressNotification).onChange(async s=>{this.plugin.settings.showProgressNotification=s,await this.plugin.saveSettings()})),new F.Setting(t).setName("Reading history").setHeading(),new F.Setting(t).setName("Track reading history").setDesc("Whether to track reading history (pages read per session)").addToggle(e=>e.setValue(this.plugin.settings.trackReadingHistory).onChange(async s=>{this.plugin.settings.trackReadingHistory=s,await this.plugin.saveSettings()})),new F.Setting(t).setName("Require reading notes").setDesc("Require notes when updating reading progress").addToggle(e=>e.setValue(this.plugin.settings.requireReadingNotes).onChange(async s=>{this.plugin.settings.requireReadingNotes=s,await this.plugin.saveSettings()})),new F.Setting(t).setName("View").setHeading(),new F.Setting(t).setName("Default sort order").setDesc("Default sort order for bookshelf view").addDropdown(e=>e.addOption("date","Date").addOption("title","Title").addOption("author","Author").addOption("progress","Progress").setValue(this.plugin.settings.defaultSort).onChange(async s=>{this.plugin.settings.defaultSort=s,await this.plugin.saveSettings()})),new F.Setting(t).setName("Default values").setHeading(),new F.Setting(t).setName("Default reading status").setDesc("Default reading status for newly added books").addDropdown(e=>e.addOption("unread","Unread").addOption("reading","Reading").setValue(this.plugin.settings.defaultStatus).onChange(async s=>{this.plugin.settings.defaultStatus=s,await this.plugin.saveSettings()})),new F.Setting(t).setName("Date & time").setHeading(),new F.Setting(t).setName("Timezone offset").setDesc("Timezone offset from UTC in hours (for example 0 for UTC, 9 for Korea, -5 for EST).").addText(e=>e.setPlaceholder("0").setValue(this.plugin.settings.timezone.toString()).onChange(async s=>{let n=parseFloat(s);!isNaN(n)&&n>=-12&&n<=14&&(this.plugin.settings.timezone=n,await this.plugin.saveSettings())}))}};Kt();function Ui(r,t){t.addCommand({id:"bookshelf-search-book",name:"Search book",callback:()=>{new Ve(r,t).open()}})}var dt=require("obsidian");function ji(r){if(r.length===0)return 0;let e=[...r].sort((s,n)=>new Date(n.date).getTime()-new Date(s.date).getTime())[0];return e?e.endPage:0}Vt();Pe();rs();Ws();_e();var ct=class{static parseFromBody(t){let e=[],s=/^##\s+Reading History\s*\n([\s\S]*?)(?=\n##|\n#|$)/m,n=t.match(s);if(!n||!n[1])return e;let i=n[1],o=/(?:^###\s+(\d{4}-\d{2}-\d{2})|^-\s+\*\*Date:\*\*\s+(\d{4}-\d{2}-\d{2}))\s*\n([\s\S]*?)(?=\n(?:###|-\s+\*\*Date:)|$)/gm,a;for(;(a=o.exec(i))!==null;){let l=a[1]||a[2]||"",c=a[3]||"",d=c.match(/(?:\*\*Start Page:\*\*|Start Page:|Start:|From:)\s*(\d+)/i),h=c.match(/(?:\*\*End Page:\*\*|End Page:|End:|To:|Page:)\s*(\d+)/i),u=c.match(/(?:\*\*Pages Read:\*\*|Pages Read:|Pages:|Read:)\s*(\d+)/i),f=c.match(/(?:\*\*Timestamp:\*\*|Timestamp:|Time:)\s*([^\n]+)/i),g,p=c.match(/(?:Notes?:|Note:)\s*\n?([\s\S]*?)(?=\n(?:Time|Timestamp)|$)/i);p&&p[1]&&(g=p[1].trim(),g===""&&(g=void 0));let m={date:l,startPage:d&&d[1]?parseInt(d[1],10):0,endPage:h&&h[1]?parseInt(h[1],10):0,pagesRead:u&&u[1]?parseInt(u[1],10):0,notes:g,timestamp:f&&f[1]?f[1].trim():void 0};m.pagesRead===0&&m.endPage>m.startPage&&(m.pagesRead=m.endPage-m.startPage),e.push(m)}return e}static updateInBody(t,e){var l,c,d;let s=[];s.push("## Reading History"),s.push("");let n=[...e].sort((h,u)=>{let f=h.timestamp||h.date||"";return(u.timestamp||u.date||"").localeCompare(f)});for(let h of n){if(s.push(`### ${h.date||"Unknown Date"}`),s.push(""),s.push(`- **Start Page:** ${(l=h.startPage)!=null?l:0}`),s.push(`- **End Page:** ${(c=h.endPage)!=null?c:0}`),s.push(`- **Pages Read:** ${(d=h.pagesRead)!=null?d:0}`),h.timestamp&&s.push(`- **Timestamp:** ${h.timestamp}`),h.notes){s.push("- **Notes:**"),s.push("");let u=h.notes.split(`
`);for(let f of u)s.push(`  ${f}`)}s.push("")}let i=s.join(`
`),o=/^##\s+Reading History\s*\n[\s\S]*?(?=\n##|\n#|$)/m,a=t;if(o.test(t))a=t.replace(o,i);else{let h=/^(##\s+[^\n]+)/m;h.test(t)?a=t.replace(h,`${i}

$1`):a=t.trim()+`

`+i}return a}static createRecord(t,e,s){let n=H();return{date:n.split(" ")[0]||n,startPage:t,endPage:e,pagesRead:Math.max(0,e-t),notes:s||void 0,timestamp:n}}};_e();var Me=class{constructor(t){this.app=t}async updateBook(t,e){let s=await this.app.vault.read(t),{frontmatter:n,body:i}=ge.extract(s),a={...ke.frontmatterToBook(n),...e},l=ke.bookToFrontmatter(a);l.updated=H();let d=`${xe.create(l)}
${i}`;await this.app.vault.modify(t,d)}async updateReadingProgress(t,e,s,n,i=!0){var y;let o=await this.app.vault.read(t),{frontmatter:a,body:l}=ge.extract(o);if(a.read_page=e,i){let b=typeof a.total=="number"?a.total:typeof a.totalPages=="number"?a.totalPages:void 0;b&&e>=b?(a.status="finished",a.read_finished||(a.read_finished=H())):e>0&&a.status==="unread"&&(a.status="reading",a.read_started||(a.read_started=H()))}a.updated=H();let c=ct.parseFromBody(l),d=c.length>0?c[c.length-1]:null,h=typeof a.read_page=="number"?a.read_page:0,u=s!==void 0?s:(y=d==null?void 0:d.endPage)!=null?y:h,f=ct.createRecord(u,e,n);c.push(f),(!a.reading_history_summary||!Array.isArray(a.reading_history_summary))&&(a.reading_history_summary=[]),a.reading_history_summary.push({date:f.date,startPage:f.startPage,endPage:f.endPage,pagesRead:f.pagesRead,timestamp:f.timestamp||"",notes:f.notes});let g=ct.updateInBody(l,c),m=`${xe.create(a)}
${g}`;await this.app.vault.modify(t,m)}};var Re=class extends dt.Modal{constructor(e,s,n){super(e);this.book=null;this.plugin=s,this.bookFileReader=new ye(e),this.bookFileUpdater=new Me(e),this.file=n!=null?n:this.app.workspace.getActiveFile()}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Update reading progress"}),this.loadBookData().then(()=>{if(!this.book){e.createEl("div",{cls:"bookshelf-error",text:"No book data found. Please open a book note first."});return}this.renderForm(e)})}onClose(){let{contentEl:e}=this;e.empty()}async loadBookData(){if(this.file)try{let e=await this.bookFileReader.read(this.file);e.title&&(this.book={title:e.title||"Unknown",subtitle:e.subtitle,author:e.author||[],isbn10:e.isbn10,isbn13:e.isbn13,publisher:e.publisher,publishDate:e.publishDate,totalPages:e.totalPages,coverUrl:e.coverUrl,category:e.category||[],status:e.status||"unread",readPage:e.readPage||0,readStarted:e.readStarted,readFinished:e.readFinished,created:e.created||new Date().toISOString(),updated:e.updated||new Date().toISOString()})}catch(e){console.error("Error loading book data:",e)}}renderForm(e){if(!this.book||!this.file)return;let s=e.createEl("div",{cls:"bookshelf-progress-book-info"});s.createEl("div",{cls:"bookshelf-progress-title",text:this.book.title}),this.book.author&&this.book.author.length>0&&s.createEl("div",{cls:"bookshelf-progress-author",text:`by ${this.book.author.join(", ")}`}),this.file&&this.app.vault.read(this.file).then(async n=>{var p;let{FrontmatterParser:i}=await Promise.resolve().then(()=>(Pe(),lt)),{frontmatter:o}=i.extract(n),l=(o.reading_history_summary||[]).map(m=>({date:m.date||"",startPage:m.startPage||0,endPage:m.endPage||0,pagesRead:m.pagesRead||0,timestamp:m.timestamp})),c=ji(l),d=((p=this.book)==null?void 0:p.readPage)||0;new dt.Setting(e).setName("Start page").setDesc("Starting page for this reading session").addText(m=>{this.startPageInput=m.inputEl,this.startPageInput.type="number",this.startPageInput.value=c>0?c.toString():(d||"0").toString(),this.startPageInput.addEventListener("input",()=>this.updateCalculations())}),new dt.Setting(e).setName("End page").setDesc("Current page you finished reading").addText(m=>{this.endPageInput=m.inputEl,this.endPageInput.type="number",this.endPageInput.value=(d||"0").toString(),this.endPageInput.addEventListener("input",()=>this.updateCalculations())});let h=e.createEl("div",{cls:"bookshelf-progress-calc"});if(h.createEl("div",{cls:"bookshelf-progress-label",text:"Pages read:"}),this.pagesReadDisplay=h.createEl("div",{cls:"bookshelf-progress-value",text:"0"}),this.book&&this.book.totalPages){let m=e.createEl("div",{cls:"bookshelf-progress-calc"});m.createEl("div",{cls:"bookshelf-progress-label",text:"Progress:"}),this.progressDisplay=m.createEl("div",{cls:"bookshelf-progress-value",text:"0%"})}let u=new dt.Setting(e).setName("Notes (optional)").setDesc("Add notes about this reading session");this.notesInput=u.controlEl.createEl("textarea",{cls:"bookshelf-notes-input"}),this.notesInput.placeholder="What did you read? Any thoughts?",this.notesInput.style.cssText=`
				width: 100%;
				min-height: 300px;
				padding: 12px;
				font-size: 14px;
				line-height: 1.6;
				font-family: var(--font-text);
				border: 1px solid var(--background-modifier-border);
				border-radius: 4px;
				background-color: var(--background-primary);
				color: var(--text-normal);
				resize: vertical;
				margin-top: 8px;
			`,this.updateCalculations(),e.createEl("div",{cls:"bookshelf-progress-buttons"}).createEl("button",{cls:"mod-cta",text:"Update progress"}).addEventListener("click",()=>{this.updateProgress()})})}updateCalculations(){var i;let e=parseInt(this.startPageInput.value,10)||0,s=parseInt(this.endPageInput.value,10)||0,n=Math.max(0,s-e);if(this.pagesReadDisplay.textContent=n.toString(),(i=this.book)!=null&&i.totalPages&&this.progressDisplay){let o=Math.min(s/this.book.totalPages*100,100);this.progressDisplay.textContent=`${Math.round(o)}%`}}async updateProgress(){let e=this.file;if(!e||!this.book)return;let s=parseInt(this.startPageInput.value,10)||0,n=parseInt(this.endPageInput.value,10)||0,i=this.notesInput.value.trim()||void 0;if(this.plugin.settings.requireReadingNotes&&!i){this.showErrorMessage("Notes are required when updating progress.");return}if(n<s){this.showErrorMessage("End page must be greater than or equal to start page.");return}try{await this.bookFileUpdater.updateReadingProgress(e,n,s,i,this.plugin.settings.autoStatusChange),this.showSuccessMessage("Progress updated successfully!")}catch(o){this.showErrorMessage(`Failed to update progress: ${o instanceof Error?o.message:"Unknown error"}`)}}showSuccessMessage(e){let s=this.contentEl.querySelector(".bookshelf-progress-success");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-progress-success"});n.setCssProps({padding:"12px","margin-top":"16px","background-color":"transparent",color:"var(--interactive-accent)","font-size":"14px","text-align":"center","font-weight":"500"}),n.createEl("span",{text:e}),setTimeout(()=>{this.close()},2e3)}showErrorMessage(e){let s=this.contentEl.querySelector(".bookshelf-message");s&&s.remove();let n=this.contentEl.createEl("div",{cls:"bookshelf-message bookshelf-message-error"});n.createEl("div",{cls:"bookshelf-message-icon",text:"!"}),n.createEl("div",{cls:"bookshelf-message-text",text:e}),n.createEl("button",{cls:"bookshelf-message-close",text:"Dismiss"}).addEventListener("click",()=>{n.remove()})}};function qi(r,t){t.addCommand({id:"bookshelf-update-progress",name:"Update reading progress",callback:()=>{let e=r.workspace.getActiveFile();new Re(r,t,e!=null?e:void 0).open()}})}function Vi(r,t){Ui(r,t),qi(r,t)}pn();ss();Pe();Ws();Kt();_e();var Hi=require("obsidian");function Oo(r){var t,e;try{let n=r.internalPlugins;if(!n)return console.debug("[Bookshelf][Bases] Internal plugins manager not available"),null;let i=(t=n.getEnabledPluginById)==null?void 0:t.call(n,"bases");return i?!i.registrations||typeof i.registrations!="object"?(console.warn("[Bookshelf][Bases] Bases plugin found but registrations API not available"),null):{registrations:i.registrations,isEnabled:!0,version:((e=i.manifest)==null?void 0:e.version)||"unknown"}:(console.debug("[Bookshelf][Bases] Bases plugin not found or not enabled"),null)}catch(s){return console.warn("[Bookshelf][Bases] Error accessing Bases plugin API:",s),null}}function Ht(r,t,e){var n;let s=r;if(typeof s.registerBasesView=="function")try{return s.registerBasesView(t,e)?(console.debug(`[Bookshelf][Bases] Successfully registered view via public API: ${t}`),!0):(console.debug("[Bookshelf][Bases] Public API returned false (Bases may be disabled)"),!1)}catch(i){let o=i;return(n=o==null?void 0:o.message)!=null&&n.includes("already exists")?(console.debug(`[Bookshelf][Bases] View ${t} already registered via public API`),!0):(console.warn(`[Bookshelf][Bases] Public API registration failed for ${t}:`,i),!1)}return console.warn("[Bookshelf][Bases] Cannot register view: Bases public API not available (requires Obsidian 1.10.0+)"),!1}function zt(r,t){let e=Oo(r.app);if(!e)return!0;try{return e.registrations[t]&&delete e.registrations[t],!0}catch(s){return console.error(`[Bookshelf][Bases] Error unregistering view ${t}:`,s),!1}}var Ki=require("obsidian");var ft=require("obsidian");Vt();var be=class extends ft.Component{constructor(e,s,n){super();this.rootElement=null;this.updateDebounceTimer=null;this.dataUpdateDebounceTimer=null;this.plugin=n,this.containerEl=s,this.bookFileReader=new ye(n.app),this.bookFileUpdater=new Me(n.app)}onload(){this.setupContainer(),requestAnimationFrame(()=>{setTimeout(()=>{var e;(e=this.rootElement)!=null&&e.isConnected&&this.render()},100)})}onDataUpdated(){var s;if(!((s=this.rootElement)!=null&&s.isConnected))return;this.dataUpdateDebounceTimer&&clearTimeout(this.dataUpdateDebounceTimer);let e=this.containerEl.ownerDocument.defaultView||window;this.dataUpdateDebounceTimer=e.setTimeout(()=>{this.dataUpdateDebounceTimer=null;try{this.render()}catch(n){console.error(`[Bookshelf][${this.type}] Render error:`,n),this.renderError(n)}},500)}onunload(){this.dataUpdateDebounceTimer&&clearTimeout(this.dataUpdateDebounceTimer),this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),super.onunload()}setupContainer(){let s=this.containerEl.ownerDocument.createElement("div");s.className="bookshelf-bases-view",s.setCssProps({display:"flex","flex-direction":"column",height:"100%",width:"100%"}),s.tabIndex=-1,this.containerEl.appendChild(s),this.rootElement=s,this.setupNewBookButton()}setupNewBookButton(){let e=0,s=10,n=()=>{e++,this.injectNewBookButton();let i=this.containerEl.closest(".bases-view"),o=i==null?void 0:i.parentElement,a=o==null?void 0:o.querySelector(".bases-toolbar");!(a==null?void 0:a.querySelector(".bookshelf-bases-new-book-btn"))&&e<s&&setTimeout(n,200)};setTimeout(n,100),this.register(()=>this.cleanupNewBookButton())}cleanupNewBookButton(){let e=this.containerEl.closest(".bases-view"),s=e==null?void 0:e.parentElement;s==null||s.classList.remove("bookshelf-view-active")}injectNewBookButton(){let e=this.containerEl.closest(".bases-view");if(!e){console.debug("[Bookshelf][Bases] No .bases-view found");return}let s=e.parentElement;if(!s){console.debug("[Bookshelf][Bases] No parent element found");return}s.classList.add("bookshelf-view-active");let n=s.querySelector(".bases-toolbar");if(!n){console.debug("[Bookshelf][Bases] No .bases-toolbar found in parent");return}if(n.querySelector(".bookshelf-bases-new-book-btn"))return;let i=this.containerEl.ownerDocument,o=i.createElement("div");o.className="bases-toolbar-item bookshelf-bases-new-book-btn";let a=i.createElement("div");a.className="text-icon-button",a.tabIndex=0;let l=i.createElement("span");l.className="text-button-icon",(0,ft.setIcon)(l,"book-plus"),a.appendChild(l);let c=i.createElement("span");c.className="text-button-label",c.textContent="New book",a.appendChild(c),o.appendChild(a);let d=async u=>{u.stopPropagation(),u.preventDefault(),u.stopImmediatePropagation();let f=this.app||this.plugin.app;if(!f){console.error("[Bookshelf][Bases] App not available");return}try{let{SearchModal:g}=await Promise.resolve().then(()=>(Kt(),gr));new g(f,this.plugin).open()}catch(g){console.error("[Bookshelf][Bases] Error opening search modal:",g)}};a.addEventListener("click",u=>{d(u)},{capture:!0,once:!1}),a.addEventListener("mousedown",u=>{u.button===0&&d(u)},{capture:!0}),a.addEventListener("keydown",u=>{(u.key==="Enter"||u.key===" ")&&(u.stopPropagation(),u.preventDefault(),d(u))});let h=n.querySelector(".bases-toolbar-new-item-menu");h?h.before(o):n.appendChild(o),console.debug("[Bookshelf][Bases] Injected New Book button into toolbar")}extractDataItems(){var s;return(s=this.data)!=null&&s.data?this.data.data.map(n=>{var o;let i=n;return(o=i==null?void 0:i.file)!=null&&o.path?{key:i.file.path,data:i,file:i.file,path:i.file.path,properties:this.extractEntryProperties(i),basesData:i}:(console.warn("[Bookshelf][BasesView] Entry missing file.path:",i),null)}).filter(n=>n!==null):(console.warn("[Bookshelf][BasesView] No data available"),[])}extractEntryProperties(e){let s={};return e.note&&Object.assign(s,e.note),e.file&&(s["file.name"]=e.file.name,s["file.path"]=e.file.path,s["file.ctime"]=e.file.ctime,s["file.mtime"]=e.file.mtime),s}async extractBooksFromBasesData(e){let s=[];for(let n of e)try{let i=n.file;if(!i||!i.path)continue;let o=this.app||this.plugin.app;if(!o)continue;let a=o.vault.getAbstractFileByPath(i.path);if(!a||!(a instanceof ft.TFile))continue;let l=await this.bookFileReader.read(a);if(l.title){let c,d;try{let g=await o.vault.read(a),{FrontmatterParser:p}=await Promise.resolve().then(()=>(Pe(),lt)),{frontmatter:m}=p.extract(g),y=m.reading_history_summary;if(y&&Array.isArray(y)&&y.length>0){let w=[...y].sort((S,v)=>{let x=S,B=v,C=x.date||x.timestamp||"";return(B.date||B.timestamp||"").localeCompare(C)})[0];w!=null&&w.date?c=w.date:w!=null&&w.timestamp&&(c=w.timestamp.split(" ")[0]),d=y.reduce((S,v)=>S+(v.pagesRead||0),0)}}catch(g){}let h=d!==void 0&&d>(l.readPage||0)?d:l.readPage,u=l.status==="unread"||l.status==="reading"||l.status==="finished"?l.status:"unread",f={title:l.title||"Unknown",subtitle:l.subtitle,author:l.author||[],isbn10:l.isbn10,isbn13:l.isbn13,publisher:l.publisher,publishDate:l.publishDate,totalPages:l.totalPages,coverUrl:l.coverUrl,category:l.category||[],status:u,readPage:h,readStarted:l.readStarted,readFinished:l.readFinished,created:l.created||new Date().toISOString(),updated:l.updated||new Date().toISOString(),lastReadDate:c};s.push({book:f,file:a})}}catch(i){console.error("[Bookshelf] Error extracting book from Bases data:",i)}return s}renderError(e){if(!this.rootElement)return;let s=this.rootElement.ownerDocument;this.rootElement.empty();let n=s.createElement("div");n.className="bookshelf-error",n.setCssProps({padding:"20px","text-align":"center",color:"var(--text-error)"}),n.textContent=`Error: ${e.message}`,this.rootElement.appendChild(n)}getEphemeralState(){var e;return{scrollTop:((e=this.rootElement)==null?void 0:e.scrollTop)||0}}setEphemeralState(e){if(!(!e||!this.rootElement||!this.rootElement.isConnected))try{let s=e;s.scrollTop!==void 0&&(this.rootElement.scrollTop=s.scrollTop)}catch(s){console.debug("[Bookshelf][Bases] Failed to restore ephemeral state:",s)}}focus(){var e;try{(e=this.rootElement)!=null&&e.isConnected&&typeof this.rootElement.focus=="function"&&this.rootElement.focus()}catch(s){console.debug("[Bookshelf][Bases] Failed to focus view:",s)}}refresh(){this.render()}onResize(){}};var ut=class{constructor(t,e,s=null,n){this.app=t,this.book=e,this.file=s,this.plugin=n||null}render(t="grid"){return this.book.status==="reading"?this.renderReadingBook(t):this.renderShelfBook(t)}renderReadingBook(t){let e=document.createElement("div");if(e.className=`bookshelf-book-card bookshelf-book-reading bookshelf-layout-${t}`,e.setCssProps({"min-height":"420px",display:"flex","flex-direction":"column"}),this.book.coverUrl){let a=e.createEl("div",{cls:"bookshelf-book-cover"});a.setCssProps({width:"100%",height:"240px","margin-bottom":"16px","flex-shrink":"0"});let l=a.createEl("img",{attr:{src:this.book.coverUrl||"",alt:this.book.title||"Book cover"}});l.setCssProps({width:"100%",height:"100%","object-fit":"cover","border-radius":"6px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.15)"}),l.addEventListener("error",()=>{l.setCssProps({display:"none"})})}let s=e.createEl("div",{cls:"bookshelf-book-info"});s.setCssProps({padding:"0 12px 12px 12px",flex:"1",display:"flex","flex-direction":"column"}),s.createEl("div",{cls:"bookshelf-book-title",text:this.book.title}).setCssProps({"font-size":"17px","font-weight":"600","margin-bottom":"8px","line-height":"1.4",color:"var(--text-normal)"}),this.book.author&&this.book.author.length>0&&s.createEl("div",{cls:"bookshelf-book-author",text:this.book.author.join(", ")}).setCssProps({"font-size":"13px",color:"var(--text-muted)","margin-bottom":"16px"});let i=this.book.lastReadDate,o=s.createEl("div",{cls:"bookshelf-reading-status"});if(o.setCssProps({"font-size":"12px",color:"var(--text-muted)","margin-bottom":"16px",padding:"12px","background-color":"var(--background-secondary)","border-radius":"6px",display:"flex","flex-direction":"column",gap:"8px"}),this.book.readStarted){let a=o.createEl("div");a.setCssProps({display:"flex","justify-content":"space-between","align-items":"center"}),a.createEl("span",{text:"Started:"}).setCssProps({color:"var(--text-faint)","font-size":"11px"});let c=typeof this.book.readStarted=="string"?this.book.readStarted.includes("T")?this.book.readStarted.split("T")[0]:this.book.readStarted.split(" ")[0]:String(this.book.readStarted);a.createEl("span",{text:c}).setCssProps({"font-weight":"600",color:"var(--text-normal)","font-size":"12px"})}else{let a=o.createEl("div");a.setCssProps({display:"flex","justify-content":"space-between","align-items":"center"}),a.createEl("span",{text:"Started:"}).setCssProps({color:"var(--text-faint)","font-size":"11px"}),a.createEl("span",{text:"Not started"}).setCssProps({"font-weight":"400",color:"var(--text-muted)","font-size":"12px","font-style":"italic"})}if(i){let a=o.createEl("div");a.setCssProps({display:"flex","justify-content":"space-between","align-items":"center"}),a.createEl("span",{text:"Last read:"}).setCssProps({color:"var(--text-faint)","font-size":"11px"}),a.createEl("span",{text:i!=null?i:""}).setCssProps({"font-weight":"700",color:"var(--interactive-accent)","font-size":"12px"})}else if(this.book.readStarted){let a=o.createEl("div");a.setCssProps({display:"flex","justify-content":"space-between","align-items":"center"}),a.createEl("span",{text:"Last read:"}).setCssProps({color:"var(--text-faint)","font-size":"11px"}),a.createEl("span",{text:"Not yet"}).setCssProps({"font-weight":"400",color:"var(--text-muted)","font-size":"12px","font-style":"italic"})}if(this.book.totalPages!==void 0&&this.book.totalPages!==null&&this.book.totalPages>0){let a=this.book.readPage||0,l=Math.min(a/this.book.totalPages*100,100),c=Math.max(0,this.book.totalPages-a),d=s.createEl("div",{cls:"bookshelf-progress-container"});d.setCssProps({"margin-bottom":"16px"});let h=d.createEl("div");h.setCssProps({display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"});let u=h.createEl("div");u.setCssProps({"font-size":"12px","font-weight":"600",color:"var(--text-normal)"}),u.textContent="Progress";let f=h.createEl("div");f.setCssProps({"font-size":"14px","font-weight":"700",color:"var(--interactive-accent)"}),f.textContent=`${Math.round(l)}%`;let g=d.createEl("div",{cls:"bookshelf-progress-bar"});g.setCssProps({width:"100%",height:"10px","background-color":"var(--background-modifier-border)","border-radius":"5px",overflow:"hidden","margin-bottom":"6px"});let p=d.createEl("div",{cls:"bookshelf-progress-fill"});p.setCssProps({width:`${l}%`,height:"100%","background-color":"var(--interactive-accent)",transition:"width 0.3s","border-radius":"5px"}),g.appendChild(p);let m=d.createEl("div");m.setCssProps({display:"flex","justify-content":"space-between","font-size":"11px",color:"var(--text-muted)"});let y=m.createEl("span");y.textContent=`Read: ${a} pages`;let b=m.createEl("span");b.textContent=`Remaining: ${c} pages`}else{let a=s.createEl("div");a.setCssProps({padding:"12px",background:"var(--background-secondary)","border-radius":"6px","margin-bottom":"16px"});let l=a.createEl("div");l.setCssProps({"font-size":"12px",color:"var(--text-muted)","text-align":"center"}),l.textContent="Please set total pages in frontmatter to track progress"}if(this.plugin&&this.file){let a=s.createEl("div",{cls:"bookshelf-card-actions"});a.setCssProps({"margin-top":"auto","padding-top":"12px"});let l=a.createEl("button",{cls:"mod-cta",text:"Update progress"});l.setCssProps({width:"100%",padding:"10px","font-size":"13px","font-weight":"600"}),l.addEventListener("click",c=>{c.stopPropagation(),new Re(this.app,this.plugin,this.file).open()})}return this.file&&(e.addEventListener("click",a=>{a.target.closest("button")||this.app.workspace.openLinkText(this.file.path,"",!1)}),e.setCssProps({cursor:"pointer"})),e}renderShelfBook(t){let e=document.createElement("div");e.className=`bookshelf-book-card bookshelf-book-shelf bookshelf-status-${this.book.status} bookshelf-layout-${t}`;let s=e.createEl("div",{cls:"bookshelf-book-spine"});return s.createEl("div",{cls:"bookshelf-spine-title",text:this.book.title}),this.book.author&&this.book.author.length>0&&s.createEl("div",{cls:"bookshelf-spine-author",text:this.book.author.join(", ")}),s.createEl("div",{cls:"bookshelf-status-badge",text:this.book.status==="finished"?"Finished":"Unread"}),this.book.status==="finished"&&this.book.readFinished&&s.createEl("div",{cls:"bookshelf-spine-meta",text:`Finished: ${this.book.readFinished.split(" ")[0]}`}),this.file&&(e.addEventListener("click",()=>{this.app.workspace.openLinkText(this.file.path,"",!1)}),e.setCssProps({cursor:"pointer"})),e}};Vt();var tn=class extends be{constructor(){super(...arguments);this.type="bookshelfView";this.books=[]}onload(){super.onload()}async render(){var e;if(this.rootElement&&(e=this.data)!=null&&e.data)try{let s=this.extractDataItems();this.books=await this.extractBooksFromBasesData(s),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][BasesView] Render error:",s),this.renderError(s)}}renderContent(){if(!this.rootElement)return;let s=this.rootElement.ownerDocument.createElement("div");s.setCssProps({flex:"1","overflow-y":"auto",padding:"12px"});let n=this.books.filter(({book:o})=>o.status==="reading"),i=this.books.filter(({book:o})=>o.status==="unread");n.sort((o,a)=>this.sortBooks(o.book,a.book)),i.sort((o,a)=>this.sortBooks(o.book,a.book)),n.length>0?this.renderReadingSection(s,n):this.renderEmptyReadingSection(s),i.length>0?this.renderUnreadSubSection(s,i):this.renderEmptyUnreadSection(s),n.length===0&&i.length===0&&(s.empty(),this.renderEmptyState(s)),this.rootElement.appendChild(s)}renderReadingSection(e,s){let n=e.ownerDocument,i=n.createElement("div");i.className="bookshelf-section-header",i.setCssProps({"margin-bottom":"16px","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"});let o=n.createElement("h2");o.textContent=`Reading (${s.length})`,o.setCssProps({margin:"0","font-size":"1.5em","font-weight":"600"}),i.appendChild(o),e.appendChild(i);let a=n.createElement("div");a.className="bookshelf-section-books bookshelf-layout-grid bookshelf-drop-zone",a.setCssProps({display:"grid","grid-template-columns":"repeat(auto-fill, minmax(280px, 1fr))",gap:"20px","min-height":"100px"});let l=u=>{u.preventDefault(),u.stopPropagation(),u.dataTransfer&&(u.dataTransfer.dropEffect="move"),a.classList.add("drag-over")},c=u=>{u.preventDefault(),u.stopPropagation(),a.classList.add("drag-over")},d=u=>{u.preventDefault(),u.stopPropagation();let f=a.getBoundingClientRect(),g=u.clientX,p=u.clientY;(g<f.left||g>f.right||p<f.top||p>f.bottom)&&a.classList.remove("drag-over")};a.addEventListener("dragover",l,!1),a.addEventListener("dragenter",c,!1),a.addEventListener("dragleave",d,!1);let h=async u=>{var f,g,p,m;u.preventDefault(),u.stopPropagation(),u.stopImmediatePropagation(),a.classList.remove("drag-over");try{let y=null;try{let b=(f=u.dataTransfer)==null?void 0:f.getData("application/bookshelf-book");b&&b.trim()&&(y=(g=JSON.parse(b).path)!=null?g:null)}catch(b){}if(!y)try{let b=(p=u.dataTransfer)==null?void 0:p.getData("text/plain");b&&b.trim()&&(y=b.trim())}catch(b){}y?await this.handleBookStatusChange(y,"reading"):console.warn("[Bookshelf] No file path found in drop data. Available types:",Array.from(((m=u.dataTransfer)==null?void 0:m.types)||[]))}catch(y){console.error("[Bookshelf] Error handling drop:",y)}};a.addEventListener("drop",u=>void h(u),!1),s.forEach(({book:u,file:f})=>{let g=this.app||this.plugin.app,m=new ut(g,u,f,this.plugin).render("grid");a.appendChild(m)}),e.appendChild(a)}async handleBookStatusChange(e,s){try{let n=this.app||this.plugin.app;if(!n)return;let i=n.vault.getAbstractFileByPath(e);if(!i||!(i instanceof Ki.TFile))return;let o=new ye(n),a=new Me(n),l={status:s};if(s==="reading"&&!(await o.read(i)).readStarted){let{getCurrentDateTime:d}=await Promise.resolve().then(()=>(_e(),xr));l.readStarted=d()}await a.updateBook(i,l),setTimeout(()=>{this.render()},300)}catch(n){console.error("[Bookshelf] Error changing book status:",n)}}renderEmptyReadingSection(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-section-header",n.setCssProps({"margin-bottom":"16px","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"});let i=s.createElement("h2");i.textContent="Reading (0)",i.setCssProps({margin:"0","font-size":"1.5em","font-weight":"600"}),n.appendChild(i),e.appendChild(n);let o=s.createElement("div");o.className="bookshelf-section-books bookshelf-layout-grid bookshelf-drop-zone",o.setCssProps({display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"60px 40px","min-height":"200px",border:"2px dashed var(--background-modifier-border)","border-radius":"8px","text-align":"center",color:"var(--text-muted)",transition:"all 0.2s"});let a=s.createElement("p");a.textContent='Drag a book from "to read" section here to start reading',a.setCssProps({margin:"0","font-size":"14px","font-weight":"500"}),o.appendChild(a);let l=s.createElement("p");l.textContent='Or click "new book" to add a new book',l.setCssProps({margin:"8px 0 0 0","font-size":"12px",color:"var(--text-faint)"}),o.appendChild(l),o.addEventListener("dragover",d=>{d.preventDefault(),d.stopPropagation(),d.dataTransfer&&(d.dataTransfer.dropEffect="move"),o.classList.add("drag-over"),o.setCssProps({"border-color":"var(--interactive-accent)","background-color":"var(--background-modifier-hover)"})}),o.addEventListener("dragenter",d=>{d.preventDefault(),d.stopPropagation(),o.classList.add("drag-over"),o.setCssProps({"border-color":"var(--interactive-accent)","background-color":"var(--background-modifier-hover)"})}),o.addEventListener("dragleave",d=>{d.preventDefault(),d.stopPropagation();let h=o.getBoundingClientRect(),u=d.clientX,f=d.clientY;(u<h.left||u>h.right||f<h.top||f>h.bottom)&&(o.classList.remove("drag-over"),o.setCssProps({"border-color":"var(--background-modifier-border)","background-color":""}))});let c=async d=>{var h,u,f;d.preventDefault(),d.stopPropagation(),o.classList.remove("drag-over"),o.setCssProps({"border-color":"var(--background-modifier-border)","background-color":""});try{let g=null,p=(h=d.dataTransfer)==null?void 0:h.getData("application/bookshelf-book");if(p)try{g=(u=JSON.parse(p).path)!=null?u:null}catch(m){}if(!g){let m=(f=d.dataTransfer)==null?void 0:f.getData("text/plain");m&&(g=m)}g?await this.handleBookStatusChange(g,"reading"):console.warn("[Bookshelf] No file path found in drop data")}catch(g){console.error("[Bookshelf] Error handling drop:",g)}};o.addEventListener("drop",d=>{c(d)}),e.appendChild(o)}renderEmptyUnreadSection(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-unread-subsection",n.setCssProps({"margin-top":"32px"});let i=s.createElement("div");i.className="bookshelf-subsection-header",i.setCssProps({display:"flex","align-items":"center","justify-content":"space-between",padding:"8px 0","border-bottom":"1px solid var(--background-modifier-border)"});let o=s.createElement("h3");o.textContent="To read (0)",o.setCssProps({margin:"0","font-size":"1.1em","font-weight":"500",color:"var(--text-muted)"}),i.appendChild(o),n.appendChild(i);let a=s.createElement("div");a.setCssProps({padding:"20px","text-align":"center",color:"var(--text-muted)"}),a.textContent="No unread books.",n.appendChild(a),e.appendChild(n)}renderUnreadSubSection(e,s){let n=e.ownerDocument,i=n.createElement("div");i.className="bookshelf-unread-subsection",i.setCssProps({"margin-top":"32px"});let o=n.createElement("div");o.className="bookshelf-subsection-header",o.setCssProps({display:"flex","align-items":"center","justify-content":"space-between",padding:"8px 0",cursor:"pointer","border-bottom":"1px solid var(--background-modifier-border)"});let a=n.createElement("h3");a.textContent=`To Read (${s.length})`,a.setCssProps({margin:"0","font-size":"1.1em","font-weight":"500",color:"var(--text-muted)"}),o.appendChild(a);let l=n.createElement("span");l.textContent="?",l.setCssProps({"font-size":"10px",color:"var(--text-muted)",transition:"transform 0.2s"}),o.appendChild(l);let c=n.createElement("div");c.className="bookshelf-unread-list",c.setCssProps({"max-height":"300px","overflow-y":"auto","margin-top":"8px"});let d=!0,h=()=>{d=!d,c.setCssProps({display:d?"block":"none"}),l.setCssProps({transform:d?"rotate(0deg)":"rotate(-90deg)"})};o.addEventListener("click",h);let u=n.createElement("ul");u.setCssProps({"list-style":"none",padding:"0",margin:"0"}),s.forEach(({book:f,file:g})=>{let p=n.createElement("li");p.className="bookshelf-unread-item",p.draggable=!0,p.dataset.bookPath=g.path,p.setCssProps({padding:"8px 12px","border-bottom":"1px solid var(--background-modifier-border)",cursor:"pointer",display:"flex","justify-content":"space-between","align-items":"center"}),p.addEventListener("click",v=>{if(v.defaultPrevented)return;let x=this.app||this.plugin.app;x&&x.workspace.openLinkText(g.path,"",!0)});let m=!1,y=v=>{m=!0,p.classList.add("dragging"),v.dataTransfer?(v.dataTransfer.effectAllowed="move",v.dataTransfer.setData("text/plain",g.path),v.dataTransfer.setData("application/bookshelf-book",JSON.stringify({path:g.path,status:"unread"}))):console.error("[Bookshelf] dataTransfer is null in dragstart")};p.addEventListener("dragstart",y,!1),p.addEventListener("dragend",v=>{m=!1,p.classList.remove("dragging"),n.querySelectorAll(".bookshelf-drop-zone").forEach(B=>{B.classList.remove("drag-over")})}),p.addEventListener("click",v=>{if(m){v.preventDefault(),v.stopPropagation(),setTimeout(()=>{m=!1},100);return}});let b=n.createElement("div");b.setCssProps({flex:"1"});let w=n.createElement("div");if(w.textContent=f.title,w.setCssProps({"font-weight":"500","font-size":"13px","margin-bottom":"2px"}),b.appendChild(w),f.author&&f.author.length>0){let v=n.createElement("div");v.textContent=f.author.join(", "),v.setCssProps({"font-size":"11px",color:"var(--text-muted)"}),b.appendChild(v)}p.appendChild(b);let S=n.createElement("span");S.textContent="",S.setCssProps({color:"var(--text-faint)","font-size":"12px","margin-left":"8px",cursor:"grab","user-select":"none"}),S.title="Drag to reading section to start reading",S.addEventListener("mousedown",v=>{v.stopPropagation()}),p.appendChild(S),u.appendChild(p)}),c.appendChild(u),i.appendChild(o),i.appendChild(c),e.appendChild(i)}sortBooks(e,s){switch(this.plugin.settings.defaultSort||"date"){case"title":return e.title.localeCompare(s.title);case"author":{let i=e.author[0]||"",o=s.author[0]||"";return i.localeCompare(o)}case"progress":{let i=e.totalPages&&e.readPage?e.readPage/e.totalPages:0;return(s.totalPages&&s.readPage?s.readPage/s.totalPages:0)-i}case"date":default:return new Date(s.created).getTime()-new Date(e.created).getTime()}}renderEmptyState(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-empty-state",n.setCssProps({display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"60px 20px","text-align":"center"});let i=s.createElement("h2");i.className="bookshelf-empty-title",i.textContent="No books added yet",i.setCssProps({margin:"0 0 8px 0","font-size":"1.5em"}),n.appendChild(i);let o=s.createElement("p");o.className="bookshelf-empty-description",o.textContent="Start building your bookshelf by searching and adding books.",o.setCssProps({margin:"0 0 24px 0",color:"var(--text-muted)"}),n.appendChild(o);let a=s.createElement("button");a.className="mod-cta",a.textContent="Search and add book";let l=async c=>{c.stopPropagation(),c.preventDefault();let d=this.app||this.plugin.app;if(!d){console.error("[Bookshelf] App not available");return}try{let{SearchModal:h}=await Promise.resolve().then(()=>(Kt(),gr));new h(d,this.plugin).open()}catch(h){console.error("[Bookshelf] Error opening search modal:",h)}};a.addEventListener("click",c=>{l(c)}),n.appendChild(a),e.appendChild(n)}};var sn=class extends be{constructor(){super(...arguments);this.type="bookshelfReadingView";this.books=[]}async render(){var e;if(!(!this.rootElement||!((e=this.data)!=null&&e.data)))try{let s=this.extractDataItems(),n=await this.extractBooksFromBasesData(s);this.books=n.filter(({book:i})=>i.status==="reading"),this.books.sort((i,o)=>{let a=i.book.totalPages&&i.book.readPage?i.book.readPage/i.book.totalPages:0;return(o.book.totalPages&&o.book.readPage?o.book.readPage/o.book.totalPages:0)-a}),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][ReadingView] Render error:",s),this.renderError(s)}}renderContent(){if(!this.rootElement)return;let e=this.rootElement.ownerDocument,s=e.createElement("div");s.className="bookshelf-header",s.setCssProps({padding:"12px","border-bottom":"1px solid var(--background-modifier-border)"});let n=e.createElement("h2");n.textContent=`Reading (${this.books.length})`,n.setCssProps({margin:"0","font-size":"1.2em"}),s.appendChild(n),this.rootElement.appendChild(s);let i=e.createElement("div");i.className="bookshelf-books-container bookshelf-layout-grid",i.setCssProps({flex:"1","overflow-y":"auto",padding:"12px",display:"grid","grid-template-columns":"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"}),this.books.length===0?this.renderEmptyState(i):this.books.forEach(({book:o,file:a})=>{let c=new ut(this.app,o,a,this.plugin).render("grid");i.appendChild(c)}),this.rootElement.appendChild(i)}renderEmptyState(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-empty-state",n.setCssProps({display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"60px 20px","text-align":"center"});let i=s.createElement("div");i.textContent="\u{1F4D6}",i.setCssProps({"font-size":"4em","margin-bottom":"16px"}),n.appendChild(i);let o=s.createElement("h2");o.textContent="No books being read",o.setCssProps({margin:"0 0 8px 0","font-size":"1.5em"}),n.appendChild(o);let a=s.createElement("p");a.textContent="Start reading a book to see it here.",a.setCssProps({margin:"0 0 24px 0",color:"var(--text-muted)"}),n.appendChild(a),e.appendChild(n)}};var nn=class extends be{constructor(e,s,n){super(e,s,n);this.type="bookshelfLibraryView";this.unreadBooks=[];this.finishedBooks=[]}async render(){var e;if(!(!this.rootElement||!((e=this.data)!=null&&e.data)))try{let s=this.extractDataItems(),n=await this.extractBooksFromBasesData(s);this.unreadBooks=n.filter(({book:i})=>i.status==="unread"),this.finishedBooks=n.filter(({book:i})=>i.status==="finished"),this.unreadBooks.sort((i,o)=>new Date(o.book.created).getTime()-new Date(i.book.created).getTime()),this.finishedBooks.sort((i,o)=>{let a=i.book.readFinished?new Date(i.book.readFinished).getTime():0;return(o.book.readFinished?new Date(o.book.readFinished).getTime():0)-a}),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][UnreadFinishedView] Render error:",s),this.renderError(s)}}renderContent(){if(!this.rootElement)return;let e=this.rootElement.ownerDocument,s=e.createElement("div");s.className="bookshelf-header",s.setCssProps({padding:"12px","border-bottom":"1px solid var(--background-modifier-border)"});let n=e.createElement("h2");n.textContent=`Unread & Finished (${this.unreadBooks.length} unread, ${this.finishedBooks.length} finished)`,n.setCssProps({margin:"0","font-size":"1.2em"}),s.appendChild(n),this.rootElement.appendChild(s);let i=e.createElement("div");if(i.setCssProps({flex:"1","overflow-y":"auto",padding:"12px"}),this.unreadBooks.length>0)this.renderSection(i,e,"Unread Books",this.unreadBooks,"unread");else{let o=e.createElement("div");o.setCssProps({"margin-top":"24px"});let a=e.createElement("div");a.setCssProps({"margin-bottom":"12px","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"});let l=e.createElement("h3");l.textContent="Unread books (0)",l.setCssProps({margin:"0","font-size":"1.2em","font-weight":"600"}),a.appendChild(l),o.appendChild(a),this.renderEmptyState(o),i.appendChild(o)}if(this.finishedBooks.length>0)this.renderSection(i,e,"Finished Books",this.finishedBooks,"finished");else{let o=e.createElement("div");o.setCssProps({"margin-top":"24px"});let a=e.createElement("div");a.setCssProps({"margin-bottom":"12px","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"});let l=e.createElement("h3");l.textContent="Finished books (0)",l.setCssProps({margin:"0","font-size":"1.2em","font-weight":"600"}),a.appendChild(l),o.appendChild(a),this.renderEmptyState(o),i.appendChild(o)}this.rootElement.appendChild(i)}renderSection(e,s,n,i,o){let a=s.createElement("div");a.setCssProps({"margin-top":"24px","margin-bottom":"12px","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"});let l=s.createElement("h3");l.textContent=`${n} (${i.length})`,l.setCssProps({margin:"0","font-size":"1.2em","font-weight":"600"}),a.appendChild(l),e.appendChild(a);let c=s.createElement("ul");c.setCssProps({"list-style":"none",padding:"0",margin:"0"}),i.forEach(({book:d,file:h})=>{let u=s.createElement("li");u.setCssProps({padding:"12px","border-bottom":"1px solid var(--background-modifier-border)",cursor:"pointer"}),u.addEventListener("click",p=>{if(p.defaultPrevented)return;let m=this.app||this.plugin.app;m&&m.workspace.openLinkText(h.path,"",!0)});let f=s.createElement("div");if(f.textContent=d.title,f.setCssProps({"font-weight":"600","font-size":"14px","margin-bottom":"4px"}),u.appendChild(f),d.author&&d.author.length>0){let p=s.createElement("div");p.textContent=d.author.join(", "),p.setCssProps({"font-size":"12px",color:"var(--text-muted)","margin-bottom":"4px"}),u.appendChild(p)}let g=s.createElement("div");if(g.setCssProps({"font-size":"11px",color:"var(--text-faint)",display:"flex",gap:"12px"}),o==="finished"&&d.readFinished){let p=s.createElement("span");p.textContent=`Finished: ${d.readFinished}`,g.appendChild(p)}else if(o==="unread"&&d.created){let p=s.createElement("span");p.textContent=`Added: ${d.created.split(" ")[0]}`,g.appendChild(p)}if(d.totalPages){let p=s.createElement("span");p.textContent=`${d.totalPages} pages`,g.appendChild(p)}u.appendChild(g),c.appendChild(u)}),e.appendChild(c)}renderEmptyState(e){let s=e.ownerDocument,n=s.createElement("div");n.className="bookshelf-empty-state",n.setCssProps({display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"40px 20px","text-align":"center"});let i=s.createElement("div");i.className="bookshelf-empty-icon",i.textContent="\u{1F4DA}",i.setCssProps({"font-size":"3em","margin-bottom":"12px"}),n.appendChild(i);let o=s.createElement("div");o.textContent="No books",o.setCssProps({margin:"0","font-size":"1.1em",color:"var(--text-muted)"}),n.appendChild(o),e.appendChild(n)}};var Yt=class{static create(t,e,s,n){let i=t.createElement("div");i.setCssProps({padding:"20px","border-radius":"8px",background:"var(--background-secondary)",border:"1px solid var(--background-modifier-border)"});let o=t.createElement("div");o.textContent=e,o.setCssProps({"font-size":"12px",color:"var(--text-muted)","margin-bottom":"8px"});let a=t.createElement("div");return a.textContent=s.toString(),a.setCssProps({"font-size":"28px","font-weight":"600",color:n}),i.appendChild(o),i.appendChild(a),i}static createDetailed(t,e,s,n,i){let o=t.createElement("div");o.setCssProps({padding:"20px","border-radius":"8px",background:"var(--background-secondary)",border:"1px solid var(--background-modifier-border)"});let a=t.createElement("div");a.textContent=e,a.setCssProps({"font-size":"12px",color:"var(--text-muted)","margin-bottom":"4px"});let l=t.createElement("div");l.textContent=s,l.setCssProps({"font-size":"10px",color:"var(--text-faint)","margin-bottom":"8px"});let c=t.createElement("div");return c.textContent=n.toString(),c.setCssProps({"font-size":"28px","font-weight":"600",color:i}),o.appendChild(a),o.appendChild(l),o.appendChild(c),o}};var Wt=class{static create(t,e){let s=t.createElement("h2");return s.textContent=e,s.setCssProps({margin:"0 0 16px 0","font-size":"1.4em","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"}),s}static createToggleable(t,e,s){let n=!0,i=t.createElement("div");i.setCssProps({display:"flex","align-items":"center","justify-content":"space-between",cursor:"pointer",margin:"0 0 16px 0","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"});let o=t.createElement("h2");o.textContent=e,o.setCssProps({margin:"0","font-size":"1.4em"});let a=t.createElement("span");return a.textContent="?",a.setCssProps({"font-size":"12px",color:"var(--text-muted)",transition:"transform 0.2s"}),i.appendChild(o),i.appendChild(a),i.addEventListener("click",()=>{n=!n,a.setCssProps({transform:n?"rotate(0deg)":"rotate(-90deg)"}),s(n)}),{header:i,isExpanded:n}}};var Ke=class{static renderBarChart(t,e,s){if(s.length===0){this.renderEmptyChart(t,e,"Category");return}let n=Math.max(...s.map(i=>i.value));s.forEach(i=>{let o=e.createElement("div");o.setCssProps({"margin-bottom":"12px"});let a=e.createElement("div");a.setCssProps({display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"4px"});let l=e.createElement("span");l.textContent=i.label,l.setCssProps({"font-size":"12px",color:"var(--text-normal)"});let c=e.createElement("span");c.textContent=i.value.toString(),c.setCssProps({"font-size":"12px","font-weight":"600",color:"var(--text-accent)"}),a.appendChild(l),a.appendChild(c);let d=e.createElement("div");d.setCssProps({width:"100%",height:"8px","background-color":"var(--background-modifier-border)","border-radius":"4px",overflow:"hidden"});let h=e.createElement("div"),u=n>0?i.value/n*100:0;h.setCssProps({width:`${u}%`,height:"100%","background-color":"var(--interactive-accent)",transition:"width 0.3s"}),d.appendChild(h),o.appendChild(a),o.appendChild(d),t.appendChild(o)})}static renderLineChart(t,e,s,n){if(s.length===0){this.renderEmptyChart(t,e,n);return}let i=Math.max(...s.map(u=>u.value)),o=200,a=40,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width","100%"),l.setAttribute("height",o.toString()),l.setCssProps({display:"block"});let c=[],d=600,h=(d-a*2)/Math.max(s.length-1,1);if(s.forEach((u,f)=>{let g=a+f*h,p=i>0?o-a-u.value/i*(o-a*2):o-a;c.push({x:g,y:p,label:u.label,value:u.value})}),l.setAttribute("viewBox",`0 0 ${d} ${o}`),l.setAttribute("preserveAspectRatio","xMidYMid meet"),c.length>1){let u=c.map((g,p)=>p===0?`M ${g.x} ${g.y}`:`L ${g.x} ${g.y}`).join(" "),f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",u),f.setAttribute("fill","none"),f.setAttribute("stroke","var(--interactive-accent)"),f.setAttribute("stroke-width","2"),l.appendChild(f)}c.forEach(u=>{let f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("cx",u.x.toString()),f.setAttribute("cy",u.y.toString()),f.setAttribute("r","4"),f.setAttribute("fill","var(--interactive-accent)"),l.appendChild(f);let g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",u.x.toString()),g.setAttribute("y",(o-10).toString()),g.setAttribute("text-anchor","middle"),g.setAttribute("fill","var(--text-muted)"),g.setAttribute("font-size","10"),g.textContent=u.label,l.appendChild(g);let p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",u.x.toString()),p.setAttribute("y",(u.y-10).toString()),p.setAttribute("text-anchor","middle"),p.setAttribute("fill","var(--text-normal)"),p.setAttribute("font-size","10"),p.setAttribute("font-weight","600"),p.textContent=u.value.toString(),l.appendChild(p)}),t.appendChild(l)}static renderEmptyChart(t,e,s){let n=e.createElement("div");n.setCssProps({display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"200px",color:"var(--text-muted)"});let i=e.createElement("div");i.textContent="\u{1F4CA}",i.setCssProps({"font-size":"3em","margin-bottom":"8px"});let o=e.createElement("div"),a=s.toLowerCase();o.textContent=a?`No ${a} data available`:"No data available",o.setCssProps({"font-size":"14px"}),n.appendChild(i),n.appendChild(o),t.appendChild(n)}};var Y=class{static create(t,e){let s=t.createElement("div");s.setCssProps({padding:"16px",background:"var(--background-secondary)","border-radius":"8px",border:"1px solid var(--background-modifier-border)",minWidth:"0"});let n=t.createElement("h3");n.textContent=e,n.setCssProps({margin:"0 0 12px 0","font-size":"0.9em",color:"var(--text-muted)"}),s.appendChild(n);let i=t.createElement("div");return i.setCssProps({height:"200px",position:"relative",width:"100%",minWidth:"0"}),s.appendChild(i),{container:s,chartEl:i}}static createDetailsPanel(t,e){let s=t.createElement("div");s.setCssProps({padding:"16px",background:"var(--background-secondary)","border-radius":"8px",border:"1px solid var(--background-modifier-border)"});let n=t.createElement("h3");n.textContent=e,n.setCssProps({margin:"0 0 12px 0","font-size":"0.9em",color:"var(--text-muted)"}),s.appendChild(n);let i=t.createElement("div");return s.appendChild(i),{container:s,listEl:i}}};var yr={padding:"6px 16px",border:"none","border-radius":"4px",background:"var(--interactive-accent)",color:"var(--text-on-accent)","font-size":"13px","font-weight":"600",cursor:"pointer"},br={padding:"6px 16px",border:"none","border-radius":"4px",background:"transparent",color:"var(--text-muted)","font-size":"13px","font-weight":"600",cursor:"pointer"},rn=class{static create(t,e,s){let n=t.createElement("div");n.setCssProps({display:"flex",gap:"4px",background:"var(--background-secondary)","border-radius":"6px",padding:"4px"});let i=t.createElement("button");i.textContent=e,i.setCssProps(yr);let o=t.createElement("button");return o.textContent=s,o.setCssProps(br),n.appendChild(i),n.appendChild(o),{container:n,yearButton:i,monthButton:o,setActive:l=>{l==="year"?(i.setCssProps(yr),o.setCssProps(br)):(o.setCssProps(yr),i.setCssProps(br))}}}};var Jt=class{static create(t,e){var c;let s=t.createElement("div");s.setCssProps({display:"flex","justify-content":"space-between","align-items":"center",padding:"8px 0","border-bottom":"1px solid var(--background-modifier-border)"});let n=t.createElement("div");n.setCssProps({display:"flex","flex-direction":"column",gap:"4px"});let i=t.createElement("span");if(i.textContent=e.label,i.setCssProps({"font-size":"14px","font-weight":"600"}),n.appendChild(i),e.changeText!==void 0){let d=t.createElement("span");d.textContent=e.changeText,d.setCssProps({"font-size":"11px",color:(c=e.changeColor)!=null?c:"var(--text-muted)"}),n.appendChild(d)}let o=t.createElement("div");o.setCssProps({display:"flex","flex-direction":"column",gap:"2px","align-items":"flex-end"});let a=t.createElement("span");a.textContent=e.rightPrimary,a.setCssProps({"font-size":"14px",color:"var(--text-muted)"});let l=t.createElement("span");return l.textContent=e.rightSecondary,l.setCssProps({"font-size":"11px",color:"var(--text-faint)"}),o.appendChild(a),o.appendChild(l),s.appendChild(n),s.appendChild(o),s}};var on=class extends be{constructor(e,s,n){super(e,s,n);this.type="bookshelfStatisticsView";this.books=[];this.stats=null}async render(){var e;if(!(!this.rootElement||!((e=this.data)!=null&&e.data)))try{let s=this.extractDataItems();this.books=await this.extractBooksFromBasesData(s),this.stats=await this.calculateStatistics(),this.rootElement.empty(),this.renderContent()}catch(s){console.error("[Bookshelf][StatisticsView] Render error:",s),this.renderError(s)}}async calculateStatistics(){let e={totalBooks:this.books.length,reading:0,unread:0,finished:0,totalPages:0,readPages:0,totalReadingDays:0,averageTimeToFinish:0,categoryCounts:{},yearlyStats:{},monthlyStats:{}},s=[],n=new Set;for(let{book:a,file:l}of this.books){if(a.status==="reading"?e.reading++:a.status==="unread"?e.unread++:a.status==="finished"&&(e.finished++,s.push(a)),a.totalPages&&(e.totalPages+=a.totalPages),a.readPage&&(e.readPages+=a.readPage),a.status==="finished"&&a.category&&a.category.length>0&&a.category.forEach(c=>{e.categoryCounts[c]=(e.categoryCounts[c]||0)+1}),a.status==="finished"&&a.readFinished){let c=new Date(a.readFinished),d=c.getFullYear().toString(),h=`${d}-${String(c.getMonth()+1).padStart(2,"0")}`;e.yearlyStats[d]||(e.yearlyStats[d]={count:0,pages:0,readingDays:0,averageTimeToFinish:0}),e.yearlyStats[d].count++,a.totalPages&&(e.yearlyStats[d].pages+=a.totalPages),e.monthlyStats[h]||(e.monthlyStats[h]={count:0,pages:0,readingDays:0,averageTimeToFinish:0}),e.monthlyStats[h].count++,a.totalPages&&(e.monthlyStats[h].pages+=a.totalPages);let u=new Set;if(a.readStarted){let p=new Date(a.readStarted).toISOString().split("T")[0];p&&u.add(p)}try{let g=await this.plugin.app.vault.read(l),{FrontmatterParser:p}=await Promise.resolve().then(()=>(Pe(),lt)),{frontmatter:m}=p.extract(g),y=m.reading_history_summary;y&&Array.isArray(y)&&y.forEach(b=>{b&&typeof b=="object"&&"date"in b&&typeof b.date=="string"&&u.add(b.date)})}catch(g){}let f=u.size;e.yearlyStats[d].readingDays+=f,e.yearlyStats[d].averageTimeToFinish+=f,e.monthlyStats[h].readingDays+=f,e.monthlyStats[h].averageTimeToFinish+=f}if(a.readStarted&&l){let d=new Date(a.readStarted).toISOString().split("T")[0];d&&n.add(d);try{let h=await this.plugin.app.vault.read(l),{FrontmatterParser:u}=await Promise.resolve().then(()=>(Pe(),lt)),{frontmatter:f}=u.extract(h),g=f.reading_history_summary;g&&Array.isArray(g)&&g.forEach(p=>{p&&typeof p=="object"&&"date"in p&&typeof p.date=="string"&&n.add(p.date)})}catch(h){}}}e.totalReadingDays=n.size;let i=Object.keys(e.yearlyStats).sort();for(let a=0;a<i.length;a++){let l=i[a];if(!l)continue;let c=e.yearlyStats[l];if(c&&(c.count>0&&(c.averageTimeToFinish=Math.round(c.averageTimeToFinish/c.count)),a>0)){let d=i[a-1],h=d?e.yearlyStats[d]:null;h&&(c.change=c.count-h.count,c.changePercent=h.count>0?Math.round(c.change/h.count*100):c.count>0?100:0)}}let o=Object.keys(e.monthlyStats).sort();for(let a=0;a<o.length;a++){let l=o[a];if(!l)continue;let c=e.monthlyStats[l];if(c&&(c.count>0&&(c.averageTimeToFinish=Math.round(c.averageTimeToFinish/c.count)),a>0)){let d=o[a-1],h=d?e.monthlyStats[d]:null;h&&(c.change=c.count-h.count,c.changePercent=h.count>0?Math.round(c.change/h.count*100):c.count>0?100:0)}}if(s.length>0){let a=0,l=0;for(let c of this.books)if(c.book.status==="finished")try{let d=await this.plugin.app.vault.read(c.file),{FrontmatterParser:h}=await Promise.resolve().then(()=>(Pe(),lt)),{frontmatter:u}=h.extract(d),f=u.reading_history_summary,g=new Set;if(c.book.readStarted){let y=new Date(c.book.readStarted).toISOString().split("T")[0];y&&g.add(y)}f&&Array.isArray(f)&&f.forEach(m=>{m&&typeof m=="object"&&"date"in m&&typeof m.date=="string"&&g.add(m.date)});let p=g.size;p>0&&(a+=p,l++)}catch(d){}e.averageTimeToFinish=l>0?Math.round(a/l):0}return e}renderContent(){if(!this.rootElement||!this.stats)return;let e=this.rootElement.ownerDocument,s=e.createElement("div");s.setCssProps({padding:"20px","overflow-y":"auto",height:"100%"});let n=e.createElement("h1");n.textContent="Reading statistics",n.setCssProps({margin:"0 0 32px 0","font-size":"1.8em"}),s.appendChild(n),this.renderOverallSection(s,e),this.renderTimeBasedSection(s,e),this.renderCategorySection(s,e),this.rootElement.appendChild(s)}renderOverallSection(e,s){let n=s.createElement("div");n.setCssProps({"margin-bottom":"40px"});let i=Wt.create(s,"Overall Statistics");n.appendChild(i);let o=s.createElement("div");o.setCssProps({display:"grid","grid-template-columns":"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px","margin-bottom":"16px"}),[{label:"Total Finished Books",value:this.stats.finished,color:"var(--interactive-success)"},{label:"Total Pages Read",value:this.stats.readPages.toLocaleString(),color:"var(--interactive-accent)"},{label:"Total Reading Days",value:this.stats.totalReadingDays,color:"var(--text-accent)"}].forEach(d=>{let h=Yt.create(s,d.label,d.value,d.color);o.appendChild(h)}),n.appendChild(o);let l=this.stats.averageTimeToFinish>0?`${this.stats.averageTimeToFinish} sessions`:"No data available",c=Yt.createDetailed(s,"Average Days to Finish","Average number of reading sessions to complete a book",l,"var(--interactive-accent)");n.appendChild(c),e.appendChild(n)}renderTimeBasedSection(e,s){let n=s.createElement("div");n.setCssProps({"margin-bottom":"40px"});let i=s.createElement("div");i.setCssProps({display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px","padding-bottom":"8px","border-bottom":"2px solid var(--background-modifier-border)"});let o=s.createElement("h2");o.textContent="Time-based statistics",o.setCssProps({margin:"0","font-size":"1.4em"}),i.appendChild(o);let{container:a,yearButton:l,monthButton:c,setActive:d}=rn.create(s,"Yearly","Monthly");i.appendChild(a),n.appendChild(i);let h=s.createElement("div");h.setCssProps({position:"relative"}),this.renderYearlyContent(h,s),l.addEventListener("click",()=>{d("year"),h.empty(),this.renderYearlyContent(h,s)}),c.addEventListener("click",()=>{d("month"),h.empty(),this.renderMonthlyContent(h,s)}),n.appendChild(h),e.appendChild(n)}renderYearlyContent(e,s){let n=Object.keys(this.stats.yearlyStats).sort().reverse(),i=s.createElement("div");i.setCssProps({display:"grid","grid-template-columns":"repeat(auto-fit, minmax(300px, 1fr))",gap:"16px","margin-bottom":"16px"});let o=["Finished Books","Pages Read","Reading Days"];if(n.length===0){o.forEach(u=>{let{container:f,chartEl:g}=Y.create(s,u);Ke.renderEmptyChart(g,s,"Year"),i.appendChild(f)}),e.appendChild(i);return}let a=Y.create(s,"Finished Books");this.renderLineChart(a.chartEl,s,n.map(u=>{let f=this.stats.yearlyStats[u];return{label:u,value:f?f.count:0,change:f==null?void 0:f.change,changePercent:f==null?void 0:f.changePercent}}),"Year"),i.appendChild(a.container);let l=Y.create(s,"Pages Read");this.renderLineChart(l.chartEl,s,n.map(u=>{let f=this.stats.yearlyStats[u];return{label:u,value:f?f.pages:0}}),"Year"),i.appendChild(l.container);let c=Y.create(s,"Reading Days");this.renderLineChart(c.chartEl,s,n.map(u=>{let f=this.stats.yearlyStats[u];return{label:u,value:f?f.readingDays:0}}),"Year"),i.appendChild(c.container),e.appendChild(i);let{container:d,listEl:h}=Y.createDetailsPanel(s,"Details");n.forEach(u=>{let f=this.stats.yearlyStats[u];if(!f)return;let g=f.change!==void 0&&f.changePercent!==void 0?`${f.change>=0?"+":""}${f.change} (${f.changePercent!==void 0?(f.change>=0?"+":"")+f.changePercent+"%":""})`:void 0,p=f.change!==void 0&&f.change>=0?"var(--interactive-success)":"var(--text-error)",m=Jt.create(s,{label:u,changeText:g,changeColor:p,rightPrimary:`${f.count} books, ${f.pages.toLocaleString()} pages`,rightSecondary:`${f.readingDays} reading days, Avg: ${f.averageTimeToFinish} sessions`});h.appendChild(m)}),e.appendChild(d)}monthLabel(e){let s=e.split("-"),n=s[0]||"",i=s[1]||"1";return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(i,10)-1]||"Jan"} ${n}`}renderMonthlyContent(e,s){let n=Object.keys(this.stats.monthlyStats).sort().reverse().slice(0,12),i=s.createElement("div");i.setCssProps({display:"grid","grid-template-columns":"repeat(auto-fit, minmax(300px, 1fr))",gap:"16px","margin-bottom":"16px"});let o=["Finished Books (Last 12)","Pages Read (Last 12)","Reading Days (Last 12)"];if(n.length===0){o.forEach(u=>{let{container:f,chartEl:g}=Y.create(s,u);Ke.renderEmptyChart(g,s,"Month"),i.appendChild(f)}),e.appendChild(i);return}let a=Y.create(s,"Finished Books (Last 12)");this.renderLineChart(a.chartEl,s,n.map(u=>{let f=this.stats.monthlyStats[u];return{label:this.monthLabel(u),value:f?f.count:0,change:f==null?void 0:f.change,changePercent:f==null?void 0:f.changePercent}}),"Month"),i.appendChild(a.container);let l=Y.create(s,"Pages Read (Last 12)");this.renderLineChart(l.chartEl,s,n.map(u=>{let f=this.stats.monthlyStats[u];return{label:this.monthLabel(u),value:f?f.pages:0}}),"Month"),i.appendChild(l.container);let c=Y.create(s,"Reading Days (Last 12)");this.renderLineChart(c.chartEl,s,n.map(u=>{let f=this.stats.monthlyStats[u];return{label:this.monthLabel(u),value:f?f.readingDays:0}}),"Month"),i.appendChild(c.container),e.appendChild(i);let{container:d,listEl:h}=Y.createDetailsPanel(s,"Details");n.forEach(u=>{let f=this.stats.monthlyStats[u];if(!f)return;let g=this.monthLabel(u),p=f.change!==void 0&&f.changePercent!==void 0?`${f.change>=0?"+":""}${f.change} (${f.changePercent!==void 0?(f.change>=0?"+":"")+f.changePercent+"%":""})`:void 0,m=f.change!==void 0&&f.change>=0?"var(--interactive-success)":"var(--text-error)",y=Jt.create(s,{label:g,changeText:p,changeColor:m,rightPrimary:`${f.count} books, ${f.pages.toLocaleString()} pages`,rightSecondary:`${f.readingDays} reading days, Avg: ${f.averageTimeToFinish} sessions`});h.appendChild(y)}),e.appendChild(d)}renderCategorySection(e,s){let n=s.createElement("div");n.setCssProps({"margin-bottom":"40px"});let i=Wt.create(s,"Category Statistics");n.appendChild(i);let o=Object.entries(this.stats.categoryCounts).sort((l,c)=>c[1]-l[1]).slice(0,10),a=Y.create(s,"Books by Category (Top 10)");a.container.setCssProps({"max-width":"600px"}),o.length===0?Ke.renderEmptyChart(a.chartEl,s,"Category"):Ke.renderBarChart(a.chartEl,s,o.map(([l,c])=>({label:l,value:c}))),n.appendChild(a.container),e.appendChild(n)}renderLineChart(e,s,n,i){if(n.length===0)return;let o=[...n].reverse(),a=Math.max(...o.map(m=>m.value),1),l=200,c=600,d=40,h=c-d*2,u=l-d*2,f=s.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("width","100%"),f.setAttribute("height",`${l}px`),f.setAttribute("viewBox",`0 0 ${c} ${l}`),f.setAttribute("preserveAspectRatio","xMidYMid meet"),f.setCssProps({display:"block"});let g=[];if(o.forEach((m,y)=>{let b=d+y/(o.length-1||1)*h,w=d+u-m.value/a*u;g.push(`${b},${w}`)}),g.length>1){let m=s.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",`M ${g.join(" L ")}`),m.setAttribute("fill","none"),m.setAttribute("stroke","var(--interactive-accent)"),m.setAttribute("stroke-width","2"),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),f.appendChild(m)}o.forEach((m,y)=>{let b=d+y/(o.length-1||1)*h,w=d+u-m.value/a*u,S=s.createElementNS("http://www.w3.org/2000/svg","circle");if(S.setAttribute("cx",b.toString()),S.setAttribute("cy",w.toString()),S.setAttribute("r","4"),S.setAttribute("fill","var(--interactive-accent)"),f.appendChild(S),m.value>0){let x=s.createElementNS("http://www.w3.org/2000/svg","text");x.setAttribute("x",b.toString()),x.setAttribute("y",(w-10).toString()),x.setAttribute("text-anchor","middle"),x.setAttribute("font-size","11"),x.setAttribute("fill","var(--text-normal)"),x.setAttribute("font-weight","600"),x.textContent=m.value.toString(),f.appendChild(x)}if(m.change!==void 0&&m.change!==0){let x=m.change>0,B=w-20,C=s.createElementNS("http://www.w3.org/2000/svg","path");x?C.setAttribute("d",`M ${b} ${B} L ${b-4} ${B+6} L ${b+4} ${B+6} Z`):C.setAttribute("d",`M ${b} ${B+6} L ${b-4} ${B} L ${b+4} ${B} Z`),C.setAttribute("fill",x?"var(--interactive-success)":"var(--text-error)"),f.appendChild(C)}let v=s.createElementNS("http://www.w3.org/2000/svg","text");v.setAttribute("x",b.toString()),v.setAttribute("y",(l-10).toString()),v.setAttribute("text-anchor","middle"),v.setAttribute("font-size","9"),v.setAttribute("fill","var(--text-muted)"),v.textContent=m.label.length>8?m.label.substring(0,8)+"...":m.label,f.appendChild(v)});let p=5;for(let m=0;m<=p;m++){let y=a/p*m,b=d+u-m/p*u,w=s.createElementNS("http://www.w3.org/2000/svg","line");w.setAttribute("x1",d.toString()),w.setAttribute("y1",b.toString()),w.setAttribute("x2",(d+h).toString()),w.setAttribute("y2",b.toString()),w.setAttribute("stroke","var(--background-modifier-border)"),w.setAttribute("stroke-width","1"),w.setAttribute("stroke-dasharray","2,2"),f.insertBefore(w,f.firstChild);let S=s.createElementNS("http://www.w3.org/2000/svg","text");S.setAttribute("x",(d-5).toString()),S.setAttribute("y",(b+4).toString()),S.setAttribute("text-anchor","end"),S.setAttribute("font-size","9"),S.setAttribute("fill","var(--text-muted)"),S.textContent=Math.round(y).toString(),f.insertBefore(S,f.firstChild)}e.appendChild(f)}renderEmptyChart(e,s,n){let d=s.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("width","100%"),d.setAttribute("height","200px"),d.setAttribute("viewBox","0 0 600 200"),d.setAttribute("preserveAspectRatio","xMidYMid meet"),d.setCssProps({display:"block"});let h=5;for(let p=0;p<=h;p++){let m=p,y=160-p/h*120,b=s.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("x1","40"),b.setAttribute("y1",y.toString()),b.setAttribute("x2","560"),b.setAttribute("y2",y.toString()),b.setAttribute("stroke","var(--background-modifier-border)"),b.setAttribute("stroke-width","1"),b.setAttribute("stroke-dasharray","2,2"),d.appendChild(b);let w=s.createElementNS("http://www.w3.org/2000/svg","text");w.setAttribute("x","35"),w.setAttribute("y",(y+4).toString()),w.setAttribute("text-anchor","end"),w.setAttribute("font-size","9"),w.setAttribute("fill","var(--text-muted)"),w.textContent=m.toString(),d.appendChild(w)}let u=s.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1","40"),u.setAttribute("y1","160"),u.setAttribute("x2","560"),u.setAttribute("y2","160"),u.setAttribute("stroke","var(--text-muted)"),u.setAttribute("stroke-width","1"),d.appendChild(u);let f=s.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1","40"),f.setAttribute("y1","40"),f.setAttribute("x2","40"),f.setAttribute("y2","160"),f.setAttribute("stroke","var(--text-muted)"),f.setAttribute("stroke-width","1"),d.appendChild(f);let g=s.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",(40+520/2).toString()),g.setAttribute("y",(40+120/2).toString()),g.setAttribute("text-anchor","middle"),g.setAttribute("font-size","14"),g.setAttribute("fill","var(--text-muted)"),g.setAttribute("font-style","italic"),g.textContent="No data available",d.appendChild(g),e.appendChild(d)}};async function zi(r){if(!(0,Hi.requireApiVersion)("1.10.1")){console.warn("[Bookshelf][Bases] Obsidian 1.10.1+ required for Bases integration");return}let t=()=>{try{let e=Ht(r,"bookshelfView",{name:"Bookshelf View",icon:"book-open",factory:(o,a)=>new tn(o,a,r)}),s=Ht(r,"bookshelfReadingView",{name:"Reading Books",icon:"book-open-text",factory:(o,a)=>new sn(o,a,r)}),n=Ht(r,"bookshelfLibraryView",{name:"Library",icon:"library",factory:(o,a)=>new nn(o,a,r)}),i=Ht(r,"bookshelfStatisticsView",{name:"Reading Statistics",icon:"bar-chart",factory:(o,a)=>new on(o,a,r)});return!e&&!s&&!n&&!i?(console.debug("[Bookshelf][Bases] Bases plugin not available for registration"),!1):(r.app.workspace.iterateAllLeaves(o=>{var a,l;if(((l=(a=o.view)==null?void 0:a.getViewType)==null?void 0:l.call(a))==="bases"){let c=o.view;if(typeof c.refresh=="function")try{c.refresh()}catch(d){console.debug("[Bookshelf][Bases] Error refreshing view:",d)}}}),!0)}catch(e){return console.warn("[Bookshelf][Bases] Registration attempt failed:",e),!1}};if(!t()){for(let e=0;e<5;e++)if(await new Promise(s=>setTimeout(s,200)),t())return;console.warn("[Bookshelf][Bases] Failed to register views after multiple attempts")}}function Yi(r){try{zt(r,"bookshelfView"),zt(r,"bookshelfReadingView"),zt(r,"bookshelfLibraryView"),zt(r,"bookshelfStatisticsView")}catch(t){console.error("[Bookshelf][Bases] Error during view unregistration:",t)}}var an=class{static generate(t){return`filters:
  and:
    - file.path.startsWith("${`${t.bookFolder}/Books`}/")
    - file.path.endsWith(".md")
    - note.status == "reading" || note.status == "unread"

order:
  - note.status
  - note.read_page
  - file.ctime

columns:
  - id: file.name
    display-name: Title
    type: text
  - id: note.author
    display-name: Author
    type: list
  - id: note.status
    display-name: Status
    type: text
  - id: note.read_page
    display-name: Progress
    type: number
  - id: note.total
    display-name: Total Pages
    type: number

views:
  - type: bookshelfView
    name: Bookshelf
`}};var ln=class{static generate(t){return`filters:
  and:
    - file.path.startsWith("${`${t.bookFolder}/Books`}/")
    - file.path.endsWith(".md")
    - note.status == "unread" || note.status == "finished"

order:
  - note.status
  - file.ctime

columns:
  - id: file.name
    display-name: Title
    type: text
  - id: note.author
    display-name: Author
    type: list
  - id: note.status
    display-name: Status
    type: text
  - id: note.total
    display-name: Total Pages
    type: number
  - id: file.ctime
    display-name: Added
    type: date
  - id: note.read_finished
    display-name: Finished
    type: date

views:
  - type: bookshelfLibraryView
    name: Library
`}};var cn=class{static generate(t){return`filters:
  and:
    - file.path.startsWith("${`${t.bookFolder}/Books`}/")
    - file.path.endsWith(".md")

views:
  - type: bookshelfStatisticsView
    name: Statistics
`}};var dn=class extends ce.Plugin{async onload(){await this.loadSettings(),ns(this.settings.timezone);let t=new He(this.app);try{await t.ensureFolder(this.settings.bookFolder),await t.ensureFolder(K.getBooksFolderPath(this.settings.bookFolder)),await t.ensureFolder(K.getInteractionFolderPath(this.settings.bookFolder)),await t.ensureFolder(K.getViewsFolderPath(this.settings.bookFolder)),await this.ensureDefaultBaseFiles()}catch(s){console.error("Failed to initialize Bookshelf folders:",s)}this.addSettingTab(new Qt(this.app,this)),Vi(this.app,this),await zi(this),this.addCommand({id:"open-view",name:"Open view",callback:()=>{this.activateView()}}),this.addRibbonIcon("book-open-text","Open bookshelf",()=>{this.activateView()}),this.addRibbonIcon("book-plus","Search and add book",()=>{new Ve(this.app,this).open()}),this.registerEvent(this.app.workspace.on("file-open",s=>{s instanceof ce.TFile&&this.addProgressButtonToNote(s)}));let e=this.app.workspace.getActiveFile();e&&this.addProgressButtonToNote(e),this.settings.autoUpdateTimestamp&&this.registerAutoUpdateTimestamp()}addProgressButtonToNote(t){if(!t||t.extension!=="md")return;let e=K.getBooksFolderPath(this.settings.bookFolder);t.path.startsWith(e)&&setTimeout(()=>{let s=this.app.workspace.getActiveViewOfType(ce.MarkdownView);if(!s)return;let n=s.containerEl;if(!n)return;let i=n.querySelector(".bookshelf-action-container");if(!i){let a=n.querySelector(".view-header")||n.querySelector(".view-header-title-container");if(a)i=a;else{let l=n.querySelector(".markdown-source-view")||n.querySelector(".markdown-preview-view");if(!l)return;let c=l.createEl("div",{cls:"bookshelf-action-container"});l.firstChild&&l.insertBefore(c,l.firstChild),i=c}}if(i.querySelector(".bookshelf-progress-button"))return;i.createEl("button",{cls:"bookshelf-progress-button mod-cta",text:"Update progress"}).addEventListener("click",()=>{let a=this.app.workspace.getActiveFile();a&&new Re(this.app,this,a).open()})},200)}onunload(){Yi(this)}registerAutoUpdateTimestamp(){let t=K.getBooksFolderPath(this.settings.bookFolder);this.registerEvent(this.app.vault.on("modify",async e=>{if(!(!(e instanceof ce.TFile)||e.extension!=="md"||!e.path.startsWith(t))&&this.settings.autoUpdateTimestamp)try{let s=await this.app.vault.read(e),{frontmatter:n,body:i}=ge.extract(s);if(!n.title)return;n.updated=H();let a=`${xe.create(n)}
${i}`;s!==a&&await this.app.vault.modify(e,a)}catch(s){console.debug("Auto-update timestamp error:",s)}}))}async activateView(){let{workspace:t}=this.app,e=K.getViewsFolderPath(this.settings.bookFolder),s=(0,ce.normalizePath)(`${e}/bookshelf-default.base`),n=this.app.vault.getAbstractFileByPath(s);if(n&&n instanceof ce.TFile){let i=t.getRightLeaf(!1)||t.getLeaf(!0);await i.openFile(n),await t.revealLeaf(i)}}async ensureDefaultBaseFiles(){let t=K.getViewsFolderPath(this.settings.bookFolder),e=[{path:`${t}/bookshelf-default.base`,generator:an},{path:`${t}/library.base`,generator:ln},{path:`${t}/statistics.base`,generator:cn}];for(let{path:s,generator:n}of e){let i=(0,ce.normalizePath)(s);if(!this.app.vault.getAbstractFileByPath(i))try{let a=n.generate(this.settings);await this.app.vault.create(i,a)}catch(a){console.error(`[Bookshelf] Failed to create ${i}:`,a)}}}async loadSettings(){this.settings=Object.assign({},wr,await this.loadData())}async saveSettings(){await this.saveData(this.settings),ns(this.settings.timezone)}};
